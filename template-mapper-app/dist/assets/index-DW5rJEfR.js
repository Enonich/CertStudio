var wd=f=>{throw TypeError(f)};var Ac=(f,e,t)=>e.has(f)||wd("Cannot "+t);var Bn=(f,e,t)=>(Ac(f,e,"read from private field"),t?t.call(f):e.get(f)),cr=(f,e,t)=>e.has(f)?wd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(f):e.set(f,t),ea=(f,e,t,s)=>(Ac(f,e,"write to private field"),s?s.call(f,t):e.set(f,t),t),vo=(f,e,t)=>(Ac(f,e,"access private method"),t);var bd=(f,e,t,s)=>({set _(r){ea(f,e,r,t)},get _(){return Bn(f,e,s)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function Kd(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Sc={exports:{}},ta={},_c={exports:{}},ze={};var Ad;function eg(){if(Ad)return ze;Ad=1;var f=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function v(M){return M===null||typeof M!="object"?null:(M=y&&M[y]||M["@@iterator"],typeof M=="function"?M:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,_={};function T(M,B,ae){this.props=M,this.context=B,this.refs=_,this.updater=ae||b}T.prototype.isReactComponent={},T.prototype.setState=function(M,B){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,B,"setState")},T.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function k(){}k.prototype=T.prototype;function F(M,B,ae){this.props=M,this.context=B,this.refs=_,this.updater=ae||b}var z=F.prototype=new k;z.constructor=F,S(z,T.prototype),z.isPureReactComponent=!0;var H=Array.isArray,$=Object.prototype.hasOwnProperty,G={current:null},X={key:!0,ref:!0,__self:!0,__source:!0};function ie(M,B,ae){var ye,ve={},Ae=null,ge=null;if(B!=null)for(ye in B.ref!==void 0&&(ge=B.ref),B.key!==void 0&&(Ae=""+B.key),B)$.call(B,ye)&&!X.hasOwnProperty(ye)&&(ve[ye]=B[ye]);var me=arguments.length-2;if(me===1)ve.children=ae;else if(1<me){for(var We=Array(me),ht=0;ht<me;ht++)We[ht]=arguments[ht+2];ve.children=We}if(M&&M.defaultProps)for(ye in me=M.defaultProps,me)ve[ye]===void 0&&(ve[ye]=me[ye]);return{$$typeof:f,type:M,key:Ae,ref:ge,props:ve,_owner:G.current}}function de(M,B){return{$$typeof:f,type:M.type,key:B,ref:M.ref,props:M.props,_owner:M._owner}}function K(M){return typeof M=="object"&&M!==null&&M.$$typeof===f}function ke(M){var B={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(ae){return B[ae]})}var Re=/\/+/g;function Be(M,B){return typeof M=="object"&&M!==null&&M.key!=null?ke(""+M.key):B.toString(36)}function Ne(M,B,ae,ye,ve){var Ae=typeof M;(Ae==="undefined"||Ae==="boolean")&&(M=null);var ge=!1;if(M===null)ge=!0;else switch(Ae){case"string":case"number":ge=!0;break;case"object":switch(M.$$typeof){case f:case e:ge=!0}}if(ge)return ge=M,ve=ve(ge),M=ye===""?"."+Be(ge,0):ye,H(ve)?(ae="",M!=null&&(ae=M.replace(Re,"$&/")+"/"),Ne(ve,B,ae,"",function(ht){return ht})):ve!=null&&(K(ve)&&(ve=de(ve,ae+(!ve.key||ge&&ge.key===ve.key?"":(""+ve.key).replace(Re,"$&/")+"/")+M)),B.push(ve)),1;if(ge=0,ye=ye===""?".":ye+":",H(M))for(var me=0;me<M.length;me++){Ae=M[me];var We=ye+Be(Ae,me);ge+=Ne(Ae,B,ae,We,ve)}else if(We=v(M),typeof We=="function")for(M=We.call(M),me=0;!(Ae=M.next()).done;)Ae=Ae.value,We=ye+Be(Ae,me++),ge+=Ne(Ae,B,ae,We,ve);else if(Ae==="object")throw B=String(M),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.");return ge}function Qe(M,B,ae){if(M==null)return M;var ye=[],ve=0;return Ne(M,ye,"","",function(Ae){return B.call(ae,Ae,ve++)}),ye}function J(M){if(M._status===-1){var B=M._result;B=B(),B.then(function(ae){(M._status===0||M._status===-1)&&(M._status=1,M._result=ae)},function(ae){(M._status===0||M._status===-1)&&(M._status=2,M._result=ae)}),M._status===-1&&(M._status=0,M._result=B)}if(M._status===1)return M._result.default;throw M._result}var ee={current:null},U={transition:null},re={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:U,ReactCurrentOwner:G};function Y(){throw Error("act(...) is not supported in production builds of React.")}return ze.Children={map:Qe,forEach:function(M,B,ae){Qe(M,function(){B.apply(this,arguments)},ae)},count:function(M){var B=0;return Qe(M,function(){B++}),B},toArray:function(M){return Qe(M,function(B){return B})||[]},only:function(M){if(!K(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},ze.Component=T,ze.Fragment=t,ze.Profiler=r,ze.PureComponent=F,ze.StrictMode=s,ze.Suspense=h,ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=re,ze.act=Y,ze.cloneElement=function(M,B,ae){if(M==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+M+".");var ye=S({},M.props),ve=M.key,Ae=M.ref,ge=M._owner;if(B!=null){if(B.ref!==void 0&&(Ae=B.ref,ge=G.current),B.key!==void 0&&(ve=""+B.key),M.type&&M.type.defaultProps)var me=M.type.defaultProps;for(We in B)$.call(B,We)&&!X.hasOwnProperty(We)&&(ye[We]=B[We]===void 0&&me!==void 0?me[We]:B[We])}var We=arguments.length-2;if(We===1)ye.children=ae;else if(1<We){me=Array(We);for(var ht=0;ht<We;ht++)me[ht]=arguments[ht+2];ye.children=me}return{$$typeof:f,type:M.type,key:ve,ref:Ae,props:ye,_owner:ge}},ze.createContext=function(M){return M={$$typeof:l,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},M.Provider={$$typeof:o,_context:M},M.Consumer=M},ze.createElement=ie,ze.createFactory=function(M){var B=ie.bind(null,M);return B.type=M,B},ze.createRef=function(){return{current:null}},ze.forwardRef=function(M){return{$$typeof:c,render:M}},ze.isValidElement=K,ze.lazy=function(M){return{$$typeof:g,_payload:{_status:-1,_result:M},_init:J}},ze.memo=function(M,B){return{$$typeof:p,type:M,compare:B===void 0?null:B}},ze.startTransition=function(M){var B=U.transition;U.transition={};try{M()}finally{U.transition=B}},ze.unstable_act=Y,ze.useCallback=function(M,B){return ee.current.useCallback(M,B)},ze.useContext=function(M){return ee.current.useContext(M)},ze.useDebugValue=function(){},ze.useDeferredValue=function(M){return ee.current.useDeferredValue(M)},ze.useEffect=function(M,B){return ee.current.useEffect(M,B)},ze.useId=function(){return ee.current.useId()},ze.useImperativeHandle=function(M,B,ae){return ee.current.useImperativeHandle(M,B,ae)},ze.useInsertionEffect=function(M,B){return ee.current.useInsertionEffect(M,B)},ze.useLayoutEffect=function(M,B){return ee.current.useLayoutEffect(M,B)},ze.useMemo=function(M,B){return ee.current.useMemo(M,B)},ze.useReducer=function(M,B,ae){return ee.current.useReducer(M,B,ae)},ze.useRef=function(M){return ee.current.useRef(M)},ze.useState=function(M){return ee.current.useState(M)},ze.useSyncExternalStore=function(M,B,ae){return ee.current.useSyncExternalStore(M,B,ae)},ze.useTransition=function(){return ee.current.useTransition()},ze.version="18.3.1",ze}var Sd;function Wc(){return Sd||(Sd=1,_c.exports=eg()),_c.exports}var _d;function tg(){if(_d)return ta;_d=1;var f=Wc(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(c,h,p){var g,y={},v=null,b=null;p!==void 0&&(v=""+p),h.key!==void 0&&(v=""+h.key),h.ref!==void 0&&(b=h.ref);for(g in h)s.call(h,g)&&!o.hasOwnProperty(g)&&(y[g]=h[g]);if(c&&c.defaultProps)for(g in h=c.defaultProps,h)y[g]===void 0&&(y[g]=h[g]);return{$$typeof:e,type:c,key:v,ref:b,props:y,_owner:r.current}}return ta.Fragment=t,ta.jsx=l,ta.jsxs=l,ta}var xd;function ng(){return xd||(xd=1,Sc.exports=tg()),Sc.exports}var x=ng(),he=Wc();const ig=Kd(he);var wo={},xc={exports:{}},cn={},Ec={exports:{}},Cc={};var Ed;function sg(){return Ed||(Ed=1,(function(f){function e(U,re){var Y=U.length;U.push(re);e:for(;0<Y;){var M=Y-1>>>1,B=U[M];if(0<r(B,re))U[M]=re,U[Y]=B,Y=M;else break e}}function t(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var re=U[0],Y=U.pop();if(Y!==re){U[0]=Y;e:for(var M=0,B=U.length,ae=B>>>1;M<ae;){var ye=2*(M+1)-1,ve=U[ye],Ae=ye+1,ge=U[Ae];if(0>r(ve,Y))Ae<B&&0>r(ge,ve)?(U[M]=ge,U[Ae]=Y,M=Ae):(U[M]=ve,U[ye]=Y,M=ye);else if(Ae<B&&0>r(ge,Y))U[M]=ge,U[Ae]=Y,M=Ae;else break e}}return re}function r(U,re){var Y=U.sortIndex-re.sortIndex;return Y!==0?Y:U.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;f.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();f.unstable_now=function(){return l.now()-c}}var h=[],p=[],g=1,y=null,v=3,b=!1,S=!1,_=!1,T=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(U){for(var re=t(p);re!==null;){if(re.callback===null)s(p);else if(re.startTime<=U)s(p),re.sortIndex=re.expirationTime,e(h,re);else break;re=t(p)}}function H(U){if(_=!1,z(U),!S)if(t(h)!==null)S=!0,J($);else{var re=t(p);re!==null&&ee(H,re.startTime-U)}}function $(U,re){S=!1,_&&(_=!1,k(ie),ie=-1),b=!0;var Y=v;try{for(z(re),y=t(h);y!==null&&(!(y.expirationTime>re)||U&&!ke());){var M=y.callback;if(typeof M=="function"){y.callback=null,v=y.priorityLevel;var B=M(y.expirationTime<=re);re=f.unstable_now(),typeof B=="function"?y.callback=B:y===t(h)&&s(h),z(re)}else s(h);y=t(h)}if(y!==null)var ae=!0;else{var ye=t(p);ye!==null&&ee(H,ye.startTime-re),ae=!1}return ae}finally{y=null,v=Y,b=!1}}var G=!1,X=null,ie=-1,de=5,K=-1;function ke(){return!(f.unstable_now()-K<de)}function Re(){if(X!==null){var U=f.unstable_now();K=U;var re=!0;try{re=X(!0,U)}finally{re?Be():(G=!1,X=null)}}else G=!1}var Be;if(typeof F=="function")Be=function(){F(Re)};else if(typeof MessageChannel<"u"){var Ne=new MessageChannel,Qe=Ne.port2;Ne.port1.onmessage=Re,Be=function(){Qe.postMessage(null)}}else Be=function(){T(Re,0)};function J(U){X=U,G||(G=!0,Be())}function ee(U,re){ie=T(function(){U(f.unstable_now())},re)}f.unstable_IdlePriority=5,f.unstable_ImmediatePriority=1,f.unstable_LowPriority=4,f.unstable_NormalPriority=3,f.unstable_Profiling=null,f.unstable_UserBlockingPriority=2,f.unstable_cancelCallback=function(U){U.callback=null},f.unstable_continueExecution=function(){S||b||(S=!0,J($))},f.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<U?Math.floor(1e3/U):5},f.unstable_getCurrentPriorityLevel=function(){return v},f.unstable_getFirstCallbackNode=function(){return t(h)},f.unstable_next=function(U){switch(v){case 1:case 2:case 3:var re=3;break;default:re=v}var Y=v;v=re;try{return U()}finally{v=Y}},f.unstable_pauseExecution=function(){},f.unstable_requestPaint=function(){},f.unstable_runWithPriority=function(U,re){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var Y=v;v=U;try{return re()}finally{v=Y}},f.unstable_scheduleCallback=function(U,re,Y){var M=f.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?M+Y:M):Y=M,U){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=Y+B,U={id:g++,callback:re,priorityLevel:U,startTime:Y,expirationTime:B,sortIndex:-1},Y>M?(U.sortIndex=Y,e(p,U),t(h)===null&&U===t(p)&&(_?(k(ie),ie=-1):_=!0,ee(H,Y-M))):(U.sortIndex=B,e(h,U),S||b||(S=!0,J($))),U},f.unstable_shouldYield=ke,f.unstable_wrapCallback=function(U){var re=v;return function(){var Y=v;v=re;try{return U.apply(this,arguments)}finally{v=Y}}}})(Cc)),Cc}var Cd;function rg(){return Cd||(Cd=1,Ec.exports=sg()),Ec.exports}var kd;function ag(){if(kd)return cn;kd=1;var f=Wc(),e=rg();function t(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function o(n,i){l(n,i),l(n+"Capture",i)}function l(n,i){for(r[n]=i,n=0;n<i.length;n++)s.add(i[n])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},y={};function v(n){return h.call(y,n)?!0:h.call(g,n)?!1:p.test(n)?y[n]=!0:(g[n]=!0,!1)}function b(n,i,a,u){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return u?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function S(n,i,a,u){if(i===null||typeof i>"u"||b(n,i,a,u))return!0;if(u)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function _(n,i,a,u,d,m,A){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=u,this.attributeNamespace=d,this.mustUseProperty=a,this.propertyName=n,this.type=i,this.sanitizeURL=m,this.removeEmptyString=A}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){T[n]=new _(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];T[i]=new _(i,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){T[n]=new _(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){T[n]=new _(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){T[n]=new _(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){T[n]=new _(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){T[n]=new _(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){T[n]=new _(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){T[n]=new _(n,5,!1,n.toLowerCase(),null,!1,!1)});var k=/[\-:]([a-z])/g;function F(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(k,F);T[i]=new _(i,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(k,F);T[i]=new _(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(k,F);T[i]=new _(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){T[n]=new _(n,1,!1,n.toLowerCase(),null,!1,!1)}),T.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){T[n]=new _(n,1,!1,n.toLowerCase(),null,!0,!0)});function z(n,i,a,u){var d=T.hasOwnProperty(i)?T[i]:null;(d!==null?d.type!==0:u||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(S(i,a,d,u)&&(a=null),u||d===null?v(i)&&(a===null?n.removeAttribute(i):n.setAttribute(i,""+a)):d.mustUseProperty?n[d.propertyName]=a===null?d.type===3?!1:"":a:(i=d.attributeName,u=d.attributeNamespace,a===null?n.removeAttribute(i):(d=d.type,a=d===3||d===4&&a===!0?"":""+a,u?n.setAttributeNS(u,i,a):n.setAttribute(i,a))))}var H=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$=Symbol.for("react.element"),G=Symbol.for("react.portal"),X=Symbol.for("react.fragment"),ie=Symbol.for("react.strict_mode"),de=Symbol.for("react.profiler"),K=Symbol.for("react.provider"),ke=Symbol.for("react.context"),Re=Symbol.for("react.forward_ref"),Be=Symbol.for("react.suspense"),Ne=Symbol.for("react.suspense_list"),Qe=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),U=Symbol.iterator;function re(n){return n===null||typeof n!="object"?null:(n=U&&n[U]||n["@@iterator"],typeof n=="function"?n:null)}var Y=Object.assign,M;function B(n){if(M===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);M=i&&i[1]||""}return`
`+M+n}var ae=!1;function ye(n,i){if(!n||ae)return"";ae=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(O){var u=O}Reflect.construct(n,[],i)}else{try{i.call()}catch(O){u=O}n.call(i.prototype)}else{try{throw Error()}catch(O){u=O}n()}}catch(O){if(O&&u&&typeof O.stack=="string"){for(var d=O.stack.split(`
`),m=u.stack.split(`
`),A=d.length-1,C=m.length-1;1<=A&&0<=C&&d[A]!==m[C];)C--;for(;1<=A&&0<=C;A--,C--)if(d[A]!==m[C]){if(A!==1||C!==1)do if(A--,C--,0>C||d[A]!==m[C]){var P=`
`+d[A].replace(" at new "," at ");return n.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",n.displayName)),P}while(1<=A&&0<=C);break}}}finally{ae=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?B(n):""}function ve(n){switch(n.tag){case 5:return B(n.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return n=ye(n.type,!1),n;case 11:return n=ye(n.type.render,!1),n;case 1:return n=ye(n.type,!0),n;default:return""}}function Ae(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case X:return"Fragment";case G:return"Portal";case de:return"Profiler";case ie:return"StrictMode";case Be:return"Suspense";case Ne:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case ke:return(n.displayName||"Context")+".Consumer";case K:return(n._context.displayName||"Context")+".Provider";case Re:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Qe:return i=n.displayName||null,i!==null?i:Ae(n.type)||"Memo";case J:i=n._payload,n=n._init;try{return Ae(n(i))}catch{}}return null}function ge(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ae(i);case 8:return i===ie?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function me(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function We(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function ht(n){var i=We(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),u=""+n[i];if(!n.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var d=a.get,m=a.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return d.call(this)},set:function(A){u=""+A,m.call(this,A)}}),Object.defineProperty(n,i,{enumerable:a.enumerable}),{getValue:function(){return u},setValue:function(A){u=""+A},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function jt(n){n._valueTracker||(n._valueTracker=ht(n))}function _i(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var a=i.getValue(),u="";return n&&(u=We(n)?n.checked?"true":"false":n.value),n=u,n!==a?(i.setValue(n),!0):!1}function Lt(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Ke(n,i){var a=i.checked;return Y({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function Xt(n,i){var a=i.defaultValue==null?"":i.defaultValue,u=i.checked!=null?i.checked:i.defaultChecked;a=me(i.value!=null?i.value:a),n._wrapperState={initialChecked:u,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function tt(n,i){i=i.checked,i!=null&&z(n,"checked",i,!1)}function wt(n,i){tt(n,i);var a=me(i.value),u=i.type;if(a!=null)u==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(u==="submit"||u==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?qe(n,i.type,a):i.hasOwnProperty("defaultValue")&&qe(n,i.type,me(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function Ns(n,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var u=i.type;if(!(u!=="submit"&&u!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,a||i===n.value||(n.value=i),n.defaultValue=i}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function qe(n,i,a){(i!=="number"||Lt(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var ai=Array.isArray;function xi(n,i,a,u){if(n=n.options,i){i={};for(var d=0;d<a.length;d++)i["$"+a[d]]=!0;for(a=0;a<n.length;a++)d=i.hasOwnProperty("$"+n[a].value),n[a].selected!==d&&(n[a].selected=d),d&&u&&(n[a].defaultSelected=!0)}else{for(a=""+me(a),i=null,d=0;d<n.length;d++){if(n[d].value===a){n[d].selected=!0,u&&(n[d].defaultSelected=!0);return}i!==null||n[d].disabled||(i=n[d])}i!==null&&(i.selected=!0)}}function Ki(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(t(91));return Y({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function vr(n,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(t(92));if(ai(a)){if(1<a.length)throw Error(t(93));a=a[0]}i=a}i==null&&(i=""),a=i}n._wrapperState={initialValue:me(a)}}function Oe(n,i){var a=me(i.value),u=me(i.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),i.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),u!=null&&(n.defaultValue=""+u)}function oi(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function ya(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tn(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?ya(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Qi,Ls=(function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,u,d){MSApp.execUnsafeLocalFunction(function(){return n(i,a,u,d)})}:n})(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(Qi=Qi||document.createElement("div"),Qi.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Qi.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Rn(n,i){if(i){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=i;return}}n.textContent=i}var li={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wn=["Webkit","ms","Moz","O"];Object.keys(li).forEach(function(n){wn.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),li[i]=li[n]})});function Is(n,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||li.hasOwnProperty(n)&&li[n]?(""+i).trim():i+"px"}function Zi(n,i){n=n.style;for(var a in i)if(i.hasOwnProperty(a)){var u=a.indexOf("--")===0,d=Is(a,i[a],u);a==="float"&&(a="cssFloat"),u?n.setProperty(a,d):n[a]=d}}var wr=Y({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Mn(n,i){if(i){if(wr[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(t(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(t(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(t(61))}if(i.style!=null&&typeof i.style!="object")throw Error(t(62))}}function Ji(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ei=null;function es(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Nn=null,ci=null,qt=null;function ts(n){if(n=zr(n)){if(typeof Nn!="function")throw Error(t(280));var i=n.stateNode;i&&(i=Na(i),Nn(n.stateNode,n.type,i))}}function Vn(n){ci?qt?qt.push(n):qt=[n]:ci=n}function ns(){if(ci){var n=ci,i=qt;if(qt=ci=null,ts(n),i)for(n=0;n<i.length;n++)ts(i[n])}}function Ci(n,i){return n(i)}function is(){}var ui=!1;function ss(n,i,a){if(ui)return n(i,a);ui=!0;try{return Ci(n,i,a)}finally{ui=!1,(ci!==null||qt!==null)&&(is(),ns())}}function Ln(n,i){var a=n.stateNode;if(a===null)return null;var u=Na(a);if(u===null)return null;a=u[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(n=n.type,u=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!u;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(t(231,i,typeof a));return a}var _t=!1;if(c)try{var nn={};Object.defineProperty(nn,"passive",{get:function(){_t=!0}}),window.addEventListener("test",nn,nn),window.removeEventListener("test",nn,nn)}catch{_t=!1}function $o(n,i,a,u,d,m,A,C,P){var O=Array.prototype.slice.call(arguments,3);try{i.apply(a,O)}catch(W){this.onError(W)}}var Z=!1,gt=null,Wn=!1,rs=null,Uo={onError:function(n){Z=!0,gt=n}};function Vo(n,i,a,u,d,m,A,C,P){Z=!1,gt=null,$o.apply(Uo,arguments)}function Wo(n,i,a,u,d,m,A,C,P){if(Vo.apply(this,arguments),Z){if(Z){var O=gt;Z=!1,gt=null}else throw Error(t(198));Wn||(Wn=!0,rs=O)}}function zt(n){var i=n,a=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,(i.flags&4098)!==0&&(a=i.return),n=i.return;while(n)}return i.tag===3?a:null}function ki(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function Fs(n){if(zt(n)!==n)throw Error(t(188))}function br(n){var i=n.alternate;if(!i){if(i=zt(n),i===null)throw Error(t(188));return i!==n?null:n}for(var a=n,u=i;;){var d=a.return;if(d===null)break;var m=d.alternate;if(m===null){if(u=d.return,u!==null){a=u;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===a)return Fs(d),n;if(m===u)return Fs(d),i;m=m.sibling}throw Error(t(188))}if(a.return!==u.return)a=d,u=m;else{for(var A=!1,C=d.child;C;){if(C===a){A=!0,a=d,u=m;break}if(C===u){A=!0,u=d,a=m;break}C=C.sibling}if(!A){for(C=m.child;C;){if(C===a){A=!0,a=m,u=d;break}if(C===u){A=!0,u=m,a=d;break}C=C.sibling}if(!A)throw Error(t(189))}}if(a.alternate!==u)throw Error(t(190))}if(a.tag!==3)throw Error(t(188));return a.stateNode.current===a?n:i}function va(n){return n=br(n),n!==null?wa(n):null}function wa(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=wa(n);if(i!==null)return i;n=n.sibling}return null}var Ye=e.unstable_scheduleCallback,Ds=e.unstable_cancelCallback,ba=e.unstable_shouldYield,Go=e.unstable_requestPaint,ot=e.unstable_now,Xo=e.unstable_getCurrentPriorityLevel,Ar=e.unstable_ImmediatePriority,Aa=e.unstable_UserBlockingPriority,Os=e.unstable_NormalPriority,as=e.unstable_LowPriority,js=e.unstable_IdlePriority,Yt=null,bn=null;function Sa(n){if(bn&&typeof bn.onCommitFiberRoot=="function")try{bn.onCommitFiberRoot(Yt,n,void 0,(n.current.flags&128)===128)}catch{}}var Ze=Math.clz32?Math.clz32:qo,hi=Math.log,di=Math.LN2;function qo(n){return n>>>=0,n===0?32:31-(hi(n)/di|0)|0}var zs=64,os=4194304;function Gn(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Xn(n,i){var a=n.pendingLanes;if(a===0)return 0;var u=0,d=n.suspendedLanes,m=n.pingedLanes,A=a&268435455;if(A!==0){var C=A&~d;C!==0?u=Gn(C):(m&=A,m!==0&&(u=Gn(m)))}else A=a&~d,A!==0?u=Gn(A):m!==0&&(u=Gn(m));if(u===0)return 0;if(i!==0&&i!==u&&(i&d)===0&&(d=u&-u,m=i&-i,d>=m||d===16&&(m&4194240)!==0))return i;if((u&4)!==0&&(u|=a&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=u;0<i;)a=31-Ze(i),d=1<<a,u|=n[a],i&=~d;return u}function Ti(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Yo(n,i){for(var a=n.suspendedLanes,u=n.pingedLanes,d=n.expirationTimes,m=n.pendingLanes;0<m;){var A=31-Ze(m),C=1<<A,P=d[A];P===-1?((C&a)===0||(C&u)!==0)&&(d[A]=Ti(C,i)):P<=i&&(n.expiredLanes|=C),m&=~C}}function Sr(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function _r(){var n=zs;return zs<<=1,(zs&4194240)===0&&(zs=64),n}function qn(n){for(var i=[],a=0;31>a;a++)i.push(n);return i}function ls(n,i,a){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-Ze(i),n[i]=a}function cs(n,i){var a=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var u=n.eventTimes;for(n=n.expirationTimes;0<a;){var d=31-Ze(a),m=1<<d;i[d]=0,u[d]=-1,n[d]=-1,a&=~m}}function Pi(n,i){var a=n.entangledLanes|=i;for(n=n.entanglements;a;){var u=31-Ze(a),d=1<<u;d&i|n[u]&i&&(n[u]|=i),a&=~d}}var Ue=0;function Hs(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Tt,An,xr,Er,_a,Cr=!1,Bs=[],Yn=null,Kn=null,Qn=null,us=new Map,w=new Map,E=[],R="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function I(n,i){switch(n){case"focusin":case"focusout":Yn=null;break;case"dragenter":case"dragleave":Kn=null;break;case"mouseover":case"mouseout":Qn=null;break;case"pointerover":case"pointerout":us.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":w.delete(i.pointerId)}}function j(n,i,a,u,d,m){return n===null||n.nativeEvent!==m?(n={blockedOn:i,domEventName:a,eventSystemFlags:u,nativeEvent:m,targetContainers:[d]},i!==null&&(i=zr(i),i!==null&&An(i)),n):(n.eventSystemFlags|=u,i=n.targetContainers,d!==null&&i.indexOf(d)===-1&&i.push(d),n)}function te(n,i,a,u,d){switch(i){case"focusin":return Yn=j(Yn,n,i,a,u,d),!0;case"dragenter":return Kn=j(Kn,n,i,a,u,d),!0;case"mouseover":return Qn=j(Qn,n,i,a,u,d),!0;case"pointerover":var m=d.pointerId;return us.set(m,j(us.get(m)||null,n,i,a,u,d)),!0;case"gotpointercapture":return m=d.pointerId,w.set(m,j(w.get(m)||null,n,i,a,u,d)),!0}return!1}function Te(n){var i=ps(n.target);if(i!==null){var a=zt(i);if(a!==null){if(i=a.tag,i===13){if(i=ki(a),i!==null){n.blockedOn=i,_a(n.priority,function(){xr(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function _e(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var a=It(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var u=new a.constructor(a.type,a);Ei=u,a.target.dispatchEvent(u),Ei=null}else return i=zr(a),i!==null&&An(i),n.blockedOn=a,!1;i.shift()}return!0}function Ce(n,i,a){_e(n)&&a.delete(i)}function je(){Cr=!1,Yn!==null&&_e(Yn)&&(Yn=null),Kn!==null&&_e(Kn)&&(Kn=null),Qn!==null&&_e(Qn)&&(Qn=null),us.forEach(Ce),w.forEach(Ce)}function Se(n,i){n.blockedOn===i&&(n.blockedOn=null,Cr||(Cr=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,je)))}function st(n){function i(d){return Se(d,n)}if(0<Bs.length){Se(Bs[0],n);for(var a=1;a<Bs.length;a++){var u=Bs[a];u.blockedOn===n&&(u.blockedOn=null)}}for(Yn!==null&&Se(Yn,n),Kn!==null&&Se(Kn,n),Qn!==null&&Se(Qn,n),us.forEach(i),w.forEach(i),a=0;a<E.length;a++)u=E[a],u.blockedOn===n&&(u.blockedOn=null);for(;0<E.length&&(a=E[0],a.blockedOn===null);)Te(a),a.blockedOn===null&&E.shift()}var Le=H.ReactCurrentBatchConfig,Ge=!0;function nt(n,i,a,u){var d=Ue,m=Le.transition;Le.transition=null;try{Ue=1,Ie(n,i,a,u)}finally{Ue=d,Le.transition=m}}function se(n,i,a,u){var d=Ue,m=Le.transition;Le.transition=null;try{Ue=4,Ie(n,i,a,u)}finally{Ue=d,Le.transition=m}}function Ie(n,i,a,u){if(Ge){var d=It(n,i,a,u);if(d===null)hl(n,i,u,Pt,a),I(n,u);else if(te(d,n,i,a,u))u.stopPropagation();else if(I(n,u),i&4&&-1<R.indexOf(n)){for(;d!==null;){var m=zr(d);if(m!==null&&Tt(m),m=It(n,i,a,u),m===null&&hl(n,i,u,Pt,a),m===d)break;d=m}d!==null&&u.stopPropagation()}else hl(n,i,u,null,a)}}var Pt=null;function It(n,i,a,u){if(Pt=null,n=es(u),n=ps(n),n!==null)if(i=zt(n),i===null)n=null;else if(a=i.tag,a===13){if(n=ki(i),n!==null)return n;n=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return Pt=n,null}function Ft(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xo()){case Ar:return 1;case Aa:return 4;case Os:case as:return 16;case js:return 536870912;default:return 16}default:return 16}}var Je=null,Zn=null,In=null;function hs(){if(In)return In;var n,i=Zn,a=i.length,u,d="value"in Je?Je.value:Je.textContent,m=d.length;for(n=0;n<a&&i[n]===d[n];n++);var A=a-n;for(u=1;u<=A&&i[a-u]===d[m-u];u++);return In=d.slice(n,1<u?1-u:void 0)}function ds(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function fs(){return!0}function kr(){return!1}function fn(n){function i(a,u,d,m,A){this._reactName=a,this._targetInst=d,this.type=u,this.nativeEvent=m,this.target=A,this.currentTarget=null;for(var C in n)n.hasOwnProperty(C)&&(a=n[C],this[C]=a?a(m):m[C]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?fs:kr,this.isPropagationStopped=kr,this}return Y(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=fs)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=fs)},persist:function(){},isPersistent:fs}),i}var $s={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ko=fn($s),Tr=Y({},$s,{view:0,detail:0}),kf=fn(Tr),Qo,Zo,Pr,xa=Y({},Tr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:el,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Pr&&(Pr&&n.type==="mousemove"?(Qo=n.screenX-Pr.screenX,Zo=n.screenY-Pr.screenY):Zo=Qo=0,Pr=n),Qo)},movementY:function(n){return"movementY"in n?n.movementY:Zo}}),lu=fn(xa),Tf=Y({},xa,{dataTransfer:0}),Pf=fn(Tf),Rf=Y({},Tr,{relatedTarget:0}),Jo=fn(Rf),Mf=Y({},$s,{animationName:0,elapsedTime:0,pseudoElement:0}),Nf=fn(Mf),Lf=Y({},$s,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),If=fn(Lf),Ff=Y({},$s,{data:0}),cu=fn(Ff),Df={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Of={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zf(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=jf[n])?!!i[n]:!1}function el(){return zf}var Hf=Y({},Tr,{key:function(n){if(n.key){var i=Df[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=ds(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Of[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:el,charCode:function(n){return n.type==="keypress"?ds(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ds(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Bf=fn(Hf),$f=Y({},xa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uu=fn($f),Uf=Y({},Tr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:el}),Vf=fn(Uf),Wf=Y({},$s,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gf=fn(Wf),Xf=Y({},xa,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),qf=fn(Xf),Yf=[9,13,27,32],tl=c&&"CompositionEvent"in window,Rr=null;c&&"documentMode"in document&&(Rr=document.documentMode);var Kf=c&&"TextEvent"in window&&!Rr,hu=c&&(!tl||Rr&&8<Rr&&11>=Rr),du=" ",fu=!1;function pu(n,i){switch(n){case"keyup":return Yf.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gu(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Us=!1;function Qf(n,i){switch(n){case"compositionend":return gu(i);case"keypress":return i.which!==32?null:(fu=!0,du);case"textInput":return n=i.data,n===du&&fu?null:n;default:return null}}function Zf(n,i){if(Us)return n==="compositionend"||!tl&&pu(n,i)?(n=hs(),In=Zn=Je=null,Us=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return hu&&i.locale!=="ko"?null:i.data;default:return null}}var Jf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mu(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!Jf[n.type]:i==="textarea"}function yu(n,i,a,u){Vn(u),i=Pa(i,"onChange"),0<i.length&&(a=new Ko("onChange","change",null,a,u),n.push({event:a,listeners:i}))}var Mr=null,Nr=null;function ep(n){Fu(n,0)}function Ea(n){var i=qs(n);if(_i(i))return n}function tp(n,i){if(n==="change")return i}var vu=!1;if(c){var nl;if(c){var il="oninput"in document;if(!il){var wu=document.createElement("div");wu.setAttribute("oninput","return;"),il=typeof wu.oninput=="function"}nl=il}else nl=!1;vu=nl&&(!document.documentMode||9<document.documentMode)}function bu(){Mr&&(Mr.detachEvent("onpropertychange",Au),Nr=Mr=null)}function Au(n){if(n.propertyName==="value"&&Ea(Nr)){var i=[];yu(i,Nr,n,es(n)),ss(ep,i)}}function np(n,i,a){n==="focusin"?(bu(),Mr=i,Nr=a,Mr.attachEvent("onpropertychange",Au)):n==="focusout"&&bu()}function ip(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ea(Nr)}function sp(n,i){if(n==="click")return Ea(i)}function rp(n,i){if(n==="input"||n==="change")return Ea(i)}function ap(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var Fn=typeof Object.is=="function"?Object.is:ap;function Lr(n,i){if(Fn(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var a=Object.keys(n),u=Object.keys(i);if(a.length!==u.length)return!1;for(u=0;u<a.length;u++){var d=a[u];if(!h.call(i,d)||!Fn(n[d],i[d]))return!1}return!0}function Su(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function _u(n,i){var a=Su(n);n=0;for(var u;a;){if(a.nodeType===3){if(u=n+a.textContent.length,n<=i&&u>=i)return{node:a,offset:i-n};n=u}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Su(a)}}function xu(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?xu(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function Eu(){for(var n=window,i=Lt();i instanceof n.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)n=i.contentWindow;else break;i=Lt(n.document)}return i}function sl(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function op(n){var i=Eu(),a=n.focusedElem,u=n.selectionRange;if(i!==a&&a&&a.ownerDocument&&xu(a.ownerDocument.documentElement,a)){if(u!==null&&sl(a)){if(i=u.start,n=u.end,n===void 0&&(n=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(n,a.value.length);else if(n=(i=a.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var d=a.textContent.length,m=Math.min(u.start,d);u=u.end===void 0?m:Math.min(u.end,d),!n.extend&&m>u&&(d=u,u=m,m=d),d=_u(a,m);var A=_u(a,u);d&&A&&(n.rangeCount!==1||n.anchorNode!==d.node||n.anchorOffset!==d.offset||n.focusNode!==A.node||n.focusOffset!==A.offset)&&(i=i.createRange(),i.setStart(d.node,d.offset),n.removeAllRanges(),m>u?(n.addRange(i),n.extend(A.node,A.offset)):(i.setEnd(A.node,A.offset),n.addRange(i)))}}for(i=[],n=a;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)n=i[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var lp=c&&"documentMode"in document&&11>=document.documentMode,Vs=null,rl=null,Ir=null,al=!1;function Cu(n,i,a){var u=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;al||Vs==null||Vs!==Lt(u)||(u=Vs,"selectionStart"in u&&sl(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Ir&&Lr(Ir,u)||(Ir=u,u=Pa(rl,"onSelect"),0<u.length&&(i=new Ko("onSelect","select",null,i,a),n.push({event:i,listeners:u}),i.target=Vs)))}function Ca(n,i){var a={};return a[n.toLowerCase()]=i.toLowerCase(),a["Webkit"+n]="webkit"+i,a["Moz"+n]="moz"+i,a}var Ws={animationend:Ca("Animation","AnimationEnd"),animationiteration:Ca("Animation","AnimationIteration"),animationstart:Ca("Animation","AnimationStart"),transitionend:Ca("Transition","TransitionEnd")},ol={},ku={};c&&(ku=document.createElement("div").style,"AnimationEvent"in window||(delete Ws.animationend.animation,delete Ws.animationiteration.animation,delete Ws.animationstart.animation),"TransitionEvent"in window||delete Ws.transitionend.transition);function ka(n){if(ol[n])return ol[n];if(!Ws[n])return n;var i=Ws[n],a;for(a in i)if(i.hasOwnProperty(a)&&a in ku)return ol[n]=i[a];return n}var Tu=ka("animationend"),Pu=ka("animationiteration"),Ru=ka("animationstart"),Mu=ka("transitionend"),Nu=new Map,Lu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ri(n,i){Nu.set(n,i),o(i,[n])}for(var ll=0;ll<Lu.length;ll++){var cl=Lu[ll],cp=cl.toLowerCase(),up=cl[0].toUpperCase()+cl.slice(1);Ri(cp,"on"+up)}Ri(Tu,"onAnimationEnd"),Ri(Pu,"onAnimationIteration"),Ri(Ru,"onAnimationStart"),Ri("dblclick","onDoubleClick"),Ri("focusin","onFocus"),Ri("focusout","onBlur"),Ri(Mu,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fr));function Iu(n,i,a){var u=n.type||"unknown-event";n.currentTarget=a,Wo(u,i,void 0,n),n.currentTarget=null}function Fu(n,i){i=(i&4)!==0;for(var a=0;a<n.length;a++){var u=n[a],d=u.event;u=u.listeners;e:{var m=void 0;if(i)for(var A=u.length-1;0<=A;A--){var C=u[A],P=C.instance,O=C.currentTarget;if(C=C.listener,P!==m&&d.isPropagationStopped())break e;Iu(d,C,O),m=P}else for(A=0;A<u.length;A++){if(C=u[A],P=C.instance,O=C.currentTarget,C=C.listener,P!==m&&d.isPropagationStopped())break e;Iu(d,C,O),m=P}}}if(Wn)throw n=rs,Wn=!1,rs=null,n}function rt(n,i){var a=i[yl];a===void 0&&(a=i[yl]=new Set);var u=n+"__bubble";a.has(u)||(Du(i,n,2,!1),a.add(u))}function ul(n,i,a){var u=0;i&&(u|=4),Du(a,n,u,i)}var Ta="_reactListening"+Math.random().toString(36).slice(2);function Dr(n){if(!n[Ta]){n[Ta]=!0,s.forEach(function(a){a!=="selectionchange"&&(hp.has(a)||ul(a,!1,n),ul(a,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[Ta]||(i[Ta]=!0,ul("selectionchange",!1,i))}}function Du(n,i,a,u){switch(Ft(i)){case 1:var d=nt;break;case 4:d=se;break;default:d=Ie}a=d.bind(null,i,a,n),d=void 0,!_t||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(d=!0),u?d!==void 0?n.addEventListener(i,a,{capture:!0,passive:d}):n.addEventListener(i,a,!0):d!==void 0?n.addEventListener(i,a,{passive:d}):n.addEventListener(i,a,!1)}function hl(n,i,a,u,d){var m=u;if((i&1)===0&&(i&2)===0&&u!==null)e:for(;;){if(u===null)return;var A=u.tag;if(A===3||A===4){var C=u.stateNode.containerInfo;if(C===d||C.nodeType===8&&C.parentNode===d)break;if(A===4)for(A=u.return;A!==null;){var P=A.tag;if((P===3||P===4)&&(P=A.stateNode.containerInfo,P===d||P.nodeType===8&&P.parentNode===d))return;A=A.return}for(;C!==null;){if(A=ps(C),A===null)return;if(P=A.tag,P===5||P===6){u=m=A;continue e}C=C.parentNode}}u=u.return}ss(function(){var O=m,W=es(a),q=[];e:{var V=Nu.get(n);if(V!==void 0){var ne=Ko,ce=n;switch(n){case"keypress":if(ds(a)===0)break e;case"keydown":case"keyup":ne=Bf;break;case"focusin":ce="focus",ne=Jo;break;case"focusout":ce="blur",ne=Jo;break;case"beforeblur":case"afterblur":ne=Jo;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=lu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=Pf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=Vf;break;case Tu:case Pu:case Ru:ne=Nf;break;case Mu:ne=Gf;break;case"scroll":ne=kf;break;case"wheel":ne=qf;break;case"copy":case"cut":case"paste":ne=If;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=uu}var ue=(i&4)!==0,mt=!ue&&n==="scroll",L=ue?V!==null?V+"Capture":null:V;ue=[];for(var N=O,D;N!==null;){D=N;var Q=D.stateNode;if(D.tag===5&&Q!==null&&(D=Q,L!==null&&(Q=Ln(N,L),Q!=null&&ue.push(Or(N,Q,D)))),mt)break;N=N.return}0<ue.length&&(V=new ne(V,ce,null,a,W),q.push({event:V,listeners:ue}))}}if((i&7)===0){e:{if(V=n==="mouseover"||n==="pointerover",ne=n==="mouseout"||n==="pointerout",V&&a!==Ei&&(ce=a.relatedTarget||a.fromElement)&&(ps(ce)||ce[fi]))break e;if((ne||V)&&(V=W.window===W?W:(V=W.ownerDocument)?V.defaultView||V.parentWindow:window,ne?(ce=a.relatedTarget||a.toElement,ne=O,ce=ce?ps(ce):null,ce!==null&&(mt=zt(ce),ce!==mt||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(ne=null,ce=O),ne!==ce)){if(ue=lu,Q="onMouseLeave",L="onMouseEnter",N="mouse",(n==="pointerout"||n==="pointerover")&&(ue=uu,Q="onPointerLeave",L="onPointerEnter",N="pointer"),mt=ne==null?V:qs(ne),D=ce==null?V:qs(ce),V=new ue(Q,N+"leave",ne,a,W),V.target=mt,V.relatedTarget=D,Q=null,ps(W)===O&&(ue=new ue(L,N+"enter",ce,a,W),ue.target=D,ue.relatedTarget=mt,Q=ue),mt=Q,ne&&ce)t:{for(ue=ne,L=ce,N=0,D=ue;D;D=Gs(D))N++;for(D=0,Q=L;Q;Q=Gs(Q))D++;for(;0<N-D;)ue=Gs(ue),N--;for(;0<D-N;)L=Gs(L),D--;for(;N--;){if(ue===L||L!==null&&ue===L.alternate)break t;ue=Gs(ue),L=Gs(L)}ue=null}else ue=null;ne!==null&&Ou(q,V,ne,ue,!1),ce!==null&&mt!==null&&Ou(q,mt,ce,ue,!0)}}e:{if(V=O?qs(O):window,ne=V.nodeName&&V.nodeName.toLowerCase(),ne==="select"||ne==="input"&&V.type==="file")var fe=tp;else if(mu(V))if(vu)fe=rp;else{fe=ip;var we=np}else(ne=V.nodeName)&&ne.toLowerCase()==="input"&&(V.type==="checkbox"||V.type==="radio")&&(fe=sp);if(fe&&(fe=fe(n,O))){yu(q,fe,a,W);break e}we&&we(n,V,O),n==="focusout"&&(we=V._wrapperState)&&we.controlled&&V.type==="number"&&qe(V,"number",V.value)}switch(we=O?qs(O):window,n){case"focusin":(mu(we)||we.contentEditable==="true")&&(Vs=we,rl=O,Ir=null);break;case"focusout":Ir=rl=Vs=null;break;case"mousedown":al=!0;break;case"contextmenu":case"mouseup":case"dragend":al=!1,Cu(q,a,W);break;case"selectionchange":if(lp)break;case"keydown":case"keyup":Cu(q,a,W)}var be;if(tl)e:{switch(n){case"compositionstart":var Pe="onCompositionStart";break e;case"compositionend":Pe="onCompositionEnd";break e;case"compositionupdate":Pe="onCompositionUpdate";break e}Pe=void 0}else Us?pu(n,a)&&(Pe="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(Pe="onCompositionStart");Pe&&(hu&&a.locale!=="ko"&&(Us||Pe!=="onCompositionStart"?Pe==="onCompositionEnd"&&Us&&(be=hs()):(Je=W,Zn="value"in Je?Je.value:Je.textContent,Us=!0)),we=Pa(O,Pe),0<we.length&&(Pe=new cu(Pe,n,null,a,W),q.push({event:Pe,listeners:we}),be?Pe.data=be:(be=gu(a),be!==null&&(Pe.data=be)))),(be=Kf?Qf(n,a):Zf(n,a))&&(O=Pa(O,"onBeforeInput"),0<O.length&&(W=new cu("onBeforeInput","beforeinput",null,a,W),q.push({event:W,listeners:O}),W.data=be))}Fu(q,i)})}function Or(n,i,a){return{instance:n,listener:i,currentTarget:a}}function Pa(n,i){for(var a=i+"Capture",u=[];n!==null;){var d=n,m=d.stateNode;d.tag===5&&m!==null&&(d=m,m=Ln(n,a),m!=null&&u.unshift(Or(n,m,d)),m=Ln(n,i),m!=null&&u.push(Or(n,m,d))),n=n.return}return u}function Gs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ou(n,i,a,u,d){for(var m=i._reactName,A=[];a!==null&&a!==u;){var C=a,P=C.alternate,O=C.stateNode;if(P!==null&&P===u)break;C.tag===5&&O!==null&&(C=O,d?(P=Ln(a,m),P!=null&&A.unshift(Or(a,P,C))):d||(P=Ln(a,m),P!=null&&A.push(Or(a,P,C)))),a=a.return}A.length!==0&&n.push({event:i,listeners:A})}var dp=/\r\n?/g,fp=/\u0000|\uFFFD/g;function ju(n){return(typeof n=="string"?n:""+n).replace(dp,`
`).replace(fp,"")}function Ra(n,i,a){if(i=ju(i),ju(n)!==i&&a)throw Error(t(425))}function Ma(){}var dl=null,fl=null;function pl(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var gl=typeof setTimeout=="function"?setTimeout:void 0,pp=typeof clearTimeout=="function"?clearTimeout:void 0,zu=typeof Promise=="function"?Promise:void 0,gp=typeof queueMicrotask=="function"?queueMicrotask:typeof zu<"u"?function(n){return zu.resolve(null).then(n).catch(mp)}:gl;function mp(n){setTimeout(function(){throw n})}function ml(n,i){var a=i,u=0;do{var d=a.nextSibling;if(n.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(u===0){n.removeChild(d),st(i);return}u--}else a!=="$"&&a!=="$?"&&a!=="$!"||u++;a=d}while(a);st(i)}function Mi(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function Hu(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return n;i--}else a==="/$"&&i++}n=n.previousSibling}return null}var Xs=Math.random().toString(36).slice(2),Jn="__reactFiber$"+Xs,jr="__reactProps$"+Xs,fi="__reactContainer$"+Xs,yl="__reactEvents$"+Xs,yp="__reactListeners$"+Xs,vp="__reactHandles$"+Xs;function ps(n){var i=n[Jn];if(i)return i;for(var a=n.parentNode;a;){if(i=a[fi]||a[Jn]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(n=Hu(n);n!==null;){if(a=n[Jn])return a;n=Hu(n)}return i}n=a,a=n.parentNode}return null}function zr(n){return n=n[Jn]||n[fi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function qs(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(t(33))}function Na(n){return n[jr]||null}var vl=[],Ys=-1;function Ni(n){return{current:n}}function at(n){0>Ys||(n.current=vl[Ys],vl[Ys]=null,Ys--)}function it(n,i){Ys++,vl[Ys]=n.current,n.current=i}var Li={},Ht=Ni(Li),sn=Ni(!1),gs=Li;function Ks(n,i){var a=n.type.contextTypes;if(!a)return Li;var u=n.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===i)return u.__reactInternalMemoizedMaskedChildContext;var d={},m;for(m in a)d[m]=i[m];return u&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=d),d}function rn(n){return n=n.childContextTypes,n!=null}function La(){at(sn),at(Ht)}function Bu(n,i,a){if(Ht.current!==Li)throw Error(t(168));it(Ht,i),it(sn,a)}function $u(n,i,a){var u=n.stateNode;if(i=i.childContextTypes,typeof u.getChildContext!="function")return a;u=u.getChildContext();for(var d in u)if(!(d in i))throw Error(t(108,ge(n)||"Unknown",d));return Y({},a,u)}function Ia(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Li,gs=Ht.current,it(Ht,n),it(sn,sn.current),!0}function Uu(n,i,a){var u=n.stateNode;if(!u)throw Error(t(169));a?(n=$u(n,i,gs),u.__reactInternalMemoizedMergedChildContext=n,at(sn),at(Ht),it(Ht,n)):at(sn),it(sn,a)}var pi=null,Fa=!1,wl=!1;function Vu(n){pi===null?pi=[n]:pi.push(n)}function wp(n){Fa=!0,Vu(n)}function Ii(){if(!wl&&pi!==null){wl=!0;var n=0,i=Ue;try{var a=pi;for(Ue=1;n<a.length;n++){var u=a[n];do u=u(!0);while(u!==null)}pi=null,Fa=!1}catch(d){throw pi!==null&&(pi=pi.slice(n+1)),Ye(Ar,Ii),d}finally{Ue=i,wl=!1}}return null}var Qs=[],Zs=0,Da=null,Oa=0,Sn=[],_n=0,ms=null,gi=1,mi="";function ys(n,i){Qs[Zs++]=Oa,Qs[Zs++]=Da,Da=n,Oa=i}function Wu(n,i,a){Sn[_n++]=gi,Sn[_n++]=mi,Sn[_n++]=ms,ms=n;var u=gi;n=mi;var d=32-Ze(u)-1;u&=~(1<<d),a+=1;var m=32-Ze(i)+d;if(30<m){var A=d-d%5;m=(u&(1<<A)-1).toString(32),u>>=A,d-=A,gi=1<<32-Ze(i)+d|a<<d|u,mi=m+n}else gi=1<<m|a<<d|u,mi=n}function bl(n){n.return!==null&&(ys(n,1),Wu(n,1,0))}function Al(n){for(;n===Da;)Da=Qs[--Zs],Qs[Zs]=null,Oa=Qs[--Zs],Qs[Zs]=null;for(;n===ms;)ms=Sn[--_n],Sn[_n]=null,mi=Sn[--_n],Sn[_n]=null,gi=Sn[--_n],Sn[_n]=null}var pn=null,gn=null,lt=!1,Dn=null;function Gu(n,i){var a=kn(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=n,i=n.deletions,i===null?(n.deletions=[a],n.flags|=16):i.push(a)}function Xu(n,i){switch(n.tag){case 5:var a=n.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,pn=n,gn=Mi(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,pn=n,gn=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=ms!==null?{id:gi,overflow:mi}:null,n.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=kn(18,null,null,0),a.stateNode=i,a.return=n,n.child=a,pn=n,gn=null,!0):!1;default:return!1}}function Sl(n){return(n.mode&1)!==0&&(n.flags&128)===0}function _l(n){if(lt){var i=gn;if(i){var a=i;if(!Xu(n,i)){if(Sl(n))throw Error(t(418));i=Mi(a.nextSibling);var u=pn;i&&Xu(n,i)?Gu(u,a):(n.flags=n.flags&-4097|2,lt=!1,pn=n)}}else{if(Sl(n))throw Error(t(418));n.flags=n.flags&-4097|2,lt=!1,pn=n}}}function qu(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;pn=n}function ja(n){if(n!==pn)return!1;if(!lt)return qu(n),lt=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!pl(n.type,n.memoizedProps)),i&&(i=gn)){if(Sl(n))throw Yu(),Error(t(418));for(;i;)Gu(n,i),i=Mi(i.nextSibling)}if(qu(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(t(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(i===0){gn=Mi(n.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}n=n.nextSibling}gn=null}}else gn=pn?Mi(n.stateNode.nextSibling):null;return!0}function Yu(){for(var n=gn;n;)n=Mi(n.nextSibling)}function Js(){gn=pn=null,lt=!1}function xl(n){Dn===null?Dn=[n]:Dn.push(n)}var bp=H.ReactCurrentBatchConfig;function Hr(n,i,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(t(309));var u=a.stateNode}if(!u)throw Error(t(147,n));var d=u,m=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===m?i.ref:(i=function(A){var C=d.refs;A===null?delete C[m]:C[m]=A},i._stringRef=m,i)}if(typeof n!="string")throw Error(t(284));if(!a._owner)throw Error(t(290,n))}return n}function za(n,i){throw n=Object.prototype.toString.call(i),Error(t(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function Ku(n){var i=n._init;return i(n._payload)}function Qu(n){function i(L,N){if(n){var D=L.deletions;D===null?(L.deletions=[N],L.flags|=16):D.push(N)}}function a(L,N){if(!n)return null;for(;N!==null;)i(L,N),N=N.sibling;return null}function u(L,N){for(L=new Map;N!==null;)N.key!==null?L.set(N.key,N):L.set(N.index,N),N=N.sibling;return L}function d(L,N){return L=$i(L,N),L.index=0,L.sibling=null,L}function m(L,N,D){return L.index=D,n?(D=L.alternate,D!==null?(D=D.index,D<N?(L.flags|=2,N):D):(L.flags|=2,N)):(L.flags|=1048576,N)}function A(L){return n&&L.alternate===null&&(L.flags|=2),L}function C(L,N,D,Q){return N===null||N.tag!==6?(N=gc(D,L.mode,Q),N.return=L,N):(N=d(N,D),N.return=L,N)}function P(L,N,D,Q){var fe=D.type;return fe===X?W(L,N,D.props.children,Q,D.key):N!==null&&(N.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===J&&Ku(fe)===N.type)?(Q=d(N,D.props),Q.ref=Hr(L,N,D),Q.return=L,Q):(Q=co(D.type,D.key,D.props,null,L.mode,Q),Q.ref=Hr(L,N,D),Q.return=L,Q)}function O(L,N,D,Q){return N===null||N.tag!==4||N.stateNode.containerInfo!==D.containerInfo||N.stateNode.implementation!==D.implementation?(N=mc(D,L.mode,Q),N.return=L,N):(N=d(N,D.children||[]),N.return=L,N)}function W(L,N,D,Q,fe){return N===null||N.tag!==7?(N=Es(D,L.mode,Q,fe),N.return=L,N):(N=d(N,D),N.return=L,N)}function q(L,N,D){if(typeof N=="string"&&N!==""||typeof N=="number")return N=gc(""+N,L.mode,D),N.return=L,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case $:return D=co(N.type,N.key,N.props,null,L.mode,D),D.ref=Hr(L,null,N),D.return=L,D;case G:return N=mc(N,L.mode,D),N.return=L,N;case J:var Q=N._init;return q(L,Q(N._payload),D)}if(ai(N)||re(N))return N=Es(N,L.mode,D,null),N.return=L,N;za(L,N)}return null}function V(L,N,D,Q){var fe=N!==null?N.key:null;if(typeof D=="string"&&D!==""||typeof D=="number")return fe!==null?null:C(L,N,""+D,Q);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case $:return D.key===fe?P(L,N,D,Q):null;case G:return D.key===fe?O(L,N,D,Q):null;case J:return fe=D._init,V(L,N,fe(D._payload),Q)}if(ai(D)||re(D))return fe!==null?null:W(L,N,D,Q,null);za(L,D)}return null}function ne(L,N,D,Q,fe){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return L=L.get(D)||null,C(N,L,""+Q,fe);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case $:return L=L.get(Q.key===null?D:Q.key)||null,P(N,L,Q,fe);case G:return L=L.get(Q.key===null?D:Q.key)||null,O(N,L,Q,fe);case J:var we=Q._init;return ne(L,N,D,we(Q._payload),fe)}if(ai(Q)||re(Q))return L=L.get(D)||null,W(N,L,Q,fe,null);za(N,Q)}return null}function ce(L,N,D,Q){for(var fe=null,we=null,be=N,Pe=N=0,Nt=null;be!==null&&Pe<D.length;Pe++){be.index>Pe?(Nt=be,be=null):Nt=be.sibling;var Xe=V(L,be,D[Pe],Q);if(Xe===null){be===null&&(be=Nt);break}n&&be&&Xe.alternate===null&&i(L,be),N=m(Xe,N,Pe),we===null?fe=Xe:we.sibling=Xe,we=Xe,be=Nt}if(Pe===D.length)return a(L,be),lt&&ys(L,Pe),fe;if(be===null){for(;Pe<D.length;Pe++)be=q(L,D[Pe],Q),be!==null&&(N=m(be,N,Pe),we===null?fe=be:we.sibling=be,we=be);return lt&&ys(L,Pe),fe}for(be=u(L,be);Pe<D.length;Pe++)Nt=ne(be,L,Pe,D[Pe],Q),Nt!==null&&(n&&Nt.alternate!==null&&be.delete(Nt.key===null?Pe:Nt.key),N=m(Nt,N,Pe),we===null?fe=Nt:we.sibling=Nt,we=Nt);return n&&be.forEach(function(Ui){return i(L,Ui)}),lt&&ys(L,Pe),fe}function ue(L,N,D,Q){var fe=re(D);if(typeof fe!="function")throw Error(t(150));if(D=fe.call(D),D==null)throw Error(t(151));for(var we=fe=null,be=N,Pe=N=0,Nt=null,Xe=D.next();be!==null&&!Xe.done;Pe++,Xe=D.next()){be.index>Pe?(Nt=be,be=null):Nt=be.sibling;var Ui=V(L,be,Xe.value,Q);if(Ui===null){be===null&&(be=Nt);break}n&&be&&Ui.alternate===null&&i(L,be),N=m(Ui,N,Pe),we===null?fe=Ui:we.sibling=Ui,we=Ui,be=Nt}if(Xe.done)return a(L,be),lt&&ys(L,Pe),fe;if(be===null){for(;!Xe.done;Pe++,Xe=D.next())Xe=q(L,Xe.value,Q),Xe!==null&&(N=m(Xe,N,Pe),we===null?fe=Xe:we.sibling=Xe,we=Xe);return lt&&ys(L,Pe),fe}for(be=u(L,be);!Xe.done;Pe++,Xe=D.next())Xe=ne(be,L,Pe,Xe.value,Q),Xe!==null&&(n&&Xe.alternate!==null&&be.delete(Xe.key===null?Pe:Xe.key),N=m(Xe,N,Pe),we===null?fe=Xe:we.sibling=Xe,we=Xe);return n&&be.forEach(function(Jp){return i(L,Jp)}),lt&&ys(L,Pe),fe}function mt(L,N,D,Q){if(typeof D=="object"&&D!==null&&D.type===X&&D.key===null&&(D=D.props.children),typeof D=="object"&&D!==null){switch(D.$$typeof){case $:e:{for(var fe=D.key,we=N;we!==null;){if(we.key===fe){if(fe=D.type,fe===X){if(we.tag===7){a(L,we.sibling),N=d(we,D.props.children),N.return=L,L=N;break e}}else if(we.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===J&&Ku(fe)===we.type){a(L,we.sibling),N=d(we,D.props),N.ref=Hr(L,we,D),N.return=L,L=N;break e}a(L,we);break}else i(L,we);we=we.sibling}D.type===X?(N=Es(D.props.children,L.mode,Q,D.key),N.return=L,L=N):(Q=co(D.type,D.key,D.props,null,L.mode,Q),Q.ref=Hr(L,N,D),Q.return=L,L=Q)}return A(L);case G:e:{for(we=D.key;N!==null;){if(N.key===we)if(N.tag===4&&N.stateNode.containerInfo===D.containerInfo&&N.stateNode.implementation===D.implementation){a(L,N.sibling),N=d(N,D.children||[]),N.return=L,L=N;break e}else{a(L,N);break}else i(L,N);N=N.sibling}N=mc(D,L.mode,Q),N.return=L,L=N}return A(L);case J:return we=D._init,mt(L,N,we(D._payload),Q)}if(ai(D))return ce(L,N,D,Q);if(re(D))return ue(L,N,D,Q);za(L,D)}return typeof D=="string"&&D!==""||typeof D=="number"?(D=""+D,N!==null&&N.tag===6?(a(L,N.sibling),N=d(N,D),N.return=L,L=N):(a(L,N),N=gc(D,L.mode,Q),N.return=L,L=N),A(L)):a(L,N)}return mt}var er=Qu(!0),Zu=Qu(!1),Ha=Ni(null),Ba=null,tr=null,El=null;function Cl(){El=tr=Ba=null}function kl(n){var i=Ha.current;at(Ha),n._currentValue=i}function Tl(n,i,a){for(;n!==null;){var u=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,u!==null&&(u.childLanes|=i)):u!==null&&(u.childLanes&i)!==i&&(u.childLanes|=i),n===a)break;n=n.return}}function nr(n,i){Ba=n,El=tr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&i)!==0&&(an=!0),n.firstContext=null)}function xn(n){var i=n._currentValue;if(El!==n)if(n={context:n,memoizedValue:i,next:null},tr===null){if(Ba===null)throw Error(t(308));tr=n,Ba.dependencies={lanes:0,firstContext:n}}else tr=tr.next=n;return i}var vs=null;function Pl(n){vs===null?vs=[n]:vs.push(n)}function Ju(n,i,a,u){var d=i.interleaved;return d===null?(a.next=a,Pl(i)):(a.next=d.next,d.next=a),i.interleaved=a,yi(n,u)}function yi(n,i){n.lanes|=i;var a=n.alternate;for(a!==null&&(a.lanes|=i),a=n,n=n.return;n!==null;)n.childLanes|=i,a=n.alternate,a!==null&&(a.childLanes|=i),a=n,n=n.return;return a.tag===3?a.stateNode:null}var Fi=!1;function Rl(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eh(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function vi(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function Di(n,i,a){var u=n.updateQueue;if(u===null)return null;if(u=u.shared,(Ve&2)!==0){var d=u.pending;return d===null?i.next=i:(i.next=d.next,d.next=i),u.pending=i,yi(n,a)}return d=u.interleaved,d===null?(i.next=i,Pl(u)):(i.next=d.next,d.next=i),u.interleaved=i,yi(n,a)}function $a(n,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var u=i.lanes;u&=n.pendingLanes,a|=u,i.lanes=a,Pi(n,a)}}function th(n,i){var a=n.updateQueue,u=n.alternate;if(u!==null&&(u=u.updateQueue,a===u)){var d=null,m=null;if(a=a.firstBaseUpdate,a!==null){do{var A={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};m===null?d=m=A:m=m.next=A,a=a.next}while(a!==null);m===null?d=m=i:m=m.next=i}else d=m=i;a={baseState:u.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:u.shared,effects:u.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=i:n.next=i,a.lastBaseUpdate=i}function Ua(n,i,a,u){var d=n.updateQueue;Fi=!1;var m=d.firstBaseUpdate,A=d.lastBaseUpdate,C=d.shared.pending;if(C!==null){d.shared.pending=null;var P=C,O=P.next;P.next=null,A===null?m=O:A.next=O,A=P;var W=n.alternate;W!==null&&(W=W.updateQueue,C=W.lastBaseUpdate,C!==A&&(C===null?W.firstBaseUpdate=O:C.next=O,W.lastBaseUpdate=P))}if(m!==null){var q=d.baseState;A=0,W=O=P=null,C=m;do{var V=C.lane,ne=C.eventTime;if((u&V)===V){W!==null&&(W=W.next={eventTime:ne,lane:0,tag:C.tag,payload:C.payload,callback:C.callback,next:null});e:{var ce=n,ue=C;switch(V=i,ne=a,ue.tag){case 1:if(ce=ue.payload,typeof ce=="function"){q=ce.call(ne,q,V);break e}q=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=ue.payload,V=typeof ce=="function"?ce.call(ne,q,V):ce,V==null)break e;q=Y({},q,V);break e;case 2:Fi=!0}}C.callback!==null&&C.lane!==0&&(n.flags|=64,V=d.effects,V===null?d.effects=[C]:V.push(C))}else ne={eventTime:ne,lane:V,tag:C.tag,payload:C.payload,callback:C.callback,next:null},W===null?(O=W=ne,P=q):W=W.next=ne,A|=V;if(C=C.next,C===null){if(C=d.shared.pending,C===null)break;V=C,C=V.next,V.next=null,d.lastBaseUpdate=V,d.shared.pending=null}}while(!0);if(W===null&&(P=q),d.baseState=P,d.firstBaseUpdate=O,d.lastBaseUpdate=W,i=d.shared.interleaved,i!==null){d=i;do A|=d.lane,d=d.next;while(d!==i)}else m===null&&(d.shared.lanes=0);As|=A,n.lanes=A,n.memoizedState=q}}function nh(n,i,a){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var u=n[i],d=u.callback;if(d!==null){if(u.callback=null,u=a,typeof d!="function")throw Error(t(191,d));d.call(u)}}}var Br={},ei=Ni(Br),$r=Ni(Br),Ur=Ni(Br);function ws(n){if(n===Br)throw Error(t(174));return n}function Ml(n,i){switch(it(Ur,i),it($r,n),it(ei,Br),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:tn(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=tn(i,n)}at(ei),it(ei,i)}function ir(){at(ei),at($r),at(Ur)}function ih(n){ws(Ur.current);var i=ws(ei.current),a=tn(i,n.type);i!==a&&(it($r,n),it(ei,a))}function Nl(n){$r.current===n&&(at(ei),at($r))}var dt=Ni(0);function Va(n){for(var i=n;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Ll=[];function Il(){for(var n=0;n<Ll.length;n++)Ll[n]._workInProgressVersionPrimary=null;Ll.length=0}var Wa=H.ReactCurrentDispatcher,Fl=H.ReactCurrentBatchConfig,bs=0,ft=null,xt=null,Rt=null,Ga=!1,Vr=!1,Wr=0,Ap=0;function Bt(){throw Error(t(321))}function Dl(n,i){if(i===null)return!1;for(var a=0;a<i.length&&a<n.length;a++)if(!Fn(n[a],i[a]))return!1;return!0}function Ol(n,i,a,u,d,m){if(bs=m,ft=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Wa.current=n===null||n.memoizedState===null?Ep:Cp,n=a(u,d),Vr){m=0;do{if(Vr=!1,Wr=0,25<=m)throw Error(t(301));m+=1,Rt=xt=null,i.updateQueue=null,Wa.current=kp,n=a(u,d)}while(Vr)}if(Wa.current=Ya,i=xt!==null&&xt.next!==null,bs=0,Rt=xt=ft=null,Ga=!1,i)throw Error(t(300));return n}function jl(){var n=Wr!==0;return Wr=0,n}function ti(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?ft.memoizedState=Rt=n:Rt=Rt.next=n,Rt}function En(){if(xt===null){var n=ft.alternate;n=n!==null?n.memoizedState:null}else n=xt.next;var i=Rt===null?ft.memoizedState:Rt.next;if(i!==null)Rt=i,xt=n;else{if(n===null)throw Error(t(310));xt=n,n={memoizedState:xt.memoizedState,baseState:xt.baseState,baseQueue:xt.baseQueue,queue:xt.queue,next:null},Rt===null?ft.memoizedState=Rt=n:Rt=Rt.next=n}return Rt}function Gr(n,i){return typeof i=="function"?i(n):i}function zl(n){var i=En(),a=i.queue;if(a===null)throw Error(t(311));a.lastRenderedReducer=n;var u=xt,d=u.baseQueue,m=a.pending;if(m!==null){if(d!==null){var A=d.next;d.next=m.next,m.next=A}u.baseQueue=d=m,a.pending=null}if(d!==null){m=d.next,u=u.baseState;var C=A=null,P=null,O=m;do{var W=O.lane;if((bs&W)===W)P!==null&&(P=P.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),u=O.hasEagerState?O.eagerState:n(u,O.action);else{var q={lane:W,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};P===null?(C=P=q,A=u):P=P.next=q,ft.lanes|=W,As|=W}O=O.next}while(O!==null&&O!==m);P===null?A=u:P.next=C,Fn(u,i.memoizedState)||(an=!0),i.memoizedState=u,i.baseState=A,i.baseQueue=P,a.lastRenderedState=u}if(n=a.interleaved,n!==null){d=n;do m=d.lane,ft.lanes|=m,As|=m,d=d.next;while(d!==n)}else d===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function Hl(n){var i=En(),a=i.queue;if(a===null)throw Error(t(311));a.lastRenderedReducer=n;var u=a.dispatch,d=a.pending,m=i.memoizedState;if(d!==null){a.pending=null;var A=d=d.next;do m=n(m,A.action),A=A.next;while(A!==d);Fn(m,i.memoizedState)||(an=!0),i.memoizedState=m,i.baseQueue===null&&(i.baseState=m),a.lastRenderedState=m}return[m,u]}function sh(){}function rh(n,i){var a=ft,u=En(),d=i(),m=!Fn(u.memoizedState,d);if(m&&(u.memoizedState=d,an=!0),u=u.queue,Bl(lh.bind(null,a,u,n),[n]),u.getSnapshot!==i||m||Rt!==null&&Rt.memoizedState.tag&1){if(a.flags|=2048,Xr(9,oh.bind(null,a,u,d,i),void 0,null),Mt===null)throw Error(t(349));(bs&30)!==0||ah(a,i,d)}return d}function ah(n,i,a){n.flags|=16384,n={getSnapshot:i,value:a},i=ft.updateQueue,i===null?(i={lastEffect:null,stores:null},ft.updateQueue=i,i.stores=[n]):(a=i.stores,a===null?i.stores=[n]:a.push(n))}function oh(n,i,a,u){i.value=a,i.getSnapshot=u,ch(i)&&uh(n)}function lh(n,i,a){return a(function(){ch(i)&&uh(n)})}function ch(n){var i=n.getSnapshot;n=n.value;try{var a=i();return!Fn(n,a)}catch{return!0}}function uh(n){var i=yi(n,1);i!==null&&Hn(i,n,1,-1)}function hh(n){var i=ti();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gr,lastRenderedState:n},i.queue=n,n=n.dispatch=xp.bind(null,ft,n),[i.memoizedState,n]}function Xr(n,i,a,u){return n={tag:n,create:i,destroy:a,deps:u,next:null},i=ft.updateQueue,i===null?(i={lastEffect:null,stores:null},ft.updateQueue=i,i.lastEffect=n.next=n):(a=i.lastEffect,a===null?i.lastEffect=n.next=n:(u=a.next,a.next=n,n.next=u,i.lastEffect=n)),n}function dh(){return En().memoizedState}function Xa(n,i,a,u){var d=ti();ft.flags|=n,d.memoizedState=Xr(1|i,a,void 0,u===void 0?null:u)}function qa(n,i,a,u){var d=En();u=u===void 0?null:u;var m=void 0;if(xt!==null){var A=xt.memoizedState;if(m=A.destroy,u!==null&&Dl(u,A.deps)){d.memoizedState=Xr(i,a,m,u);return}}ft.flags|=n,d.memoizedState=Xr(1|i,a,m,u)}function fh(n,i){return Xa(8390656,8,n,i)}function Bl(n,i){return qa(2048,8,n,i)}function ph(n,i){return qa(4,2,n,i)}function gh(n,i){return qa(4,4,n,i)}function mh(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function yh(n,i,a){return a=a!=null?a.concat([n]):null,qa(4,4,mh.bind(null,i,n),a)}function $l(){}function vh(n,i){var a=En();i=i===void 0?null:i;var u=a.memoizedState;return u!==null&&i!==null&&Dl(i,u[1])?u[0]:(a.memoizedState=[n,i],n)}function wh(n,i){var a=En();i=i===void 0?null:i;var u=a.memoizedState;return u!==null&&i!==null&&Dl(i,u[1])?u[0]:(n=n(),a.memoizedState=[n,i],n)}function bh(n,i,a){return(bs&21)===0?(n.baseState&&(n.baseState=!1,an=!0),n.memoizedState=a):(Fn(a,i)||(a=_r(),ft.lanes|=a,As|=a,n.baseState=!0),i)}function Sp(n,i){var a=Ue;Ue=a!==0&&4>a?a:4,n(!0);var u=Fl.transition;Fl.transition={};try{n(!1),i()}finally{Ue=a,Fl.transition=u}}function Ah(){return En().memoizedState}function _p(n,i,a){var u=Hi(n);if(a={lane:u,action:a,hasEagerState:!1,eagerState:null,next:null},Sh(n))_h(i,a);else if(a=Ju(n,i,a,u),a!==null){var d=Qt();Hn(a,n,u,d),xh(a,i,u)}}function xp(n,i,a){var u=Hi(n),d={lane:u,action:a,hasEagerState:!1,eagerState:null,next:null};if(Sh(n))_h(i,d);else{var m=n.alternate;if(n.lanes===0&&(m===null||m.lanes===0)&&(m=i.lastRenderedReducer,m!==null))try{var A=i.lastRenderedState,C=m(A,a);if(d.hasEagerState=!0,d.eagerState=C,Fn(C,A)){var P=i.interleaved;P===null?(d.next=d,Pl(i)):(d.next=P.next,P.next=d),i.interleaved=d;return}}catch{}a=Ju(n,i,d,u),a!==null&&(d=Qt(),Hn(a,n,u,d),xh(a,i,u))}}function Sh(n){var i=n.alternate;return n===ft||i!==null&&i===ft}function _h(n,i){Vr=Ga=!0;var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}function xh(n,i,a){if((a&4194240)!==0){var u=i.lanes;u&=n.pendingLanes,a|=u,i.lanes=a,Pi(n,a)}}var Ya={readContext:xn,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useInsertionEffect:Bt,useLayoutEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useMutableSource:Bt,useSyncExternalStore:Bt,useId:Bt,unstable_isNewReconciler:!1},Ep={readContext:xn,useCallback:function(n,i){return ti().memoizedState=[n,i===void 0?null:i],n},useContext:xn,useEffect:fh,useImperativeHandle:function(n,i,a){return a=a!=null?a.concat([n]):null,Xa(4194308,4,mh.bind(null,i,n),a)},useLayoutEffect:function(n,i){return Xa(4194308,4,n,i)},useInsertionEffect:function(n,i){return Xa(4,2,n,i)},useMemo:function(n,i){var a=ti();return i=i===void 0?null:i,n=n(),a.memoizedState=[n,i],n},useReducer:function(n,i,a){var u=ti();return i=a!==void 0?a(i):i,u.memoizedState=u.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},u.queue=n,n=n.dispatch=_p.bind(null,ft,n),[u.memoizedState,n]},useRef:function(n){var i=ti();return n={current:n},i.memoizedState=n},useState:hh,useDebugValue:$l,useDeferredValue:function(n){return ti().memoizedState=n},useTransition:function(){var n=hh(!1),i=n[0];return n=Sp.bind(null,n[1]),ti().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,a){var u=ft,d=ti();if(lt){if(a===void 0)throw Error(t(407));a=a()}else{if(a=i(),Mt===null)throw Error(t(349));(bs&30)!==0||ah(u,i,a)}d.memoizedState=a;var m={value:a,getSnapshot:i};return d.queue=m,fh(lh.bind(null,u,m,n),[n]),u.flags|=2048,Xr(9,oh.bind(null,u,m,a,i),void 0,null),a},useId:function(){var n=ti(),i=Mt.identifierPrefix;if(lt){var a=mi,u=gi;a=(u&~(1<<32-Ze(u)-1)).toString(32)+a,i=":"+i+"R"+a,a=Wr++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=Ap++,i=":"+i+"r"+a.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},Cp={readContext:xn,useCallback:vh,useContext:xn,useEffect:Bl,useImperativeHandle:yh,useInsertionEffect:ph,useLayoutEffect:gh,useMemo:wh,useReducer:zl,useRef:dh,useState:function(){return zl(Gr)},useDebugValue:$l,useDeferredValue:function(n){var i=En();return bh(i,xt.memoizedState,n)},useTransition:function(){var n=zl(Gr)[0],i=En().memoizedState;return[n,i]},useMutableSource:sh,useSyncExternalStore:rh,useId:Ah,unstable_isNewReconciler:!1},kp={readContext:xn,useCallback:vh,useContext:xn,useEffect:Bl,useImperativeHandle:yh,useInsertionEffect:ph,useLayoutEffect:gh,useMemo:wh,useReducer:Hl,useRef:dh,useState:function(){return Hl(Gr)},useDebugValue:$l,useDeferredValue:function(n){var i=En();return xt===null?i.memoizedState=n:bh(i,xt.memoizedState,n)},useTransition:function(){var n=Hl(Gr)[0],i=En().memoizedState;return[n,i]},useMutableSource:sh,useSyncExternalStore:rh,useId:Ah,unstable_isNewReconciler:!1};function On(n,i){if(n&&n.defaultProps){i=Y({},i),n=n.defaultProps;for(var a in n)i[a]===void 0&&(i[a]=n[a]);return i}return i}function Ul(n,i,a,u){i=n.memoizedState,a=a(u,i),a=a==null?i:Y({},i,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var Ka={isMounted:function(n){return(n=n._reactInternals)?zt(n)===n:!1},enqueueSetState:function(n,i,a){n=n._reactInternals;var u=Qt(),d=Hi(n),m=vi(u,d);m.payload=i,a!=null&&(m.callback=a),i=Di(n,m,d),i!==null&&(Hn(i,n,d,u),$a(i,n,d))},enqueueReplaceState:function(n,i,a){n=n._reactInternals;var u=Qt(),d=Hi(n),m=vi(u,d);m.tag=1,m.payload=i,a!=null&&(m.callback=a),i=Di(n,m,d),i!==null&&(Hn(i,n,d,u),$a(i,n,d))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var a=Qt(),u=Hi(n),d=vi(a,u);d.tag=2,i!=null&&(d.callback=i),i=Di(n,d,u),i!==null&&(Hn(i,n,u,a),$a(i,n,u))}};function Eh(n,i,a,u,d,m,A){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(u,m,A):i.prototype&&i.prototype.isPureReactComponent?!Lr(a,u)||!Lr(d,m):!0}function Ch(n,i,a){var u=!1,d=Li,m=i.contextType;return typeof m=="object"&&m!==null?m=xn(m):(d=rn(i)?gs:Ht.current,u=i.contextTypes,m=(u=u!=null)?Ks(n,d):Li),i=new i(a,m),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ka,n.stateNode=i,i._reactInternals=n,u&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=d,n.__reactInternalMemoizedMaskedChildContext=m),i}function kh(n,i,a,u){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,u),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,u),i.state!==n&&Ka.enqueueReplaceState(i,i.state,null)}function Vl(n,i,a,u){var d=n.stateNode;d.props=a,d.state=n.memoizedState,d.refs={},Rl(n);var m=i.contextType;typeof m=="object"&&m!==null?d.context=xn(m):(m=rn(i)?gs:Ht.current,d.context=Ks(n,m)),d.state=n.memoizedState,m=i.getDerivedStateFromProps,typeof m=="function"&&(Ul(n,i,m,a),d.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(i=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),i!==d.state&&Ka.enqueueReplaceState(d,d.state,null),Ua(n,a,d,u),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308)}function sr(n,i){try{var a="",u=i;do a+=ve(u),u=u.return;while(u);var d=a}catch(m){d=`
Error generating stack: `+m.message+`
`+m.stack}return{value:n,source:i,stack:d,digest:null}}function Wl(n,i,a){return{value:n,source:null,stack:a??null,digest:i??null}}function Gl(n,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var Tp=typeof WeakMap=="function"?WeakMap:Map;function Th(n,i,a){a=vi(-1,a),a.tag=3,a.payload={element:null};var u=i.value;return a.callback=function(){io||(io=!0,oc=u),Gl(n,i)},a}function Ph(n,i,a){a=vi(-1,a),a.tag=3;var u=n.type.getDerivedStateFromError;if(typeof u=="function"){var d=i.value;a.payload=function(){return u(d)},a.callback=function(){Gl(n,i)}}var m=n.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(a.callback=function(){Gl(n,i),typeof u!="function"&&(ji===null?ji=new Set([this]):ji.add(this));var A=i.stack;this.componentDidCatch(i.value,{componentStack:A!==null?A:""})}),a}function Rh(n,i,a){var u=n.pingCache;if(u===null){u=n.pingCache=new Tp;var d=new Set;u.set(i,d)}else d=u.get(i),d===void 0&&(d=new Set,u.set(i,d));d.has(a)||(d.add(a),n=$p.bind(null,n,i,a),i.then(n,n))}function Mh(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function Nh(n,i,a,u,d){return(n.mode&1)===0?(n===i?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=vi(-1,1),i.tag=2,Di(a,i,1))),a.lanes|=1),n):(n.flags|=65536,n.lanes=d,n)}var Pp=H.ReactCurrentOwner,an=!1;function Kt(n,i,a,u){i.child=n===null?Zu(i,null,a,u):er(i,n.child,a,u)}function Lh(n,i,a,u,d){a=a.render;var m=i.ref;return nr(i,d),u=Ol(n,i,a,u,m,d),a=jl(),n!==null&&!an?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~d,wi(n,i,d)):(lt&&a&&bl(i),i.flags|=1,Kt(n,i,u,d),i.child)}function Ih(n,i,a,u,d){if(n===null){var m=a.type;return typeof m=="function"&&!pc(m)&&m.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=m,Fh(n,i,m,u,d)):(n=co(a.type,null,u,i,i.mode,d),n.ref=i.ref,n.return=i,i.child=n)}if(m=n.child,(n.lanes&d)===0){var A=m.memoizedProps;if(a=a.compare,a=a!==null?a:Lr,a(A,u)&&n.ref===i.ref)return wi(n,i,d)}return i.flags|=1,n=$i(m,u),n.ref=i.ref,n.return=i,i.child=n}function Fh(n,i,a,u,d){if(n!==null){var m=n.memoizedProps;if(Lr(m,u)&&n.ref===i.ref)if(an=!1,i.pendingProps=u=m,(n.lanes&d)!==0)(n.flags&131072)!==0&&(an=!0);else return i.lanes=n.lanes,wi(n,i,d)}return Xl(n,i,a,u,d)}function Dh(n,i,a){var u=i.pendingProps,d=u.children,m=n!==null?n.memoizedState:null;if(u.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(ar,mn),mn|=a;else{if((a&1073741824)===0)return n=m!==null?m.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,it(ar,mn),mn|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=m!==null?m.baseLanes:a,it(ar,mn),mn|=u}else m!==null?(u=m.baseLanes|a,i.memoizedState=null):u=a,it(ar,mn),mn|=u;return Kt(n,i,d,a),i.child}function Oh(n,i){var a=i.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function Xl(n,i,a,u,d){var m=rn(a)?gs:Ht.current;return m=Ks(i,m),nr(i,d),a=Ol(n,i,a,u,m,d),u=jl(),n!==null&&!an?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~d,wi(n,i,d)):(lt&&u&&bl(i),i.flags|=1,Kt(n,i,a,d),i.child)}function jh(n,i,a,u,d){if(rn(a)){var m=!0;Ia(i)}else m=!1;if(nr(i,d),i.stateNode===null)Za(n,i),Ch(i,a,u),Vl(i,a,u,d),u=!0;else if(n===null){var A=i.stateNode,C=i.memoizedProps;A.props=C;var P=A.context,O=a.contextType;typeof O=="object"&&O!==null?O=xn(O):(O=rn(a)?gs:Ht.current,O=Ks(i,O));var W=a.getDerivedStateFromProps,q=typeof W=="function"||typeof A.getSnapshotBeforeUpdate=="function";q||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(C!==u||P!==O)&&kh(i,A,u,O),Fi=!1;var V=i.memoizedState;A.state=V,Ua(i,u,A,d),P=i.memoizedState,C!==u||V!==P||sn.current||Fi?(typeof W=="function"&&(Ul(i,a,W,u),P=i.memoizedState),(C=Fi||Eh(i,a,C,u,V,P,O))?(q||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(i.flags|=4194308)):(typeof A.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=u,i.memoizedState=P),A.props=u,A.state=P,A.context=O,u=C):(typeof A.componentDidMount=="function"&&(i.flags|=4194308),u=!1)}else{A=i.stateNode,eh(n,i),C=i.memoizedProps,O=i.type===i.elementType?C:On(i.type,C),A.props=O,q=i.pendingProps,V=A.context,P=a.contextType,typeof P=="object"&&P!==null?P=xn(P):(P=rn(a)?gs:Ht.current,P=Ks(i,P));var ne=a.getDerivedStateFromProps;(W=typeof ne=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(C!==q||V!==P)&&kh(i,A,u,P),Fi=!1,V=i.memoizedState,A.state=V,Ua(i,u,A,d);var ce=i.memoizedState;C!==q||V!==ce||sn.current||Fi?(typeof ne=="function"&&(Ul(i,a,ne,u),ce=i.memoizedState),(O=Fi||Eh(i,a,O,u,V,ce,P)||!1)?(W||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(u,ce,P),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(u,ce,P)),typeof A.componentDidUpdate=="function"&&(i.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof A.componentDidUpdate!="function"||C===n.memoizedProps&&V===n.memoizedState||(i.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||C===n.memoizedProps&&V===n.memoizedState||(i.flags|=1024),i.memoizedProps=u,i.memoizedState=ce),A.props=u,A.state=ce,A.context=P,u=O):(typeof A.componentDidUpdate!="function"||C===n.memoizedProps&&V===n.memoizedState||(i.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||C===n.memoizedProps&&V===n.memoizedState||(i.flags|=1024),u=!1)}return ql(n,i,a,u,m,d)}function ql(n,i,a,u,d,m){Oh(n,i);var A=(i.flags&128)!==0;if(!u&&!A)return d&&Uu(i,a,!1),wi(n,i,m);u=i.stateNode,Pp.current=i;var C=A&&typeof a.getDerivedStateFromError!="function"?null:u.render();return i.flags|=1,n!==null&&A?(i.child=er(i,n.child,null,m),i.child=er(i,null,C,m)):Kt(n,i,C,m),i.memoizedState=u.state,d&&Uu(i,a,!0),i.child}function zh(n){var i=n.stateNode;i.pendingContext?Bu(n,i.pendingContext,i.pendingContext!==i.context):i.context&&Bu(n,i.context,!1),Ml(n,i.containerInfo)}function Hh(n,i,a,u,d){return Js(),xl(d),i.flags|=256,Kt(n,i,a,u),i.child}var Yl={dehydrated:null,treeContext:null,retryLane:0};function Kl(n){return{baseLanes:n,cachePool:null,transitions:null}}function Bh(n,i,a){var u=i.pendingProps,d=dt.current,m=!1,A=(i.flags&128)!==0,C;if((C=A)||(C=n!==null&&n.memoizedState===null?!1:(d&2)!==0),C?(m=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(d|=1),it(dt,d&1),n===null)return _l(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((i.mode&1)===0?i.lanes=1:n.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(A=u.children,n=u.fallback,m?(u=i.mode,m=i.child,A={mode:"hidden",children:A},(u&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=A):m=uo(A,u,0,null),n=Es(n,u,a,null),m.return=i,n.return=i,m.sibling=n,i.child=m,i.child.memoizedState=Kl(a),i.memoizedState=Yl,n):Ql(i,A));if(d=n.memoizedState,d!==null&&(C=d.dehydrated,C!==null))return Rp(n,i,A,u,C,d,a);if(m){m=u.fallback,A=i.mode,d=n.child,C=d.sibling;var P={mode:"hidden",children:u.children};return(A&1)===0&&i.child!==d?(u=i.child,u.childLanes=0,u.pendingProps=P,i.deletions=null):(u=$i(d,P),u.subtreeFlags=d.subtreeFlags&14680064),C!==null?m=$i(C,m):(m=Es(m,A,a,null),m.flags|=2),m.return=i,u.return=i,u.sibling=m,i.child=u,u=m,m=i.child,A=n.child.memoizedState,A=A===null?Kl(a):{baseLanes:A.baseLanes|a,cachePool:null,transitions:A.transitions},m.memoizedState=A,m.childLanes=n.childLanes&~a,i.memoizedState=Yl,u}return m=n.child,n=m.sibling,u=$i(m,{mode:"visible",children:u.children}),(i.mode&1)===0&&(u.lanes=a),u.return=i,u.sibling=null,n!==null&&(a=i.deletions,a===null?(i.deletions=[n],i.flags|=16):a.push(n)),i.child=u,i.memoizedState=null,u}function Ql(n,i){return i=uo({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function Qa(n,i,a,u){return u!==null&&xl(u),er(i,n.child,null,a),n=Ql(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function Rp(n,i,a,u,d,m,A){if(a)return i.flags&256?(i.flags&=-257,u=Wl(Error(t(422))),Qa(n,i,A,u)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(m=u.fallback,d=i.mode,u=uo({mode:"visible",children:u.children},d,0,null),m=Es(m,d,A,null),m.flags|=2,u.return=i,m.return=i,u.sibling=m,i.child=u,(i.mode&1)!==0&&er(i,n.child,null,A),i.child.memoizedState=Kl(A),i.memoizedState=Yl,m);if((i.mode&1)===0)return Qa(n,i,A,null);if(d.data==="$!"){if(u=d.nextSibling&&d.nextSibling.dataset,u)var C=u.dgst;return u=C,m=Error(t(419)),u=Wl(m,u,void 0),Qa(n,i,A,u)}if(C=(A&n.childLanes)!==0,an||C){if(u=Mt,u!==null){switch(A&-A){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=(d&(u.suspendedLanes|A))!==0?0:d,d!==0&&d!==m.retryLane&&(m.retryLane=d,yi(n,d),Hn(u,n,d,-1))}return fc(),u=Wl(Error(t(421))),Qa(n,i,A,u)}return d.data==="$?"?(i.flags|=128,i.child=n.child,i=Up.bind(null,n),d._reactRetry=i,null):(n=m.treeContext,gn=Mi(d.nextSibling),pn=i,lt=!0,Dn=null,n!==null&&(Sn[_n++]=gi,Sn[_n++]=mi,Sn[_n++]=ms,gi=n.id,mi=n.overflow,ms=i),i=Ql(i,u.children),i.flags|=4096,i)}function $h(n,i,a){n.lanes|=i;var u=n.alternate;u!==null&&(u.lanes|=i),Tl(n.return,i,a)}function Zl(n,i,a,u,d){var m=n.memoizedState;m===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:u,tail:a,tailMode:d}:(m.isBackwards=i,m.rendering=null,m.renderingStartTime=0,m.last=u,m.tail=a,m.tailMode=d)}function Uh(n,i,a){var u=i.pendingProps,d=u.revealOrder,m=u.tail;if(Kt(n,i,u.children,a),u=dt.current,(u&2)!==0)u=u&1|2,i.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&$h(n,a,i);else if(n.tag===19)$h(n,a,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}u&=1}if(it(dt,u),(i.mode&1)===0)i.memoizedState=null;else switch(d){case"forwards":for(a=i.child,d=null;a!==null;)n=a.alternate,n!==null&&Va(n)===null&&(d=a),a=a.sibling;a=d,a===null?(d=i.child,i.child=null):(d=a.sibling,a.sibling=null),Zl(i,!1,d,a,m);break;case"backwards":for(a=null,d=i.child,i.child=null;d!==null;){if(n=d.alternate,n!==null&&Va(n)===null){i.child=d;break}n=d.sibling,d.sibling=a,a=d,d=n}Zl(i,!0,a,null,m);break;case"together":Zl(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Za(n,i){(i.mode&1)===0&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function wi(n,i,a){if(n!==null&&(i.dependencies=n.dependencies),As|=i.lanes,(a&i.childLanes)===0)return null;if(n!==null&&i.child!==n.child)throw Error(t(153));if(i.child!==null){for(n=i.child,a=$i(n,n.pendingProps),i.child=a,a.return=i;n.sibling!==null;)n=n.sibling,a=a.sibling=$i(n,n.pendingProps),a.return=i;a.sibling=null}return i.child}function Mp(n,i,a){switch(i.tag){case 3:zh(i),Js();break;case 5:ih(i);break;case 1:rn(i.type)&&Ia(i);break;case 4:Ml(i,i.stateNode.containerInfo);break;case 10:var u=i.type._context,d=i.memoizedProps.value;it(Ha,u._currentValue),u._currentValue=d;break;case 13:if(u=i.memoizedState,u!==null)return u.dehydrated!==null?(it(dt,dt.current&1),i.flags|=128,null):(a&i.child.childLanes)!==0?Bh(n,i,a):(it(dt,dt.current&1),n=wi(n,i,a),n!==null?n.sibling:null);it(dt,dt.current&1);break;case 19:if(u=(a&i.childLanes)!==0,(n.flags&128)!==0){if(u)return Uh(n,i,a);i.flags|=128}if(d=i.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),it(dt,dt.current),u)break;return null;case 22:case 23:return i.lanes=0,Dh(n,i,a)}return wi(n,i,a)}var Vh,Jl,Wh,Gh;Vh=function(n,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},Jl=function(){},Wh=function(n,i,a,u){var d=n.memoizedProps;if(d!==u){n=i.stateNode,ws(ei.current);var m=null;switch(a){case"input":d=Ke(n,d),u=Ke(n,u),m=[];break;case"select":d=Y({},d,{value:void 0}),u=Y({},u,{value:void 0}),m=[];break;case"textarea":d=Ki(n,d),u=Ki(n,u),m=[];break;default:typeof d.onClick!="function"&&typeof u.onClick=="function"&&(n.onclick=Ma)}Mn(a,u);var A;a=null;for(O in d)if(!u.hasOwnProperty(O)&&d.hasOwnProperty(O)&&d[O]!=null)if(O==="style"){var C=d[O];for(A in C)C.hasOwnProperty(A)&&(a||(a={}),a[A]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(r.hasOwnProperty(O)?m||(m=[]):(m=m||[]).push(O,null));for(O in u){var P=u[O];if(C=d?.[O],u.hasOwnProperty(O)&&P!==C&&(P!=null||C!=null))if(O==="style")if(C){for(A in C)!C.hasOwnProperty(A)||P&&P.hasOwnProperty(A)||(a||(a={}),a[A]="");for(A in P)P.hasOwnProperty(A)&&C[A]!==P[A]&&(a||(a={}),a[A]=P[A])}else a||(m||(m=[]),m.push(O,a)),a=P;else O==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,C=C?C.__html:void 0,P!=null&&C!==P&&(m=m||[]).push(O,P)):O==="children"?typeof P!="string"&&typeof P!="number"||(m=m||[]).push(O,""+P):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(r.hasOwnProperty(O)?(P!=null&&O==="onScroll"&&rt("scroll",n),m||C===P||(m=[])):(m=m||[]).push(O,P))}a&&(m=m||[]).push("style",a);var O=m;(i.updateQueue=O)&&(i.flags|=4)}},Gh=function(n,i,a,u){a!==u&&(i.flags|=4)};function qr(n,i){if(!lt)switch(n.tailMode){case"hidden":i=n.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:u.sibling=null}}function $t(n){var i=n.alternate!==null&&n.alternate.child===n.child,a=0,u=0;if(i)for(var d=n.child;d!==null;)a|=d.lanes|d.childLanes,u|=d.subtreeFlags&14680064,u|=d.flags&14680064,d.return=n,d=d.sibling;else for(d=n.child;d!==null;)a|=d.lanes|d.childLanes,u|=d.subtreeFlags,u|=d.flags,d.return=n,d=d.sibling;return n.subtreeFlags|=u,n.childLanes=a,i}function Np(n,i,a){var u=i.pendingProps;switch(Al(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $t(i),null;case 1:return rn(i.type)&&La(),$t(i),null;case 3:return u=i.stateNode,ir(),at(sn),at(Ht),Il(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(n===null||n.child===null)&&(ja(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Dn!==null&&(uc(Dn),Dn=null))),Jl(n,i),$t(i),null;case 5:Nl(i);var d=ws(Ur.current);if(a=i.type,n!==null&&i.stateNode!=null)Wh(n,i,a,u,d),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!u){if(i.stateNode===null)throw Error(t(166));return $t(i),null}if(n=ws(ei.current),ja(i)){u=i.stateNode,a=i.type;var m=i.memoizedProps;switch(u[Jn]=i,u[jr]=m,n=(i.mode&1)!==0,a){case"dialog":rt("cancel",u),rt("close",u);break;case"iframe":case"object":case"embed":rt("load",u);break;case"video":case"audio":for(d=0;d<Fr.length;d++)rt(Fr[d],u);break;case"source":rt("error",u);break;case"img":case"image":case"link":rt("error",u),rt("load",u);break;case"details":rt("toggle",u);break;case"input":Xt(u,m),rt("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!m.multiple},rt("invalid",u);break;case"textarea":vr(u,m),rt("invalid",u)}Mn(a,m),d=null;for(var A in m)if(m.hasOwnProperty(A)){var C=m[A];A==="children"?typeof C=="string"?u.textContent!==C&&(m.suppressHydrationWarning!==!0&&Ra(u.textContent,C,n),d=["children",C]):typeof C=="number"&&u.textContent!==""+C&&(m.suppressHydrationWarning!==!0&&Ra(u.textContent,C,n),d=["children",""+C]):r.hasOwnProperty(A)&&C!=null&&A==="onScroll"&&rt("scroll",u)}switch(a){case"input":jt(u),Ns(u,m,!0);break;case"textarea":jt(u),oi(u);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(u.onclick=Ma)}u=d,i.updateQueue=u,u!==null&&(i.flags|=4)}else{A=d.nodeType===9?d:d.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=ya(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=A.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof u.is=="string"?n=A.createElement(a,{is:u.is}):(n=A.createElement(a),a==="select"&&(A=n,u.multiple?A.multiple=!0:u.size&&(A.size=u.size))):n=A.createElementNS(n,a),n[Jn]=i,n[jr]=u,Vh(n,i,!1,!1),i.stateNode=n;e:{switch(A=Ji(a,u),a){case"dialog":rt("cancel",n),rt("close",n),d=u;break;case"iframe":case"object":case"embed":rt("load",n),d=u;break;case"video":case"audio":for(d=0;d<Fr.length;d++)rt(Fr[d],n);d=u;break;case"source":rt("error",n),d=u;break;case"img":case"image":case"link":rt("error",n),rt("load",n),d=u;break;case"details":rt("toggle",n),d=u;break;case"input":Xt(n,u),d=Ke(n,u),rt("invalid",n);break;case"option":d=u;break;case"select":n._wrapperState={wasMultiple:!!u.multiple},d=Y({},u,{value:void 0}),rt("invalid",n);break;case"textarea":vr(n,u),d=Ki(n,u),rt("invalid",n);break;default:d=u}Mn(a,d),C=d;for(m in C)if(C.hasOwnProperty(m)){var P=C[m];m==="style"?Zi(n,P):m==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,P!=null&&Ls(n,P)):m==="children"?typeof P=="string"?(a!=="textarea"||P!=="")&&Rn(n,P):typeof P=="number"&&Rn(n,""+P):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(r.hasOwnProperty(m)?P!=null&&m==="onScroll"&&rt("scroll",n):P!=null&&z(n,m,P,A))}switch(a){case"input":jt(n),Ns(n,u,!1);break;case"textarea":jt(n),oi(n);break;case"option":u.value!=null&&n.setAttribute("value",""+me(u.value));break;case"select":n.multiple=!!u.multiple,m=u.value,m!=null?xi(n,!!u.multiple,m,!1):u.defaultValue!=null&&xi(n,!!u.multiple,u.defaultValue,!0);break;default:typeof d.onClick=="function"&&(n.onclick=Ma)}switch(a){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return $t(i),null;case 6:if(n&&i.stateNode!=null)Gh(n,i,n.memoizedProps,u);else{if(typeof u!="string"&&i.stateNode===null)throw Error(t(166));if(a=ws(Ur.current),ws(ei.current),ja(i)){if(u=i.stateNode,a=i.memoizedProps,u[Jn]=i,(m=u.nodeValue!==a)&&(n=pn,n!==null))switch(n.tag){case 3:Ra(u.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Ra(u.nodeValue,a,(n.mode&1)!==0)}m&&(i.flags|=4)}else u=(a.nodeType===9?a:a.ownerDocument).createTextNode(u),u[Jn]=i,i.stateNode=u}return $t(i),null;case 13:if(at(dt),u=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(lt&&gn!==null&&(i.mode&1)!==0&&(i.flags&128)===0)Yu(),Js(),i.flags|=98560,m=!1;else if(m=ja(i),u!==null&&u.dehydrated!==null){if(n===null){if(!m)throw Error(t(318));if(m=i.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(t(317));m[Jn]=i}else Js(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;$t(i),m=!1}else Dn!==null&&(uc(Dn),Dn=null),m=!0;if(!m)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=a,i):(u=u!==null,u!==(n!==null&&n.memoizedState!==null)&&u&&(i.child.flags|=8192,(i.mode&1)!==0&&(n===null||(dt.current&1)!==0?Et===0&&(Et=3):fc())),i.updateQueue!==null&&(i.flags|=4),$t(i),null);case 4:return ir(),Jl(n,i),n===null&&Dr(i.stateNode.containerInfo),$t(i),null;case 10:return kl(i.type._context),$t(i),null;case 17:return rn(i.type)&&La(),$t(i),null;case 19:if(at(dt),m=i.memoizedState,m===null)return $t(i),null;if(u=(i.flags&128)!==0,A=m.rendering,A===null)if(u)qr(m,!1);else{if(Et!==0||n!==null&&(n.flags&128)!==0)for(n=i.child;n!==null;){if(A=Va(n),A!==null){for(i.flags|=128,qr(m,!1),u=A.updateQueue,u!==null&&(i.updateQueue=u,i.flags|=4),i.subtreeFlags=0,u=a,a=i.child;a!==null;)m=a,n=u,m.flags&=14680066,A=m.alternate,A===null?(m.childLanes=0,m.lanes=n,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=A.childLanes,m.lanes=A.lanes,m.child=A.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=A.memoizedProps,m.memoizedState=A.memoizedState,m.updateQueue=A.updateQueue,m.type=A.type,n=A.dependencies,m.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return it(dt,dt.current&1|2),i.child}n=n.sibling}m.tail!==null&&ot()>or&&(i.flags|=128,u=!0,qr(m,!1),i.lanes=4194304)}else{if(!u)if(n=Va(A),n!==null){if(i.flags|=128,u=!0,a=n.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),qr(m,!0),m.tail===null&&m.tailMode==="hidden"&&!A.alternate&&!lt)return $t(i),null}else 2*ot()-m.renderingStartTime>or&&a!==1073741824&&(i.flags|=128,u=!0,qr(m,!1),i.lanes=4194304);m.isBackwards?(A.sibling=i.child,i.child=A):(a=m.last,a!==null?a.sibling=A:i.child=A,m.last=A)}return m.tail!==null?(i=m.tail,m.rendering=i,m.tail=i.sibling,m.renderingStartTime=ot(),i.sibling=null,a=dt.current,it(dt,u?a&1|2:a&1),i):($t(i),null);case 22:case 23:return dc(),u=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==u&&(i.flags|=8192),u&&(i.mode&1)!==0?(mn&1073741824)!==0&&($t(i),i.subtreeFlags&6&&(i.flags|=8192)):$t(i),null;case 24:return null;case 25:return null}throw Error(t(156,i.tag))}function Lp(n,i){switch(Al(i),i.tag){case 1:return rn(i.type)&&La(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return ir(),at(sn),at(Ht),Il(),n=i.flags,(n&65536)!==0&&(n&128)===0?(i.flags=n&-65537|128,i):null;case 5:return Nl(i),null;case 13:if(at(dt),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(t(340));Js()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return at(dt),null;case 4:return ir(),null;case 10:return kl(i.type._context),null;case 22:case 23:return dc(),null;case 24:return null;default:return null}}var Ja=!1,Ut=!1,Ip=typeof WeakSet=="function"?WeakSet:Set,oe=null;function rr(n,i){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(u){pt(n,i,u)}else a.current=null}function ec(n,i,a){try{a()}catch(u){pt(n,i,u)}}var Xh=!1;function Fp(n,i){if(dl=Ge,n=Eu(),sl(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var u=a.getSelection&&a.getSelection();if(u&&u.rangeCount!==0){a=u.anchorNode;var d=u.anchorOffset,m=u.focusNode;u=u.focusOffset;try{a.nodeType,m.nodeType}catch{a=null;break e}var A=0,C=-1,P=-1,O=0,W=0,q=n,V=null;t:for(;;){for(var ne;q!==a||d!==0&&q.nodeType!==3||(C=A+d),q!==m||u!==0&&q.nodeType!==3||(P=A+u),q.nodeType===3&&(A+=q.nodeValue.length),(ne=q.firstChild)!==null;)V=q,q=ne;for(;;){if(q===n)break t;if(V===a&&++O===d&&(C=A),V===m&&++W===u&&(P=A),(ne=q.nextSibling)!==null)break;q=V,V=q.parentNode}q=ne}a=C===-1||P===-1?null:{start:C,end:P}}else a=null}a=a||{start:0,end:0}}else a=null;for(fl={focusedElem:n,selectionRange:a},Ge=!1,oe=i;oe!==null;)if(i=oe,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,oe=n;else for(;oe!==null;){i=oe;try{var ce=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var ue=ce.memoizedProps,mt=ce.memoizedState,L=i.stateNode,N=L.getSnapshotBeforeUpdate(i.elementType===i.type?ue:On(i.type,ue),mt);L.__reactInternalSnapshotBeforeUpdate=N}break;case 3:var D=i.stateNode.containerInfo;D.nodeType===1?D.textContent="":D.nodeType===9&&D.documentElement&&D.removeChild(D.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Q){pt(i,i.return,Q)}if(n=i.sibling,n!==null){n.return=i.return,oe=n;break}oe=i.return}return ce=Xh,Xh=!1,ce}function Yr(n,i,a){var u=i.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var d=u=u.next;do{if((d.tag&n)===n){var m=d.destroy;d.destroy=void 0,m!==void 0&&ec(i,a,m)}d=d.next}while(d!==u)}}function eo(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&n)===n){var u=a.create;a.destroy=u()}a=a.next}while(a!==i)}}function tc(n){var i=n.ref;if(i!==null){var a=n.stateNode;n.tag,n=a,typeof i=="function"?i(n):i.current=n}}function qh(n){var i=n.alternate;i!==null&&(n.alternate=null,qh(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[Jn],delete i[jr],delete i[yl],delete i[yp],delete i[vp])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Yh(n){return n.tag===5||n.tag===3||n.tag===4}function Kh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Yh(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function nc(n,i,a){var u=n.tag;if(u===5||u===6)n=n.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(n,i):a.insertBefore(n,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(n,a)):(i=a,i.appendChild(n)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=Ma));else if(u!==4&&(n=n.child,n!==null))for(nc(n,i,a),n=n.sibling;n!==null;)nc(n,i,a),n=n.sibling}function ic(n,i,a){var u=n.tag;if(u===5||u===6)n=n.stateNode,i?a.insertBefore(n,i):a.appendChild(n);else if(u!==4&&(n=n.child,n!==null))for(ic(n,i,a),n=n.sibling;n!==null;)ic(n,i,a),n=n.sibling}var Dt=null,jn=!1;function Oi(n,i,a){for(a=a.child;a!==null;)Qh(n,i,a),a=a.sibling}function Qh(n,i,a){if(bn&&typeof bn.onCommitFiberUnmount=="function")try{bn.onCommitFiberUnmount(Yt,a)}catch{}switch(a.tag){case 5:Ut||rr(a,i);case 6:var u=Dt,d=jn;Dt=null,Oi(n,i,a),Dt=u,jn=d,Dt!==null&&(jn?(n=Dt,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Dt.removeChild(a.stateNode));break;case 18:Dt!==null&&(jn?(n=Dt,a=a.stateNode,n.nodeType===8?ml(n.parentNode,a):n.nodeType===1&&ml(n,a),st(n)):ml(Dt,a.stateNode));break;case 4:u=Dt,d=jn,Dt=a.stateNode.containerInfo,jn=!0,Oi(n,i,a),Dt=u,jn=d;break;case 0:case 11:case 14:case 15:if(!Ut&&(u=a.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){d=u=u.next;do{var m=d,A=m.destroy;m=m.tag,A!==void 0&&((m&2)!==0||(m&4)!==0)&&ec(a,i,A),d=d.next}while(d!==u)}Oi(n,i,a);break;case 1:if(!Ut&&(rr(a,i),u=a.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=a.memoizedProps,u.state=a.memoizedState,u.componentWillUnmount()}catch(C){pt(a,i,C)}Oi(n,i,a);break;case 21:Oi(n,i,a);break;case 22:a.mode&1?(Ut=(u=Ut)||a.memoizedState!==null,Oi(n,i,a),Ut=u):Oi(n,i,a);break;default:Oi(n,i,a)}}function Zh(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new Ip),i.forEach(function(u){var d=Vp.bind(null,n,u);a.has(u)||(a.add(u),u.then(d,d))})}}function zn(n,i){var a=i.deletions;if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];try{var m=n,A=i,C=A;e:for(;C!==null;){switch(C.tag){case 5:Dt=C.stateNode,jn=!1;break e;case 3:Dt=C.stateNode.containerInfo,jn=!0;break e;case 4:Dt=C.stateNode.containerInfo,jn=!0;break e}C=C.return}if(Dt===null)throw Error(t(160));Qh(m,A,d),Dt=null,jn=!1;var P=d.alternate;P!==null&&(P.return=null),d.return=null}catch(O){pt(d,i,O)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Jh(i,n),i=i.sibling}function Jh(n,i){var a=n.alternate,u=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(zn(i,n),ni(n),u&4){try{Yr(3,n,n.return),eo(3,n)}catch(ue){pt(n,n.return,ue)}try{Yr(5,n,n.return)}catch(ue){pt(n,n.return,ue)}}break;case 1:zn(i,n),ni(n),u&512&&a!==null&&rr(a,a.return);break;case 5:if(zn(i,n),ni(n),u&512&&a!==null&&rr(a,a.return),n.flags&32){var d=n.stateNode;try{Rn(d,"")}catch(ue){pt(n,n.return,ue)}}if(u&4&&(d=n.stateNode,d!=null)){var m=n.memoizedProps,A=a!==null?a.memoizedProps:m,C=n.type,P=n.updateQueue;if(n.updateQueue=null,P!==null)try{C==="input"&&m.type==="radio"&&m.name!=null&&tt(d,m),Ji(C,A);var O=Ji(C,m);for(A=0;A<P.length;A+=2){var W=P[A],q=P[A+1];W==="style"?Zi(d,q):W==="dangerouslySetInnerHTML"?Ls(d,q):W==="children"?Rn(d,q):z(d,W,q,O)}switch(C){case"input":wt(d,m);break;case"textarea":Oe(d,m);break;case"select":var V=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!m.multiple;var ne=m.value;ne!=null?xi(d,!!m.multiple,ne,!1):V!==!!m.multiple&&(m.defaultValue!=null?xi(d,!!m.multiple,m.defaultValue,!0):xi(d,!!m.multiple,m.multiple?[]:"",!1))}d[jr]=m}catch(ue){pt(n,n.return,ue)}}break;case 6:if(zn(i,n),ni(n),u&4){if(n.stateNode===null)throw Error(t(162));d=n.stateNode,m=n.memoizedProps;try{d.nodeValue=m}catch(ue){pt(n,n.return,ue)}}break;case 3:if(zn(i,n),ni(n),u&4&&a!==null&&a.memoizedState.isDehydrated)try{st(i.containerInfo)}catch(ue){pt(n,n.return,ue)}break;case 4:zn(i,n),ni(n);break;case 13:zn(i,n),ni(n),d=n.child,d.flags&8192&&(m=d.memoizedState!==null,d.stateNode.isHidden=m,!m||d.alternate!==null&&d.alternate.memoizedState!==null||(ac=ot())),u&4&&Zh(n);break;case 22:if(W=a!==null&&a.memoizedState!==null,n.mode&1?(Ut=(O=Ut)||W,zn(i,n),Ut=O):zn(i,n),ni(n),u&8192){if(O=n.memoizedState!==null,(n.stateNode.isHidden=O)&&!W&&(n.mode&1)!==0)for(oe=n,W=n.child;W!==null;){for(q=oe=W;oe!==null;){switch(V=oe,ne=V.child,V.tag){case 0:case 11:case 14:case 15:Yr(4,V,V.return);break;case 1:rr(V,V.return);var ce=V.stateNode;if(typeof ce.componentWillUnmount=="function"){u=V,a=V.return;try{i=u,ce.props=i.memoizedProps,ce.state=i.memoizedState,ce.componentWillUnmount()}catch(ue){pt(u,a,ue)}}break;case 5:rr(V,V.return);break;case 22:if(V.memoizedState!==null){nd(q);continue}}ne!==null?(ne.return=V,oe=ne):nd(q)}W=W.sibling}e:for(W=null,q=n;;){if(q.tag===5){if(W===null){W=q;try{d=q.stateNode,O?(m=d.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(C=q.stateNode,P=q.memoizedProps.style,A=P!=null&&P.hasOwnProperty("display")?P.display:null,C.style.display=Is("display",A))}catch(ue){pt(n,n.return,ue)}}}else if(q.tag===6){if(W===null)try{q.stateNode.nodeValue=O?"":q.memoizedProps}catch(ue){pt(n,n.return,ue)}}else if((q.tag!==22&&q.tag!==23||q.memoizedState===null||q===n)&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===n)break e;for(;q.sibling===null;){if(q.return===null||q.return===n)break e;W===q&&(W=null),q=q.return}W===q&&(W=null),q.sibling.return=q.return,q=q.sibling}}break;case 19:zn(i,n),ni(n),u&4&&Zh(n);break;case 21:break;default:zn(i,n),ni(n)}}function ni(n){var i=n.flags;if(i&2){try{e:{for(var a=n.return;a!==null;){if(Yh(a)){var u=a;break e}a=a.return}throw Error(t(160))}switch(u.tag){case 5:var d=u.stateNode;u.flags&32&&(Rn(d,""),u.flags&=-33);var m=Kh(n);ic(n,m,d);break;case 3:case 4:var A=u.stateNode.containerInfo,C=Kh(n);nc(n,C,A);break;default:throw Error(t(161))}}catch(P){pt(n,n.return,P)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function Dp(n,i,a){oe=n,ed(n)}function ed(n,i,a){for(var u=(n.mode&1)!==0;oe!==null;){var d=oe,m=d.child;if(d.tag===22&&u){var A=d.memoizedState!==null||Ja;if(!A){var C=d.alternate,P=C!==null&&C.memoizedState!==null||Ut;C=Ja;var O=Ut;if(Ja=A,(Ut=P)&&!O)for(oe=d;oe!==null;)A=oe,P=A.child,A.tag===22&&A.memoizedState!==null?id(d):P!==null?(P.return=A,oe=P):id(d);for(;m!==null;)oe=m,ed(m),m=m.sibling;oe=d,Ja=C,Ut=O}td(n)}else(d.subtreeFlags&8772)!==0&&m!==null?(m.return=d,oe=m):td(n)}}function td(n){for(;oe!==null;){var i=oe;if((i.flags&8772)!==0){var a=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:Ut||eo(5,i);break;case 1:var u=i.stateNode;if(i.flags&4&&!Ut)if(a===null)u.componentDidMount();else{var d=i.elementType===i.type?a.memoizedProps:On(i.type,a.memoizedProps);u.componentDidUpdate(d,a.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var m=i.updateQueue;m!==null&&nh(i,m,u);break;case 3:var A=i.updateQueue;if(A!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}nh(i,A,a)}break;case 5:var C=i.stateNode;if(a===null&&i.flags&4){a=C;var P=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":P.autoFocus&&a.focus();break;case"img":P.src&&(a.src=P.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var O=i.alternate;if(O!==null){var W=O.memoizedState;if(W!==null){var q=W.dehydrated;q!==null&&st(q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ut||i.flags&512&&tc(i)}catch(V){pt(i,i.return,V)}}if(i===n){oe=null;break}if(a=i.sibling,a!==null){a.return=i.return,oe=a;break}oe=i.return}}function nd(n){for(;oe!==null;){var i=oe;if(i===n){oe=null;break}var a=i.sibling;if(a!==null){a.return=i.return,oe=a;break}oe=i.return}}function id(n){for(;oe!==null;){var i=oe;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{eo(4,i)}catch(P){pt(i,a,P)}break;case 1:var u=i.stateNode;if(typeof u.componentDidMount=="function"){var d=i.return;try{u.componentDidMount()}catch(P){pt(i,d,P)}}var m=i.return;try{tc(i)}catch(P){pt(i,m,P)}break;case 5:var A=i.return;try{tc(i)}catch(P){pt(i,A,P)}}}catch(P){pt(i,i.return,P)}if(i===n){oe=null;break}var C=i.sibling;if(C!==null){C.return=i.return,oe=C;break}oe=i.return}}var Op=Math.ceil,to=H.ReactCurrentDispatcher,sc=H.ReactCurrentOwner,Cn=H.ReactCurrentBatchConfig,Ve=0,Mt=null,bt=null,Ot=0,mn=0,ar=Ni(0),Et=0,Kr=null,As=0,no=0,rc=0,Qr=null,on=null,ac=0,or=1/0,bi=null,io=!1,oc=null,ji=null,so=!1,zi=null,ro=0,Zr=0,lc=null,ao=-1,oo=0;function Qt(){return(Ve&6)!==0?ot():ao!==-1?ao:ao=ot()}function Hi(n){return(n.mode&1)===0?1:(Ve&2)!==0&&Ot!==0?Ot&-Ot:bp.transition!==null?(oo===0&&(oo=_r()),oo):(n=Ue,n!==0||(n=window.event,n=n===void 0?16:Ft(n.type)),n)}function Hn(n,i,a,u){if(50<Zr)throw Zr=0,lc=null,Error(t(185));ls(n,a,u),((Ve&2)===0||n!==Mt)&&(n===Mt&&((Ve&2)===0&&(no|=a),Et===4&&Bi(n,Ot)),ln(n,u),a===1&&Ve===0&&(i.mode&1)===0&&(or=ot()+500,Fa&&Ii()))}function ln(n,i){var a=n.callbackNode;Yo(n,i);var u=Xn(n,n===Mt?Ot:0);if(u===0)a!==null&&Ds(a),n.callbackNode=null,n.callbackPriority=0;else if(i=u&-u,n.callbackPriority!==i){if(a!=null&&Ds(a),i===1)n.tag===0?wp(rd.bind(null,n)):Vu(rd.bind(null,n)),gp(function(){(Ve&6)===0&&Ii()}),a=null;else{switch(Hs(u)){case 1:a=Ar;break;case 4:a=Aa;break;case 16:a=Os;break;case 536870912:a=js;break;default:a=Os}a=fd(a,sd.bind(null,n))}n.callbackPriority=i,n.callbackNode=a}}function sd(n,i){if(ao=-1,oo=0,(Ve&6)!==0)throw Error(t(327));var a=n.callbackNode;if(lr()&&n.callbackNode!==a)return null;var u=Xn(n,n===Mt?Ot:0);if(u===0)return null;if((u&30)!==0||(u&n.expiredLanes)!==0||i)i=lo(n,u);else{i=u;var d=Ve;Ve|=2;var m=od();(Mt!==n||Ot!==i)&&(bi=null,or=ot()+500,_s(n,i));do try{Hp();break}catch(C){ad(n,C)}while(!0);Cl(),to.current=m,Ve=d,bt!==null?i=0:(Mt=null,Ot=0,i=Et)}if(i!==0){if(i===2&&(d=Sr(n),d!==0&&(u=d,i=cc(n,d))),i===1)throw a=Kr,_s(n,0),Bi(n,u),ln(n,ot()),a;if(i===6)Bi(n,u);else{if(d=n.current.alternate,(u&30)===0&&!jp(d)&&(i=lo(n,u),i===2&&(m=Sr(n),m!==0&&(u=m,i=cc(n,m))),i===1))throw a=Kr,_s(n,0),Bi(n,u),ln(n,ot()),a;switch(n.finishedWork=d,n.finishedLanes=u,i){case 0:case 1:throw Error(t(345));case 2:xs(n,on,bi);break;case 3:if(Bi(n,u),(u&130023424)===u&&(i=ac+500-ot(),10<i)){if(Xn(n,0)!==0)break;if(d=n.suspendedLanes,(d&u)!==u){Qt(),n.pingedLanes|=n.suspendedLanes&d;break}n.timeoutHandle=gl(xs.bind(null,n,on,bi),i);break}xs(n,on,bi);break;case 4:if(Bi(n,u),(u&4194240)===u)break;for(i=n.eventTimes,d=-1;0<u;){var A=31-Ze(u);m=1<<A,A=i[A],A>d&&(d=A),u&=~m}if(u=d,u=ot()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*Op(u/1960))-u,10<u){n.timeoutHandle=gl(xs.bind(null,n,on,bi),u);break}xs(n,on,bi);break;case 5:xs(n,on,bi);break;default:throw Error(t(329))}}}return ln(n,ot()),n.callbackNode===a?sd.bind(null,n):null}function cc(n,i){var a=Qr;return n.current.memoizedState.isDehydrated&&(_s(n,i).flags|=256),n=lo(n,i),n!==2&&(i=on,on=a,i!==null&&uc(i)),n}function uc(n){on===null?on=n:on.push.apply(on,n)}function jp(n){for(var i=n;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var u=0;u<a.length;u++){var d=a[u],m=d.getSnapshot;d=d.value;try{if(!Fn(m(),d))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Bi(n,i){for(i&=~rc,i&=~no,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var a=31-Ze(i),u=1<<a;n[a]=-1,i&=~u}}function rd(n){if((Ve&6)!==0)throw Error(t(327));lr();var i=Xn(n,0);if((i&1)===0)return ln(n,ot()),null;var a=lo(n,i);if(n.tag!==0&&a===2){var u=Sr(n);u!==0&&(i=u,a=cc(n,u))}if(a===1)throw a=Kr,_s(n,0),Bi(n,i),ln(n,ot()),a;if(a===6)throw Error(t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,xs(n,on,bi),ln(n,ot()),null}function hc(n,i){var a=Ve;Ve|=1;try{return n(i)}finally{Ve=a,Ve===0&&(or=ot()+500,Fa&&Ii())}}function Ss(n){zi!==null&&zi.tag===0&&(Ve&6)===0&&lr();var i=Ve;Ve|=1;var a=Cn.transition,u=Ue;try{if(Cn.transition=null,Ue=1,n)return n()}finally{Ue=u,Cn.transition=a,Ve=i,(Ve&6)===0&&Ii()}}function dc(){mn=ar.current,at(ar)}function _s(n,i){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,pp(a)),bt!==null)for(a=bt.return;a!==null;){var u=a;switch(Al(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&La();break;case 3:ir(),at(sn),at(Ht),Il();break;case 5:Nl(u);break;case 4:ir();break;case 13:at(dt);break;case 19:at(dt);break;case 10:kl(u.type._context);break;case 22:case 23:dc()}a=a.return}if(Mt=n,bt=n=$i(n.current,null),Ot=mn=i,Et=0,Kr=null,rc=no=As=0,on=Qr=null,vs!==null){for(i=0;i<vs.length;i++)if(a=vs[i],u=a.interleaved,u!==null){a.interleaved=null;var d=u.next,m=a.pending;if(m!==null){var A=m.next;m.next=d,u.next=A}a.pending=u}vs=null}return n}function ad(n,i){do{var a=bt;try{if(Cl(),Wa.current=Ya,Ga){for(var u=ft.memoizedState;u!==null;){var d=u.queue;d!==null&&(d.pending=null),u=u.next}Ga=!1}if(bs=0,Rt=xt=ft=null,Vr=!1,Wr=0,sc.current=null,a===null||a.return===null){Et=1,Kr=i,bt=null;break}e:{var m=n,A=a.return,C=a,P=i;if(i=Ot,C.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){var O=P,W=C,q=W.tag;if((W.mode&1)===0&&(q===0||q===11||q===15)){var V=W.alternate;V?(W.updateQueue=V.updateQueue,W.memoizedState=V.memoizedState,W.lanes=V.lanes):(W.updateQueue=null,W.memoizedState=null)}var ne=Mh(A);if(ne!==null){ne.flags&=-257,Nh(ne,A,C,m,i),ne.mode&1&&Rh(m,O,i),i=ne,P=O;var ce=i.updateQueue;if(ce===null){var ue=new Set;ue.add(P),i.updateQueue=ue}else ce.add(P);break e}else{if((i&1)===0){Rh(m,O,i),fc();break e}P=Error(t(426))}}else if(lt&&C.mode&1){var mt=Mh(A);if(mt!==null){(mt.flags&65536)===0&&(mt.flags|=256),Nh(mt,A,C,m,i),xl(sr(P,C));break e}}m=P=sr(P,C),Et!==4&&(Et=2),Qr===null?Qr=[m]:Qr.push(m),m=A;do{switch(m.tag){case 3:m.flags|=65536,i&=-i,m.lanes|=i;var L=Th(m,P,i);th(m,L);break e;case 1:C=P;var N=m.type,D=m.stateNode;if((m.flags&128)===0&&(typeof N.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(ji===null||!ji.has(D)))){m.flags|=65536,i&=-i,m.lanes|=i;var Q=Ph(m,C,i);th(m,Q);break e}}m=m.return}while(m!==null)}cd(a)}catch(fe){i=fe,bt===a&&a!==null&&(bt=a=a.return);continue}break}while(!0)}function od(){var n=to.current;return to.current=Ya,n===null?Ya:n}function fc(){(Et===0||Et===3||Et===2)&&(Et=4),Mt===null||(As&268435455)===0&&(no&268435455)===0||Bi(Mt,Ot)}function lo(n,i){var a=Ve;Ve|=2;var u=od();(Mt!==n||Ot!==i)&&(bi=null,_s(n,i));do try{zp();break}catch(d){ad(n,d)}while(!0);if(Cl(),Ve=a,to.current=u,bt!==null)throw Error(t(261));return Mt=null,Ot=0,Et}function zp(){for(;bt!==null;)ld(bt)}function Hp(){for(;bt!==null&&!ba();)ld(bt)}function ld(n){var i=dd(n.alternate,n,mn);n.memoizedProps=n.pendingProps,i===null?cd(n):bt=i,sc.current=null}function cd(n){var i=n;do{var a=i.alternate;if(n=i.return,(i.flags&32768)===0){if(a=Np(a,i,mn),a!==null){bt=a;return}}else{if(a=Lp(a,i),a!==null){a.flags&=32767,bt=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Et=6,bt=null;return}}if(i=i.sibling,i!==null){bt=i;return}bt=i=n}while(i!==null);Et===0&&(Et=5)}function xs(n,i,a){var u=Ue,d=Cn.transition;try{Cn.transition=null,Ue=1,Bp(n,i,a,u)}finally{Cn.transition=d,Ue=u}return null}function Bp(n,i,a,u){do lr();while(zi!==null);if((Ve&6)!==0)throw Error(t(327));a=n.finishedWork;var d=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(t(177));n.callbackNode=null,n.callbackPriority=0;var m=a.lanes|a.childLanes;if(cs(n,m),n===Mt&&(bt=Mt=null,Ot=0),(a.subtreeFlags&2064)===0&&(a.flags&2064)===0||so||(so=!0,fd(Os,function(){return lr(),null})),m=(a.flags&15990)!==0,(a.subtreeFlags&15990)!==0||m){m=Cn.transition,Cn.transition=null;var A=Ue;Ue=1;var C=Ve;Ve|=4,sc.current=null,Fp(n,a),Jh(a,n),op(fl),Ge=!!dl,fl=dl=null,n.current=a,Dp(a),Go(),Ve=C,Ue=A,Cn.transition=m}else n.current=a;if(so&&(so=!1,zi=n,ro=d),m=n.pendingLanes,m===0&&(ji=null),Sa(a.stateNode),ln(n,ot()),i!==null)for(u=n.onRecoverableError,a=0;a<i.length;a++)d=i[a],u(d.value,{componentStack:d.stack,digest:d.digest});if(io)throw io=!1,n=oc,oc=null,n;return(ro&1)!==0&&n.tag!==0&&lr(),m=n.pendingLanes,(m&1)!==0?n===lc?Zr++:(Zr=0,lc=n):Zr=0,Ii(),null}function lr(){if(zi!==null){var n=Hs(ro),i=Cn.transition,a=Ue;try{if(Cn.transition=null,Ue=16>n?16:n,zi===null)var u=!1;else{if(n=zi,zi=null,ro=0,(Ve&6)!==0)throw Error(t(331));var d=Ve;for(Ve|=4,oe=n.current;oe!==null;){var m=oe,A=m.child;if((oe.flags&16)!==0){var C=m.deletions;if(C!==null){for(var P=0;P<C.length;P++){var O=C[P];for(oe=O;oe!==null;){var W=oe;switch(W.tag){case 0:case 11:case 15:Yr(8,W,m)}var q=W.child;if(q!==null)q.return=W,oe=q;else for(;oe!==null;){W=oe;var V=W.sibling,ne=W.return;if(qh(W),W===O){oe=null;break}if(V!==null){V.return=ne,oe=V;break}oe=ne}}}var ce=m.alternate;if(ce!==null){var ue=ce.child;if(ue!==null){ce.child=null;do{var mt=ue.sibling;ue.sibling=null,ue=mt}while(ue!==null)}}oe=m}}if((m.subtreeFlags&2064)!==0&&A!==null)A.return=m,oe=A;else e:for(;oe!==null;){if(m=oe,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:Yr(9,m,m.return)}var L=m.sibling;if(L!==null){L.return=m.return,oe=L;break e}oe=m.return}}var N=n.current;for(oe=N;oe!==null;){A=oe;var D=A.child;if((A.subtreeFlags&2064)!==0&&D!==null)D.return=A,oe=D;else e:for(A=N;oe!==null;){if(C=oe,(C.flags&2048)!==0)try{switch(C.tag){case 0:case 11:case 15:eo(9,C)}}catch(fe){pt(C,C.return,fe)}if(C===A){oe=null;break e}var Q=C.sibling;if(Q!==null){Q.return=C.return,oe=Q;break e}oe=C.return}}if(Ve=d,Ii(),bn&&typeof bn.onPostCommitFiberRoot=="function")try{bn.onPostCommitFiberRoot(Yt,n)}catch{}u=!0}return u}finally{Ue=a,Cn.transition=i}}return!1}function ud(n,i,a){i=sr(a,i),i=Th(n,i,1),n=Di(n,i,1),i=Qt(),n!==null&&(ls(n,1,i),ln(n,i))}function pt(n,i,a){if(n.tag===3)ud(n,n,a);else for(;i!==null;){if(i.tag===3){ud(i,n,a);break}else if(i.tag===1){var u=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(ji===null||!ji.has(u))){n=sr(a,n),n=Ph(i,n,1),i=Di(i,n,1),n=Qt(),i!==null&&(ls(i,1,n),ln(i,n));break}}i=i.return}}function $p(n,i,a){var u=n.pingCache;u!==null&&u.delete(i),i=Qt(),n.pingedLanes|=n.suspendedLanes&a,Mt===n&&(Ot&a)===a&&(Et===4||Et===3&&(Ot&130023424)===Ot&&500>ot()-ac?_s(n,0):rc|=a),ln(n,i)}function hd(n,i){i===0&&((n.mode&1)===0?i=1:(i=os,os<<=1,(os&130023424)===0&&(os=4194304)));var a=Qt();n=yi(n,i),n!==null&&(ls(n,i,a),ln(n,a))}function Up(n){var i=n.memoizedState,a=0;i!==null&&(a=i.retryLane),hd(n,a)}function Vp(n,i){var a=0;switch(n.tag){case 13:var u=n.stateNode,d=n.memoizedState;d!==null&&(a=d.retryLane);break;case 19:u=n.stateNode;break;default:throw Error(t(314))}u!==null&&u.delete(i),hd(n,a)}var dd;dd=function(n,i,a){if(n!==null)if(n.memoizedProps!==i.pendingProps||sn.current)an=!0;else{if((n.lanes&a)===0&&(i.flags&128)===0)return an=!1,Mp(n,i,a);an=(n.flags&131072)!==0}else an=!1,lt&&(i.flags&1048576)!==0&&Wu(i,Oa,i.index);switch(i.lanes=0,i.tag){case 2:var u=i.type;Za(n,i),n=i.pendingProps;var d=Ks(i,Ht.current);nr(i,a),d=Ol(null,i,u,n,d,a);var m=jl();return i.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,rn(u)?(m=!0,Ia(i)):m=!1,i.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,Rl(i),d.updater=Ka,i.stateNode=d,d._reactInternals=i,Vl(i,u,n,a),i=ql(null,i,u,!0,m,a)):(i.tag=0,lt&&m&&bl(i),Kt(null,i,d,a),i=i.child),i;case 16:u=i.elementType;e:{switch(Za(n,i),n=i.pendingProps,d=u._init,u=d(u._payload),i.type=u,d=i.tag=Gp(u),n=On(u,n),d){case 0:i=Xl(null,i,u,n,a);break e;case 1:i=jh(null,i,u,n,a);break e;case 11:i=Lh(null,i,u,n,a);break e;case 14:i=Ih(null,i,u,On(u.type,n),a);break e}throw Error(t(306,u,""))}return i;case 0:return u=i.type,d=i.pendingProps,d=i.elementType===u?d:On(u,d),Xl(n,i,u,d,a);case 1:return u=i.type,d=i.pendingProps,d=i.elementType===u?d:On(u,d),jh(n,i,u,d,a);case 3:e:{if(zh(i),n===null)throw Error(t(387));u=i.pendingProps,m=i.memoizedState,d=m.element,eh(n,i),Ua(i,u,null,a);var A=i.memoizedState;if(u=A.element,m.isDehydrated)if(m={element:u,isDehydrated:!1,cache:A.cache,pendingSuspenseBoundaries:A.pendingSuspenseBoundaries,transitions:A.transitions},i.updateQueue.baseState=m,i.memoizedState=m,i.flags&256){d=sr(Error(t(423)),i),i=Hh(n,i,u,a,d);break e}else if(u!==d){d=sr(Error(t(424)),i),i=Hh(n,i,u,a,d);break e}else for(gn=Mi(i.stateNode.containerInfo.firstChild),pn=i,lt=!0,Dn=null,a=Zu(i,null,u,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Js(),u===d){i=wi(n,i,a);break e}Kt(n,i,u,a)}i=i.child}return i;case 5:return ih(i),n===null&&_l(i),u=i.type,d=i.pendingProps,m=n!==null?n.memoizedProps:null,A=d.children,pl(u,d)?A=null:m!==null&&pl(u,m)&&(i.flags|=32),Oh(n,i),Kt(n,i,A,a),i.child;case 6:return n===null&&_l(i),null;case 13:return Bh(n,i,a);case 4:return Ml(i,i.stateNode.containerInfo),u=i.pendingProps,n===null?i.child=er(i,null,u,a):Kt(n,i,u,a),i.child;case 11:return u=i.type,d=i.pendingProps,d=i.elementType===u?d:On(u,d),Lh(n,i,u,d,a);case 7:return Kt(n,i,i.pendingProps,a),i.child;case 8:return Kt(n,i,i.pendingProps.children,a),i.child;case 12:return Kt(n,i,i.pendingProps.children,a),i.child;case 10:e:{if(u=i.type._context,d=i.pendingProps,m=i.memoizedProps,A=d.value,it(Ha,u._currentValue),u._currentValue=A,m!==null)if(Fn(m.value,A)){if(m.children===d.children&&!sn.current){i=wi(n,i,a);break e}}else for(m=i.child,m!==null&&(m.return=i);m!==null;){var C=m.dependencies;if(C!==null){A=m.child;for(var P=C.firstContext;P!==null;){if(P.context===u){if(m.tag===1){P=vi(-1,a&-a),P.tag=2;var O=m.updateQueue;if(O!==null){O=O.shared;var W=O.pending;W===null?P.next=P:(P.next=W.next,W.next=P),O.pending=P}}m.lanes|=a,P=m.alternate,P!==null&&(P.lanes|=a),Tl(m.return,a,i),C.lanes|=a;break}P=P.next}}else if(m.tag===10)A=m.type===i.type?null:m.child;else if(m.tag===18){if(A=m.return,A===null)throw Error(t(341));A.lanes|=a,C=A.alternate,C!==null&&(C.lanes|=a),Tl(A,a,i),A=m.sibling}else A=m.child;if(A!==null)A.return=m;else for(A=m;A!==null;){if(A===i){A=null;break}if(m=A.sibling,m!==null){m.return=A.return,A=m;break}A=A.return}m=A}Kt(n,i,d.children,a),i=i.child}return i;case 9:return d=i.type,u=i.pendingProps.children,nr(i,a),d=xn(d),u=u(d),i.flags|=1,Kt(n,i,u,a),i.child;case 14:return u=i.type,d=On(u,i.pendingProps),d=On(u.type,d),Ih(n,i,u,d,a);case 15:return Fh(n,i,i.type,i.pendingProps,a);case 17:return u=i.type,d=i.pendingProps,d=i.elementType===u?d:On(u,d),Za(n,i),i.tag=1,rn(u)?(n=!0,Ia(i)):n=!1,nr(i,a),Ch(i,u,d),Vl(i,u,d,a),ql(null,i,u,!0,n,a);case 19:return Uh(n,i,a);case 22:return Dh(n,i,a)}throw Error(t(156,i.tag))};function fd(n,i){return Ye(n,i)}function Wp(n,i,a,u){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kn(n,i,a,u){return new Wp(n,i,a,u)}function pc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Gp(n){if(typeof n=="function")return pc(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Re)return 11;if(n===Qe)return 14}return 2}function $i(n,i){var a=n.alternate;return a===null?(a=kn(n.tag,i,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=i,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,i=n.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function co(n,i,a,u,d,m){var A=2;if(u=n,typeof n=="function")pc(n)&&(A=1);else if(typeof n=="string")A=5;else e:switch(n){case X:return Es(a.children,d,m,i);case ie:A=8,d|=8;break;case de:return n=kn(12,a,i,d|2),n.elementType=de,n.lanes=m,n;case Be:return n=kn(13,a,i,d),n.elementType=Be,n.lanes=m,n;case Ne:return n=kn(19,a,i,d),n.elementType=Ne,n.lanes=m,n;case ee:return uo(a,d,m,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case K:A=10;break e;case ke:A=9;break e;case Re:A=11;break e;case Qe:A=14;break e;case J:A=16,u=null;break e}throw Error(t(130,n==null?n:typeof n,""))}return i=kn(A,a,i,d),i.elementType=n,i.type=u,i.lanes=m,i}function Es(n,i,a,u){return n=kn(7,n,u,i),n.lanes=a,n}function uo(n,i,a,u){return n=kn(22,n,u,i),n.elementType=ee,n.lanes=a,n.stateNode={isHidden:!1},n}function gc(n,i,a){return n=kn(6,n,null,i),n.lanes=a,n}function mc(n,i,a){return i=kn(4,n.children!==null?n.children:[],n.key,i),i.lanes=a,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function Xp(n,i,a,u,d){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qn(0),this.expirationTimes=qn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qn(0),this.identifierPrefix=u,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function yc(n,i,a,u,d,m,A,C,P){return n=new Xp(n,i,a,C,P),i===1?(i=1,m===!0&&(i|=8)):i=0,m=kn(3,null,null,i),n.current=m,m.stateNode=n,m.memoizedState={element:u,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rl(m),n}function qp(n,i,a){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:G,key:u==null?null:""+u,children:n,containerInfo:i,implementation:a}}function pd(n){if(!n)return Li;n=n._reactInternals;e:{if(zt(n)!==n||n.tag!==1)throw Error(t(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(rn(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(t(171))}if(n.tag===1){var a=n.type;if(rn(a))return $u(n,a,i)}return i}function gd(n,i,a,u,d,m,A,C,P){return n=yc(a,u,!0,n,d,m,A,C,P),n.context=pd(null),a=n.current,u=Qt(),d=Hi(a),m=vi(u,d),m.callback=i??null,Di(a,m,d),n.current.lanes=d,ls(n,d,u),ln(n,u),n}function ho(n,i,a,u){var d=i.current,m=Qt(),A=Hi(d);return a=pd(a),i.context===null?i.context=a:i.pendingContext=a,i=vi(m,A),i.payload={element:n},u=u===void 0?null:u,u!==null&&(i.callback=u),n=Di(d,i,A),n!==null&&(Hn(n,d,A,m),$a(n,d,A)),A}function fo(n){return n=n.current,n.child?(n.child.tag===5,n.child.stateNode):null}function md(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<i?a:i}}function vc(n,i){md(n,i),(n=n.alternate)&&md(n,i)}function Yp(){return null}var yd=typeof reportError=="function"?reportError:function(n){console.error(n)};function wc(n){this._internalRoot=n}po.prototype.render=wc.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(t(409));ho(n,i,null,null)},po.prototype.unmount=wc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;Ss(function(){ho(null,n,null,null)}),i[fi]=null}};function po(n){this._internalRoot=n}po.prototype.unstable_scheduleHydration=function(n){if(n){var i=Er();n={blockedOn:null,target:n,priority:i};for(var a=0;a<E.length&&i!==0&&i<E[a].priority;a++);E.splice(a,0,n),a===0&&Te(n)}};function bc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function go(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function vd(){}function Kp(n,i,a,u,d){if(d){if(typeof u=="function"){var m=u;u=function(){var O=fo(A);m.call(O)}}var A=gd(i,u,n,0,null,!1,!1,"",vd);return n._reactRootContainer=A,n[fi]=A.current,Dr(n.nodeType===8?n.parentNode:n),Ss(),A}for(;d=n.lastChild;)n.removeChild(d);if(typeof u=="function"){var C=u;u=function(){var O=fo(P);C.call(O)}}var P=yc(n,0,!1,null,null,!1,!1,"",vd);return n._reactRootContainer=P,n[fi]=P.current,Dr(n.nodeType===8?n.parentNode:n),Ss(function(){ho(i,P,a,u)}),P}function mo(n,i,a,u,d){var m=a._reactRootContainer;if(m){var A=m;if(typeof d=="function"){var C=d;d=function(){var P=fo(A);C.call(P)}}ho(i,A,n,d)}else A=Kp(a,i,n,d,u);return fo(A)}Tt=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var a=Gn(i.pendingLanes);a!==0&&(Pi(i,a|1),ln(i,ot()),(Ve&6)===0&&(or=ot()+500,Ii()))}break;case 13:Ss(function(){var u=yi(n,1);if(u!==null){var d=Qt();Hn(u,n,1,d)}}),vc(n,1)}},An=function(n){if(n.tag===13){var i=yi(n,134217728);if(i!==null){var a=Qt();Hn(i,n,134217728,a)}vc(n,134217728)}},xr=function(n){if(n.tag===13){var i=Hi(n),a=yi(n,i);if(a!==null){var u=Qt();Hn(a,n,i,u)}vc(n,i)}},Er=function(){return Ue},_a=function(n,i){var a=Ue;try{return Ue=n,i()}finally{Ue=a}},Nn=function(n,i,a){switch(i){case"input":if(wt(n,a),i=a.name,a.type==="radio"&&i!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var u=a[i];if(u!==n&&u.form===n.form){var d=Na(u);if(!d)throw Error(t(90));_i(u),wt(u,d)}}}break;case"textarea":Oe(n,a);break;case"select":i=a.value,i!=null&&xi(n,!!a.multiple,i,!1)}},Ci=hc,is=Ss;var Qp={usingClientEntryPoint:!1,Events:[zr,qs,Na,Vn,ns,hc]},Jr={findFiberByHostInstance:ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Zp={bundleType:Jr.bundleType,version:Jr.version,rendererPackageName:Jr.rendererPackageName,rendererConfig:Jr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:H.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=va(n),n===null?null:n.stateNode},findFiberByHostInstance:Jr.findFiberByHostInstance||Yp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yo.isDisabled&&yo.supportsFiber)try{Yt=yo.inject(Zp),bn=yo}catch{}}return cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qp,cn.createPortal=function(n,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bc(i))throw Error(t(200));return qp(n,i,null,a)},cn.createRoot=function(n,i){if(!bc(n))throw Error(t(299));var a=!1,u="",d=yd;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onRecoverableError!==void 0&&(d=i.onRecoverableError)),i=yc(n,1,!1,null,null,a,!1,u,d),n[fi]=i.current,Dr(n.nodeType===8?n.parentNode:n),new wc(i)},cn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(t(188)):(n=Object.keys(n).join(","),Error(t(268,n)));return n=va(i),n=n===null?null:n.stateNode,n},cn.flushSync=function(n){return Ss(n)},cn.hydrate=function(n,i,a){if(!go(i))throw Error(t(200));return mo(null,n,i,!0,a)},cn.hydrateRoot=function(n,i,a){if(!bc(n))throw Error(t(405));var u=a!=null&&a.hydratedSources||null,d=!1,m="",A=yd;if(a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onRecoverableError!==void 0&&(A=a.onRecoverableError)),i=gd(i,null,n,1,a??null,d,!1,m,A),n[fi]=i.current,Dr(n),u)for(n=0;n<u.length;n++)a=u[n],d=a._getVersion,d=d(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,d]:i.mutableSourceEagerHydrationData.push(a,d);return new po(i)},cn.render=function(n,i,a){if(!go(i))throw Error(t(200));return mo(null,n,i,!1,a)},cn.unmountComponentAtNode=function(n){if(!go(n))throw Error(t(40));return n._reactRootContainer?(Ss(function(){mo(null,null,n,!1,function(){n._reactRootContainer=null,n[fi]=null})}),!0):!1},cn.unstable_batchedUpdates=hc,cn.unstable_renderSubtreeIntoContainer=function(n,i,a,u){if(!go(a))throw Error(t(200));if(n==null||n._reactInternals===void 0)throw Error(t(38));return mo(n,i,a,!1,u)},cn.version="18.3.1-next-f1338f8080-20240426",cn}var Td;function og(){if(Td)return xc.exports;Td=1;function f(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f)}catch(e){console.error(e)}}return f(),xc.exports=ag(),xc.exports}var Pd;function lg(){if(Pd)return wo;Pd=1;var f=og();return wo.createRoot=f.createRoot,wo.hydrateRoot=f.hydrateRoot,wo}var cg=lg();const ug=Kd(cg);var ca={};ca.d=(f,e)=>{for(var t in e)ca.o(e,t)&&!ca.o(f,t)&&Object.defineProperty(f,t,{enumerable:!0,get:e[t]})};ca.o=(f,e)=>Object.prototype.hasOwnProperty.call(f,e);var Me=globalThis.pdfjsLib={};ca.d(Me,{AbortException:()=>Xi,AnnotationEditorLayer:()=>Si,AnnotationEditorParamsType:()=>$e,AnnotationEditorType:()=>Fe,AnnotationEditorUIManager:()=>qi,AnnotationLayer:()=>ry,AnnotationMode:()=>Wi,ColorPicker:()=>Pn,DOMSVGFactory:()=>iu,DrawLayer:()=>Zt,FeatureTest:()=>en,GlobalWorkerOptions:()=>ha,ImageKind:()=>Co,InvalidPDFException:()=>jc,MissingPDFException:()=>da,OPS:()=>$n,OutputScale:()=>zc,PDFDataRangeTransport:()=>mf,PDFDateString:()=>Jd,PDFWorker:()=>pr,PasswordResponses:()=>pg,PermissionFlag:()=>fg,PixelsPerInch:()=>yr,RenderingCancelledException:()=>qc,TextLayer:()=>Jt,TouchManager:()=>jo,UnexpectedResponseException:()=>Po,Util:()=>pe,VerbosityLevel:()=>No,XfaLayer:()=>vf,build:()=>zm,createValidAbsoluteUrl:()=>vg,fetchData:()=>Do,getDocument:()=>Rm,getFilenameFromUrl:()=>kg,getPdfFilenameFromUrl:()=>Tg,getXfaPageViewport:()=>Pg,isDataScheme:()=>Oo,isPdfFile:()=>Yc,noContextMenu:()=>Un,normalizeUnicode:()=>xg,setLayerDimensions:()=>Ps,shadow:()=>He,stopEvent:()=>vn,version:()=>jm});const Gt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Qd=[1,0,0,1,0,0],Oc=[.001,0,0,.001,0,0],hg=1e7,kc=1.35,yn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Wi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},dg="pdfjs_internal_editor_",Fe={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},$e={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},fg={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Vt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Co={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ct={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},na={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},No={ERRORS:0,WARNINGS:1,INFOS:5},$n={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},pg={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Lo=No.WARNINGS;function gg(f){Number.isInteger(f)&&(Lo=f)}function mg(){return Lo}function Io(f){Lo>=No.INFOS&&console.log(`Info: ${f}`)}function De(f){Lo>=No.WARNINGS&&console.log(`Warning: ${f}`)}function et(f){throw new Error(f)}function St(f,e){f||et(e)}function yg(f){switch(f?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function vg(f,e=null,t=null){if(!f)return null;try{if(t&&typeof f=="string"&&(t.addDefaultProtocol&&f.startsWith("www.")&&f.match(/\./g)?.length>=2&&(f=`http://${f}`),t.tryConvertEncoding))try{f=_g(f)}catch{}const s=e?new URL(f,e):new URL(f);if(yg(s))return s}catch{}return null}function He(f,e,t,s=!1){return Object.defineProperty(f,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Yi=(function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e})();class Rd extends Yi{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Tc extends Yi{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class jc extends Yi{constructor(e){super(e,"InvalidPDFException")}}class da extends Yi{constructor(e){super(e,"MissingPDFException")}}class Po extends Yi{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class wg extends Yi{constructor(e){super(e,"FormatError")}}class Xi extends Yi{constructor(e){super(e,"AbortException")}}function Zd(f){(typeof f!="object"||f?.length===void 0)&&et("Invalid argument for bytesToString");const e=f.length,t=8192;if(e<t)return String.fromCharCode.apply(null,f);const s=[];for(let r=0;r<e;r+=t){const o=Math.min(r+t,e),l=f.subarray(r,o);s.push(String.fromCharCode.apply(null,l))}return s.join("")}function Fo(f){typeof f!="string"&&et("Invalid argument for stringToBytes");const e=f.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=f.charCodeAt(s)&255;return t}function bg(f){return String.fromCharCode(f>>24&255,f>>16&255,f>>8&255,f&255)}function Gc(f){const e=Object.create(null);for(const[t,s]of f)e[t]=s;return e}function Ag(){const f=new Uint8Array(4);return f[0]=1,new Uint32Array(f.buffer,0,1)[0]===1}function Sg(){try{return new Function(""),!0}catch{return!1}}class en{static get isLittleEndian(){return He(this,"isLittleEndian",Ag())}static get isEvalSupported(){return He(this,"isEvalSupported",Sg())}static get isOffscreenCanvasSupported(){return He(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return He(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?He(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):He(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return He(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Pc=Array.from(Array(256).keys(),f=>f.toString(16).padStart(2,"0"));class pe{static makeHexColor(e,t,s){return`#${Pc[e]}${Pc[t]}${Pc[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],r=e[0]*t[1]+e[1]*t[3]+t[5];return[s,r]}static applyInverseTransform(e,t){const s=t[0]*t[3]-t[1]*t[2],r=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,o=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[r,o]}static getAxialAlignedBoundingBox(e,t){const s=this.applyTransform(e,t),r=this.applyTransform(e.slice(2,4),t),o=this.applyTransform([e[0],e[3]],t),l=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],r[0],o[0],l[0]),Math.min(s[1],r[1],o[1],l[1]),Math.max(s[0],r[0],o[0],l[0]),Math.max(s[1],r[1],o[1],l[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],o=e[2]*t[0]+e[3]*t[2],l=e[2]*t[1]+e[3]*t[3],c=(s+l)/2,h=Math.sqrt((s+l)**2-4*(s*l-o*r))/2,p=c+h||1,g=c-h||1;return[Math.sqrt(p),Math.sqrt(g)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>r)return null;const o=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),l=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return o>l?null:[s,o,r,l]}static#e(e,t,s,r,o,l,c,h,p,g){if(p<=0||p>=1)return;const y=1-p,v=p*p,b=v*p,S=y*(y*(y*e+3*p*t)+3*v*s)+b*r,_=y*(y*(y*o+3*p*l)+3*v*c)+b*h;g[0]=Math.min(g[0],S),g[1]=Math.min(g[1],_),g[2]=Math.max(g[2],S),g[3]=Math.max(g[3],_)}static#t(e,t,s,r,o,l,c,h,p,g,y,v){if(Math.abs(p)<1e-12){Math.abs(g)>=1e-12&&this.#e(e,t,s,r,o,l,c,h,-y/g,v);return}const b=g**2-4*y*p;if(b<0)return;const S=Math.sqrt(b),_=2*p;this.#e(e,t,s,r,o,l,c,h,(-g+S)/_,v),this.#e(e,t,s,r,o,l,c,h,(-g-S)/_,v)}static bezierBoundingBox(e,t,s,r,o,l,c,h,p){return p?(p[0]=Math.min(p[0],e,c),p[1]=Math.min(p[1],t,h),p[2]=Math.max(p[2],e,c),p[3]=Math.max(p[3],t,h)):p=[Math.min(e,c),Math.min(t,h),Math.max(e,c),Math.max(t,h)],this.#t(e,s,o,c,t,r,l,h,3*(-e+3*(s-o)+c),6*(e-2*s+o),3*(s-e),p),this.#t(e,s,o,c,t,r,l,h,3*(-t+3*(r-l)+h),6*(t-2*r+l),3*(r-t),p),p}}function _g(f){return decodeURIComponent(escape(f))}let Rc=null,Md=null;function xg(f){return Rc||(Rc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Md=new Map([["","t"]])),f.replaceAll(Rc,(e,t,s)=>t?t.normalize("NFKC"):Md.get(s))}function Eg(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const f=new Uint8Array(32);return crypto.getRandomValues(f),Zd(f)}const Xc="pdfjs_internal_id_";function Cg(f){return Uint8Array.prototype.toBase64?f.toBase64():btoa(Zd(f))}typeof Promise.try!="function"&&(Promise.try=function(f,...e){return new Promise(t=>{t(f(...e))})});const Ai="http://www.w3.org/2000/svg";class yr{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Do(f,e="text"){if(oa(f,document.baseURI)){const t=await fetch(f);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const r=new XMLHttpRequest;r.open("GET",f,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}s(new Error(r.statusText))}},r.send(null)})}class pa{constructor({viewBox:e,userUnit:t,scale:s,rotation:r,offsetX:o=0,offsetY:l=0,dontFlip:c=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=r,this.offsetX=o,this.offsetY=l,s*=t;const h=(e[2]+e[0])/2,p=(e[3]+e[1])/2;let g,y,v,b;switch(r%=360,r<0&&(r+=360),r){case 180:g=-1,y=0,v=0,b=1;break;case 90:g=0,y=1,v=1,b=0;break;case 270:g=0,y=-1,v=-1,b=0;break;case 0:g=1,y=0,v=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(v=-v,b=-b);let S,_,T,k;g===0?(S=Math.abs(p-e[1])*s+o,_=Math.abs(h-e[0])*s+l,T=(e[3]-e[1])*s,k=(e[2]-e[0])*s):(S=Math.abs(h-e[0])*s+o,_=Math.abs(p-e[1])*s+l,T=(e[2]-e[0])*s,k=(e[3]-e[1])*s),this.transform=[g*s,y*s,v*s,b*s,S-g*s*h-v*s*p,_-y*s*h-b*s*p],this.width=T,this.height=k}get rawDims(){const{userUnit:e,viewBox:t}=this,s=t.map(r=>r*e);return He(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:r=this.offsetY,dontFlip:o=!1}={}){return new pa({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:r,dontFlip:o})}convertToViewportPoint(e,t){return pe.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=pe.applyTransform([e[0],e[1]],this.transform),s=pe.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return pe.applyInverseTransform([e,t],this.transform)}}class qc extends Yi{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Oo(f){const e=f.length;let t=0;for(;t<e&&f[t].trim()==="";)t++;return f.substring(t,t+5).toLowerCase()==="data:"}function Yc(f){return typeof f=="string"&&/\.pdf$/i.test(f)}function kg(f){return[f]=f.split(/[#?]/,1),f.substring(f.lastIndexOf("/")+1)}function Tg(f,e="document.pdf"){if(typeof f!="string")return e;if(Oo(f))return De('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=t.exec(f);let o=s.exec(r[1])||s.exec(r[2])||s.exec(r[3]);if(o&&(o=o[0],o.includes("%")))try{o=s.exec(decodeURIComponent(o))[0]}catch{}return o||e}class Nd{started=Object.create(null);times=[];time(e){e in this.started&&De(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||De(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:r,end:o}of this.times)e.push(`${s.padEnd(t)} ${o-r}ms
`);return e.join("")}}function oa(f,e){try{const{protocol:t}=e?new URL(f,e):new URL(f);return t==="http:"||t==="https:"}catch{return!1}}function Un(f){f.preventDefault()}function vn(f){f.preventDefault(),f.stopPropagation()}class Jd{static#e;static toDateObject(e){if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const s=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let o=parseInt(t[3],10);o=o>=1&&o<=31?o:1;let l=parseInt(t[4],10);l=l>=0&&l<=23?l:0;let c=parseInt(t[5],10);c=c>=0&&c<=59?c:0;let h=parseInt(t[6],10);h=h>=0&&h<=59?h:0;const p=t[7]||"Z";let g=parseInt(t[8],10);g=g>=0&&g<=23?g:0;let y=parseInt(t[9],10)||0;return y=y>=0&&y<=59?y:0,p==="-"?(l+=g,c+=y):p==="+"&&(l-=g,c-=y),new Date(Date.UTC(s,r,o,l,c,h))}}function Pg(f,{scale:e=1,rotation:t=0}){const{width:s,height:r}=f.attributes.style,o=[0,0,parseInt(s),parseInt(r)];return new pa({viewBox:o,userUnit:1,scale:e,rotation:t})}function Kc(f){if(f.startsWith("#")){const e=parseInt(f.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return f.startsWith("rgb(")?f.slice(4,-1).split(",").map(e=>parseInt(e)):f.startsWith("rgba(")?f.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(De(`Not a valid color format: "${f}"`),[0,0,0])}function Rg(f){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of f.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;f.set(t,Kc(s))}e.remove()}function ut(f){const{a:e,b:t,c:s,d:r,e:o,f:l}=f.getTransform();return[e,t,s,r,o,l]}function ii(f){const{a:e,b:t,c:s,d:r,e:o,f:l}=f.getTransform().invertSelf();return[e,t,s,r,o,l]}function Ps(f,e,t=!1,s=!0){if(e instanceof pa){const{pageWidth:r,pageHeight:o}=e.rawDims,{style:l}=f,c=en.isCSSRoundSupported,h=`var(--scale-factor) * ${r}px`,p=`var(--scale-factor) * ${o}px`,g=c?`round(down, ${h}, var(--scale-round-x, 1px))`:`calc(${h})`,y=c?`round(down, ${p}, var(--scale-round-y, 1px))`:`calc(${p})`;!t||e.rotation%180===0?(l.width=g,l.height=y):(l.width=y,l.height=g)}s&&f.setAttribute("data-main-rotation",e.rotation)}class zc{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}class ua{#e=null;#t=null;#n;#i=null;#r=null;static#s=null;constructor(e){this.#n=e,ua.#s||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#n._uiManager._signal;e.addEventListener("contextmenu",Un,{signal:t}),e.addEventListener("pointerdown",ua.#l,{signal:t});const s=this.#i=document.createElement("div");s.className="buttons",e.append(s);const r=this.#n.toolbarPosition;if(r){const{style:o}=e,l=this.#n._uiManager.direction==="ltr"?1-r[0]:r[0];o.insetInlineEnd=`${100*l}%`,o.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return this.#d(),e}get div(){return this.#e}static#l(e){e.stopPropagation()}#o(e){this.#n._focusEventsAllowed=!1,vn(e)}#u(e){this.#n._focusEventsAllowed=!0,vn(e)}#c(e){const t=this.#n._uiManager._signal;e.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Un,{signal:t})}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#r?.shown()}#d(){const{editorType:e,_uiManager:t}=this.#n,s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",ua.#s[e]),this.#c(s),s.addEventListener("click",r=>{t.delete()},{signal:t._signal}),this.#i.append(s)}get#h(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#c(t),this.#i.prepend(t,this.#h),this.#r=e}addColorPicker(e){this.#t=e;const t=e.renderButton();this.#c(t),this.#i.prepend(t,this.#h)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class Mg{#e=null;#t=null;#n;constructor(e){this.#n=e}#i(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Un,{signal:this.#n._signal});const t=this.#e=document.createElement("div");return t.className="buttons",e.append(t),this.#s(),e}#r(e,t){let s=0,r=0;for(const o of e){const l=o.y+o.height;if(l<s)continue;const c=o.x+(t?o.width:0);if(l>s){r=c,s=l;continue}t?c>r&&(r=c):c<r&&(r=c)}return[t?1-r:r,s]}show(e,t,s){const[r,o]=this.#r(t,s),{style:l}=this.#t||=this.#i();e.append(this.#t),l.insetInlineEnd=`${100*r}%`,l.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#s(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=this.#n._signal;e.addEventListener("contextmenu",Un,{signal:s}),e.addEventListener("click",()=>{this.#n.highlightSelection("floating_button")},{signal:s}),this.#e.append(e)}}function Ro(f,e,t){for(const s of t)e.addEventListener(s,f[s].bind(f))}class Ng{#e=0;get id(){return`${dg}${this.#e++}`}}class Qc{#e=Eg();#t=0;#n=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const o=r.decode().then(()=>(s.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return He(this,"_isSVGFittingCanvas",o)}async#i(e,t){this.#n||=new Map;let s=this.#n.get(e);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let r;if(typeof t=="string"?(s.url=t,r=await Do(t,"blob")):t instanceof File?r=s.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const o=Qc._isSVGFittingCanvas,l=new FileReader,c=new Image,h=new Promise((p,g)=>{c.onload=()=>{s.bitmap=c,s.isSvg=!0,p()},l.onload=async()=>{const y=s.svgUrl=l.result;c.src=await o?`${y}#svgView(preserveAspectRatio(none))`:y},c.onerror=l.onerror=g});l.readAsDataURL(r),await h}else s.bitmap=await createImageBitmap(r);s.refCounter=1}catch(r){De(r),s=null}return this.#n.set(e,s),s&&this.#n.set(s.id,s),s}async getFromFile(e){const{lastModified:t,name:s,size:r,type:o}=e;return this.#i(`${t}_${s}_${r}_${o}`,e)}async getFromUrl(e){return this.#i(e,e)}async getFromBlob(e,t){const s=await t;return this.#i(e,s)}async getFromId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#n||=new Map;let s=this.#n.get(e);if(s?.bitmap)return s.refCounter+=1,s;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),s={bitmap:r.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#n.set(e,s),this.#n.set(s.id,s),s}getSvgUrl(e){const t=this.#n.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}s.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class Lg{#e=[];#t=!1;#n;#i=-1;constructor(e=128){this.#n=e}add({cmd:e,undo:t,post:s,mustExec:r,type:o=NaN,overwriteIfSameType:l=!1,keepUndo:c=!1}){if(r&&e(),this.#t)return;const h={cmd:e,undo:t,post:s,type:o};if(this.#i===-1){this.#e.length>0&&(this.#e.length=0),this.#i=0,this.#e.push(h);return}if(l&&this.#e[this.#i].type===o){c&&(h.undo=this.#e[this.#i].undo),this.#e[this.#i]=h;return}const p=this.#i+1;p===this.#n?this.#e.splice(0,1):(this.#i=p,p<this.#e.length&&this.#e.splice(p)),this.#e.push(h)}undo(){if(this.#i===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1,this.#i-=1}redo(){if(this.#i<this.#e.length-1){this.#i+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#e.length-1}cleanType(e){if(this.#i!==-1){for(let t=this.#i;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#i-t),this.#i=t;return}this.#e.length=0,this.#i=-1}}destroy(){this.#e=null}}class ga{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=en.platform;for(const[s,r,o={}]of e)for(const l of s){const c=l.startsWith("mac+");t&&c?(this.callbacks.set(l.slice(4),{callback:r,options:o}),this.allKeys.add(l.split("+").at(-1))):!t&&!c&&(this.callbacks.set(l,{callback:r,options:o}),this.allKeys.add(l.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(this.#e(t));if(!s)return;const{callback:r,options:{bubbles:o=!1,args:l=[],checker:c=null}}=s;c&&!c(e,t)||(r.bind(e,...l,t)(),o||vn(t))}}class Zc{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Rg(e),He(this,"_colors",e)}convert(e){const t=Kc(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,r]of this._colors)if(r.every((o,l)=>o===t[l]))return Zc._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?pe.makeHexColor(...t):e}}class qi{#e=new AbortController;#t=null;#n=new Map;#i=new Map;#r=null;#s=null;#l=null;#o=new Lg;#u=null;#c=null;#d=0;#h=new Set;#f=null;#a=null;#p=new Set;_editorUndoBar=null;#m=!1;#g=!1;#y=!1;#b=null;#v=null;#A=null;#_=null;#E=!1;#k=null;#P=new Ng;#S=!1;#T=!1;#C=null;#M=null;#I=null;#D=null;#x=Fe.NONE;#w=new Set;#L=null;#B=null;#$=null;#U={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#O=[0,0];#F=null;#j=null;#V=null;#N=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=qi.prototype,t=l=>l.#j.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&l.hasSomethingToControl(),s=(l,{target:c})=>{if(c instanceof HTMLInputElement){const{type:h}=c;return h!=="text"&&h!=="number"}return!0},r=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return He(this,"_keyboardManager",new ga([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(l,{target:c})=>!(c instanceof HTMLButtonElement)&&l.#j.contains(c)&&!l.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(l,{target:c})=>!(c instanceof HTMLButtonElement)&&l.#j.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-o,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[o,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-o],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,o],checker:t}]]))}constructor(e,t,s,r,o,l,c,h,p,g,y,v,b){const S=this._signal=this.#e.signal;this.#j=e,this.#V=t,this.#r=s,this._eventBus=r,r._on("editingaction",this.onEditingAction.bind(this),{signal:S}),r._on("pagechanging",this.onPageChanging.bind(this),{signal:S}),r._on("scalechanging",this.onScaleChanging.bind(this),{signal:S}),r._on("rotationchanging",this.onRotationChanging.bind(this),{signal:S}),r._on("setpreference",this.onSetPreference.bind(this),{signal:S}),r._on("switchannotationeditorparams",_=>this.updateParams(_.type,_.value),{signal:S}),this.#te(),this.#re(),this.#q(),this.#s=o.annotationStorage,this.#b=o.filterFactory,this.#B=l,this.#_=c||null,this.#m=h,this.#g=p,this.#y=g,this.#D=y||null,this.viewParameters={realScale:yr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=v||null,this._supportsPinchToZoom=b!==!1}destroy(){this.#N?.resolve(),this.#N=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#i.values())e.destroy();this.#i.clear(),this.#n.clear(),this.#p.clear(),this.#t=null,this.#w.clear(),this.#o.destroy(),this.#r?.destroy(),this.#k?.hide(),this.#k=null,this.#v&&(clearTimeout(this.#v),this.#v=null),this.#F&&(clearTimeout(this.#F),this.#F=null),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#D}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return He(this,"hcmFilter",this.#B?this.#b.addHCMFilter(this.#B.foreground,this.#B.background):"none")}get direction(){return He(this,"direction",getComputedStyle(this.#j).direction)}get highlightColors(){return He(this,"highlightColors",this.#_?new Map(this.#_.split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return He(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#c=e}setMainHighlightColorPicker(e){this.#I=e}editAltText(e,t=!1){this.#r?.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){e==="enableNewAltTextWhenAddingImage"&&(this.#y=t)}onPageChanging({pageNumber:e}){this.#d=e-1}focusMainContainer(){this.#j.focus()}findParent(e,t){for(const s of this.#i.values()){const{x:r,y:o,width:l,height:c}=s.div.getBoundingClientRect();if(e>=r&&e<=r+l&&t>=o&&t<=o+c)return s}return null}disableUserSelect(e=!1){this.#V.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*yr.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#c?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#z({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#X(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of this.#i.values())if(s.hasTextLayer(e))return s;return null}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:o,focusOffset:l}=t,c=t.toString(),p=this.#z(t).closest(".textLayer"),g=this.getSelectionBoxes(p);if(!g)return;t.empty();const y=this.#X(p),v=this.#x===Fe.NONE,b=()=>{y?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:g,anchorNode:s,anchorOffset:r,focusNode:o,focusOffset:l,text:c}),v&&this.showAllEditors("highlight",!0,!0)};if(v){this.switchToMode(Fe.HIGHLIGHT,b);return}b()}#J(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=this.#z(e).closest(".textLayer"),r=this.getSelectionBoxes(s);r&&(this.#k||=new Mg(this),this.#k.show(s,r,this.direction==="ltr"))}addToAnnotationStorage(e){!e.isEmpty()&&this.#s&&!this.#s.has(e.id)&&this.#s.setValue(e.id,e)}#ee(){const e=document.getSelection();if(!e||e.isCollapsed){this.#L&&(this.#k?.hide(),this.#L=null,this.#R({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#L)return;const r=this.#z(e).closest(".textLayer");if(!r){this.#L&&(this.#k?.hide(),this.#L=null,this.#R({hasSelectedText:!1}));return}if(this.#k?.hide(),this.#L=t,this.#R({hasSelectedText:!0}),!(this.#x!==Fe.HIGHLIGHT&&this.#x!==Fe.NONE)&&(this.#x===Fe.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#x===Fe.HIGHLIGHT?this.#X(r):null;o?.toggleDrawing();const l=new AbortController,c=this.combinedSignal(l),h=p=>{p.type==="pointerup"&&p.button!==0||(l.abort(),o?.toggleDrawing(!0),p.type==="pointerup"&&this.#G("main_toolbar"))};window.addEventListener("pointerup",h,{signal:c}),window.addEventListener("blur",h,{signal:c})}}#G(e=""){this.#x===Fe.HIGHLIGHT?this.highlightSelection(e):this.#m&&this.#J()}#te(){document.addEventListener("selectionchange",this.#ee.bind(this),{signal:this._signal})}#ne(){if(this.#A)return;this.#A=new AbortController;const e=this.combinedSignal(this.#A);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#ie(){this.#A?.abort(),this.#A=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#G("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#w)if(t.div.contains(e)){this.#M=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#M)return;const[e,t]=this.#M;this.#M=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#q(){if(this.#C)return;this.#C=new AbortController;const e=this.combinedSignal(this.#C);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#se(){this.#C?.abort(),this.#C=null}#Y(){if(this.#u)return;this.#u=new AbortController;const e=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#K(){this.#u?.abort(),this.#u=null}#re(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#q(),this.#Y()}removeEditListeners(){this.#se(),this.#K()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of this.#a)if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of this.#a)if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const s of this.#w){const r=s.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const o of t.items)for(const l of this.#a)if(l.isHandlingMimeForPasting(o.type)){l.paste(o,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(o){De(`paste: "${o.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const r=this.currentLayer;try{const o=[];for(const h of s){const p=await r.deserialize(h);if(!p)return;o.push(p)}const l=()=>{for(const h of o)this.#Q(h);this.#Z(o)},c=()=>{for(const h of o)h.remove()};this.addCommands({cmd:l,undo:c,mustExec:!0})}catch(o){De(`paste: "${o.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#x!==Fe.NONE&&!this.isEditorHandlingKeyboard&&qi._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#G("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#R(e){Object.entries(e).some(([s,r])=>this.#U[s]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#U,e)}),this.#x===Fe.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#H([[$e.HIGHLIGHT_FREE,!0]]))}#H(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#ne(),this.#Y(),this.#R({isEditing:this.#x!==Fe.NONE,isEmpty:this.#W(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ie(),this.#K(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#a){this.#a=e;for(const t of this.#a)this.#H(t.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#i.get(this.#d)}getLayer(e){return this.#i.get(e)}get currentPageIndex(){return this.#d}addLayer(e){this.#i.set(e.pageIndex,e),this.#S?e.enable():e.disable()}removeLayer(e){this.#i.delete(e.pageIndex)}async updateMode(e,t=null,s=!1){if(this.#x!==e&&!(this.#N&&(await this.#N.promise,!this.#N))){if(this.#N=Promise.withResolvers(),this.#x=e,e===Fe.NONE){this.setEditingState(!1),this.#oe(),this._editorUndoBar?.hide(),this.#N.resolve();return}this.setEditingState(!0),await this.#ae(),this.unselectAll();for(const r of this.#i.values())r.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),this.#N.resolve();return}for(const r of this.#n.values())r.annotationElementId===t?(this.setSelected(r),r.enterInEditMode()):r.unselect();this.#N.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==this.#x&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(this.#a){switch(e){case $e.CREATE:this.currentLayer.addNewEditor();return;case $e.HIGHLIGHT_DEFAULT_COLOR:this.#I?.updateColor(t);break;case $e.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#$||=new Map).set(e,t),this.showAllEditors("highlight",t);break}for(const s of this.#w)s.updateParams(e,t);for(const s of this.#a)s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){for(const o of this.#n.values())o.editorType===e&&o.show(t);(this.#$?.get($e.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#H([[$e.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#T!==e){this.#T=e;for(const t of this.#i.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#ae(){if(!this.#S){this.#S=!0;const e=[];for(const t of this.#i.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#oe(){if(this.unselectAll(),this.#S){this.#S=!1;for(const e of this.#i.values())e.disable();for(const e of this.#n.values())e.disable()}}getEditors(e){const t=[];for(const s of this.#n.values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.focusMainContainer(),this.#v=null},0)),this.#n.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#h.has(e.annotationElementId))&&this.#s?.remove(e.id)}addDeletedAnnotationElement(e){this.#h.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#h.has(e)}removeDeletedAnnotationElement(e){this.#h.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#Q(e){const t=this.#i.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#H(e.propertiesToUpdate))}get#le(){let e=null;for(e of this.#w);return e}updateUI(e){this.#le===e&&this.#H(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#H(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#w.has(e)){this.#w.delete(e),e.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#w.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(e){this.#c?.commitOrRemove();for(const t of this.#w)t!==e&&t.unselect();this.#w.clear(),this.#w.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(e){return this.#w.has(e)}get firstSelectedEditor(){return this.#w.values().next().value}unselect(e){e.unselect(),this.#w.delete(e),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#w.size!==0}get isEnterHandled(){return this.#w.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#R({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#W()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#W()})}addCommands(e){this.#o.add(e),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#W()})}cleanUndoStack(e){this.#o.cleanType(e)}#W(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#w],s=()=>{this._editorUndoBar?.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const o of t)this.#Q(o)};this.addCommands({cmd:s,undo:r,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#Z(e){for(const t of this.#w)t.unselect();this.#w.clear();for(const t of e)t.isEmpty()||(this.#w.add(t),t.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#w)e.commit();this.#Z(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#x!==Fe.NONE))&&!this.#c?.commitOrRemove()&&this.hasSelection){for(const e of this.#w)e.unselect();this.#w.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#O[0]+=e,this.#O[1]+=t;const[r,o]=this.#O,l=[...this.#w],c=1e3;this.#F&&clearTimeout(this.#F),this.#F=setTimeout(()=>{this.#F=null,this.#O[0]=this.#O[1]=0,this.addCommands({cmd:()=>{for(const h of l)this.#n.has(h.id)&&h.translateInPage(r,o)},undo:()=>{for(const h of l)this.#n.has(h.id)&&h.translateInPage(-r,-o)},mustExec:!1})},c);for(const h of l)h.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const e of this.#w)this.#f.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const e=this.#f;this.#f=null;let t=!1;for(const[{x:r,y:o,pageIndex:l},c]of e)c.newX=r,c.newY=o,c.newPageIndex=l,t||=r!==c.savedX||o!==c.savedY||l!==c.savedPageIndex;if(!t)return!1;const s=(r,o,l,c)=>{if(this.#n.has(r.id)){const h=this.#i.get(c);h?r._setParentAndPosition(h,o,l):(r.pageIndex=c,r.x=o,r.y=l)}};return this.addCommands({cmd:()=>{for(const[r,{newX:o,newY:l,newPageIndex:c}]of e)s(r,o,l,c)},undo:()=>{for(const[r,{savedX:o,savedY:l,savedPageIndex:c}]of e)s(r,o,l,c)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#f)for(const s of this.#f.keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#w.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#x}get imageManager(){return He(this,"imageManager",new Qc)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let p=0,g=t.rangeCount;p<g;p++)if(!e.contains(t.getRangeAt(p).commonAncestorContainer))return null;const{x:s,y:r,width:o,height:l}=e.getBoundingClientRect();let c;switch(e.getAttribute("data-main-rotation")){case"90":c=(p,g,y,v)=>({x:(g-r)/l,y:1-(p+y-s)/o,width:v/l,height:y/o});break;case"180":c=(p,g,y,v)=>({x:1-(p+y-s)/o,y:1-(g+v-r)/l,width:y/o,height:v/l});break;case"270":c=(p,g,y,v)=>({x:1-(g+v-r)/l,y:(p-s)/o,width:v/l,height:y/o});break;default:c=(p,g,y,v)=>({x:(p-s)/o,y:(g-r)/l,width:y/o,height:v/l});break}const h=[];for(let p=0,g=t.rangeCount;p<g;p++){const y=t.getRangeAt(p);if(!y.collapsed)for(const{x:v,y:b,width:S,height:_}of y.getClientRects())S===0||_===0||h.push(c(v,b,S,_))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#l||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#l?.delete(e)}renderAnnotationElement(e){const t=this.#l?.get(e.data.id);if(!t)return;const s=this.#s.getRawValue(t);s&&(this.#x===Fe.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}}class ri{#e=null;#t=!1;#n=null;#i=null;#r=null;#s=null;#l=!1;#o=null;#u=null;#c=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(e){this.#u=e,this.#h=e._uiManager.useNewAltTextFlow,ri.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){ri._l10n??=e}async render(){const e=this.#n=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#i=document.createElement("span");e.append(t),this.#h?(e.classList.add("new"),e.setAttribute("data-l10n-id",ri.#f.missing),t.setAttribute("data-l10n-id",ri.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#u._uiManager._signal;e.addEventListener("contextmenu",Un,{signal:s}),e.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:s});const r=o=>{o.preventDefault(),this.#u._uiManager.editAltText(this.#u),this.#h&&this.#u._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#a}})};return e.addEventListener("click",r,{capture:!0,signal:s}),e.addEventListener("keydown",o=>{o.target===e&&o.key==="Enter"&&(this.#l=!0,r(o))},{signal:s}),await this.#p(),e}get#a(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#h?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#h?this.#e!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(e){this.#e===null&&(this.#c=e,this.#d=await ri._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#p())}toggleAltTextBadge(e=!1){if(!this.#h||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#u.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#c===t&&(t=this.#d),{altText:t,decorative:this.#t,guessedText:this.#c,textWithDisclaimer:this.#d}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:r,cancel:o=!1}){s&&(this.#c=s,this.#d=r),!(this.#e===e&&this.#t===t)&&(o||(this.#e=e,this.#t=t),this.#p())}toggle(e=!1){this.#n&&(!e&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!e)}shown(){this.#u._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#a}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#r=null,this.#o?.remove(),this.#o=null}async#p(){const e=this.#n;if(!e)return;if(this.#h){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",ri.#f[this.#a]),this.#i?.setAttribute("data-l10n-id",ri.#f[`${this.#a}-label`]),!this.#e){this.#r?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#r;if(!t){this.#r=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#u.id}`;const r=100,o=this.#u._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#r.classList.add("show"),this.#u._reportTelemetry({action:"alt_text_tooltip"})},r)},{signal:o}),e.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#r?.classList.remove("show")},{signal:o})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#u.getImageForAltText()?.setAttribute("aria-describedby",t.id)}}class jo{#e;#t=!1;#n=null;#i;#r;#s;#l;#o;#u=null;#c;#d=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:r=null,onPinching:o=null,onPinchEnd:l=null,signal:c}){this.#e=e,this.#n=s,this.#i=t,this.#r=r,this.#s=o,this.#l=l,this.#c=new AbortController,this.#o=AbortSignal.any([c,this.#c.signal]),e.addEventListener("touchstart",this.#h.bind(this),{passive:!1,signal:this.#o})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return He(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#h(e){if(this.#i?.()||e.touches.length<2)return;if(!this.#d){this.#d=new AbortController;const r=AbortSignal.any([this.#o,this.#d.signal]),o=this.#e,l={signal:r,passive:!1};o.addEventListener("touchmove",this.#f.bind(this),l),o.addEventListener("touchend",this.#a.bind(this),l),o.addEventListener("touchcancel",this.#a.bind(this),l),this.#r?.()}if(vn(e),e.touches.length!==2||this.#n?.()){this.#u=null;return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),this.#u={touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#f(e){if(!this.#u||e.touches.length!==2)return;let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:r,screenY:o}=t,{screenX:l,screenY:c}=s,h=this.#u,{touch0X:p,touch0Y:g,touch1X:y,touch1Y:v}=h,b=y-p,S=v-g,_=l-r,T=c-o,k=Math.hypot(_,T)||1,F=Math.hypot(b,S)||1;if(!this.#t&&Math.abs(F-k)<=jo.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=r,h.touch0Y=o,h.touch1X=l,h.touch1Y=c,e.preventDefault(),!this.#t){this.#t=!0;return}const z=[(r+l)/2,(o+c)/2];this.#s?.(z,F,k)}#a(e){this.#d.abort(),this.#d=null,this.#l?.(),this.#u&&(e.preventDefault(),this.#u=null,this.#t=!1)}destroy(){this.#c?.abort(),this.#c=null}}class Ee{#e=null;#t=null;#n=null;#i=!1;#r=null;#s="";#l=!1;#o=null;#u=null;#c=null;#d=null;#h="";#f=!1;#a=null;#p=!1;#m=!1;#g=!1;#y=null;#b=0;#v=0;#A=null;#_=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#E=!1;#k=Ee._zIndex++;static _borderLineWidth=-1;static _colorManager=new Zc;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=Ee.prototype._resizeWithKeyboard,t=qi.TRANSLATE_SMALL,s=qi.TRANSLATE_BIG;return He(this,"_resizerKeyboardManager",new ga([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],Ee.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:r,pageX:o,pageY:l}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,r],this.pageTranslation=[o,l];const[c,h]=this.parentDimensions;this.x=e.x/c,this.y=e.y/h,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return He(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Ig({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Ee._l10n??=e,Ee._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Ee._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Ee._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){et("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#E}set _isDraggable(e){this.#E=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#k}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#z(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,r){const[o,l]=this.parentDimensions;[s,r]=this.screenToPageTranslation(s,r),this.x=(e+s)/o,this.y=(t+r)/l,this.fixAndSetPosition()}#P([e,t],s,r){[s,r]=this.screenToPageTranslation(s,r),this.x+=s/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#P(this.parentDimensions,e,t)}translateInPage(e,t){this.#a||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#a||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[r,o]}=this;if(this.x+=e/r,this.y+=t/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:y,y:v}=this.div.getBoundingClientRect();this.parent.findNewParent(this,y,v)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:l,y:c}=this;const[h,p]=this.getBaseTranslation();l+=h,c+=p;const{style:g}=s;g.left=`${(100*l).toFixed(2)}%`,g.top=`${(100*c).toFixed(2)}%`,this._onTranslating(l,c),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#a&&(this.#a[0]!==this.x||this.#a[1]!==this.y)}get _hasBeenResized(){return!!this.#a&&(this.#a[2]!==this.width||this.#a[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=Ee,r=s/e,o=s/t;switch(this.rotation){case 90:return[-r,o];case 180:return[r,o];case 270:return[r,-o];default:return[-r,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,r]}=this;let{x:o,y:l,width:c,height:h}=this;if(c*=s,h*=r,o*=s,l*=r,this._mustFixPosition)switch(e){case 0:o=Math.max(0,Math.min(s-c,o)),l=Math.max(0,Math.min(r-h,l));break;case 90:o=Math.max(0,Math.min(s-h,o)),l=Math.min(r,Math.max(c,l));break;case 180:o=Math.min(s,Math.max(c,o)),l=Math.min(r,Math.max(h,l));break;case 270:o=Math.min(s,Math.max(h,o)),l=Math.max(0,Math.min(r-c,l));break}this.x=o/=s,this.y=l/=r;const[p,g]=this.getBaseTranslation();o+=p,l+=g,t.left=`${(100*o).toFixed(2)}%`,t.top=`${(100*l).toFixed(2)}%`,this.moveInDOM()}static#S(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return Ee.#S(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return Ee.#S(e,t,360-this.parentRotation)}#T(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,r]=this.parentDimensions,{style:o}=this.div;o.width=`${(100*e/s).toFixed(2)}%`,this.#l||(o.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,r=s.endsWith("%"),o=!this.#l&&t.endsWith("%");if(r&&o)return;const[l,c]=this.parentDimensions;r||(e.width=`${(100*parseFloat(s)/l).toFixed(2)}%`),!this.#l&&!o&&(e.height=`${(100*parseFloat(t)/c).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#C(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const r=document.createElement("div");this.#o.append(r),r.classList.add("resizer",s),r.setAttribute("data-resizer-name",s),r.addEventListener("pointerdown",this.#M.bind(this,s),{signal:t}),r.addEventListener("contextmenu",Un,{signal:t}),r.tabIndex=-1}this.div.prepend(this.#o)}#M(e,t){t.preventDefault();const{isMac:s}=en.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#n?.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,this.#u=[t.screenX,t.screenY];const o=new AbortController,l=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#x.bind(this,e),{passive:!0,capture:!0,signal:l}),window.addEventListener("touchmove",vn,{passive:!1,signal:l}),window.addEventListener("contextmenu",Un,{signal:l}),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const c=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const p=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=c,this.div.style.cursor=h,this.#D()};window.addEventListener("pointerup",p,{signal:l}),window.addEventListener("blur",p,{signal:l})}#I(e,t,s,r){this.width=s,this.height=r,this.x=e,this.y=t;const[o,l]=this.parentDimensions;this.setDims(o*s,l*r),this.fixAndSetPosition(),this._onResized()}_onResized(){}#D(){if(!this.#c)return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:r}=this.#c;this.#c=null;const o=this.x,l=this.y,c=this.width,h=this.height;o===e&&l===t&&c===s&&h===r||this.addCommands({cmd:this.#I.bind(this,o,l,c,h),undo:this.#I.bind(this,e,t,s,r),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#x(e,t){const[s,r]=this.parentDimensions,o=this.x,l=this.y,c=this.width,h=this.height,p=Ee.MIN_SIZE/s,g=Ee.MIN_SIZE/r,y=this.#T(this.rotation),v=(J,ee)=>[y[0]*J+y[2]*ee,y[1]*J+y[3]*ee],b=this.#T(360-this.rotation),S=(J,ee)=>[b[0]*J+b[2]*ee,b[1]*J+b[3]*ee];let _,T,k=!1,F=!1;switch(e){case"topLeft":k=!0,_=(J,ee)=>[0,0],T=(J,ee)=>[J,ee];break;case"topMiddle":_=(J,ee)=>[J/2,0],T=(J,ee)=>[J/2,ee];break;case"topRight":k=!0,_=(J,ee)=>[J,0],T=(J,ee)=>[0,ee];break;case"middleRight":F=!0,_=(J,ee)=>[J,ee/2],T=(J,ee)=>[0,ee/2];break;case"bottomRight":k=!0,_=(J,ee)=>[J,ee],T=(J,ee)=>[0,0];break;case"bottomMiddle":_=(J,ee)=>[J/2,ee],T=(J,ee)=>[J/2,0];break;case"bottomLeft":k=!0,_=(J,ee)=>[0,ee],T=(J,ee)=>[J,0];break;case"middleLeft":F=!0,_=(J,ee)=>[0,ee/2],T=(J,ee)=>[J,ee/2];break}const z=_(c,h),H=T(c,h);let $=v(...H);const G=Ee._round(o+$[0]),X=Ee._round(l+$[1]);let ie=1,de=1,K,ke;if(t.fromKeyboard)({deltaX:K,deltaY:ke}=t);else{const{screenX:J,screenY:ee}=t,[U,re]=this.#u;[K,ke]=this.screenToPageTranslation(J-U,ee-re),this.#u[0]=J,this.#u[1]=ee}if([K,ke]=S(K/s,ke/r),k){const J=Math.hypot(c,h);ie=de=Math.max(Math.min(Math.hypot(H[0]-z[0]-K,H[1]-z[1]-ke)/J,1/c,1/h),p/c,g/h)}else F?ie=Math.max(p,Math.min(1,Math.abs(H[0]-z[0]-K)))/c:de=Math.max(g,Math.min(1,Math.abs(H[1]-z[1]-ke)))/h;const Re=Ee._round(c*ie),Be=Ee._round(h*de);$=v(...T(Re,Be));const Ne=G-$[0],Qe=X-$[1];this.#a||=[this.x,this.y,this.width,this.height],this.width=Re,this.height=Be,this.x=Ne,this.y=Qe,this.setDims(s*Re,r*Be),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}async addEditToolbar(){return this._editToolbar||this.#m?this._editToolbar:(this._editToolbar=new ua(this),this.div.append(this._editToolbar.render()),this.#n&&await this._editToolbar.addAltText(this.#n),this._editToolbar)}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#n||(ri.initialize(Ee._l10n),this.#n=new ri(this),this.#e&&(this.#n.data=this.#e,this.#e=null),await this.addEditToolbar())}get altTextData(){return this.#n?.data}set altTextData(e){this.#n&&(this.#n.data=e)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(e){await this.#n?.setGuessedText(e)}serializeAltText(e){return this.#n?.serialize(e)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#i?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#O();const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[s,r]=this.getInitialTranslation();return this.translate(s,r),Ro(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#_||=new jo({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#w.bind(this),onPinching:this.#L.bind(this),onPinchEnd:this.#B.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#w(){this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#L(e,t,s){let o=.7*(s/t)+1-.7;if(o===1)return;const l=this.#T(this.rotation),c=(G,X)=>[l[0]*G+l[2]*X,l[1]*G+l[3]*X],[h,p]=this.parentDimensions,g=this.x,y=this.y,v=this.width,b=this.height,S=Ee.MIN_SIZE/h,_=Ee.MIN_SIZE/p;o=Math.max(Math.min(o,1/v,1/b),S/v,_/b);const T=Ee._round(v*o),k=Ee._round(b*o);if(T===v&&k===b)return;this.#a||=[g,y,v,b];const F=c(v/2,b/2),z=Ee._round(g+F[0]),H=Ee._round(y+F[1]),$=c(T/2,k/2);this.x=z-$[0],this.y=H-$[1],this.width=T,this.height=k,this.setDims(h*T,p*k),this.fixAndSetPosition(),this._onResizing()}#B(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#D()}pointerdown(e){const{isMac:t}=en.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#U(e);return}this.#$(e)}get isSelected(){return this._uiManager.isSelected(this)}#$(e){const{isMac:t}=en.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const r=new AbortController,o=this._uiManager.combinedSignal(r),l={capture:!0,passive:!1,signal:o},c=p=>{r.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#$(p),s&&this._onStopDragging()};t&&(this.#b=e.clientX,this.#v=e.clientY,this.#r=e.pointerId,this.#s=e.pointerType,window.addEventListener("pointermove",p=>{s||(s=!0,this._onStartDragging());const{clientX:g,clientY:y,pointerId:v}=p;if(v!==this.#r){vn(p);return}const[b,S]=this.screenToPageTranslation(g-this.#b,y-this.#v);this.#b=g,this.#v=y,this._uiManager.dragSelectedEditors(b,S)},l),window.addEventListener("touchmove",vn,l),window.addEventListener("pointerdown",p=>{p.pointerType===this.#s&&(this.#_||p.isPrimary)&&c(p),vn(p)},l));const h=p=>{if(!this.#r||this.#r===p.pointerId){c(p);return}vn(p)};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const r=this.parentScale,[o,l]=this.pageDimensions,[c,h]=this.pageTranslation,p=e/r,g=t/r,y=this.x*o,v=this.y*l,b=this.width*o,S=this.height*l;switch(s){case 0:return[y+p+c,l-v-g-S+h,y+p+b+c,l-v-g+h];case 90:return[y+g+c,l-v+p+h,y+g+S+c,l-v+p+b+h];case 180:return[y-p-b+c,l-v+g+h,y-p+c,l-v+g+S+h];case 270:return[y-g-S+c,l-v-p-b+h,y-g+c,l-v-p+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,r,o,l]=e,c=o-s,h=l-r;switch(this.rotation){case 0:return[s,t-l,c,h];case 90:return[s,t-r,h,c];case 180:return[o,t-r,c,h];case 270:return[o,t-l,h,c];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:r}=this.getClientDimensions(),{innerHeight:o,innerWidth:l}=window;return t<l&&r>0&&e<o&&s>0}#O(){if(this.#d||!this.div)return;this.#d=new AbortController;const e=this._uiManager.combinedSignal(this.#d);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#O()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){et("An editor must be serializable")}static async deserialize(e,t,s){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});r.rotation=e.rotation,r.#e=e.accessibilityData;const[o,l]=r.pageDimensions,[c,h,p,g]=r.getRectInCurrentCoords(e.rect,l);return r.x=c/o,r.y=h/l,r.width=p/o,r.height=g/l,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#d?.abort(),this.#d=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#z(),this.removeEditToolbar(),this.#A){for(const e of this.#A.values())clearTimeout(e);this.#A=null}this.parent=null,this.#_?.destroy(),this.#_=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#C(),this.#o.classList.remove("hidden"),Ro(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#o.children;if(!this.#t){this.#t=Array.from(t);const l=this.#F.bind(this),c=this.#j.bind(this),h=this._uiManager._signal;for(const p of this.#t){const g=p.getAttribute("data-resizer-name");p.setAttribute("role","spinbutton"),p.addEventListener("keydown",l,{signal:h}),p.addEventListener("blur",c,{signal:h}),p.addEventListener("focus",this.#V.bind(this,g),{signal:h}),p.setAttribute("data-l10n-id",Ee._l10nResizer[g])}}const s=this.#t[0];let r=0;for(const l of t){if(l===s)break;r++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(o!==r){if(o<r)for(let c=0;c<r-o;c++)this.#o.append(this.#o.firstChild);else if(o>r)for(let c=0;c<o-r;c++)this.#o.firstChild.before(this.#o.lastChild);let l=0;for(const c of t){const p=this.#t[l++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",Ee._l10nResizer[p])}}this.#N(0),this.#g=!0,this.#o.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#F(e){Ee._resizerKeyboardManager.exec(this,e)}#j(e){this.#g&&e.relatedTarget?.parentNode!==this.#o&&this.#z()}#V(e){this.#h=this.#g?e:""}#N(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#g&&this.#x(this.#h,{deltaX:e,deltaY:t,fromKeyboard:!0})}#z(){this.#g=!1,this.#N(-1),this.#D()}_stopResizingWithKeyboard(){this.#z(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#l=!0;const s=e/t,{style:r}=this.div;r.aspectRatio=s,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#A||=new Map;const{action:s}=e;let r=this.#A.get(s);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),this.#A.delete(s),this.#A.size===0&&(this.#A=null)},Ee._telemetryTimeout),this.#A.set(s,r);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#i=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#i=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class Ig extends Ee{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ld=3285377520,Tn=4294901760,si=65535;class ef{constructor(e){this.h1=e?e&4294967295:Ld,this.h2=e?e&4294967295:Ld}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let _=0,T=e.length;_<T;_++){const k=e.charCodeAt(_);k<=255?t[s++]=k:(t[s++]=k>>>8,t[s++]=k&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=s>>2,o=s-r*4,l=new Uint32Array(t.buffer,0,r);let c=0,h=0,p=this.h1,g=this.h2;const y=3432918353,v=461845907,b=y&si,S=v&si;for(let _=0;_<r;_++)_&1?(c=l[_],c=c*y&Tn|c*b&si,c=c<<15|c>>>17,c=c*v&Tn|c*S&si,p^=c,p=p<<13|p>>>19,p=p*5+3864292196):(h=l[_],h=h*y&Tn|h*b&si,h=h<<15|h>>>17,h=h*v&Tn|h*S&si,g^=h,g=g<<13|g>>>19,g=g*5+3864292196);switch(c=0,o){case 3:c^=t[r*4+2]<<16;case 2:c^=t[r*4+1]<<8;case 1:c^=t[r*4],c=c*y&Tn|c*b&si,c=c<<15|c>>>17,c=c*v&Tn|c*S&si,r&1?p^=c:g^=c}this.h1=p,this.h2=g}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Tn|e*36045&si,t=t*4283543511&Tn|((t<<16|e>>>16)*2950163797&Tn)>>>16,e^=t>>>1,e=e*444984403&Tn|e*60499&si,t=t*3301882366&Tn|((t<<16|e>>>16)*3120437893&Tn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Hc=Object.freeze({map:null,hash:"",transfer:void 0});class Jc{#e=!1;#t=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=this.#n.get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return this.#n.get(e)}remove(e){if(this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of this.#n.values())if(t instanceof Ee)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=this.#n.get(e);let r=!1;if(s!==void 0)for(const[o,l]of Object.entries(t))s[o]!==l&&(r=!0,s[o]=l);else r=!0,this.#n.set(e,t);r&&this.#i(),t instanceof Ee&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#n.has(e)}getAll(){return this.#n.size>0?Gc(this.#n):null}setAll(e){for(const[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return this.#n.size}#i(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new tf(this)}get serializable(){if(this.#n.size===0)return Hc;const e=new Map,t=new ef,s=[],r=Object.create(null);let o=!1;for(const[l,c]of this.#n){const h=c instanceof Ee?c.serialize(!1,r):c;h&&(e.set(l,h),t.update(`${l}:${JSON.stringify(h)}`),o||=!!h.bitmap)}if(o)for(const l of e.values())l.bitmap&&s.push(l.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Hc}get editorStats(){let e=null;const t=new Map;for(const s of this.#n.values()){if(!(s instanceof Ee))continue;const r=s.telemetryFinalData;if(!r)continue;const{type:o}=r;t.has(o)||t.set(o,Object.getPrototypeOf(s).constructor),e||=Object.create(null);const l=e[o]||=new Map;for(const[c,h]of Object.entries(r)){if(c==="type")continue;let p=l.get(c);p||(p=new Map,l.set(c,p));const g=p.get(h)??0;p.set(h,g+1)}}for(const[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){this.#t=null}get modifiedIds(){if(this.#t)return this.#t;const e=[];for(const t of this.#n.values())!(t instanceof Ee)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}}class tf extends Jc{#e;constructor(e){super();const{map:t,hash:s,transfer:r}=e.serializable,o=structuredClone(t,r?{transfer:r}:null);this.#e={map:o,hash:s,transfer:r}}get print(){et("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return He(this,"modifiedIds",{ids:new Set,hash:""})}}class Fg{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||this.#e.has(e.loadedName))){if(St(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:r,style:o}=e,l=new FontFace(s,r,o);this.addNativeFontFace(l);try{await l.load(),this.#e.add(s),t?.(e)}catch{De(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}et("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(r){throw De(`Failed to load font '${s.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const r=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return He(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(Gt||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),He(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(St(!r.done,"completeRequest() cannot be called twice."),r.done=!0;s.length>0&&s[0].done;){const o=s.shift();setTimeout(o.callback,0)}}const{loadingRequests:s}=this,r={done:!1,complete:t,callback:e};return s.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return He(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(H,$){return H.charCodeAt($)<<24|H.charCodeAt($+1)<<16|H.charCodeAt($+2)<<8|H.charCodeAt($+3)&255}function r(H,$,G,X){const ie=H.substring(0,$),de=H.substring($+G);return ie+X+de}let o,l;const c=this._document.createElement("canvas");c.width=1,c.height=1;const h=c.getContext("2d");let p=0;function g(H,$){if(++p>30){De("Load test font never loaded."),$();return}if(h.font="30px "+H,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){$();return}setTimeout(g.bind(null,H,$))}const y=`lt${Date.now()}${this.loadTestFontId++}`;let v=this._loadTestFont;v=r(v,976,y.length,y);const S=16,_=1482184792;let T=s(v,S);for(o=0,l=y.length-3;o<l;o+=4)T=T-_+s(y,o)|0;o<y.length&&(T=T-_+s(y+"XXX",o)|0),v=r(v,S,4,bg(T));const k=`url(data:font/opentype;base64,${btoa(v)});`,F=`@font-face {font-family:"${y}";src:${k}}`;this.insertRule(F);const z=this._document.createElement("div");z.style.visibility="hidden",z.style.width=z.style.height="10px",z.style.position="absolute",z.style.top=z.style.left="0px";for(const H of[e.loadedName,y]){const $=this._document.createElement("span");$.textContent="Hi",$.style.fontFamily=H,z.append($)}this._document.body.append(z),g(y,()=>{z.remove(),t.complete()})}}class Dg{constructor(e,{disableFontFace:t=!1,fontExtraProperties:s=!1,inspectFont:r=null}){this.compiledGlyphs=Object.create(null);for(const o in e)this[o]=e[o];this.disableFontFace=t===!0,this.fontExtraProperties=s===!0,this._inspectFont=r}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Cg(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let r;try{r=e.get(s)}catch(l){De(`getPathGenerator - ignoring character: "${l}".`)}const o=new Path2D(r||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=o}}const bo={DATA:1,ERROR:2},At={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Id(){}function hn(f){if(f instanceof Xi||f instanceof jc||f instanceof da||f instanceof Rd||f instanceof Po||f instanceof Tc)return f;switch(f instanceof Error||typeof f=="object"&&f!==null||et('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),f.name){case"AbortException":return new Xi(f.message);case"InvalidPDFException":return new jc(f.message);case"MissingPDFException":return new da(f.message);case"PasswordException":return new Rd(f.message,f.code);case"UnexpectedResponseException":return new Po(f.message,f.status);case"UnknownErrorException":return new Tc(f.message,f.details)}return new Tc(f.message,f.toString())}class la{#e=new AbortController;constructor(e,t,s){this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#i(e);return}if(e.callback){const s=e.callbackId,r=this.callbackCapabilities[s];if(!r)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===bo.DATA)r.resolve(e.data);else if(e.callback===bo.ERROR)r.reject(hn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,r=e.sourceName,o=this.comObj;Promise.try(t,e.data).then(function(l){o.postMessage({sourceName:s,targetName:r,callback:bo.DATA,callbackId:e.callbackId,data:l})},function(l){o.postMessage({sourceName:s,targetName:r,callback:bo.ERROR,callbackId:e.callbackId,reason:hn(l)})});return}if(e.streamId){this.#n(e);return}t(e.data)}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const r=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[r]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},s)}catch(l){o.reject(l)}return o.promise}sendWithStream(e,t,s,r){const o=this.streamId++,l=this.sourceName,c=this.targetName,h=this.comObj;return new ReadableStream({start:p=>{const g=Promise.withResolvers();return this.streamControllers[o]={controller:p,startCall:g,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:l,targetName:c,action:e,streamId:o,data:t,desiredSize:p.desiredSize},r),g.promise},pull:p=>{const g=Promise.withResolvers();return this.streamControllers[o].pullCall=g,h.postMessage({sourceName:l,targetName:c,stream:At.PULL,streamId:o,desiredSize:p.desiredSize}),g.promise},cancel:p=>{St(p instanceof Error,"cancel must have a valid reason");const g=Promise.withResolvers();return this.streamControllers[o].cancelCall=g,this.streamControllers[o].isClosed=!0,h.postMessage({sourceName:l,targetName:c,stream:At.CANCEL,streamId:o,reason:hn(p)}),g.promise}},s)}#n(e){const t=e.streamId,s=this.sourceName,r=e.sourceName,o=this.comObj,l=this,c=this.actionHandler[e.action],h={enqueue(p,g=1,y){if(this.isCancelled)return;const v=this.desiredSize;this.desiredSize-=g,v>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:s,targetName:r,stream:At.ENQUEUE,streamId:t,chunk:p},y)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:s,targetName:r,stream:At.CLOSE,streamId:t}),delete l.streamSinks[t])},error(p){St(p instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:s,targetName:r,stream:At.ERROR,streamId:t,reason:hn(p)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[t]=h,Promise.try(c,e.data,h).then(function(){o.postMessage({sourceName:s,targetName:r,stream:At.START_COMPLETE,streamId:t,success:!0})},function(p){o.postMessage({sourceName:s,targetName:r,stream:At.START_COMPLETE,streamId:t,reason:hn(p)})})}#i(e){const t=e.streamId,s=this.sourceName,r=e.sourceName,o=this.comObj,l=this.streamControllers[t],c=this.streamSinks[t];switch(e.stream){case At.START_COMPLETE:e.success?l.startCall.resolve():l.startCall.reject(hn(e.reason));break;case At.PULL_COMPLETE:e.success?l.pullCall.resolve():l.pullCall.reject(hn(e.reason));break;case At.PULL:if(!c){o.postMessage({sourceName:s,targetName:r,stream:At.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&e.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=e.desiredSize,Promise.try(c.onPull||Id).then(function(){o.postMessage({sourceName:s,targetName:r,stream:At.PULL_COMPLETE,streamId:t,success:!0})},function(p){o.postMessage({sourceName:s,targetName:r,stream:At.PULL_COMPLETE,streamId:t,reason:hn(p)})});break;case At.ENQUEUE:if(St(l,"enqueue should have stream controller"),l.isClosed)break;l.controller.enqueue(e.chunk);break;case At.CLOSE:if(St(l,"close should have stream controller"),l.isClosed)break;l.isClosed=!0,l.controller.close(),this.#r(l,t);break;case At.ERROR:St(l,"error should have stream controller"),l.controller.error(hn(e.reason)),this.#r(l,t);break;case At.CANCEL_COMPLETE:e.success?l.cancelCall.resolve():l.cancelCall.reject(hn(e.reason)),this.#r(l,t);break;case At.CANCEL:if(!c)break;const h=hn(e.reason);Promise.try(c.onCancel||Id,h).then(function(){o.postMessage({sourceName:s,targetName:r,stream:At.CANCEL_COMPLETE,streamId:t,success:!0})},function(p){o.postMessage({sourceName:s,targetName:r,stream:At.CANCEL_COMPLETE,streamId:t,reason:hn(p)})}),c.sinkCapability.reject(h),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#r(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class nf{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){et("Abstract method `_createCanvas` called.")}}class Og extends nf{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class sf{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){et("Abstract method `_fetch` called.")}}class rf extends sf{async _fetch(e){const t=await Do(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Fo(t)}}class af{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,r,o){return"none"}destroy(e=!1){}}class jg extends af{#e;#t;#n;#i;#r;#s;#l=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#i=e,this.#r=t}get#o(){return this.#t||=new Map}get#u(){return this.#s||=new Map}get#c(){if(!this.#n){const e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const s=this.#r.createElementNS(Ai,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#n=this.#r.createElementNS(Ai,"defs"),e.append(s),s.append(this.#n),this.#r.body.append(e)}return this.#n}#d(e){if(e.length===1){const h=e[0],p=new Array(256);for(let y=0;y<256;y++)p[y]=h[y]/255;const g=p.join(",");return[g,g,g]}const[t,s,r]=e,o=new Array(256),l=new Array(256),c=new Array(256);for(let h=0;h<256;h++)o[h]=t[h]/255,l[h]=s[h]/255,c[h]=r[h]/255;return[o.join(","),l.join(","),c.join(",")]}#h(e){if(this.#e===void 0){this.#e="";const t=this.#r.URL;t!==this.#r.baseURI&&(Oo(t)?De('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=t.split("#",1)[0])}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[s,r,o]=this.#d(e),l=e.length===1?s:`${s}${r}${o}`;if(t=this.#o.get(l),t)return this.#o.set(e,t),t;const c=`g_${this.#i}_transfer_map_${this.#l++}`,h=this.#h(c);this.#o.set(e,h),this.#o.set(l,h);const p=this.#p(c);return this.#g(s,r,o,p),h}addHCMFilter(e,t){const s=`${e}-${t}`,r="base";let o=this.#u.get(r);if(o?.key===s||(o?(o.filter?.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},this.#u.set(r,o)),!e||!t))return o.url;const l=this.#b(e);e=pe.makeHexColor(...l);const c=this.#b(t);if(t=pe.makeHexColor(...c),this.#c.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return o.url;const h=new Array(256);for(let b=0;b<=255;b++){const S=b/255;h[b]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const p=h.join(","),g=`g_${this.#i}_hcm_filter`,y=o.filter=this.#p(g);this.#g(p,p,p,y),this.#a(y);const v=(b,S)=>{const _=l[b]/255,T=c[b]/255,k=new Array(S+1);for(let F=0;F<=S;F++)k[F]=_+F/S*(T-_);return k.join(",")};return this.#g(v(0,5),v(1,5),v(2,5),y),o.url=this.#h(g),o.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[s]=this.#d([e]),r=`alpha_${s}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;const o=`g_${this.#i}_alpha_map_${this.#l++}`,l=this.#h(o);this.#o.set(e,l),this.#o.set(r,l);const c=this.#p(o);return this.#y(s,c),l}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let s,r;if(e?([s]=this.#d([e]),r=`luminosity_${s}`):r="luminosity",t=this.#o.get(r),t)return this.#o.set(e,t),t;const o=`g_${this.#i}_luminosity_map_${this.#l++}`,l=this.#h(o);this.#o.set(e,l),this.#o.set(r,l);const c=this.#p(o);return this.#f(c),e&&this.#y(s,c),l}addHighlightHCMFilter(e,t,s,r,o){const l=`${t}-${s}-${r}-${o}`;let c=this.#u.get(e);if(c?.key===l||(c?(c.filter?.remove(),c.key=l,c.url="none",c.filter=null):(c={key:l,url:"none",filter:null},this.#u.set(e,c)),!t||!s))return c.url;const[h,p]=[t,s].map(this.#b.bind(this));let g=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),y=Math.round(.2126*p[0]+.7152*p[1]+.0722*p[2]),[v,b]=[r,o].map(this.#b.bind(this));y<g&&([g,y,v,b]=[y,g,b,v]),this.#c.style.color="";const S=(k,F,z)=>{const H=new Array(256),$=(y-g)/z,G=k/255,X=(F-k)/(255*z);let ie=0;for(let de=0;de<=z;de++){const K=Math.round(g+de*$),ke=G+de*X;for(let Re=ie;Re<=K;Re++)H[Re]=ke;ie=K+1}for(let de=ie;de<256;de++)H[de]=H[ie-1];return H.join(",")},_=`g_${this.#i}_hcm_${e}_filter`,T=c.filter=this.#p(_);return this.#a(T),this.#g(S(v[0],b[0],5),S(v[1],b[1],5),S(v[2],b[2],5),T),c.url=this.#h(_),c.url}destroy(e=!1){e&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#t?.clear(),this.#t=null,this.#s?.clear(),this.#s=null,this.#l=0)}#f(e){const t=this.#r.createElementNS(Ai,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#a(e){const t=this.#r.createElementNS(Ai,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){const t=this.#r.createElementNS(Ai,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#c.append(t),t}#m(e,t,s){const r=this.#r.createElementNS(Ai,t);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),e.append(r)}#g(e,t,s,r){const o=this.#r.createElementNS(Ai,"feComponentTransfer");r.append(o),this.#m(o,"feFuncR",e),this.#m(o,"feFuncG",t),this.#m(o,"feFuncB",s)}#y(e,t){const s=this.#r.createElementNS(Ai,"feComponentTransfer");t.append(s),this.#m(s,"feFuncA",e)}#b(e){return this.#c.style.color=e,Kc(getComputedStyle(this.#c).getPropertyValue("color"))}}class of{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){et("Abstract method `_fetch` called.")}}class lf extends of{async _fetch(e){const t=await Do(e,"arraybuffer");return new Uint8Array(t)}}Gt&&De("Please use the `legacy` build in Node.js environments.");async function cf(f){const t=await process.getBuiltinModule("fs").promises.readFile(f);return new Uint8Array(t)}class zg extends af{}class Hg extends nf{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Bg extends sf{async _fetch(e){return cf(e)}}class $g extends of{async _fetch(e){return cf(e)}}const Wt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Bc(f,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,s),f.clip(r)}class eu{getPattern(){et("Abstract method `getPattern` called.")}}class Ug extends eu{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,r){let o;if(r===Wt.STROKE||r===Wt.FILL){const l=t.current.getClippedPathBoundingBox(r,ut(e))||[0,0,0,0],c=Math.ceil(l[2]-l[0])||1,h=Math.ceil(l[3]-l[1])||1,p=t.cachedCanvases.getCanvas("pattern",c,h),g=p.context;g.clearRect(0,0,g.canvas.width,g.canvas.height),g.beginPath(),g.rect(0,0,g.canvas.width,g.canvas.height),g.translate(-l[0],-l[1]),s=pe.transform(s,[1,0,0,1,l[0],l[1]]),g.transform(...t.baseTransform),this.matrix&&g.transform(...this.matrix),Bc(g,this._bbox),g.fillStyle=this._createGradient(g),g.fill(),o=e.createPattern(p.canvas,"no-repeat");const y=new DOMMatrix(s);o.setTransform(y)}else Bc(e,this._bbox),o=this._createGradient(e);return o}}function Mc(f,e,t,s,r,o,l,c){const h=e.coords,p=e.colors,g=f.data,y=f.width*4;let v;h[t+1]>h[s+1]&&(v=t,t=s,s=v,v=o,o=l,l=v),h[s+1]>h[r+1]&&(v=s,s=r,r=v,v=l,l=c,c=v),h[t+1]>h[s+1]&&(v=t,t=s,s=v,v=o,o=l,l=v);const b=(h[t]+e.offsetX)*e.scaleX,S=(h[t+1]+e.offsetY)*e.scaleY,_=(h[s]+e.offsetX)*e.scaleX,T=(h[s+1]+e.offsetY)*e.scaleY,k=(h[r]+e.offsetX)*e.scaleX,F=(h[r+1]+e.offsetY)*e.scaleY;if(S>=F)return;const z=p[o],H=p[o+1],$=p[o+2],G=p[l],X=p[l+1],ie=p[l+2],de=p[c],K=p[c+1],ke=p[c+2],Re=Math.round(S),Be=Math.round(F);let Ne,Qe,J,ee,U,re,Y,M;for(let B=Re;B<=Be;B++){if(B<T){const ge=B<S?0:(S-B)/(S-T);Ne=b-(b-_)*ge,Qe=z-(z-G)*ge,J=H-(H-X)*ge,ee=$-($-ie)*ge}else{let ge;B>F?ge=1:T===F?ge=0:ge=(T-B)/(T-F),Ne=_-(_-k)*ge,Qe=G-(G-de)*ge,J=X-(X-K)*ge,ee=ie-(ie-ke)*ge}let ae;B<S?ae=0:B>F?ae=1:ae=(S-B)/(S-F),U=b-(b-k)*ae,re=z-(z-de)*ae,Y=H-(H-K)*ae,M=$-($-ke)*ae;const ye=Math.round(Math.min(Ne,U)),ve=Math.round(Math.max(Ne,U));let Ae=y*B+ye*4;for(let ge=ye;ge<=ve;ge++)ae=(Ne-ge)/(Ne-U),ae<0?ae=0:ae>1&&(ae=1),g[Ae++]=Qe-(Qe-re)*ae|0,g[Ae++]=J-(J-Y)*ae|0,g[Ae++]=ee-(ee-M)*ae|0,g[Ae++]=255}}function Vg(f,e,t){const s=e.coords,r=e.colors;let o,l;switch(e.type){case"lattice":const c=e.verticesPerRow,h=Math.floor(s.length/c)-1,p=c-1;for(o=0;o<h;o++){let g=o*c;for(let y=0;y<p;y++,g++)Mc(f,t,s[g],s[g+1],s[g+c],r[g],r[g+1],r[g+c]),Mc(f,t,s[g+c+1],s[g+1],s[g+c],r[g+c+1],r[g+1],r[g+c])}break;case"triangles":for(o=0,l=s.length;o<l;o+=3)Mc(f,t,s[o],s[o+1],s[o+2],r[o],r[o+1],r[o+2]);break;default:throw new Error("illegal figure")}}class Wg extends eu{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){const c=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),p=Math.ceil(this._bounds[2])-c,g=Math.ceil(this._bounds[3])-h,y=Math.min(Math.ceil(Math.abs(p*e[0]*1.1)),3e3),v=Math.min(Math.ceil(Math.abs(g*e[1]*1.1)),3e3),b=p/y,S=g/v,_={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-h,scaleX:1/b,scaleY:1/S},T=y+4,k=v+4,F=s.getCanvas("mesh",T,k),z=F.context,H=z.createImageData(y,v);if(t){const G=H.data;for(let X=0,ie=G.length;X<ie;X+=4)G[X]=t[0],G[X+1]=t[1],G[X+2]=t[2],G[X+3]=255}for(const G of this._figures)Vg(H,G,_);return z.putImageData(H,2,2),{canvas:F.canvas,offsetX:c-2*b,offsetY:h-2*S,scaleX:b,scaleY:S}}getPattern(e,t,s,r){Bc(e,this._bbox);let o;if(r===Wt.SHADING)o=pe.singularValueDecompose2dScale(ut(e));else if(o=pe.singularValueDecompose2dScale(t.baseTransform),this.matrix){const c=pe.singularValueDecompose2dScale(this.matrix);o=[o[0]*c[0],o[1]*c[1]]}const l=this._createMeshCanvas(o,r===Wt.SHADING?null:this._background,t.cachedCanvases);return r!==Wt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(l.offsetX,l.offsetY),e.scale(l.scaleX,l.scaleY),e.createPattern(l.canvas,"no-repeat")}}class Gg extends eu{getPattern(){return"hotpink"}}function Xg(f){switch(f[0]){case"RadialAxial":return new Ug(f);case"Mesh":return new Wg(f);case"Dummy":return new Gg}throw new Error(`Unknown IR type: ${f[0]}`)}const Fd={COLORED:1,UNCOLORED:2};class tu{static MAX_PATTERN_SIZE=3e3;constructor(e,t,s,r,o){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=s,this.canvasGraphicsFactory=r,this.baseTransform=o}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:r,tilingType:o,color:l,canvasGraphicsFactory:c}=this;let{xstep:h,ystep:p}=this;h=Math.abs(h),p=Math.abs(p),Io("TilingType: "+o);const g=t[0],y=t[1],v=t[2],b=t[3],S=v-g,_=b-y,T=pe.singularValueDecompose2dScale(this.matrix),k=pe.singularValueDecompose2dScale(this.baseTransform),F=T[0]*k[0],z=T[1]*k[1];let H=S,$=_,G=!1,X=!1;const ie=Math.ceil(h*F),de=Math.ceil(p*z),K=Math.ceil(S*F),ke=Math.ceil(_*z);ie>=K?H=h:G=!0,de>=ke?$=p:X=!0;const Re=this.getSizeAndScale(H,this.ctx.canvas.width,F),Be=this.getSizeAndScale($,this.ctx.canvas.height,z),Ne=e.cachedCanvases.getCanvas("pattern",Re.size,Be.size),Qe=Ne.context,J=c.createCanvasGraphics(Qe);if(J.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(J,r,l),Qe.translate(-Re.scale*g,-Be.scale*y),J.transform(Re.scale,0,0,Be.scale,0,0),Qe.save(),this.clipBbox(J,g,y,v,b),J.baseTransform=ut(J.ctx),J.executeOperatorList(s),J.endDrawing(),Qe.restore(),G||X){const ee=Ne.canvas;G&&(H=h),X&&($=p);const U=this.getSizeAndScale(H,this.ctx.canvas.width,F),re=this.getSizeAndScale($,this.ctx.canvas.height,z),Y=U.size,M=re.size,B=e.cachedCanvases.getCanvas("pattern-workaround",Y,M),ae=B.context,ye=G?Math.floor(S/h):0,ve=X?Math.floor(_/p):0;for(let Ae=0;Ae<=ye;Ae++)for(let ge=0;ge<=ve;ge++)ae.drawImage(ee,Y*Ae,M*ge,Y,M,0,0,Y,M);return{canvas:B.canvas,scaleX:U.scale,scaleY:re.scale,offsetX:g,offsetY:y}}return{canvas:Ne.canvas,scaleX:Re.scale,scaleY:Be.scale,offsetX:g,offsetY:y}}getSizeAndScale(e,t,s){const r=Math.max(tu.MAX_PATTERN_SIZE,t);let o=Math.ceil(e*s);return o>=r?o=r:s=o/e,{scale:s,size:o}}clipBbox(e,t,s,r,o){const l=r-t,c=o-s;e.ctx.rect(t,s,l,c),e.current.updateRectMinMax(ut(e.ctx),[t,s,r,o]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const r=e.ctx,o=e.current;switch(t){case Fd.COLORED:const l=this.ctx;r.fillStyle=l.fillStyle,r.strokeStyle=l.strokeStyle,o.fillColor=l.fillStyle,o.strokeColor=l.strokeStyle;break;case Fd.UNCOLORED:const c=pe.makeHexColor(s[0],s[1],s[2]);r.fillStyle=c,r.strokeStyle=c,o.fillColor=c,o.strokeColor=c;break;default:throw new wg(`Unsupported paint type: ${t}`)}}getPattern(e,t,s,r){let o=s;r!==Wt.SHADING&&(o=pe.transform(o,t.baseTransform),this.matrix&&(o=pe.transform(o,this.matrix)));const l=this.createPatternCanvas(t);let c=new DOMMatrix(o);c=c.translate(l.offsetX,l.offsetY),c=c.scale(1/l.scaleX,1/l.scaleY);const h=e.createPattern(l.canvas,"repeat");return h.setTransform(c),h}}function qg({src:f,srcPos:e=0,dest:t,width:s,height:r,nonBlackColor:o=4294967295,inverseDecode:l=!1}){const c=en.isLittleEndian?4278190080:255,[h,p]=l?[o,c]:[c,o],g=s>>3,y=s&7,v=f.length;t=new Uint32Array(t.buffer);let b=0;for(let S=0;S<r;S++){for(const T=e+g;e<T;e++){const k=e<v?f[e]:255;t[b++]=k&128?p:h,t[b++]=k&64?p:h,t[b++]=k&32?p:h,t[b++]=k&16?p:h,t[b++]=k&8?p:h,t[b++]=k&4?p:h,t[b++]=k&2?p:h,t[b++]=k&1?p:h}if(y===0)continue;const _=e<v?f[e++]:255;for(let T=0;T<y;T++)t[b++]=_&1<<7-T?p:h}return{srcPos:e,destPos:b}}const Dd=16,Od=100,Yg=15,jd=10,zd=1e3,dn=16;function Kg(f,e){if(f._removeMirroring)throw new Error("Context is already forwarding operations.");f.__originalSave=f.save,f.__originalRestore=f.restore,f.__originalRotate=f.rotate,f.__originalScale=f.scale,f.__originalTranslate=f.translate,f.__originalTransform=f.transform,f.__originalSetTransform=f.setTransform,f.__originalResetTransform=f.resetTransform,f.__originalClip=f.clip,f.__originalMoveTo=f.moveTo,f.__originalLineTo=f.lineTo,f.__originalBezierCurveTo=f.bezierCurveTo,f.__originalRect=f.rect,f.__originalClosePath=f.closePath,f.__originalBeginPath=f.beginPath,f._removeMirroring=()=>{f.save=f.__originalSave,f.restore=f.__originalRestore,f.rotate=f.__originalRotate,f.scale=f.__originalScale,f.translate=f.__originalTranslate,f.transform=f.__originalTransform,f.setTransform=f.__originalSetTransform,f.resetTransform=f.__originalResetTransform,f.clip=f.__originalClip,f.moveTo=f.__originalMoveTo,f.lineTo=f.__originalLineTo,f.bezierCurveTo=f.__originalBezierCurveTo,f.rect=f.__originalRect,f.closePath=f.__originalClosePath,f.beginPath=f.__originalBeginPath,delete f._removeMirroring},f.save=function(){e.save(),this.__originalSave()},f.restore=function(){e.restore(),this.__originalRestore()},f.translate=function(s,r){e.translate(s,r),this.__originalTranslate(s,r)},f.scale=function(s,r){e.scale(s,r),this.__originalScale(s,r)},f.transform=function(s,r,o,l,c,h){e.transform(s,r,o,l,c,h),this.__originalTransform(s,r,o,l,c,h)},f.setTransform=function(s,r,o,l,c,h){e.setTransform(s,r,o,l,c,h),this.__originalSetTransform(s,r,o,l,c,h)},f.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},f.rotate=function(s){e.rotate(s),this.__originalRotate(s)},f.clip=function(s){e.clip(s),this.__originalClip(s)},f.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},f.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},f.bezierCurveTo=function(t,s,r,o,l,c){e.bezierCurveTo(t,s,r,o,l,c),this.__originalBezierCurveTo(t,s,r,o,l,c)},f.rect=function(t,s,r,o){e.rect(t,s,r,o),this.__originalRect(t,s,r,o)},f.closePath=function(){e.closePath(),this.__originalClosePath()},f.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Qg{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,s)):(r=this.canvasFactory.create(t,s),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Ao(f,e,t,s,r,o,l,c,h,p){const[g,y,v,b,S,_]=ut(f);if(y===0&&v===0){const F=l*g+S,z=Math.round(F),H=c*b+_,$=Math.round(H),G=(l+h)*g+S,X=Math.abs(Math.round(G)-z)||1,ie=(c+p)*b+_,de=Math.abs(Math.round(ie)-$)||1;return f.setTransform(Math.sign(g),0,0,Math.sign(b),z,$),f.drawImage(e,t,s,r,o,0,0,X,de),f.setTransform(g,y,v,b,S,_),[X,de]}if(g===0&&b===0){const F=c*v+S,z=Math.round(F),H=l*y+_,$=Math.round(H),G=(c+p)*v+S,X=Math.abs(Math.round(G)-z)||1,ie=(l+h)*y+_,de=Math.abs(Math.round(ie)-$)||1;return f.setTransform(0,Math.sign(y),Math.sign(v),0,z,$),f.drawImage(e,t,s,r,o,0,0,de,X),f.setTransform(g,y,v,b,S,_),[de,X]}f.drawImage(e,t,s,r,o,l,c,h,p);const T=Math.hypot(g,y),k=Math.hypot(v,b);return[T*h,k*p]}function Zg(f){const{width:e,height:t}=f;if(e>zd||t>zd)return null;const s=1e3,r=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=e+1;let l=new Uint8Array(o*(t+1)),c,h,p;const g=e+7&-8;let y=new Uint8Array(g*t),v=0;for(const k of f.data){let F=128;for(;F>0;)y[v++]=k&F?0:255,F>>=1}let b=0;for(v=0,y[v]!==0&&(l[0]=1,++b),h=1;h<e;h++)y[v]!==y[v+1]&&(l[h]=y[v]?2:1,++b),v++;for(y[v]!==0&&(l[h]=2,++b),c=1;c<t;c++){v=c*g,p=c*o,y[v-g]!==y[v]&&(l[p]=y[v]?1:8,++b);let k=(y[v]?4:0)+(y[v-g]?8:0);for(h=1;h<e;h++)k=(k>>2)+(y[v+1]?4:0)+(y[v-g+1]?8:0),r[k]&&(l[p+h]=r[k],++b),v++;if(y[v-g]!==y[v]&&(l[p+h]=y[v]?2:4,++b),b>s)return null}for(v=g*(t-1),p=c*o,y[v]!==0&&(l[p]=8,++b),h=1;h<e;h++)y[v]!==y[v+1]&&(l[p+h]=y[v]?4:8,++b),v++;if(y[v]!==0&&(l[p+h]=4,++b),b>s)return null;const S=new Int32Array([0,o,-1,0,-o,0,0,0,1]),_=new Path2D;for(c=0;b&&c<=t;c++){let k=c*o;const F=k+e;for(;k<F&&!l[k];)k++;if(k===F)continue;_.moveTo(k%o,c);const z=k;let H=l[k];do{const $=S[H];do k+=$;while(!l[k]);const G=l[k];G!==5&&G!==10?(H=G,l[k]=0):(H=G&51*H>>4,l[k]&=H>>2|H<<2),_.lineTo(k%o,k/o|0),l[k]||--b}while(z!==k);--c}return y=null,l=null,function(k){k.save(),k.scale(1/e,-1/t),k.translate(0,-t),k.fill(_),k.beginPath(),k.restore()}}class Hd{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Qd,this.textMatrixScale=1,this.fontMatrix=Oc,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Vt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=pe.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){const s=pe.applyTransform(t,e),r=pe.applyTransform(t.slice(2),e),o=pe.applyTransform([t[0],t[3]],e),l=pe.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],r[0],o[0],l[0]),this.minY=Math.min(this.minY,s[1],r[1],o[1],l[1]),this.maxX=Math.max(this.maxX,s[0],r[0],o[0],l[0]),this.maxY=Math.max(this.maxY,s[1],r[1],o[1],l[1])}updateScalingPathMinMax(e,t){pe.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,r,o,l,c,h,p,g){const y=pe.bezierBoundingBox(t,s,r,o,l,c,h,p,g);g||this.updateRectMinMax(e,y)}getPathBoundingBox(e=Wt.FILL,t=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(e===Wt.STROKE){t||et("Stroke bounding box must include transform.");const r=pe.singularValueDecompose2dScale(t),o=r[0]*this.lineWidth/2,l=r[1]*this.lineWidth/2;s[0]-=o,s[1]-=l,s[2]+=o,s[3]+=l}return s}updateClipFromPath(){const e=pe.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Wt.FILL,t=null){return pe.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Bd(f,e){if(e instanceof ImageData){f.putImageData(e,0,0);return}const t=e.height,s=e.width,r=t%dn,o=(t-r)/dn,l=r===0?o:o+1,c=f.createImageData(s,dn);let h=0,p;const g=e.data,y=c.data;let v,b,S,_;if(e.kind===Co.GRAYSCALE_1BPP){const T=g.byteLength,k=new Uint32Array(y.buffer,0,y.byteLength>>2),F=k.length,z=s+7>>3,H=4294967295,$=en.isLittleEndian?4278190080:255;for(v=0;v<l;v++){for(S=v<o?dn:r,p=0,b=0;b<S;b++){const G=T-h;let X=0;const ie=G>z?s:G*8-7,de=ie&-8;let K=0,ke=0;for(;X<de;X+=8)ke=g[h++],k[p++]=ke&128?H:$,k[p++]=ke&64?H:$,k[p++]=ke&32?H:$,k[p++]=ke&16?H:$,k[p++]=ke&8?H:$,k[p++]=ke&4?H:$,k[p++]=ke&2?H:$,k[p++]=ke&1?H:$;for(;X<ie;X++)K===0&&(ke=g[h++],K=128),k[p++]=ke&K?H:$,K>>=1}for(;p<F;)k[p++]=0;f.putImageData(c,0,v*dn)}}else if(e.kind===Co.RGBA_32BPP){for(b=0,_=s*dn*4,v=0;v<o;v++)y.set(g.subarray(h,h+_)),h+=_,f.putImageData(c,0,b),b+=dn;v<l&&(_=s*r*4,y.set(g.subarray(h,h+_)),f.putImageData(c,0,b))}else if(e.kind===Co.RGB_24BPP)for(S=dn,_=s*S,v=0;v<l;v++){for(v>=o&&(S=r,_=s*S),p=0,b=_;b--;)y[p++]=g[h++],y[p++]=g[h++],y[p++]=g[h++],y[p++]=255;f.putImageData(c,0,v*dn)}else throw new Error(`bad image kind: ${e.kind}`)}function $d(f,e){if(e.bitmap){f.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,r=t%dn,o=(t-r)/dn,l=r===0?o:o+1,c=f.createImageData(s,dn);let h=0;const p=e.data,g=c.data;for(let y=0;y<l;y++){const v=y<o?dn:r;({srcPos:h}=qg({src:p,srcPos:h,dest:g,width:s,height:v,nonBlackColor:0})),f.putImageData(c,0,y*dn)}}function ia(f,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)f[s]!==void 0&&(e[s]=f[s]);f.setLineDash!==void 0&&(e.setLineDash(f.getLineDash()),e.lineDashOffset=f.lineDashOffset)}function So(f){if(f.strokeStyle=f.fillStyle="#000000",f.fillRule="nonzero",f.globalAlpha=1,f.lineWidth=1,f.lineCap="butt",f.lineJoin="miter",f.miterLimit=10,f.globalCompositeOperation="source-over",f.font="10px sans-serif",f.setLineDash!==void 0&&(f.setLineDash([]),f.lineDashOffset=0),!Gt){const{filter:e}=f;e!=="none"&&e!==""&&(f.filter="none")}}function Ud(f,e){if(e)return!0;const t=pe.singularValueDecompose2dScale(f);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*yr.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}const Jg=["butt","round","square"],em=["miter","round","bevel"],tm={},Vd={};class fr{constructor(e,t,s,r,o,{optionalContentConfig:l,markedContentStack:c=null},h,p){this.ctx=e,this.current=new Hd(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=r,this.filterFactory=o,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=l,this.cachedCanvases=new Qg(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=p,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:r=null}){const o=this.ctx.canvas.width,l=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,o,l),this.ctx.fillStyle=c,s){const h=this.cachedCanvases.getCanvas("transparent",o,l);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...ut(this.compositeCtx))}this.ctx.save(),So(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=ut(this.ctx)}executeOperatorList(e,t,s,r){const o=e.argsArray,l=e.fnArray;let c=t||0;const h=o.length;if(h===c)return c;const p=h-c>jd&&typeof s=="function",g=p?Date.now()+Yg:0;let y=0;const v=this.commonObjs,b=this.objs;let S;for(;;){if(r!==void 0&&c===r.nextBreakPoint)return r.breakIt(c,s),c;if(S=l[c],S!==$n.dependency)this[S].apply(this,o[c]);else for(const _ of o[c]){const T=_.startsWith("g_")?v:b;if(!T.has(_))return T.get(_,s),c}if(c++,c===h)return c;if(p&&++y>jd){if(Date.now()>g)return s(),c;y=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const s=e.width??e.displayWidth,r=e.height??e.displayHeight;let o=Math.max(Math.hypot(t[0],t[1]),1),l=Math.max(Math.hypot(t[2],t[3]),1),c=s,h=r,p="prescale1",g,y;for(;o>2&&c>1||l>2&&h>1;){let v=c,b=h;o>2&&c>1&&(v=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),o/=c/v),l>2&&h>1&&(b=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,l/=h/b),g=this.cachedCanvases.getCanvas(p,v,b),y=g.context,y.clearRect(0,0,v,b),y.drawImage(e,0,0,c,h,0,0,v,b),e=g.canvas,c=v,h=b,p=p==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:c,paintHeight:h}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:r}=e,o=this.current.fillColor,l=this.current.patternFill,c=ut(t);let h,p,g,y;if((e.bitmap||e.data)&&e.count>1){const ie=e.bitmap||e.data.buffer;p=JSON.stringify(l?c:[c.slice(0,4),o]),h=this._cachedBitmapsMap.get(ie),h||(h=new Map,this._cachedBitmapsMap.set(ie,h));const de=h.get(p);if(de&&!l){const K=Math.round(Math.min(c[0],c[2])+c[4]),ke=Math.round(Math.min(c[1],c[3])+c[5]);return{canvas:de,offsetX:K,offsetY:ke}}g=de}g||(y=this.cachedCanvases.getCanvas("maskCanvas",s,r),$d(y.context,e));let v=pe.transform(c,[1/s,0,0,-1/r,0,0]);v=pe.transform(v,[1,0,0,1,0,-r]);const[b,S,_,T]=pe.getAxialAlignedBoundingBox([0,0,s,r],v),k=Math.round(_-b)||1,F=Math.round(T-S)||1,z=this.cachedCanvases.getCanvas("fillCanvas",k,F),H=z.context,$=b,G=S;H.translate(-$,-G),H.transform(...v),g||(g=this._scaleImage(y.canvas,ii(H)),g=g.img,h&&l&&h.set(p,g)),H.imageSmoothingEnabled=Ud(ut(H),e.interpolate),Ao(H,g,0,0,g.width,g.height,0,0,s,r),H.globalCompositeOperation="source-in";const X=pe.transform(ii(H),[1,0,0,1,-$,-G]);return H.fillStyle=l?o.getPattern(t,this,X,Wt.FILL):o,H.fillRect(0,0,s,r),h&&!l&&(this.cachedCanvases.delete("fillCanvas"),h.set(p,z.canvas)),{canvas:z.canvas,offsetX:Math.round($),offsetY:Math.round(G)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=Jg[e]}setLineJoin(e){this.ctx.lineJoin=em[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=r.context;const o=this.ctx;o.setTransform(...ut(this.suspendedCtx)),ia(this.suspendedCtx,o),Kg(o,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ia(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,r){const o=r[0],l=r[1],c=r[2]-o,h=r[3]-l;c===0||h===0||(this.genericComposeSMask(t.context,s,c,h,t.subtype,t.backdrop,t.transferMap,o,l,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,r,o,l,c,h,p,g,y){let v=e.canvas,b=h-g,S=p-y;if(l){const T=pe.makeHexColor(...l);if(b<0||S<0||b+s>v.width||S+r>v.height){const k=this.cachedCanvases.getCanvas("maskExtension",s,r),F=k.context;F.drawImage(v,-b,-S),F.globalCompositeOperation="destination-atop",F.fillStyle=T,F.fillRect(0,0,s,r),F.globalCompositeOperation="source-over",v=k.canvas,b=S=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const k=new Path2D;k.rect(b,S,s,r),e.clip(k),e.globalCompositeOperation="destination-atop",e.fillStyle=T,e.fillRect(b,S,s,r),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),o==="Alpha"&&c?t.filter=this.filterFactory.addAlphaFilter(c):o==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(c));const _=new Path2D;_.rect(h,p,s,r),t.clip(_),t.globalCompositeOperation="destination-in",t.drawImage(v,b,S,s,r,h,p,s,r),t.restore()}save(){this.inSMaskMode?(ia(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ia(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,r,o,l){this.ctx.transform(e,t,s,r,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){const r=this.ctx,o=this.current;let l=o.x,c=o.y,h,p;const g=ut(r),y=g[0]===0&&g[3]===0||g[1]===0&&g[2]===0,v=y?s.slice(0):null;for(let b=0,S=0,_=e.length;b<_;b++)switch(e[b]|0){case $n.rectangle:l=t[S++],c=t[S++];const T=t[S++],k=t[S++],F=l+T,z=c+k;r.moveTo(l,c),T===0||k===0?r.lineTo(F,z):(r.lineTo(F,c),r.lineTo(F,z),r.lineTo(l,z)),y||o.updateRectMinMax(g,[l,c,F,z]),r.closePath();break;case $n.moveTo:l=t[S++],c=t[S++],r.moveTo(l,c),y||o.updatePathMinMax(g,l,c);break;case $n.lineTo:l=t[S++],c=t[S++],r.lineTo(l,c),y||o.updatePathMinMax(g,l,c);break;case $n.curveTo:h=l,p=c,l=t[S+4],c=t[S+5],r.bezierCurveTo(t[S],t[S+1],t[S+2],t[S+3],l,c),o.updateCurvePathMinMax(g,h,p,t[S],t[S+1],t[S+2],t[S+3],l,c,v),S+=6;break;case $n.curveTo2:h=l,p=c,r.bezierCurveTo(l,c,t[S],t[S+1],t[S+2],t[S+3]),o.updateCurvePathMinMax(g,h,p,l,c,t[S],t[S+1],t[S+2],t[S+3],v),l=t[S+2],c=t[S+3],S+=4;break;case $n.curveTo3:h=l,p=c,l=t[S+2],c=t[S+3],r.bezierCurveTo(t[S],t[S+1],l,c,l,c),o.updateCurvePathMinMax(g,h,p,t[S],t[S+1],l,c,l,c,v),S+=4;break;case $n.closePath:r.closePath();break}y&&o.updateScalingPathMinMax(g,v),o.setCurrentPoint(l,c)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&s?.getPattern?(t.save(),t.strokeStyle=s.getPattern(t,this,ii(t),Wt.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,s=this.current.fillColor,r=this.current.patternFill;let o=!1;r&&(t.save(),t.fillStyle=s.getPattern(t,this,ii(t),Wt.FILL),o=!0);const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),o&&t.restore(),e&&this.consumePath(l)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=tm}eoClip(){this.pendingClip=Vd}beginText(){this.current.textMatrix=Qd,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const s=new Path2D,r=t.getTransform().invertSelf();for(const{transform:o,x:l,y:c,fontSize:h,path:p}of e)s.addPath(p,new DOMMatrix(o).preMultiplySelf(r).translate(l,c).scale(h,-h));t.clip(s),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const s=this.commonObjs.get(e),r=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=s.fontMatrix||Oc,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&De("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const o=s.loadedName||"sans-serif",l=s.systemFontInfo?.css||`"${o}", ${s.fallbackName}`;let c="normal";s.black?c="900":s.bold&&(c="bold");const h=s.italic?"italic":"normal";let p=t;t<Dd?p=Dd:t>Od&&(p=Od),this.current.fontSizeScale=t/p,this.ctx.font=`${h} ${c} ${p}px ${l}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,r,o,l){this.current.textMatrix=[e,t,s,r,o,l],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#n(e,t,s){const r=new Path2D;return r.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),r}paintChar(e,t,s,r,o){const l=this.ctx,c=this.current,h=c.font,p=c.textRenderingMode,g=c.fontSize/c.fontSizeScale,y=p&Vt.FILL_STROKE_MASK,v=!!(p&Vt.ADD_TO_PATH_FLAG),b=c.patternFill&&!h.missingFile,S=c.patternStroke&&!h.missingFile;let _;if((h.disableFontFace||v||b||S)&&(_=h.getPathGenerator(this.commonObjs,e)),h.disableFontFace||b||S){if(l.save(),l.translate(t,s),l.scale(g,-g),y===Vt.FILL||y===Vt.FILL_STROKE)if(r){const T=l.getTransform();l.setTransform(...r),l.fill(this.#n(_,T,r))}else l.fill(_);if(y===Vt.STROKE||y===Vt.FILL_STROKE)if(o){const T=l.getTransform();l.setTransform(...o),l.stroke(this.#n(_,T,o))}else l.lineWidth/=g,l.stroke(_);l.restore()}else(y===Vt.FILL||y===Vt.FILL_STROKE)&&l.fillText(e,t,s),(y===Vt.STROKE||y===Vt.FILL_STROKE)&&l.strokeText(e,t,s);v&&(this.pendingTextPaths||=[]).push({transform:ut(l),x:t,y:s,fontSize:g,path:_})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){s=!0;break}return He(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const o=this.ctx,l=t.fontSizeScale,c=t.charSpacing,h=t.wordSpacing,p=t.fontDirection,g=t.textHScale*p,y=e.length,v=s.vertical,b=v?1:-1,S=s.defaultVMetrics,_=r*t.fontMatrix[0],T=t.textRenderingMode===Vt.FILL&&!s.disableFontFace&&!t.patternFill;o.save(),o.transform(...t.textMatrix),o.translate(t.x,t.y+t.textRise),p>0?o.scale(g,-1):o.scale(g,1);let k,F;if(t.patternFill){o.save();const X=t.fillColor.getPattern(o,this,ii(o),Wt.FILL);k=ut(o),o.restore(),o.fillStyle=X}if(t.patternStroke){o.save();const X=t.strokeColor.getPattern(o,this,ii(o),Wt.STROKE);F=ut(o),o.restore(),o.strokeStyle=X}let z=t.lineWidth;const H=t.textMatrixScale;if(H===0||z===0){const X=t.textRenderingMode&Vt.FILL_STROKE_MASK;(X===Vt.STROKE||X===Vt.FILL_STROKE)&&(z=this.getSinglePixelWidth())}else z/=H;if(l!==1&&(o.scale(l,l),z/=l),o.lineWidth=z,s.isInvalidPDFjsFont){const X=[];let ie=0;for(const de of e)X.push(de.unicode),ie+=de.width;o.fillText(X.join(""),0,0),t.x+=ie*_*g,o.restore(),this.compose();return}let $=0,G;for(G=0;G<y;++G){const X=e[G];if(typeof X=="number"){$+=b*X*r/1e3;continue}let ie=!1;const de=(X.isSpace?h:0)+c,K=X.fontChar,ke=X.accent;let Re,Be,Ne=X.width;if(v){const J=X.vmetric||S,ee=-(X.vmetric?J[1]:Ne*.5)*_,U=J[2]*_;Ne=J?-J[0]:Ne,Re=ee/l,Be=($+U)/l}else Re=$/l,Be=0;if(s.remeasure&&Ne>0){const J=o.measureText(K).width*1e3/r*l;if(Ne<J&&this.isFontSubpixelAAEnabled){const ee=Ne/J;ie=!0,o.save(),o.scale(ee,1),Re/=ee}else Ne!==J&&(Re+=(Ne-J)/2e3*r/l)}if(this.contentVisible&&(X.isInFont||s.missingFile)){if(T&&!ke)o.fillText(K,Re,Be);else if(this.paintChar(K,Re,Be,k,F),ke){const J=Re+r*ke.offset.x/l,ee=Be-r*ke.offset.y/l;this.paintChar(ke.fontChar,J,ee,k,F)}}const Qe=v?Ne*_-de*p:Ne*_+de*p;$+=Qe,ie&&o.restore()}v?t.y-=$:t.x+=$*g,o.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,r=s.font,o=s.fontSize,l=s.fontDirection,c=r.vertical?1:-1,h=s.charSpacing,p=s.wordSpacing,g=s.textHScale*l,y=s.fontMatrix||Oc,v=e.length,b=s.textRenderingMode===Vt.INVISIBLE;let S,_,T,k;if(!(b||o===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(g,l),S=0;S<v;++S){if(_=e[S],typeof _=="number"){k=c*_*o/1e3,this.ctx.translate(k,0),s.x+=k*g;continue}const F=(_.isSpace?p:0)+h,z=r.charProcOperatorList[_.operatorListId];if(!z){De(`Type3 character "${_.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=_,this.save(),t.scale(o,o),t.transform(...y),this.executeOperatorList(z),this.restore()),T=pe.applyTransform([_.width,0],y)[0]*o+F,t.translate(T,0),s.x+=T*g}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,r,o,l){this.ctx.rect(s,r,o-s,l-r),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=e[1],r=this.baseTransform||ut(this.ctx),o={createCanvasGraphics:l=>new fr(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new tu(e,s,this.ctx,o,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=pe.makeHexColor(e,t,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=pe.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=Xg(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,ii(t),Wt.SHADING);const r=ii(t);if(r){const{width:o,height:l}=t.canvas,[c,h,p,g]=pe.getAxialAlignedBoundingBox([0,0,o,l],r);this.ctx.fillRect(c,h,p-c,g-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){et("Should not call beginInlineImage")}beginImageData(){et("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ut(this.ctx),t)){const s=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],s,r),this.current.updateRectMinMax(ut(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||Io("TODO: Support non-isolated groups."),e.knockout&&De("Knockout groups not supported.");const s=ut(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=pe.getAxialAlignedBoundingBox(e.bbox,ut(t));const o=[0,0,t.canvas.width,t.canvas.height];r=pe.intersect(r,o)||[0,0,0,0];const l=Math.floor(r[0]),c=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-l,1),p=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,h,p]);let g="groupAt"+this.groupLevel;e.smask&&(g+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(g,h,p),v=y.context;v.translate(-l,-c),v.transform(...s),e.smask?this.smaskStack.push({canvas:y.canvas,context:v,offsetX:l,offsetY:c,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(l,c),t.save()),ia(t,v),this.ctx=v,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=ut(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const o=pe.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,s,r,o){if(this.#e(),So(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const l=t[2]-t[0],c=t[3]-t[1];if(o&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=l,t[3]=c;const[h,p]=pe.singularValueDecompose2dScale(ut(this.ctx)),{viewportScale:g}=this,y=Math.ceil(l*this.outputScaleX*g),v=Math.ceil(c*this.outputScaleY*g);this.annotationCanvas=this.canvasFactory.create(y,v);const{canvas:b,context:S}=this.annotationCanvas;this.annotationCanvasMap.set(e,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=S,this.ctx.save(),this.ctx.setTransform(h,0,0,-p,0,c*p),So(this.ctx)}else So(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],l,c),this.ctx.clip(),this.ctx.beginPath()}this.current=new Hd(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,r=this.processingType3;if(r&&(r.compiled===void 0&&(r.compiled=Zg(e)),r.compiled)){r.compiled(s);return}const o=this._createMaskCanvas(e),l=o.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(l,o.offsetX,o.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,r=0,o,l){if(!this.contentVisible)return;e=this.getObject(e.data,e);const c=this.ctx;c.save();const h=ut(c);c.transform(t,s,r,o,0,0);const p=this._createMaskCanvas(e);c.setTransform(1,0,0,1,p.offsetX-h[4],p.offsetY-h[5]);for(let g=0,y=l.length;g<y;g+=2){const v=pe.transform(h,[t,s,r,o,l[g],l[g+1]]),[b,S]=pe.applyTransform([0,0],v);c.drawImage(p.canvas,b,S)}c.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,r=this.current.patternFill;for(const o of e){const{data:l,width:c,height:h,transform:p}=o,g=this.cachedCanvases.getCanvas("maskCanvas",c,h),y=g.context;y.save();const v=this.getObject(l,o);$d(y,v),y.globalCompositeOperation="source-in",y.fillStyle=r?s.getPattern(y,this,ii(t),Wt.FILL):s,y.fillRect(0,0,c,h),y.restore(),t.save(),t.transform(...p),t.scale(1,-1),Ao(t,g.canvas,0,0,c,h,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){De("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,r){if(!this.contentVisible)return;const o=this.getObject(e);if(!o){De("Dependent image isn't ready yet");return}const l=o.width,c=o.height,h=[];for(let p=0,g=r.length;p<g;p+=2)h.push({transform:[t,0,0,s,r[p],r[p+1]],x:0,y:0,w:l,h:c});this.paintInlineImageXObjectGroup(o,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:r}=e,o=this.cachedCanvases.getCanvas("inlineImage",s,r),l=o.context;return l.filter=this.current.transferMaps,l.drawImage(t,0,0),l.filter="none",o.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,r=this.ctx;if(this.save(),!Gt){const{filter:c}=r;c!=="none"&&c!==""&&(r.filter="none")}r.scale(1/t,-1/s);let o;if(e.bitmap)o=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)o=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",t,s).context;Bd(h,e),o=this.applyTransferMapsToCanvas(h)}const l=this._scaleImage(o,ii(r));r.imageSmoothingEnabled=Ud(ut(r),e.interpolate),Ao(r,l.img,0,0,l.paintWidth,l.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const o=e.width,l=e.height,h=this.cachedCanvases.getCanvas("inlineImage",o,l).context;Bd(h,e),r=this.applyTransferMapsToCanvas(h)}for(const o of t)s.save(),s.transform(...o.transform),s.scale(1,-1),Ao(s,r,o.x,o.y,o.w,o.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(t||(this.pendingClip===Vd?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ut(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:r,d:o}=this.ctx.getTransform();let l,c;if(s===0&&r===0){const h=Math.abs(t),p=Math.abs(o);if(h===p)if(e===0)l=c=1/h;else{const g=h*e;l=c=g<1?1/g:1}else if(e===0)l=1/h,c=1/p;else{const g=h*e,y=p*e;l=g<1?1/g:1,c=y<1?1/y:1}}else{const h=Math.abs(t*o-s*r),p=Math.hypot(t,s),g=Math.hypot(r,o);if(e===0)l=g/h,c=p/h;else{const y=e*h;l=g>y?g/y:1,c=p>y?p/y:1}}this._cachedScaleForStroking[0]=l,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:s}=this.current,[r,o]=this.getScaleForStroking();if(t.lineWidth=s||1,r===1&&o===1){t.stroke();return}const l=t.getLineDash();if(e&&t.save(),t.scale(r,o),l.length>0){const c=Math.max(r,o);t.setLineDash(l.map(h=>h/c)),t.lineDashOffset/=c}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const f in $n)fr.prototype[f]!==void 0&&(fr.prototype[$n[f]]=fr.prototype[f]);class ha{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class nm{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}getAll(){return Gc(this.#e)}has(e){return this.#e.has(e)}}const hr=Symbol("INTERNAL");class im{#e=!1;#t=!1;#n=!1;#i=!0;constructor(e,{name:t,intent:s,usage:r,rbGroups:o}){this.#e=!!(e&yn.DISPLAY),this.#t=!!(e&yn.PRINT),this.name=t,this.intent=s,this.usage=r,this.rbGroups=o}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,s=!1){e!==hr&&et("Internal method `_setVisible` called."),this.#n=s,this.#i=t}}class sm{#e=null;#t=new Map;#n=null;#i=null;constructor(e,t=yn.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#i=e.order;for(const s of e.groups)this.#t.set(s.id,new im(t,s));if(e.baseState==="OFF")for(const s of this.#t.values())s._setVisible(hr,!1);for(const s of e.on)this.#t.get(s)._setVisible(hr,!0);for(const s of e.off)this.#t.get(s)._setVisible(hr,!1);this.#n=this.getHash()}}#r(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let r=1;r<t;r++){const o=e[r];let l;if(Array.isArray(o))l=this.#r(o);else if(this.#t.has(o))l=this.#t.get(o).visible;else return De(`Optional content group not found: ${o}`),!0;switch(s){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return s==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return Io("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(De(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return De(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return De(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return De(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return De(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return De(`Unknown optional content policy ${e.policy}.`),!0}return De(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){const r=this.#t.get(e);if(!r){De(`Optional content group not found: ${e}`);return}if(s&&t&&r.rbGroups.length)for(const o of r.rbGroups)for(const l of o)l!==e&&this.#t.get(l)?._setVisible(hr,!1,!0);r._setVisible(hr,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let s;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":s=r;continue}const o=this.#t.get(r);if(o)switch(s){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!o.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#i?this.#i.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?Gc(this.#t):null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new ef;for(const[t,s]of this.#t)e.update(`${t}:${s.visible}`);return this.#e=e.hexdigest()}}class rm{constructor(e,{disableRange:t=!1,disableStream:s=!1}){St(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:o,progressiveDone:l,contentDispositionFilename:c}=e;if(this._queuedChunks=[],this._progressiveDone=l,this._contentDispositionFilename=c,o?.length>0){const h=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((h,p)=>{this._onReceiveData({begin:h,chunk:p})}),e.addProgressListener((h,p)=>{this._onProgress({loaded:h,total:p})}),e.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const r=this._rangeReaders.some(function(o){return o._begin!==e?!1:(o._enqueue(s),!0)});St(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){St(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new am(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new om(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class am{constructor(e,t,s=!1,r=null){this._stream=e,this._done=s||!1,this._filename=Yc(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class om{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function lm(f){let e=!0,t=s("filename\\*","i").exec(f);if(t){t=t[1];let g=c(t);return g=unescape(g),g=h(g),g=p(g),o(g)}if(t=l(f),t){const g=p(t);return o(g)}if(t=s("filename","i").exec(f),t){t=t[1];let g=c(t);return g=p(g),o(g)}function s(g,y){return new RegExp("(?:^|;)\\s*"+g+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function r(g,y){if(g){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const v=new TextDecoder(g,{fatal:!0}),b=Fo(y);y=v.decode(b),e=!1}catch{}}return y}function o(g){return e&&/[\x80-\xff]/.test(g)&&(g=r("utf-8",g),e&&(g=r("iso-8859-1",g))),g}function l(g){const y=[];let v;const b=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(v=b.exec(g))!==null;){let[,_,T,k]=v;if(_=parseInt(_,10),_ in y){if(_===0)break;continue}y[_]=[T,k]}const S=[];for(let _=0;_<y.length&&_ in y;++_){let[T,k]=y[_];k=c(k),T&&(k=unescape(k),_===0&&(k=h(k))),S.push(k)}return S.join("")}function c(g){if(g.startsWith('"')){const y=g.slice(1).split('\\"');for(let v=0;v<y.length;++v){const b=y[v].indexOf('"');b!==-1&&(y[v]=y[v].slice(0,b),y.length=v+1),y[v]=y[v].replaceAll(/\\(.)/g,"$1")}g=y.join('"')}return g}function h(g){const y=g.indexOf("'");if(y===-1)return g;const v=g.slice(0,y),S=g.slice(y+1).replace(/^[^']*'/,"");return r(v,S)}function p(g){return!g.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(g)?g:g.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,v,b,S){if(b==="q"||b==="Q")return S=S.replaceAll("_"," "),S=S.replaceAll(/=([0-9a-fA-F]{2})/g,function(_,T){return String.fromCharCode(parseInt(T,16))}),r(v,S);try{S=atob(S)}catch{}return r(v,S)})}return""}function uf(f,e){const t=new Headers;if(!f||!e||typeof e!="object")return t;for(const s in e){const r=e[s];r!==void 0&&t.append(s,r)}return t}function zo(f){try{return new URL(f).origin}catch{}return null}function hf({responseHeaders:f,isHttp:e,rangeChunkSize:t,disableRange:s}){const r={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(f.get("Content-Length"),10);return!Number.isInteger(o)||(r.suggestedLength=o,o<=2*t)||s||!e||f.get("Accept-Ranges")!=="bytes"||(f.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function df(f){const e=f.get("Content-Disposition");if(e){let t=lm(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Yc(t))return t}return null}function Ho(f,e){return f===404||f===0&&e.startsWith("file:")?new da('Missing PDF "'+e+'".'):new Po(`Unexpected server response (${f}) while retrieving PDF "${e}".`,f)}function ff(f){return f===200||f===206}function pf(f,e,t){return{method:"GET",headers:f,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function gf(f){return f instanceof Uint8Array?f.buffer:f instanceof ArrayBuffer?f:(De(`getArrayBuffer - unexpected data format: ${f}`),new Uint8Array(f).buffer)}class Wd{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=uf(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return St(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new cm(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new um(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class cm{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),r=t.url;fetch(r,pf(s,this._withCredentials,this._abortController)).then(o=>{if(e._responseOrigin=zo(o.url),!ff(o.status))throw Ho(o.status,r);this._reader=o.body.getReader(),this._headersCapability.resolve();const l=o.headers,{allowRangeRequests:c,suggestedLength:h}=hf({responseHeaders:l,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=c,this._contentLength=h||this._contentLength,this._filename=df(l),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:gf(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class um{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const o=new Headers(e.headers);o.append("Range",`bytes=${t}-${s-1}`);const l=r.url;fetch(l,pf(o,this._withCredentials,this._abortController)).then(c=>{const h=zo(c.url);if(h!==e._responseOrigin)throw new Error(`Expected range response-origin "${h}" to match "${e._responseOrigin}".`);if(!ff(c.status))throw Ho(c.status,l);this._readCapability.resolve(),this._reader=c.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:gf(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const Nc=200,Lc=206;function hm(f){const e=f.response;return typeof e!="string"?e:Fo(e).buffer}class dm{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:s}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=uf(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,r=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[o,l]of this.headers)t.setRequestHeader(o,l);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Lc):r.expectedStatus=Nc,t.responseType="arraybuffer",St(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){const s=this.pendingRequests[e];s&&s.onProgress?.(t)}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const r=s.xhr;if(r.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){s.onError(r.status);return}const o=r.status||Nc;if(!(o===Nc&&s.expectedStatus===Lc)&&o!==s.expectedStatus){s.onError(r.status);return}const c=hm(r);if(o===Lc){const h=r.getResponseHeader("Content-Range"),p=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);p?s.onDone({begin:parseInt(p[1],10),chunk:c}):(De('Missing or invalid "Content-Range" header.'),s.onError(0))}else c?s.onDone({begin:0,chunk:c}):s.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class fm{constructor(e){this._source=e,this._manager=new dm(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return St(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new pm(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new gm(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class pm{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=zo(t.responseURL);const s=t.getAllResponseHeaders(),r=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[h,...p]=c.split(": ");return[h,p.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:l}=hf({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=l||this._contentLength,this._filename=df(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Ho(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class gm{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=zo(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=Ho(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const mm=/^[a-z][a-z0-9\-+.]+:/i;function ym(f){if(mm.test(f))return new URL(f);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(f))}class vm{constructor(e){this.source=e,this.url=ym(e.url),St(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return St(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new wm(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new bm(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class wm{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=new da(`Missing PDF "${this._url}".`)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Xi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class bm{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Am=1e5,un=30,Sm=.8;class Jt{#e=Promise.withResolvers();#t=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#r=null;#s=null;#l=0;#o=0;#u=null;#c=null;#d=0;#h=0;#f=Object.create(null);#a=[];#p=null;#m=[];#g=new WeakMap;#y=null;static#b=new Map;static#v=new Map;static#A=new WeakMap;static#_=null;static#E=new Set;constructor({textContentSource:e,container:t,viewport:s}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(h){h.enqueue(e),h.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#c=t,this.#h=s.scale*(globalThis.devicePixelRatio||1),this.#d=s.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:r,pageHeight:o,pageX:l,pageY:c}=s.rawDims;this.#y=[1,0,0,-1,-l,c+o],this.#o=r,this.#l=o,Jt.#M(),Ps(t,s),this.#e.promise.finally(()=>{Jt.#E.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=en.platform;return He(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#u.read().then(({value:t,done:s})=>{if(s){this.#e.resolve();return}this.#r??=t.lang,Object.assign(this.#f,t.styles),this.#k(t.items),e()},this.#e.reject)};return this.#u=this.#p.getReader(),Jt.#E.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const s=e.scale*(globalThis.devicePixelRatio||1),r=e.rotation;if(r!==this.#d&&(t?.(),this.#d=r,Ps(this.#c,{rotation:r})),s!==this.#h){t?.(),this.#h=s;const o={div:null,properties:null,ctx:Jt.#T(this.#r)};for(const l of this.#m)o.properties=this.#g.get(l),o.div=l,this.#S(o)}}cancel(){const e=new Xi("TextLayer task cancelled.");this.#u?.cancel(e).catch(()=>{}),this.#u=null,this.#e.reject(e)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#a}#k(e){if(this.#n)return;this.#s.ctx??=Jt.#T(this.#r);const t=this.#m,s=this.#a;for(const r of e){if(t.length>Am){De("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const o=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),r.id!==null&&this.#t.setAttribute("id",`${r.id}`),o.append(this.#t)}else r.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}s.push(r.str),this.#P(r)}}#P(e){const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#m.push(t);const r=pe.transform(this.#y,e.transform);let o=Math.atan2(r[1],r[0]);const l=this.#f[e.fontName];l.vertical&&(o+=Math.PI/2);let c=this.#i&&l.fontSubstitution||l.fontFamily;c=Jt.fontFamilyMap.get(c)||c;const h=Math.hypot(r[2],r[3]),p=h*Jt.#I(c,this.#r);let g,y;o===0?(g=r[4],y=r[5]-p):(g=r[4]+p*Math.sin(o),y=r[5]-p*Math.cos(o));const v="calc(var(--scale-factor)*",b=t.style;this.#t===this.#c?(b.left=`${(100*g/this.#o).toFixed(2)}%`,b.top=`${(100*y/this.#l).toFixed(2)}%`):(b.left=`${v}${g.toFixed(2)}px)`,b.top=`${v}${y.toFixed(2)}px)`),b.fontSize=`${v}${(Jt.#_*h).toFixed(2)}px)`,b.fontFamily=c,s.fontSize=h,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#i&&(t.dataset.fontName=l.fontSubstitutionLoadedName||e.fontName),o!==0&&(s.angle=o*(180/Math.PI));let S=!1;if(e.str.length>1)S=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const _=Math.abs(e.transform[0]),T=Math.abs(e.transform[3]);_!==T&&Math.max(_,T)/Math.min(_,T)>1.5&&(S=!0)}if(S&&(s.canvasWidth=l.vertical?e.height:e.width),this.#g.set(t,s),this.#s.div=t,this.#s.properties=s,this.#S(this.#s),s.hasText&&this.#t.append(t),s.hasEOL){const _=document.createElement("br");_.setAttribute("role","presentation"),this.#t.append(_)}}#S(e){const{div:t,properties:s,ctx:r}=e,{style:o}=t;let l="";if(Jt.#_>1&&(l=`scale(${1/Jt.#_})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:c}=o,{canvasWidth:h,fontSize:p}=s;Jt.#C(r,p*this.#h,c);const{width:g}=r.measureText(t.textContent);g>0&&(l=`scaleX(${h*this.#h/g}) ${l}`)}s.angle!==0&&(l=`rotate(${s.angle}deg) ${l}`),l.length>0&&(o.transform=l)}static cleanup(){if(!(this.#E.size>0)){this.#b.clear();for(const{canvas:e}of this.#v.values())e.remove();this.#v.clear()}}static#T(e=null){let t=this.#v.get(e||="");if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(e,t),this.#A.set(t,{size:0,family:""})}return t}static#C(e,t,s){const r=this.#A.get(e);t===r.size&&s===r.family||(e.font=`${t}px ${s}`,r.size=t,r.family=s)}static#M(){if(this.#_!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#_=e.getBoundingClientRect().height,e.remove()}static#I(e,t){const s=this.#b.get(e);if(s)return s;const r=this.#T(t);r.canvas.width=r.canvas.height=un,this.#C(r,un,e);const o=r.measureText("");let l=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);if(l){const g=l/(l+c);return this.#b.set(e,g),r.canvas.width=r.canvas.height=0,g}r.strokeStyle="red",r.clearRect(0,0,un,un),r.strokeText("g",0,0);let h=r.getImageData(0,0,un,un).data;c=0;for(let g=h.length-1-3;g>=0;g-=4)if(h[g]>0){c=Math.ceil(g/4/un);break}r.clearRect(0,0,un,un),r.strokeText("A",0,un),h=r.getImageData(0,0,un,un).data,l=0;for(let g=0,y=h.length;g<y;g+=4)if(h[g]>0){l=un-Math.floor(g/4/un);break}r.canvas.width=r.canvas.height=0;const p=l?l/(l+c):Sm;return this.#b.set(e,p),p}}class fa{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function r(o){if(!o)return;let l=null;const c=o.name;if(c==="#text")l=o.value;else if(fa.shouldBuildText(c))o?.attributes?.textContent?l=o.attributes.textContent:o.value&&(l=o.value);else return;if(l!==null&&t.push({str:l}),!!o.children)for(const h of o.children)r(h)}return r(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const _m=65536,xm=100,Em=5e3,Cm=Gt?Hg:Og,km=Gt?Bg:rf,Tm=Gt?zg:jg,Pm=Gt?$g:lf;function Rm(f={}){typeof f=="string"||f instanceof URL?f={url:f}:(f instanceof ArrayBuffer||ArrayBuffer.isView(f))&&(f={data:f});const e=new nu,{docId:t}=e,s=f.url?Mm(f.url):null,r=f.data?Nm(f.data):null,o=f.httpHeaders||null,l=f.withCredentials===!0,c=f.password??null,h=f.range instanceof mf?f.range:null,p=Number.isInteger(f.rangeChunkSize)&&f.rangeChunkSize>0?f.rangeChunkSize:_m;let g=f.worker instanceof pr?f.worker:null;const y=f.verbosity,v=typeof f.docBaseUrl=="string"&&!Oo(f.docBaseUrl)?f.docBaseUrl:null,b=typeof f.cMapUrl=="string"?f.cMapUrl:null,S=f.cMapPacked!==!1,_=f.CMapReaderFactory||km,T=typeof f.standardFontDataUrl=="string"?f.standardFontDataUrl:null,k=f.StandardFontDataFactory||Pm,F=f.stopAtErrors!==!0,z=Number.isInteger(f.maxImageSize)&&f.maxImageSize>-1?f.maxImageSize:-1,H=f.isEvalSupported!==!1,$=typeof f.isOffscreenCanvasSupported=="boolean"?f.isOffscreenCanvasSupported:!Gt,G=typeof f.isImageDecoderSupported=="boolean"?f.isImageDecoderSupported:!Gt&&(en.platform.isFirefox||!globalThis.chrome),X=Number.isInteger(f.canvasMaxAreaInBytes)?f.canvasMaxAreaInBytes:-1,ie=typeof f.disableFontFace=="boolean"?f.disableFontFace:Gt,de=f.fontExtraProperties===!0,K=f.enableXfa===!0,ke=f.ownerDocument||globalThis.document,Re=f.disableRange===!0,Be=f.disableStream===!0,Ne=f.disableAutoFetch===!0,Qe=f.pdfBug===!0,J=f.CanvasFactory||Cm,ee=f.FilterFactory||Tm,U=f.enableHWA===!0,re=h?h.length:f.length??NaN,Y=typeof f.useSystemFonts=="boolean"?f.useSystemFonts:!Gt&&!ie,M=typeof f.useWorkerFetch=="boolean"?f.useWorkerFetch:_===rf&&k===lf&&b&&T&&oa(b,document.baseURI)&&oa(T,document.baseURI),B=null;gg(y);const ae={canvasFactory:new J({ownerDocument:ke,enableHWA:U}),filterFactory:new ee({docId:t,ownerDocument:ke}),cMapReaderFactory:M?null:new _({baseUrl:b,isCompressed:S}),standardFontDataFactory:M?null:new k({baseUrl:T})};if(!g){const Ae={verbosity:y,port:ha.workerPort};g=Ae.port?pr.fromPort(Ae):new pr(Ae),e._worker=g}const ye={docId:t,apiVersion:"4.10.38",data:r,password:c,disableAutoFetch:Ne,rangeChunkSize:p,length:re,docBaseUrl:v,enableXfa:K,evaluatorOptions:{maxImageSize:z,disableFontFace:ie,ignoreErrors:F,isEvalSupported:H,isOffscreenCanvasSupported:$,isImageDecoderSupported:G,canvasMaxAreaInBytes:X,fontExtraProperties:de,useSystemFonts:Y,cMapUrl:M?b:null,standardFontDataUrl:M?T:null}},ve={disableFontFace:ie,fontExtraProperties:de,ownerDocument:ke,pdfBug:Qe,styleElement:B,loadingParams:{disableAutoFetch:Ne,enableXfa:K}};return g.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const Ae=g.messageHandler.sendWithPromise("GetDocRequest",ye,r?[r.buffer]:null);let ge;if(h)ge=new rm(h,{disableRange:Re,disableStream:Be});else if(!r){if(!s)throw new Error("getDocument - no `url` parameter provided.");let me;if(Gt)if(oa(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");me=Wd}else me=vm;else me=oa(s)?Wd:fm;ge=new me({url:s,length:re,httpHeaders:o,withCredentials:l,rangeChunkSize:p,disableRange:Re,disableStream:Be})}return Ae.then(me=>{if(e.destroyed)throw new Error("Loading aborted");if(g.destroyed)throw new Error("Worker was destroyed");const We=new la(t,me,g.port),ht=new Dm(We,e,ge,ve,ae);e._transport=ht,We.send("Ready",null)})}).catch(e._capability.reject),e}function Mm(f){if(f instanceof URL)return f.href;try{return new URL(f,window.location).href}catch{if(Gt&&typeof f=="string")return f}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Nm(f){if(Gt&&typeof Buffer<"u"&&f instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(f instanceof Uint8Array&&f.byteLength===f.buffer.byteLength)return f;if(typeof f=="string")return Fo(f);if(f instanceof ArrayBuffer||ArrayBuffer.isView(f)||typeof f=="object"&&!isNaN(f?.length))return new Uint8Array(f);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Gd(f){return typeof f=="object"&&Number.isInteger(f?.num)&&f.num>=0&&Number.isInteger(f?.gen)&&f.gen>=0}class nu{static#e=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${nu.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}}class mf{constructor(e,t,s=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){et("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Lm{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return He(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Im{#e=null;#t=!1;constructor(e,t,s,r=!1){this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=r?new Nd:null,this._pdfBug=r,this.commonObjs=s.commonObjs,this.objs=new yf,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:r=0,dontFlip:o=!1}={}){return new pa({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:r,dontFlip:o})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return He(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:r=Wi.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:h=null,pageColors:p=null,printAnnotationStorage:g=null,isEditing:y=!1}){this._stats?.time("Overall");const v=this._transport.getRenderingIntent(s,r,g,y),{renderingIntent:b,cacheKey:S}=v;this.#t=!1,this.#i(),c||=this._transport.getOptionalContentConfig(b);let _=this._intentStates.get(S);_||(_=Object.create(null),this._intentStates.set(S,_)),_.streamReaderCancelTimeout&&(clearTimeout(_.streamReaderCancelTimeout),_.streamReaderCancelTimeout=null);const T=!!(b&yn.PRINT);_.displayReadyCapability||(_.displayReadyCapability=Promise.withResolvers(),_.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(v));const k=H=>{_.renderTasks.delete(F),(this._maybeCleanupAfterRender||T)&&(this.#t=!0),this.#n(!T),H?(F.capability.reject(H),this._abortOperatorList({intentState:_,reason:H instanceof Error?H:new Error(H)})):F.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},F=new dr({callback:k,params:{canvasContext:e,viewport:t,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:_.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:p});(_.renderTasks||=new Set).add(F);const z=F.task;return Promise.all([_.displayReadyCapability.promise,c]).then(([H,$])=>{if(this.destroyed){k();return}if(this._stats?.time("Rendering"),!($.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");F.initializeGraphics({transparency:H,optionalContentConfig:$}),F.operatorListChanged()}).catch(k),z}getOperatorList({intent:e="display",annotationMode:t=Wi.ENABLE,printAnnotationStorage:s=null,isEditing:r=!1}={}){function o(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(h))}const l=this._transport.getRenderingIntent(e,t,s,r,!0);let c=this._intentStates.get(l.cacheKey);c||(c=Object.create(null),this._intentStates.set(l.cacheKey,c));let h;return c.opListReadCapability||(h=Object.create(null),h.operatorListChanged=o,c.opListReadCapability=Promise.withResolvers(),(c.renderTasks||=new Set).add(h),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(l)),c.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>fa.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,r){function o(){l.read().then(function({value:h,done:p}){if(p){s(c);return}c.lang??=h.lang,Object.assign(c.styles,h.styles),c.items.push(...h.items),o()},r)}const l=t.getReader(),c={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,this.#i(),Promise.all(e)}cleanup(e=!1){this.#t=!0;const t=this.#n(!1);return e&&t&&(this._stats&&=new Nd),t}#n(e=!1){if(this.#i(),!this.#t||this.destroyed)return!1;if(e)return this.#e=setTimeout(()=>{this.#e=null,this.#n(!1)},Em),!1;for(const{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}#i(){this.#e&&(clearTimeout(this.#e),this.#e=null)}_startRenderPage(e,t){const s=this._intentStates.get(t);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let s=0,r=e.length;s<r;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&this.#n(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:r}){const{map:o,transfer:l}=s,h=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:o,modifiedIds:r},l).getReader(),p=this._intentStates.get(t);p.streamReader=h;const g=()=>{h.read().then(({value:y,done:v})=>{if(v){p.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(y,p),g())},y=>{if(p.streamReader=null,!this._transport.destroyed){if(p.operatorList){p.operatorList.lastChunk=!0;for(const v of p.renderTasks)v.operatorListChanged();this.#n(!0)}if(p.displayReadyCapability)p.displayReadyCapability.reject(y);else if(p.opListReadCapability)p.opListReadCapability.reject(y);else throw y}})};g()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof qc){let r=xm;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Xi(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,o]of this._intentStates)if(o===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}class Fm{#e=new Map;#t=Promise.resolve();postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[r]of this.#e)r.call(this,s)})}addEventListener(e,t,s=null){let r=null;if(s?.signal instanceof AbortSignal){const{signal:o}=s;if(o.aborted){De("LoopbackPort - cannot use an `aborted` signal.");return}const l=()=>this.removeEventListener(e,t);r=()=>o.removeEventListener("abort",l),o.addEventListener("abort",l)}this.#e.set(t,r)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}var Mo,ks,Ts,gr,ko,mr,To;const ct=class ct{constructor({name:e=null,port:t=null,verbosity:s=mg()}={}){cr(this,gr);if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(Bn(ct,Ts)?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(Bn(ct,Ts)||ea(ct,Ts,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new la("main","worker",e),this._messageHandler.on("ready",function(){}),vo(this,gr,ko).call(this)}_initialize(){if(Bn(ct,ks)||Bn(ct,mr,To)){this._setupFakeWorker();return}let{workerSrc:e}=ct;try{ct._isSameOrigin(window.location.href,e)||(e=ct._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new la("main","worker",t),r=()=>{o.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},o=new AbortController;t.addEventListener("error",()=>{this._webWorker||r()},{signal:o.signal}),s.on("test",c=>{if(o.abort(),this.destroyed||!c){r();return}this._messageHandler=s,this._port=t,this._webWorker=t,vo(this,gr,ko).call(this)}),s.on("ready",c=>{if(o.abort(),this.destroyed){r();return}try{l()}catch{this._setupFakeWorker()}});const l=()=>{const c=new Uint8Array;s.send("test",c,[c.buffer])};l();return}catch{Io("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){Bn(ct,ks)||(De("Setting up fake worker."),ea(ct,ks,!0)),ct._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new Fm;this._port=t;const s=`fake${bd(ct,Mo)._++}`,r=new la(s+"_worker",s,t);e.setup(r,t),this._messageHandler=new la(s,s+"_worker",t),vo(this,gr,ko).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,Bn(ct,Ts)?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const t=Bn(this,Ts)?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ct(e)}static get workerSrc(){if(ha.workerSrc)return ha.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return He(this,"_setupFakeWorkerGlobal",(async()=>Bn(this,mr,To)?Bn(this,mr,To):(await import(this.workerSrc)).WorkerMessageHandler)())}};Mo=new WeakMap,ks=new WeakMap,Ts=new WeakMap,gr=new WeakSet,ko=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},mr=new WeakSet,To=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},cr(ct,mr),cr(ct,Mo,0),cr(ct,ks,!1),cr(ct,Ts),Gt&&(ea(ct,ks,!0),ha.workerSrc||="./pdf.worker.mjs"),ct._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const r=new URL(t,s);return s.origin===r.origin},ct._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let pr=ct;class Dm{#e=new Map;#t=new Map;#n=new Map;#i=new Map;#r=null;constructor(e,t,s,r,o){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new yf,this.fontLoader=new Fg({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#s(e,t=null){const s=this.#e.get(e);if(s)return s;const r=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,r),r}get annotationStorage(){return He(this,"annotationStorage",new Jc)}getRenderingIntent(e,t=Wi.ENABLE,s=null,r=!1,o=!1){let l=yn.DISPLAY,c=Hc;switch(e){case"any":l=yn.ANY;break;case"display":break;case"print":l=yn.PRINT;break;default:De(`getRenderingIntent - invalid intent: ${e}`)}const h=l&yn.PRINT&&s instanceof tf?s:this.annotationStorage;switch(t){case Wi.DISABLE:l+=yn.ANNOTATIONS_DISABLE;break;case Wi.ENABLE:break;case Wi.ENABLE_FORMS:l+=yn.ANNOTATIONS_FORMS;break;case Wi.ENABLE_STORAGE:l+=yn.ANNOTATIONS_STORAGE,c=h.serializable;break;default:De(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(l+=yn.IS_EDITING),o&&(l+=yn.OPLIST);const{ids:p,hash:g}=h.modifiedIds,y=[l,c.hash,g];return{renderingIntent:l,cacheKey:y.join("_"),annotationStorageSerializable:c,modifiedIds:p}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const s of this.#t.values())e.push(s._destroy());this.#t.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),Jt.cleanup(),this._networkStream?.cancelAllRequests(new Xi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,r)=>{St(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},r.onPull=()=>{this._fullReader.read().then(function({value:o,done:l}){if(l){r.close();return}St(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{this._fullReader.cancel(o),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:o,contentLength:l}=this._fullReader;return(!r||!o)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=c=>{t.onProgress?.({loaded:c.loaded,total:c.total})}),{isStreamingSupported:r,isRangeSupported:o,contentLength:l}}),e.on("GetRangeReader",(s,r)=>{St(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(s.begin,s.end);if(!o){r.close();return}r.onPull=()=>{o.read().then(function({value:l,done:c}){if(c){r.close();return}St(l instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{r.error(l)})},r.onCancel=l=>{o.cancel(l),r.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new Lm(s,this))}),e.on("DocException",s=>{t._capability.reject(hn(s))}),e.on("PasswordRequest",s=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw hn(s);const r=o=>{o instanceof Error?this.#r.reject(o):this.#r.resolve({password:o})};t.onPassword(r,s.code)}catch(r){this.#r.reject(r)}return this.#r.promise}),e.on("DataLoaded",s=>{t.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;this.#t.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,r,o])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(r){case"Font":const{disableFontFace:l,fontExtraProperties:c,pdfBug:h}=this._params;if("error"in o){const v=o.error;De(`Error during font loading: ${v}`),this.commonObjs.resolve(s,v);break}const p=h&&globalThis.FontInspector?.enabled?(v,b)=>globalThis.FontInspector.fontAdded(v,b):null,g=new Dg(o,{disableFontFace:l,fontExtraProperties:c,inspectFont:p});this.fontLoader.bind(g).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c&&g.data&&(g.data=null),this.commonObjs.resolve(s,g)});break;case"CopyLocalImage":const{imageRef:y}=o;St(y,"The imageRef must be defined.");for(const v of this.#t.values())for(const[,b]of v.objs)if(b?.ref===y)return b.dataLen?(this.commonObjs.resolve(s,structuredClone(b)),b.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,o);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([s,r,o,l])=>{if(this.destroyed)return;const c=this.#t.get(r);if(!c.objs.has(s)){if(c._intentStates.size===0){l?.bitmap?.close();return}switch(o){case"Image":c.objs.resolve(s,l),l?.dataLen>hg&&(c._maybeCleanupAfterRender=!0);break;case"Pattern":c.objs.resolve(s,l);break;default:throw new Error(`Got unknown object type ${o}`)}}}),e.on("DocProgress",s=>{this.destroyed||t.onProgress?.({loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),e.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&De("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=this.#n.get(t);if(s)return s;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#i.set(o.refStr,e);const l=new Im(t,o,this,this._params.pdfBug);return this.#t.set(t,l),l});return this.#n.set(t,r),r}getPageIndex(e){return Gd(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#s("GetOptionalContentConfig").then(t=>new sm(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(r=>({info:r[0],metadata:r[1]?new nm(r[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),Jt.cleanup()}}cachedPageNumber(e){if(!Gd(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#i.get(t)??null}}const sa=Symbol("INITIAL_DATA");class yf{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:sa}}get(e,t=null){if(t){const r=this.#t(e);return r.promise.then(()=>t(r.data)),null}const s=this.#e[e];if(!s||s.data===sa)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=this.#e[e];return!!t&&t.data!==sa}delete(e){const t=this.#e[e];return!t||t.data===sa?!1:(delete this.#e[e],!0)}resolve(e,t=null){const s=this.#t(e);s.data=t,s.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==sa&&(yield[e,t])}}}class Om{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class dr{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:s,commonObjs:r,annotationCanvasMap:o,operatorList:l,pageIndex:c,canvasFactory:h,filterFactory:p,useRequestAnimationFrame:g=!1,pdfBug:y=!1,pageColors:v=null}){this.callback=e,this.params=t,this.objs=s,this.commonObjs=r,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=l,this._pageIndex=c,this.canvasFactory=h,this.filterFactory=p,this._pdfBug=y,this.pageColors=v,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=g===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Om(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(dr.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");dr.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:r,transform:o,background:l}=this.params;this.gfx=new fr(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:r,transparency:e,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),dr.#t.delete(this._canvas),this.callback(e||new qc(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),dr.#t.delete(this._canvas),this.callback())))}}const jm="4.10.38",zm="f9bea397f";function Xd(f){return Math.floor(Math.max(0,Math.min(1,f))*255).toString(16).padStart(2,"0")}function ra(f){return Math.max(0,Math.min(255,255*f))}class qd{static CMYK_G([e,t,s,r]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ra(e),[e,e,e]}static G_HTML([e]){const t=Xd(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(ra)}static RGB_HTML(e){return`#${e.map(Xd).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,s+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,s,r]){return[ra(1-Math.min(1,e+r)),ra(1-Math.min(1,s+r)),ra(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const r=1-e,o=1-t,l=1-s,c=Math.min(r,o,l);return["CMYK",r,o,l,c]}}class Hm{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),s||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){et("Abstract method `_createSVG` called.")}}class iu extends Hm{_createSVG(e){return document.createElementNS(Ai,e)}}class vf{static setupStorage(e,t,s,r,o){const l=r.getValue(t,{value:null});switch(s.name){case"textarea":if(l.value!==null&&(e.textContent=l.value),o==="print")break;e.addEventListener("input",c=>{r.setValue(t,{value:c.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(l.value===s.attributes.xfaOn?e.setAttribute("checked",!0):l.value===s.attributes.xfaOff&&e.removeAttribute("checked"),o==="print")break;e.addEventListener("change",c=>{r.setValue(t,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(l.value!==null&&e.setAttribute("value",l.value),o==="print")break;e.addEventListener("input",c=>{r.setValue(t,{value:c.target.value})})}break;case"select":if(l.value!==null){e.setAttribute("value",l.value);for(const c of s.children)c.attributes.value===l.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}e.addEventListener("input",c=>{const h=c.target.options,p=h.selectedIndex===-1?"":h[h.selectedIndex].value;r.setValue(t,{value:p})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:r,linkService:o}){const{attributes:l}=t,c=e instanceof HTMLAnchorElement;l.type==="radio"&&(l.name=`${l.name}-${r}`);for(const[h,p]of Object.entries(l))if(p!=null)switch(h){case"class":p.length&&e.setAttribute(h,p.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",p);break;case"style":Object.assign(e.style,p);break;case"textContent":e.textContent=p;break;default:(!c||h!=="href"&&h!=="newWindow")&&e.setAttribute(h,p)}c&&o.addLinkAttributes(e,l.href,l.newWindow),s&&l.dataId&&this.setupStorage(e,l.dataId,t,s)}static render(e){const t=e.annotationStorage,s=e.linkService,r=e.xfaHtml,o=e.intent||"display",l=document.createElement(r.name);r.attributes&&this.setAttributes({html:l,element:r,intent:o,linkService:s});const c=o!=="richText",h=e.div;if(h.append(l),e.viewport){const y=`matrix(${e.viewport.transform.join(",")})`;h.style.transform=y}c&&h.setAttribute("class","xfaLayer xfaFont");const p=[];if(r.children.length===0){if(r.value){const y=document.createTextNode(r.value);l.append(y),c&&fa.shouldBuildText(r.name)&&p.push(y)}return{textDivs:p}}const g=[[r,-1,l]];for(;g.length>0;){const[y,v,b]=g.at(-1);if(v+1===y.children.length){g.pop();continue}const S=y.children[++g.at(-1)[1]];if(S===null)continue;const{name:_}=S;if(_==="#text"){const k=document.createTextNode(S.value);p.push(k),b.append(k);continue}const T=S?.attributes?.xmlns?document.createElementNS(S.attributes.xmlns,_):document.createElement(_);if(b.append(T),S.attributes&&this.setAttributes({html:T,element:S,storage:t,intent:o,linkService:s}),S.children?.length>0)g.push([S,-1,T]);else if(S.value){const k=document.createTextNode(S.value);c&&fa.shouldBuildText(_)&&p.push(k),T.append(k)}}for(const y of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:p}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const ma=1e3,Bm=9,Rs=new WeakSet;function Gi(f){return{width:f[2]-f[0],height:f[3]-f[1]}}class $m{static create(e){switch(e.data.annotationType){case Ct.LINK:return new wf(e);case Ct.TEXT:return new Um(e);case Ct.WIDGET:switch(e.data.fieldType){case"Tx":return new Vm(e);case"Btn":return e.data.radioButton?new bf(e):e.data.checkBox?new Gm(e):new Xm(e);case"Ch":return new qm(e);case"Sig":return new Wm(e)}return new Ms(e);case Ct.POPUP:return new $c(e);case Ct.FREETEXT:return new Af(e);case Ct.LINE:return new Km(e);case Ct.SQUARE:return new Qm(e);case Ct.CIRCLE:return new Zm(e);case Ct.POLYLINE:return new Sf(e);case Ct.CARET:return new ey(e);case Ct.INK:return new su(e);case Ct.POLYGON:return new Jm(e);case Ct.HIGHLIGHT:return new _f(e);case Ct.UNDERLINE:return new ty(e);case Ct.SQUIGGLY:return new ny(e);case Ct.STRIKEOUT:return new iy(e);case Ct.STAMP:return new xf(e);case Ct.FILEATTACHMENT:return new sy(e);default:return new vt(e)}}}class vt{#e=null;#t=!1;#n=null;constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e?.str||t?.str||s?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return vt._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#e||={rect:this.data.rect.slice(0)};const{rect:t}=e;t&&this.#i(t),this.#n?.popup.updateEdited(e)}resetEdited(){this.#e&&(this.#i(this.#e.rect),this.#n?.popup.resetEdited(),this.#e=null)}#i(e){const{container:{style:t},data:{rect:s,rotation:r},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:l,pageX:c,pageY:h}}}}=this;s?.splice(0,4,...e);const{width:p,height:g}=Gi(e);t.left=`${100*(e[0]-c)/o}%`,t.top=`${100*(l-e[3]+h)/l}%`,r===0?(t.width=`${100*p/o}%`,t.height=`${100*g/l}%`):this.setRotation(r)}_createContainer(e){const{data:t,parent:{page:s,viewport:r}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",t.id),this instanceof Ms||(o.tabIndex=ma);const{style:l}=o;if(l.zIndex=this.parent.zIndex++,t.alternativeText&&(o.title=t.alternativeText),t.noRotate&&o.classList.add("norotate"),!t.rect||this instanceof $c){const{rotation:_}=t;return!t.hasOwnCanvas&&_!==0&&this.setRotation(_,o),o}const{width:c,height:h}=Gi(t.rect);if(!e&&t.borderStyle.width>0){l.borderWidth=`${t.borderStyle.width}px`;const _=t.borderStyle.horizontalCornerRadius,T=t.borderStyle.verticalCornerRadius;if(_>0||T>0){const F=`calc(${_}px * var(--scale-factor)) / calc(${T}px * var(--scale-factor))`;l.borderRadius=F}else if(this instanceof bf){const F=`calc(${c}px * var(--scale-factor)) / calc(${h}px * var(--scale-factor))`;l.borderRadius=F}switch(t.borderStyle.style){case na.SOLID:l.borderStyle="solid";break;case na.DASHED:l.borderStyle="dashed";break;case na.BEVELED:De("Unimplemented border style: beveled");break;case na.INSET:De("Unimplemented border style: inset");break;case na.UNDERLINE:l.borderBottomStyle="solid";break}const k=t.borderColor||null;k?(this.#t=!0,l.borderColor=pe.makeHexColor(k[0]|0,k[1]|0,k[2]|0)):l.borderWidth=0}const p=pe.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:g,pageHeight:y,pageX:v,pageY:b}=r.rawDims;l.left=`${100*(p[0]-v)/g}%`,l.top=`${100*(p[1]-b)/y}%`;const{rotation:S}=t;return t.hasOwnCanvas||S===0?(l.width=`${100*c/g}%`,l.height=`${100*h/y}%`):this.setRotation(S,o),o}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:r}=this.parent.viewport.rawDims,{width:o,height:l}=Gi(this.data.rect);let c,h;e%180===0?(c=100*o/s,h=100*l/r):(c=100*l/s,h=100*o/r),t.style.width=`${c}%`,t.style.height=`${h}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,r)=>{const o=r.detail[t],l=o[0],c=o.slice(1);r.target.style[s]=qd[`${l}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[s]:qd[`${l}_rgb`](c)})};return He(this,"_commonActions",{display:t=>{const{display:s}=t.detail,r=s%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const r of Object.keys(t.detail))(e[r]||s[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[r,o]of Object.entries(t)){const l=s[r];if(l){const c={detail:{[r]:o},target:e};l(c),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,r,o]=this.data.rect.map(_=>Math.fround(_));if(e.length===8){const[_,T,k,F]=e.subarray(2,6);if(r===_&&o===T&&t===k&&s===F)return}const{style:l}=this.container;let c;if(this.#t){const{borderColor:_,borderWidth:T}=l;l.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${_}" stroke-width="${T}">`],this.container.classList.add("hasBorder")}const h=r-t,p=o-s,{svgFactory:g}=this,y=g.createElement("svg");y.classList.add("quadrilateralsContainer"),y.setAttribute("width",0),y.setAttribute("height",0);const v=g.createElement("defs");y.append(v);const b=g.createElement("clipPath"),S=`clippath_${this.data.id}`;b.setAttribute("id",S),b.setAttribute("clipPathUnits","objectBoundingBox"),v.append(b);for(let _=2,T=e.length;_<T;_+=8){const k=e[_],F=e[_+1],z=e[_+2],H=e[_+3],$=g.createElement("rect"),G=(z-t)/h,X=(o-F)/p,ie=(k-z)/h,de=(F-H)/p;$.setAttribute("x",G),$.setAttribute("y",X),$.setAttribute("width",ie),$.setAttribute("height",de),b.append($),c?.push(`<rect vector-effect="non-scaling-stroke" x="${G}" y="${X}" width="${ie}" height="${de}"/>`)}this.#t&&(c.push("</g></svg>')"),l.backgroundImage=c.join("")),this.container.append(y),this.container.style.clipPath=`url(#${S})`}_createPopup(){const{data:e}=this,t=this.#n=new $c({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){et("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:o,id:l,exportValues:c}of r){if(o===-1||l===t)continue;const h=typeof c=="string"?c:null,p=document.querySelector(`[data-element-id="${l}"]`);if(p&&!Rs.has(p)){De(`_getElementsByName - element not allowed: ${l}`);continue}s.push({id:l,exportValue:h,domElement:p})}return s}for(const r of document.getElementsByName(e)){const{exportValue:o}=r,l=r.getAttribute("data-element-id");l!==t&&Rs.has(r)&&s.push({id:l,exportValue:o,domElement:r})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}}class wf extends vt{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let r=!1;return e.url?(t.addLinkAttributes(s,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(s,e.action),r=!0):e.attachment?(this.#t(s,e.attachment,e.attachmentDest),r=!0):e.setOCGState?(this.#n(s,e.setOCGState),r=!0):e.dest?(this._bindLink(s,e.dest),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),r=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(s),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#e()}#t(e,t,s=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,s),!1),this.#e()}#n(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const o=s.get(r);o&&(e[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1))}e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){De('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{s?.();const{fields:r,refs:o,include:l}=t,c=[];if(r.length!==0||o.length!==0){const g=new Set(o);for(const y of r){const v=this._fieldObjects[y]||[];for(const{id:b}of v)g.add(b)}for(const y of Object.values(this._fieldObjects))for(const v of y)g.has(v.id)===l&&c.push(v)}else for(const g of Object.values(this._fieldObjects))c.push(...g);const h=this.annotationStorage,p=[];for(const g of c){const{id:y}=g;switch(p.push(y),g.type){case"text":{const b=g.defaultValue||"";h.setValue(y,{value:b});break}case"checkbox":case"radiobutton":{const b=g.defaultValue===g.exportValues;h.setValue(y,{value:b});break}case"combobox":case"listbox":{const b=g.defaultValue||"";h.setValue(y,{value:b});break}default:continue}const v=document.querySelector(`[data-element-id="${y}"]`);if(v){if(!Rs.has(v)){De(`_bindResetFormAction - element not allowed: ${y}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:p,name:"ResetForm"}}),!1}}}class Um extends vt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Ms extends vt{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return en.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,r,o){s.includes("mouse")?e.addEventListener(s,l=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:o(l),shift:l.shiftKey,modifier:this._getKeyModifier(l)}})}):e.addEventListener(s,l=>{if(s==="blur"){if(!t.focused||!l.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:o(l)}})})}_setEventListeners(e,t,s,r){for(const[o,l]of s)(l==="Action"||this.data.actions?.[l])&&((l==="Focus"||l==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,o,l,r),l==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):l==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":pe.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||Bm,o=e.style;let l;const c=2,h=p=>Math.round(10*p)/10;if(this.data.multiLine){const p=Math.abs(this.data.rect[3]-this.data.rect[1]-c),g=Math.round(p/(kc*r))||1,y=p/g;l=Math.min(r,h(y/kc))}else{const p=Math.abs(this.data.rect[3]-this.data.rect[1]-c);l=Math.min(r,h(p/kc))}o.fontSize=`calc(${l}px * var(--scale-factor))`,o.color=pe.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(o.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Vm extends Ms{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,r){const o=this.annotationStorage;for(const l of this._getElementsByName(e.name,e.id))l.domElement&&(l.domElement[t]=s),o.setValue(l.id,{[r]:s})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let o=r.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let c=r.formattedValue||this.data.textContent?.join(`
`)||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=c??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",c??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Rs.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=ma,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",g=>{e.setValue(t,{value:g.target.value}),this.setPropertyOnSiblings(s,"value",g.target.value,"value"),h.formattedValue=null}),s.addEventListener("resetform",g=>{const y=this.data.defaultFieldValue??"";s.value=h.userValue=y,h.formattedValue=null});let p=g=>{const{formattedValue:y}=h;y!=null&&(g.target.value=y),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",y=>{if(h.focused)return;const{target:v}=y;h.userValue&&(v.value=h.userValue),h.lastCommittedValue=v.value,h.commitKey=1,this.data.actions?.Focus||(h.focused=!0)}),s.addEventListener("updatefromsandbox",y=>{this.showElementAndHideCanvas(y.target);const v={value(b){h.userValue=b.detail.value??"",e.setValue(t,{value:h.userValue.toString()}),b.target.value=h.userValue},formattedValue(b){const{formattedValue:S}=b.detail;h.formattedValue=S,S!=null&&b.target!==document.activeElement&&(b.target.value=S),e.setValue(t,{formattedValue:S})},selRange(b){b.target.setSelectionRange(...b.detail.selRange)},charLimit:b=>{const{charLimit:S}=b.detail,{target:_}=b;if(S===0){_.removeAttribute("maxLength");return}_.setAttribute("maxLength",S);let T=h.userValue;!T||T.length<=S||(T=T.slice(0,S),_.value=h.userValue=T,e.setValue(t,{value:T}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:_.selectionStart,selEnd:_.selectionEnd}}))}};this._dispatchEventFromSandbox(v,y)}),s.addEventListener("keydown",y=>{h.commitKey=1;let v=-1;if(y.key==="Escape"?v=0:y.key==="Enter"&&!this.data.multiLine?v=2:y.key==="Tab"&&(h.commitKey=3),v===-1)return;const{value:b}=y.target;h.lastCommittedValue!==b&&(h.lastCommittedValue=b,h.userValue=b,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:v,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}}))});const g=p;p=null,s.addEventListener("blur",y=>{if(!h.focused||!y.relatedTarget)return;this.data.actions?.Blur||(h.focused=!1);const{value:v}=y.target;h.userValue=v,h.lastCommittedValue!==v&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:h.commitKey,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}}),g(y)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",y=>{h.lastCommittedValue=null;const{data:v,target:b}=y,{value:S,selectionStart:_,selectionEnd:T}=b;let k=_,F=T;switch(y.inputType){case"deleteWordBackward":{const z=S.substring(0,_).match(/\w*[^\w]*$/);z&&(k-=z[0].length);break}case"deleteWordForward":{const z=S.substring(_).match(/^[^\w]*\w*/);z&&(F+=z[0].length);break}case"deleteContentBackward":_===T&&(k-=1);break;case"deleteContentForward":_===T&&(F+=1);break}y.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,change:v||"",willCommit:!1,selStart:k,selEnd:F}})}),this._setEventListeners(s,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],y=>y.target.value)}if(p&&s.addEventListener("blur",p),this.data.comb){const y=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${y}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Wm extends Ms{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Gm extends Ms{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let r=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(s,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return Rs.add(o),o.setAttribute("data-element-id",s),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=t.fieldName,r&&o.setAttribute("checked",!0),o.setAttribute("exportValue",t.exportValue),o.tabIndex=ma,o.addEventListener("change",l=>{const{name:c,checked:h}=l.target;for(const p of this._getElementsByName(c,s)){const g=h&&p.exportValue===t.exportValue;p.domElement&&(p.domElement.checked=g),e.setValue(p.id,{value:g})}e.setValue(s,{value:h})}),o.addEventListener("resetform",l=>{const c=t.defaultFieldValue||"Off";l.target.checked=c===t.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",l=>{const c={value(h){h.target.checked=h.detail.value!=="Off",e.setValue(s,{value:h.target.checked})}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class bf extends Ms{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let r=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(s,{value:r})),r)for(const l of this._getElementsByName(t.fieldName,s))e.setValue(l.id,{value:!1});const o=document.createElement("input");if(Rs.add(o),o.setAttribute("data-element-id",s),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=t.fieldName,r&&o.setAttribute("checked",!0),o.tabIndex=ma,o.addEventListener("change",l=>{const{name:c,checked:h}=l.target;for(const p of this._getElementsByName(c,s))e.setValue(p.id,{value:!1});e.setValue(s,{value:h})}),o.addEventListener("resetform",l=>{const c=t.defaultFieldValue;l.target.checked=c!=null&&c===t.buttonValue}),this.enableScripting&&this.hasJSActions){const l=t.buttonValue;o.addEventListener("updatefromsandbox",c=>{const h={value:p=>{const g=l===p.detail.value;for(const y of this._getElementsByName(p.target.name)){const v=g&&y.id===s;y.domElement&&(y.domElement.checked=v),e.setValue(y.id,{value:v})}}};this._dispatchEventFromSandbox(h,c)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class Xm extends wf{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class qm extends Ms{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");Rs.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=ma;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",g=>{const y=this.data.defaultFieldValue;for(const v of r.options)v.selected=v.value===y});for(const g of this.data.options){const y=document.createElement("option");y.textContent=g.displayValue,y.value=g.exportValue,s.value.includes(g.exportValue)&&(y.setAttribute("selected",!0),o=!1),r.append(y)}let l=null;if(o){const g=document.createElement("option");g.value=" ",g.setAttribute("hidden",!0),g.setAttribute("selected",!0),r.prepend(g),l=()=>{g.remove(),r.removeEventListener("input",l),l=null},r.addEventListener("input",l)}const c=g=>{const y=g?"value":"textContent",{options:v,multiple:b}=r;return b?Array.prototype.filter.call(v,S=>S.selected).map(S=>S[y]):v.selectedIndex===-1?null:v[v.selectedIndex][y]};let h=c(!1);const p=g=>{const y=g.target.options;return Array.prototype.map.call(y,v=>({displayValue:v.textContent,exportValue:v.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",g=>{const y={value(v){l?.();const b=v.detail.value,S=new Set(Array.isArray(b)?b:[b]);for(const _ of r.options)_.selected=S.has(_.value);e.setValue(t,{value:c(!0)}),h=c(!1)},multipleSelection(v){r.multiple=!0},remove(v){const b=r.options,S=v.detail.remove;b[S].selected=!1,r.remove(S),b.length>0&&Array.prototype.findIndex.call(b,T=>T.selected)===-1&&(b[0].selected=!0),e.setValue(t,{value:c(!0),items:p(v)}),h=c(!1)},clear(v){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),h=c(!1)},insert(v){const{index:b,displayValue:S,exportValue:_}=v.detail.insert,T=r.children[b],k=document.createElement("option");k.textContent=S,k.value=_,T?T.before(k):r.append(k),e.setValue(t,{value:c(!0),items:p(v)}),h=c(!1)},items(v){const{items:b}=v.detail;for(;r.length!==0;)r.remove(0);for(const S of b){const{displayValue:_,exportValue:T}=S,k=document.createElement("option");k.textContent=_,k.value=T,r.append(k)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:c(!0),items:p(v)}),h=c(!1)},indices(v){const b=new Set(v.detail.indices);for(const S of v.target.options)S.selected=b.has(S.index);e.setValue(t,{value:c(!0)}),h=c(!1)},editable(v){v.target.disabled=!v.detail.editable}};this._dispatchEventFromSandbox(y,g)}),r.addEventListener("input",g=>{const y=c(!0),v=c(!1);e.setValue(t,{value:y}),g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:h,change:v,changeEx:y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],g=>g.target.value)):r.addEventListener("input",function(g){e.setValue(t,{value:c(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class $c extends vt{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:vt._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Ym({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${Xc}${s}`).join(",")),this.container}}class Ym{#e=this.#k.bind(this);#t=this.#C.bind(this);#n=this.#T.bind(this);#i=this.#S.bind(this);#r=null;#s=null;#l=null;#o=null;#u=null;#c=null;#d=null;#h=!1;#f=null;#a=null;#p=null;#m=null;#g=null;#y=null;#b=!1;constructor({container:e,color:t,elements:s,titleObj:r,modificationDate:o,contentsObj:l,richText:c,parent:h,rect:p,parentRect:g,open:y}){this.#s=e,this.#g=r,this.#l=l,this.#m=c,this.#c=h,this.#r=t,this.#p=p,this.#d=g,this.#u=s,this.#o=Jd.toDateObject(o),this.trigger=s.flatMap(v=>v.getElementsToTriggerPopup());for(const v of this.trigger)v.addEventListener("click",this.#i),v.addEventListener("mouseenter",this.#n),v.addEventListener("mouseleave",this.#t),v.classList.add("popupTriggerArea");for(const v of s)v.container?.addEventListener("keydown",this.#e);this.#s.hidden=!0,y&&this.#S()}render(){if(this.#f)return;const e=this.#f=document.createElement("div");if(e.className="popup",this.#r){const o=e.style.outlineColor=pe.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${o} 30%, white)`:e.style.backgroundColor=pe.makeHexColor(...this.#r.map(c=>Math.floor(.7*(255-c)+c)))}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=this.#g,e.append(t),this.#o){const o=document.createElement("span");o.classList.add("popupDate"),o.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),o.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),t.append(o)}const r=this.#v;if(r)vf.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const o=this._formatContents(this.#l);e.append(o)}this.#s.append(e)}get#v(){const e=this.#m,t=this.#l;return e?.str&&(!t?.str||t.str===e.str)&&this.#m.html||null}get#A(){return this.#v?.attributes?.style?.fontSize||0}get#_(){return this.#v?.attributes?.style?.color||null}#E(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:this.#_,fontSize:this.#A?`calc(${this.#A}px * var(--scale-factor))`:""}};for(const o of e.split(`
`))t.push({name:"span",value:o,attributes:r});return s}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let o=0,l=r.length;o<l;++o){const c=r[o];s.append(document.createTextNode(c)),o<l-1&&s.append(document.createElement("br"))}return s}#k(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#h)&&this.#S()}updateEdited({rect:e,popupContent:t}){this.#y||={contentsObj:this.#l,richText:this.#m},e&&(this.#a=null),t&&(this.#m=this.#E(t),this.#l=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#y&&({contentsObj:this.#l,richText:this.#m}=this.#y,this.#y=null,this.#f?.remove(),this.#f=null,this.#a=null)}#P(){if(this.#a!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:r,pageY:o}}}=this.#c;let l=!!this.#d,c=l?this.#d:this.#p;for(const S of this.#u)if(!c||pe.intersect(S.data.rect,c)!==null){c=S.data.rect,l=!0;break}const h=pe.normalizeRect([c[0],e[3]-c[1]+e[1],c[2],e[3]-c[3]+e[1]]),g=l?c[2]-c[0]+5:0,y=h[0]+g,v=h[1];this.#a=[100*(y-r)/t,100*(v-o)/s];const{style:b}=this.#s;b.left=`${this.#a[0]}%`,b.top=`${this.#a[1]}%`}#S(){this.#h=!this.#h,this.#h?(this.#T(),this.#s.addEventListener("click",this.#i),this.#s.addEventListener("keydown",this.#e)):(this.#C(),this.#s.removeEventListener("click",this.#i),this.#s.removeEventListener("keydown",this.#e))}#T(){this.#f||this.render(),this.isVisible?this.#h&&this.#s.classList.add("focused"):(this.#P(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#C(){this.#s.classList.remove("focused"),!(this.#h||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#b=this.isVisible,this.#b&&(this.#s.hidden=!0)}maybeShow(){this.#b&&(this.#f||this.#T(),this.#b=!1,this.#s.hidden=!1)}get isVisible(){return this.#s.hidden===!1}}class Af extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Fe.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Km extends vt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:t,height:s}=Gi(e.rect),r=this.svgFactory.create(t,s,!0),o=this.#e=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),o.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),o.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),o.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),o.setAttribute("stroke-width",e.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Qm extends vt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:t,height:s}=Gi(e.rect),r=this.svgFactory.create(t,s,!0),o=e.borderStyle.width,l=this.#e=this.svgFactory.createElement("svg:rect");return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",t-o),l.setAttribute("height",s-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Zm extends vt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:t,height:s}=Gi(e.rect),r=this.svgFactory.create(t,s,!0),o=e.borderStyle.width,l=this.#e=this.svgFactory.createElement("svg:ellipse");return l.setAttribute("cx",t/2),l.setAttribute("cy",s/2),l.setAttribute("rx",t/2-o/2),l.setAttribute("ry",s/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Sf extends vt{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:s,popupRef:r}}=this;if(!t)return this.container;const{width:o,height:l}=Gi(e),c=this.svgFactory.create(o,l,!0);let h=[];for(let g=0,y=t.length;g<y;g+=2){const v=t[g]-e[0],b=e[3]-t[g+1];h.push(`${v},${b}`)}h=h.join(" ");const p=this.#e=this.svgFactory.createElement(this.svgElementName);return p.setAttribute("points",h),p.setAttribute("stroke-width",s.width||1),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),c.append(p),this.container.append(c),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Jm extends Sf{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ey extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class su extends vt{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Fe.HIGHLIGHT:Fe.INK}#n(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:s,borderStyle:r,popupRef:o}}=this,{transform:l,width:c,height:h}=this.#n(t,e),p=this.svgFactory.create(c,h,!0),g=this.#e=this.svgFactory.createElement("svg:g");p.append(g),g.setAttribute("stroke-width",r.width||1),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round"),g.setAttribute("stroke-miterlimit",10),g.setAttribute("stroke","transparent"),g.setAttribute("fill","transparent"),g.setAttribute("transform",l);for(let y=0,v=s.length;y<v;y++){const b=this.svgFactory.createElement(this.svgElementName);this.#t.push(b),b.setAttribute("points",s[y].join(",")),g.append(b)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(p),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:s,rect:r}=e,o=this.#e;if(t>=0&&o.setAttribute("stroke-width",t||1),s)for(let l=0,c=this.#t.length;l<c;l++)this.#t[l].setAttribute("points",s[l].join(","));if(r){const{transform:l,width:c,height:h}=this.#n(this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${h}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class _f extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Fe.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class ty extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ny extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class iy extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class xf extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Fe.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class sy extends vt{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let s;t.hasAppearance||t.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#t.bind(this)),this.#e=s;const{isMac:r}=en.platform;return e.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class ry{#e=null;#t=null;#n=new Map;#i=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:r,page:o,viewport:l,structTreeLayer:c}){this.div=e,this.#e=t,this.#t=s,this.#i=c||null,this.page=o,this.viewport=l,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return this.#n.size>0}async#r(e,t){const s=e.firstChild||e,r=s.id=`${Xc}${t}`,o=await this.#i?.getAriaAttributes(r);if(o)for(const[l,c]of o)s.setAttribute(l,c);this.div.append(e),this.#e?.moveElementInDOM(this.div,e,s,!1)}async render(e){const{annotations:t}=e,s=this.div;Ps(s,this.viewport);const r=new Map,o={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new iu,annotationStorage:e.annotationStorage||new Jc,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const l of t){if(l.noHTML)continue;const c=l.annotationType===Ct.POPUP;if(c){const g=r.get(l.id);if(!g)continue;o.elements=g}else{const{width:g,height:y}=Gi(l.rect);if(g<=0||y<=0)continue}o.data=l;const h=$m.create(o);if(!h.isRenderable)continue;if(!c&&l.popupRef){const g=r.get(l.popupRef);g?g.push(h):r.set(l.popupRef,[h])}const p=h.render();l.hidden&&(p.style.visibility="hidden"),await this.#r(p,l.id),h._isEditable&&(this.#n.set(h.data.id,h),this._annotationEditorUIManager?.renderAnnotationElement(h))}this.#s()}update({viewport:e}){const t=this.div;this.viewport=e,Ps(t,{rotation:e.rotation}),this.#s(),t.hidden=!1}#s(){if(!this.#t)return;const e=this.div;for(const[t,s]of this.#t){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;s.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(s):o.classList.contains("annotationContent")?o.after(s):o.before(s):r.append(s)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}}const _o=/\r\n?|\n/g;class kt extends Ee{#e;#t="";#n=`${this.id}-editor`;#i=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=kt.prototype,t=o=>o.isEmpty(),s=qi.TRANSLATE_SMALL,r=qi.TRANSLATE_BIG;return He(this,"_keyboardManager",new ga([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}]]))}static _type="freetext";static _editorType=Fe.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.#e=e.color||kt._defaultColor||Ee._defaultLineColor,this.#r=e.fontSize||kt._defaultFontSize}static initialize(e,t){Ee.initialize(e,t);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case $e.FREETEXT_SIZE:kt._defaultFontSize=t;break;case $e.FREETEXT_COLOR:kt._defaultColor=t;break}}updateParams(e,t){switch(e){case $e.FREETEXT_SIZE:this.#s(t);break;case $e.FREETEXT_COLOR:this.#l(t);break}}static get defaultPropertiesToUpdate(){return[[$e.FREETEXT_SIZE,kt._defaultFontSize],[$e.FREETEXT_COLOR,kt._defaultColor||Ee._defaultLineColor]]}get propertiesToUpdate(){return[[$e.FREETEXT_SIZE,this.#r],[$e.FREETEXT_COLOR,this.#e]]}#s(e){const t=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--scale-factor))`,this.translate(0,-(r-this.#r)*this.parentScale),this.#r=r,this.#u()},s=this.#r;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$e.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(e){const t=r=>{this.#e=this.editorDiv.style.color=r},s=this.#e;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$e.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-kt._internalPadding*e,-(kt._internalPadding+this.#r)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Fe.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const e=this._uiManager.combinedSignal(this.#i);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const e=[];this.editorDiv.normalize();let t=null;for(const s of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(e.push(kt.#c(s)),t=s);return e.join(`
`)}#u(){const[e,t]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,l=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/t):(this.width=s.height/e,this.height=s.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#t,t=this.#t=this.#o().trimEnd();if(e===t)return;const s=r=>{if(this.#t=r,!r){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{s(t)},undo:()=>{s(e)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){kt._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#r}px * var(--scale-factor))`,s.color=this.#e,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ro(this,this.div,["dblclick","keydown"]),this.width){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[c,h]=this.getInitialTranslation();[c,h]=this.pageTranslationToScreen(c,h);const[p,g]=this.pageDimensions,[y,v]=this.pageTranslation;let b,S;switch(this.rotation){case 0:b=e+(l[0]-y)/p,S=t+this.height-(l[1]-v)/g;break;case 90:b=e+(l[0]-y)/p,S=t-(l[1]-v)/g,[c,h]=[h,-c];break;case 180:b=e-this.width+(l[0]-y)/p,S=t-(l[1]-v)/g,[c,h]=[-c,-h];break;case 270:b=e+(l[0]-y-this.height*g)/p,S=t+(l[1]-v-this.width*p)/g,[c,h]=[-h,c];break}this.setAt(b*r,S*o,c,h)}else this.setAt(e*r,t*o,this.width*r,this.height*o);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(_o,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:s}=t;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();const r=kt.#f(t.getData("text")||"").replaceAll(_o,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!r.includes(`
`)){l.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:h}=l,p=[],g=[];if(c.nodeType===Node.TEXT_NODE){const b=c.parentElement;if(g.push(c.nodeValue.slice(h).replaceAll(_o,"")),b!==this.editorDiv){let S=p;for(const _ of this.editorDiv.childNodes){if(_===b){S=g;continue}S.push(kt.#c(_))}}p.push(c.nodeValue.slice(0,h).replaceAll(_o,""))}else if(c===this.editorDiv){let b=p,S=0;for(const _ of this.editorDiv.childNodes)S++===h&&(b=g),b.push(kt.#c(_))}this.#t=`${p.join(`
`)}${r}${g.join(`
`)}`,this.#d();const y=new Range;let v=p.reduce((b,S)=>b+S.length,0);for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const S=b.nodeValue.length;if(v<=S){y.setStart(b,v),y.setEnd(b,v);break}v-=S}o.removeAllRanges(),o.addRange(y)}#d(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const e of this.#t.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#h(){return this.#t.replaceAll(""," ")}static#f(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}static async deserialize(e,t,s){let r=null;if(e instanceof Af){const{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:h,rotation:p,id:g,popupRef:y},textContent:v,textPosition:b,parent:{page:{pageNumber:S}}}=e;if(!v||v.length===0)return null;r=e={annotationType:Fe.FREETEXT,color:Array.from(c),fontSize:l,value:v.join(`
`),position:b,pageIndex:S-1,rect:h.slice(0),rotation:p,id:g,deleted:!1,popupRef:y}}const o=await super.deserialize(e,t,s);return o.#r=e.fontSize,o.#e=pe.makeHexColor(...e.color),o.#t=kt.#f(e.value),o.annotationElementId=e.id||null,o._initialData=r,o}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=kt._internalPadding*this.parentScale,s=this.getRect(t,t),r=Ee._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#e),o={annotationType:Fe.FREETEXT,color:r,fontSize:this.#r,value:this.#h(),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?o:this.annotationElementId&&!this.#a(o)?null:(o.id=this.annotationElementId,o)}#a(e){const{value:t,fontSize:s,color:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==s||e.color.some((l,c)=>l!==r[c])||e.pageIndex!==o}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(this.deleted)return t;const{style:s}=t;s.fontSize=`calc(${this.#r}px * var(--scale-factor))`,s.color=this.#e,t.replaceChildren();for(const o of this.#t.split(`
`)){const l=document.createElement("div");l.append(o?document.createTextNode(o):document.createElement("br")),t.append(l)}const r=kt._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(r,r),popupContent:this.#t}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class le{static PRECISION=1e-4;toSVGPath(){et("Abstract method `toSVGPath` must be implemented.")}get box(){et("Abstract getter `box` must be implemented.")}serialize(e,t){et("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,r,o,l){l||=new Float32Array(e.length);for(let c=0,h=e.length;c<h;c+=2)l[c]=t+e[c]*r,l[c+1]=s+e[c+1]*o;return l}static _rescaleAndSwap(e,t,s,r,o,l){l||=new Float32Array(e.length);for(let c=0,h=e.length;c<h;c+=2)l[c]=t+e[c+1]*r,l[c+1]=s+e[c]*o;return l}static _translate(e,t,s,r){r||=new Float32Array(e.length);for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o],r[o+1]=s+e[o+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,r,o){switch(o){case 90:return[1-t/s,e/r];case 180:return[1-e/s,1-t/r];case 270:return[t/s,1-e/r];default:return[e/s,t/r]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,r,o,l){return[(e+5*s)/6,(t+5*r)/6,(5*s+o)/6,(5*r+l)/6,(s+o)/2,(r+l)/2]}}class Cs{#e;#t=[];#n;#i;#r=[];#s=new Float32Array(18);#l;#o;#u;#c;#d;#h;#f=[];static#a=8;static#p=2;static#m=Cs.#a+Cs.#p;constructor({x:e,y:t},s,r,o,l,c=0){this.#e=s,this.#h=o*r,this.#i=l,this.#s.set([NaN,NaN,NaN,NaN,e,t],6),this.#n=c,this.#c=Cs.#a*r,this.#u=Cs.#m*r,this.#d=r,this.#f.push(e,t)}isEmpty(){return isNaN(this.#s[8])}#g(){const e=this.#s.subarray(4,6),t=this.#s.subarray(16,18),[s,r,o,l]=this.#e;return[(this.#l+(e[0]-t[0])/2-s)/o,(this.#o+(e[1]-t[1])/2-r)/l,(this.#l+(t[0]-e[0])/2-s)/o,(this.#o+(t[1]-e[1])/2-r)/l]}add({x:e,y:t}){this.#l=e,this.#o=t;const[s,r,o,l]=this.#e;let[c,h,p,g]=this.#s.subarray(8,12);const y=e-p,v=t-g,b=Math.hypot(y,v);if(b<this.#u)return!1;const S=b-this.#c,_=S/b,T=_*y,k=_*v;let F=c,z=h;c=p,h=g,p+=T,g+=k,this.#f?.push(e,t);const H=-k/S,$=T/S,G=H*this.#h,X=$*this.#h;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([p+G,g+X],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([p-G,g-X],16),isNaN(this.#s[6])?(this.#r.length===0&&(this.#s.set([c+G,h+X],2),this.#r.push(NaN,NaN,NaN,NaN,(c+G-s)/o,(h+X-r)/l),this.#s.set([c-G,h-X],14),this.#t.push(NaN,NaN,NaN,NaN,(c-G-s)/o,(h-X-r)/l)),this.#s.set([F,z,c,h,p,g],6),!this.isEmpty()):(this.#s.set([F,z,c,h,p,g],6),Math.abs(Math.atan2(z-h,F-c)-Math.atan2(k,T))<Math.PI/2?([c,h,p,g]=this.#s.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((c+p)/2-s)/o,((h+g)/2-r)/l),[c,h,F,z]=this.#s.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((F+c)/2-s)/o,((z+h)/2-r)/l),!0):([F,z,c,h,p,g]=this.#s.subarray(0,6),this.#r.push(((F+5*c)/6-s)/o,((z+5*h)/6-r)/l,((5*c+p)/6-s)/o,((5*h+g)/6-r)/l,((c+p)/2-s)/o,((h+g)/2-r)/l),[p,g,c,h,F,z]=this.#s.subarray(12,18),this.#t.push(((F+5*c)/6-s)/o,((z+5*h)/6-r)/l,((5*c+p)/6-s)/o,((5*h+g)/6-r)/l,((c+p)/2-s)/o,((h+g)/2-r)/l),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#r,t=this.#t;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#y();const s=[];s.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?s.push(`L${e[r+4]} ${e[r+5]}`):s.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);this.#v(s);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?s.push(`L${t[r+4]} ${t[r+5]}`):s.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return this.#b(s),s.join(" ")}#y(){const[e,t,s,r]=this.#e,[o,l,c,h]=this.#g();return`M${(this.#s[2]-e)/s} ${(this.#s[3]-t)/r} L${(this.#s[4]-e)/s} ${(this.#s[5]-t)/r} L${o} ${l} L${c} ${h} L${(this.#s[16]-e)/s} ${(this.#s[17]-t)/r} L${(this.#s[14]-e)/s} ${(this.#s[15]-t)/r} Z`}#b(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#v(e){const[t,s,r,o]=this.#e,l=this.#s.subarray(4,6),c=this.#s.subarray(16,18),[h,p,g,y]=this.#g();e.push(`L${(l[0]-t)/r} ${(l[1]-s)/o} L${h} ${p} L${g} ${y} L${(c[0]-t)/r} ${(c[1]-s)/o}`)}newFreeDrawOutline(e,t,s,r,o,l){return new Ef(e,t,s,r,o,l)}getOutlines(){const e=this.#r,t=this.#t,s=this.#s,[r,o,l,c]=this.#e,h=new Float32Array((this.#f?.length??0)+2);for(let y=0,v=h.length-2;y<v;y+=2)h[y]=(this.#f[y]-r)/l,h[y+1]=(this.#f[y+1]-o)/c;if(h[h.length-2]=(this.#l-r)/l,h[h.length-1]=(this.#o-o)/c,isNaN(s[6])&&!this.isEmpty())return this.#A(h);const p=new Float32Array(this.#r.length+24+this.#t.length);let g=e.length;for(let y=0;y<g;y+=2){if(isNaN(e[y])){p[y]=p[y+1]=NaN;continue}p[y]=e[y],p[y+1]=e[y+1]}g=this.#E(p,g);for(let y=t.length-6;y>=6;y-=6)for(let v=0;v<6;v+=2){if(isNaN(t[y+v])){p[g]=p[g+1]=NaN,g+=2;continue}p[g]=t[y+v],p[g+1]=t[y+v+1],g+=2}return this.#_(p,g),this.newFreeDrawOutline(p,h,this.#e,this.#d,this.#n,this.#i)}#A(e){const t=this.#s,[s,r,o,l]=this.#e,[c,h,p,g]=this.#g(),y=new Float32Array(36);return y.set([NaN,NaN,NaN,NaN,(t[2]-s)/o,(t[3]-r)/l,NaN,NaN,NaN,NaN,(t[4]-s)/o,(t[5]-r)/l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,p,g,NaN,NaN,NaN,NaN,(t[16]-s)/o,(t[17]-r)/l,NaN,NaN,NaN,NaN,(t[14]-s)/o,(t[15]-r)/l],0),this.newFreeDrawOutline(y,e,this.#e,this.#d,this.#n,this.#i)}#_(e,t){const s=this.#t;return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6}#E(e,t){const s=this.#s.subarray(4,6),r=this.#s.subarray(16,18),[o,l,c,h]=this.#e,[p,g,y,v]=this.#g();return e.set([NaN,NaN,NaN,NaN,(s[0]-o)/c,(s[1]-l)/h,NaN,NaN,NaN,NaN,p,g,NaN,NaN,NaN,NaN,y,v,NaN,NaN,NaN,NaN,(r[0]-o)/c,(r[1]-l)/h],t),t+=24}}class Ef extends le{#e;#t=new Float32Array(4);#n;#i;#r;#s;#l;constructor(e,t,s,r,o,l){super(),this.#l=e,this.#r=t,this.#e=s,this.#s=r,this.#n=o,this.#i=l,this.lastPoint=[NaN,NaN],this.#o(l);const[c,h,p,g]=this.#t;for(let y=0,v=e.length;y<v;y+=2)e[y]=(e[y]-c)/p,e[y+1]=(e[y+1]-h)/g;for(let y=0,v=t.length;y<v;y+=2)t[y]=(t[y]-c)/p,t[y+1]=(t[y+1]-h)/g}toSVGPath(){const e=[`M${this.#l[4]} ${this.#l[5]}`];for(let t=6,s=this.#l.length;t<s;t+=6){if(isNaN(this.#l[t])){e.push(`L${this.#l[t+4]} ${this.#l[t+5]}`);continue}e.push(`C${this.#l[t]} ${this.#l[t+1]} ${this.#l[t+2]} ${this.#l[t+3]} ${this.#l[t+4]} ${this.#l[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,s,r],o){const l=s-e,c=r-t;let h,p;switch(o){case 0:h=le._rescale(this.#l,e,r,l,-c),p=le._rescale(this.#r,e,r,l,-c);break;case 90:h=le._rescaleAndSwap(this.#l,e,t,l,c),p=le._rescaleAndSwap(this.#r,e,t,l,c);break;case 180:h=le._rescale(this.#l,s,t,-l,c),p=le._rescale(this.#r,s,t,-l,c);break;case 270:h=le._rescaleAndSwap(this.#l,s,r,-l,-c),p=le._rescaleAndSwap(this.#r,s,r,-l,-c);break}return{outline:Array.from(h),points:[Array.from(p)]}}#o(e){const t=this.#l;let s=t[4],r=t[5],o=s,l=r,c=s,h=r,p=s,g=r;const y=e?Math.max:Math.min;for(let b=6,S=t.length;b<S;b+=6){if(isNaN(t[b]))o=Math.min(o,t[b+4]),l=Math.min(l,t[b+5]),c=Math.max(c,t[b+4]),h=Math.max(h,t[b+5]),g<t[b+5]?(p=t[b+4],g=t[b+5]):g===t[b+5]&&(p=y(p,t[b+4]));else{const _=pe.bezierBoundingBox(s,r,...t.slice(b,b+6));o=Math.min(o,_[0]),l=Math.min(l,_[1]),c=Math.max(c,_[2]),h=Math.max(h,_[3]),g<_[3]?(p=_[2],g=_[3]):g===_[3]&&(p=y(p,_[2]))}s=t[b+4],r=t[b+5]}const v=this.#t;v[0]=o-this.#n,v[1]=l-this.#n,v[2]=c-o+2*this.#n,v[3]=h-l+2*this.#n,this.lastPoint=[p,g]}get box(){return this.#t}newOutliner(e,t,s,r,o,l=0){return new Cs(e,t,s,r,o,l)}getNewOutline(e,t){const[s,r,o,l]=this.#t,[c,h,p,g]=this.#e,y=o*p,v=l*g,b=s*p+c,S=r*g+h,_=this.newOutliner({x:this.#r[0]*y+b,y:this.#r[1]*v+S},this.#e,this.#s,e,this.#i,t??this.#n);for(let T=2;T<this.#r.length;T+=2)_.add({x:this.#r[T]*y+b,y:this.#r[T+1]*v+S});return _.getOutlines()}}class Uc{#e;#t;#n=[];#i=[];constructor(e,t=0,s=0,r=!0){let o=1/0,l=-1/0,c=1/0,h=-1/0;const p=10**-4;for(const{x:T,y:k,width:F,height:z}of e){const H=Math.floor((T-t)/p)*p,$=Math.ceil((T+F+t)/p)*p,G=Math.floor((k-t)/p)*p,X=Math.ceil((k+z+t)/p)*p,ie=[H,G,X,!0],de=[$,G,X,!1];this.#n.push(ie,de),o=Math.min(o,H),l=Math.max(l,$),c=Math.min(c,G),h=Math.max(h,X)}const g=l-o+2*s,y=h-c+2*s,v=o-s,b=c-s,S=this.#n.at(r?-1:-2),_=[S[0],S[2]];for(const T of this.#n){const[k,F,z]=T;T[0]=(k-v)/g,T[1]=(F-b)/y,T[2]=(z-b)/y}this.#e=new Float32Array([v,b,g,y]),this.#t=_}getOutlines(){this.#n.sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#u(t)),this.#l(t)):(this.#o(t),e.push(...this.#u(t)));return this.#r(e)}#r(e){const t=[],s=new Set;for(const l of e){const[c,h,p]=l;t.push([c,h,l],[c,p,l])}t.sort((l,c)=>l[1]-c[1]||l[0]-c[0]);for(let l=0,c=t.length;l<c;l+=2){const h=t[l][2],p=t[l+1][2];h.push(p),p.push(h),s.add(h),s.add(p)}const r=[];let o;for(;s.size>0;){const l=s.values().next().value;let[c,h,p,g,y]=l;s.delete(l);let v=c,b=h;for(o=[c,p],r.push(o);;){let S;if(s.has(g))S=g;else if(s.has(y))S=y;else break;s.delete(S),[c,h,p,g,y]=S,v!==c&&(o.push(v,b,c,b===h?h:p),v=c),b=b===h?p:h}o.push(v,b)}return new ay(r,this.#e,this.#t)}#s(e){const t=this.#i;let s=0,r=t.length-1;for(;s<=r;){const o=s+r>>1,l=t[o][0];if(l===e)return o;l<e?s=o+1:r=o-1}return r+1}#l([,e,t]){const s=this.#s(e);this.#i.splice(s,0,[e,t])}#o([,e,t]){const s=this.#s(e);for(let r=s;r<this.#i.length;r++){const[o,l]=this.#i[r];if(o!==e)break;if(o===e&&l===t){this.#i.splice(r,1);return}}for(let r=s-1;r>=0;r--){const[o,l]=this.#i[r];if(o!==e)break;if(o===e&&l===t){this.#i.splice(r,1);return}}}#u(e){const[t,s,r]=e,o=[[t,s,r]],l=this.#s(r);for(let c=0;c<l;c++){const[h,p]=this.#i[c];for(let g=0,y=o.length;g<y;g++){const[,v,b]=o[g];if(!(p<=v||b<=h)){if(v>=h){if(b>p)o[g][1]=p;else{if(y===1)return[];o.splice(g,1),g--,y--}continue}o[g][2]=h,b>p&&o.push([t,p,b])}}}return o}}class ay extends le{#e;#t;constructor(e,t,s){super(),this.#t=e,this.#e=t,this.lastPoint=s}toSVGPath(){const e=[];for(const t of this.#t){let[s,r]=t;e.push(`M${s} ${r}`);for(let o=2;o<t.length;o+=2){const l=t[o],c=t[o+1];l===s?(e.push(`V${c}`),r=c):c===r&&(e.push(`H${l}`),s=l)}e.push("Z")}return e.join(" ")}serialize([e,t,s,r],o){const l=[],c=s-e,h=r-t;for(const p of this.#t){const g=new Array(p.length);for(let y=0;y<p.length;y+=2)g[y]=e+p[y]*c,g[y+1]=r-p[y+1]*h;l.push(g)}return l}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class Vc extends Cs{newFreeDrawOutline(e,t,s,r,o,l){return new oy(e,t,s,r,o,l)}}class oy extends Ef{newOutliner(e,t,s,r,o,l=0){return new Vc(e,t,s,r,o,l)}}class Pn{#e=null;#t=null;#n;#i=null;#r=!1;#s=!1;#l=null;#o;#u=null;#c=null;#d;static#h=null;static get _keyboardManager(){return He(this,"_keyboardManager",new ga([[["Escape","mac+Escape"],Pn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Pn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Pn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Pn.prototype._moveToPrevious],[["Home","mac+Home"],Pn.prototype._moveToBeginning],[["End","mac+End"],Pn.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#s=!1,this.#d=$e.HIGHLIGHT_COLOR,this.#l=e):(this.#s=!0,this.#d=$e.HIGHLIGHT_DEFAULT_COLOR),this.#c=e?._uiManager||t,this.#o=this.#c._eventBus,this.#n=e?.color||this.#c?.highlightColors.values().next().value||"#FFFF98",Pn.#h||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=this.#c._signal;e.addEventListener("click",this.#m.bind(this),{signal:t}),e.addEventListener("keydown",this.#p.bind(this),{signal:t});const s=this.#t=document.createElement("span");return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=this.#n,e.append(s),e}renderMainDropdown(){const e=this.#i=this.#f();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#f(){const e=document.createElement("div"),t=this.#c._signal;e.addEventListener("contextmenu",Un,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,r]of this.#c.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",r),o.title=s,o.setAttribute("data-l10n-id",Pn.#h[s]);const l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=r,o.setAttribute("aria-selected",r===this.#n),o.addEventListener("click",this.#a.bind(this,r),{signal:t}),e.append(o)}return e.addEventListener("keydown",this.#p.bind(this),{signal:t}),e}#a(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#d,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#m(e);return}const t=e.target.getAttribute("data-color");t&&this.#a(t,e)}_moveToNext(e){if(!this.#y){this.#m(e);return}if(e.target===this.#e){this.#i.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#i?.firstChild||e.target===this.#e){this.#y&&this._hideDropdownFromKeyboard();return}this.#y||this.#m(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#y){this.#m(e);return}this.#i.firstChild?.focus()}_moveToEnd(e){if(!this.#y){this.#m(e);return}this.#i.lastChild?.focus()}#p(e){Pn._keyboardManager.exec(this,e)}#m(e){if(this.#y){this.hideDropdown();return}if(this.#r=e.detail===0,this.#u||(this.#u=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#c.combinedSignal(this.#u)})),this.#i){this.#i.classList.remove("hidden");return}const t=this.#i=this.#f();this.#e.append(t)}#g(e){this.#i?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#u?.abort(),this.#u=null}get#y(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#y){this.#l?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#i)return;const t=this.#c.highlightColors.values();for(const s of this.#i.children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#i?.remove(),this.#i=null}}class yt extends Ee{#e=null;#t=0;#n;#i=null;#r=null;#s=null;#l=null;#o=0;#u=null;#c=null;#d=null;#h=!1;#f=null;#a;#p=null;#m="";#g;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Fe.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=yt.prototype;return He(this,"_keyboardManager",new ga([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||yt._defaultColor,this.#g=e.thickness||yt._defaultThickness,this.#a=e.opacity||yt._defaultOpacity,this.#n=e.boxes||null,this.#y=e.methodOfCreation||"",this.#m=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#h=!0,this.#v(e),this.#P()):this.#n&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#l=e.focusNode,this.#o=e.focusOffset,this.#b(),this.#P(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new Uc(this.#n,.001);this.#c=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const t=new Uc(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=t.getOutlines();const{lastPoint:s}=this.#s;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#v({highlightOutlines:e,highlightId:t,clipPathId:s}){this.#c=e;const r=1.5;if(this.#s=e.getNewOutline(this.#g/2+r,.0025),t>=0)this.#d=t,this.#i=s,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:yt.#S(this.#c.box,(g-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:yt.#S(this.#s.box,g),path:{d:this.#s.toSVGPath()}})}const[o,l,c,h]=e.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=c,this.height=h;break;case 90:{const[g,y]=this.parentDimensions;this.x=l,this.y=1-o,this.width=c*y/g,this.height=h*g/y;break}case 180:this.x=1-o,this.y=1-l,this.width=c,this.height=h;break;case 270:{const[g,y]=this.parentDimensions;this.x=1-l,this.y=o,this.width=c*y/g,this.height=h*g/y;break}}const{lastPoint:p}=this.#s;this.#f=[(p[0]-o)/c,(p[1]-l)/h]}static initialize(e,t){Ee.initialize(e,t),yt._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case $e.HIGHLIGHT_DEFAULT_COLOR:yt._defaultColor=t;break;case $e.HIGHLIGHT_THICKNESS:yt._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#f}updateParams(e,t){switch(e){case $e.HIGHLIGHT_COLOR:this.#A(t);break;case $e.HIGHLIGHT_THICKNESS:this.#_(t);break}}static get defaultPropertiesToUpdate(){return[[$e.HIGHLIGHT_DEFAULT_COLOR,yt._defaultColor],[$e.HIGHLIGHT_THICKNESS,yt._defaultThickness]]}get propertiesToUpdate(){return[[$e.HIGHLIGHT_COLOR,this.color||yt._defaultColor],[$e.HIGHLIGHT_THICKNESS,this.#g||yt._defaultThickness],[$e.HIGHLIGHT_FREE,this.#h]]}#A(e){const t=(o,l)=>{this.color=o,this.#a=l,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:o,"fill-opacity":l}}),this.#r?.updateColor(o)},s=this.color,r=this.#a;this.addCommands({cmd:t.bind(this,e,yt._defaultOpacity),undo:t.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$e.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#_(e){const t=this.#g,s=r=>{this.#g=r,this.#E(r)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:$e.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(this.#r=new Pn({editor:this}),e.addColorPicker(this.#r)),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#M())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#M())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#k(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#P(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#k():e&&(this.#P(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#E(e){if(!this.#h)return;this.#v({highlightOutlines:this.#c.getNewOutline(e/2)}),this.fixAndSetPosition();const[t,s]=this.parentDimensions;this.setDims(this.width*t,this.height*s)}#k(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#P(e=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#i}=e.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#a},rootClass:{highlight:!0,free:this.#h},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#h),this.#u&&(this.#u.style.clipPath=this.#i))}static#S([e,t,s,r],o){switch(o){case 90:return[1-t-r,e,r,s];case 180:return[1-e-s,1-t-r,s,r];case 270:return[t,1-e-s,r,s]}return[e,t,s,r]}rotate(e){const{drawLayer:t}=this.parent;let s;this.#h?(e=(e-this.rotation+360)%360,s=yt.#S(this.#c.box,e)):s=yt.#S([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#d,{bbox:s,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:yt.#S(this.#s.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#m&&(e.setAttribute("aria-label",this.#m),e.setAttribute("role","mark")),this.#h?e.classList.add("free"):this.div.addEventListener("keydown",this.#T.bind(this),{signal:this._uiManager._signal});const t=this.#u=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#i;const[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),Ro(this,this.#u,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#T(e){yt._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#l,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#h||this.#C(!1))}get _mustFixPosition(){return!this.#h}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#M(){return this.#h?this.rotation:0}#I(){if(this.#h)return null;const[e,t]=this.pageDimensions,[s,r]=this.pageTranslation,o=this.#n,l=new Float32Array(o.length*8);let c=0;for(const{x:h,y:p,width:g,height:y}of o){const v=h*e+s,b=(1-p)*t+r;l[c]=l[c+4]=v,l[c+1]=l[c+3]=b,l[c+2]=l[c+6]=v+g*e,l[c+5]=l[c+7]=b-y*t,c+=8}return l}#D(e){return this.#c.serialize(e,this.#M())}static startHighlighting(e,t,{target:s,x:r,y:o}){const{x:l,y:c,width:h,height:p}=s.getBoundingClientRect(),g=new AbortController,y=e.combinedSignal(g),v=b=>{g.abort(),this.#w(e,b)};window.addEventListener("blur",v,{signal:y}),window.addEventListener("pointerup",v,{signal:y}),window.addEventListener("pointerdown",vn,{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Un,{signal:y}),s.addEventListener("pointermove",this.#x.bind(this,e),{signal:y}),this._freeHighlight=new Vc({x:r,y:o},[l,c,h,p],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#x(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#w(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,s){let r=null;if(e instanceof _f){const{data:{quadPoints:S,rect:_,rotation:T,id:k,color:F,opacity:z,popupRef:H},parent:{page:{pageNumber:$}}}=e;r=e={annotationType:Fe.HIGHLIGHT,color:Array.from(F),opacity:z,quadPoints:S,boxes:null,pageIndex:$-1,rect:_.slice(0),rotation:T,id:k,deleted:!1,popupRef:H}}else if(e instanceof su){const{data:{inkLists:S,rect:_,rotation:T,id:k,color:F,borderStyle:{rawWidth:z},popupRef:H},parent:{page:{pageNumber:$}}}=e;r=e={annotationType:Fe.HIGHLIGHT,color:Array.from(F),thickness:z,inkLists:S,boxes:null,pageIndex:$-1,rect:_.slice(0),rotation:T,id:k,deleted:!1,popupRef:H}}const{color:o,quadPoints:l,inkLists:c,opacity:h}=e,p=await super.deserialize(e,t,s);p.color=pe.makeHexColor(...o),p.#a=h||1,c&&(p.#g=e.thickness),p.annotationElementId=e.id||null,p._initialData=r;const[g,y]=p.pageDimensions,[v,b]=p.pageTranslation;if(l){const S=p.#n=[];for(let _=0;_<l.length;_+=8)S.push({x:(l[_]-v)/g,y:1-(l[_+1]-b)/y,width:(l[_+2]-l[_])/g,height:(l[_+1]-l[_+5])/y});p.#b(),p.#P(),p.rotate(p.rotation)}else if(c){p.#h=!0;const S=c[0],_={x:S[0]-v,y:y-(S[1]-b)},T=new Vc(_,[0,0,g,y],1,p.#g/2,!0,.001);for(let z=0,H=S.length;z<H;z+=2)_.x=S[z]-v,_.y=y-(S[z+1]-b),T.add(_);const{id:k,clipPathId:F}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:p.color,"fill-opacity":p._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:T.toSVGPath()}},!0,!0);p.#v({highlightOutlines:T.getOutlines(),highlightId:k,clipPathId:F}),p.#P()}return p}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=this.getRect(0,0),s=Ee._colorManager.convert(this.color),r={annotationType:Fe.HIGHLIGHT,color:s,opacity:this.#a,thickness:this.#g,quadPoints:this.#I(),outlines:this.#D(t),pageIndex:this.pageIndex,rect:t,rotation:this.#M(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#L(r)?null:(r.id=this.annotationElementId,r)}#L(e){const{color:t}=this._initialData;return e.color.some((s,r)=>s!==t[r])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class ly{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))this.updateProperty(t,s)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){et("Not implemented")}}class xe extends Ee{#e=null;#t;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#r=null;static#s=NaN;static#l=null;static#o=null;static#u=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,e.drawOutlines&&(this.#c(e),this.#f())}#c({drawOutlines:e,drawId:t,drawingOptions:s}){this.#e=e,this._drawingOptions||=s,t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#d(e,this.parent),this.#m(e.box)}#d(e,t){const{id:s}=t.drawLayer.draw(xe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(e,t){const s=new Set(Object.keys(e));for(const[r,o]of Object.entries(t))s.has(r)?Object.assign(e[r],o):e[r]=o;return e}static getDefaultDrawingOptions(e){et("Not implemented")}static get typesMap(){et("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,t),this._currentParent&&(xe.#n.updateProperty(s,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[s,r]of this.typesMap)e.push([s,t[r]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[s,r]of this.constructor.typesMap)e.push([s,t[r]]);return e}_updateProperty(e,t,s){const r=this._drawingOptions,o=r[t],l=c=>{r.updateProperty(t,c);const h=this.#e.updateProperty(t,c);h&&this.#m(h),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties())};this.addCommands({cmd:l.bind(this,s),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,xe._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,xe._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g(e,t)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,xe._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#h(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#m(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#h()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#h(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#e,e)}}#a([e,t,s,r]){const{parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[t,1-e,s*(l/o),r*(o/l)];case 180:return[1-e,1-t,s,r];case 270:return[1-t,e,s*(l/o),r*(o/l)];default:return[e,t,s,r]}}#p(){const{x:e,y:t,width:s,height:r,parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[1-t,e,s*(o/l),r*(l/o)];case 180:return[1-e,1-t,s,r];case 270:return[t,1-e,s*(o/l),r*(l/o)];default:return[e,t,s,r]}}#m(e){if([this.x,this.y,this.width,this.height]=this.#a(e),this.div){this.fixAndSetPosition();const[t,s]=this.parentDimensions;this.setDims(this.width*t,this.height*s)}this._onResized()}#g(){const{x:e,y:t,width:s,height:r,rotation:o,parentRotation:l,parentDimensions:[c,h]}=this;switch((o*4+l)/90){case 1:return[1-t-r,e,r,s];case 2:return[1-e-s,1-t-r,s,r];case 3:return[t,1-e-s,r,s];case 4:return[e,t-s*(c/h),r*(h/c),s*(c/h)];case 5:return[1-t,e,s*(c/h),r*(h/c)];case 6:return[1-e-r*(h/c),1-t,r*(h/c),s*(c/h)];case 7:return[t-s*(c/h),1-e-r*(h/c),s*(c/h),r*(h/c)];case 8:return[e-s,t-r,s,r];case 9:return[1-t,e-s,r,s];case 10:return[1-e,1-t,s,r];case 11:return[t-r,1-e,r,s];case 12:return[e-r*(h/c),t,r*(h/c),s*(c/h)];case 13:return[1-t-s*(c/h),e-r*(h/c),s*(c/h),r*(h/c)];case 14:return[1-e,1-t-s*(c/h),r*(h/c),s*(c/h)];case 15:return[t,1-e,s*(c/h),r*(h/c)];default:return[e,t,s,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,xe._mergeSVGProperties({bbox:this.#g()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const e=super.render();e.classList.add("draw");const t=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal";const[s,r]=this.parentDimensions;return this.setDims(this.width*s,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,t,s,r,o){et("Not implemented")}static startDrawing(e,t,s,r){const{target:o,offsetX:l,offsetY:c,pointerId:h,pointerType:p}=r;if(xe.#l&&xe.#l!==p)return;const{viewport:{rotation:g}}=e,{width:y,height:v}=o.getBoundingClientRect(),b=xe.#i=new AbortController,S=e.combinedSignal(b);if(xe.#s||=h,xe.#l??=p,window.addEventListener("pointerup",_=>{xe.#s===_.pointerId?this._endDraw(_):xe.#o?.delete(_.pointerId)},{signal:S}),window.addEventListener("pointercancel",_=>{xe.#s===_.pointerId?this._currentParent.endDrawingSession():xe.#o?.delete(_.pointerId)},{signal:S}),window.addEventListener("pointerdown",_=>{xe.#l===_.pointerType&&((xe.#o||=new Set).add(_.pointerId),xe.#n.isCancellable()&&(xe.#n.removeLastElement(),xe.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:S}),window.addEventListener("contextmenu",Un,{signal:S}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:S}),o.addEventListener("touchmove",_=>{_.timeStamp===xe.#u&&vn(_)},{signal:S}),e.toggleDrawing(),t._editorUndoBar?.hide(),xe.#n){e.drawLayer.updateProperties(this._currentDrawId,xe.#n.startNew(l,c,y,v,g));return}t.updateUIForDefaultProperties(this),xe.#n=this.createDrawerInstance(l,c,y,v,g),xe.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(xe.#r.toSVGProperties(),xe.#n.defaultSVGProperties),!0,!1)}static _drawMove(e){if(xe.#u=-1,!xe.#n)return;const{offsetX:t,offsetY:s,pointerId:r}=e;if(xe.#s===r){if(xe.#o?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,xe.#n.add(t,s)),xe.#u=e.timeStamp,vn(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,xe.#n=null,xe.#r=null,xe.#l=null,xe.#u=NaN),xe.#i&&(xe.#i.abort(),xe.#i=null,xe.#s=NaN,xe.#o=null)}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e&&t.drawLayer.updateProperties(this._currentDrawId,xe.#n.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const s=xe.#n,r=this._currentDrawId,o=s.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(r,s.setLastElement(o))},undo:()=>{t.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:$e.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack($e.DRAW_STEP),!xe.#n.isEmpty()){const{pageDimensions:[s,r],scale:o}=t,l=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:xe.#n.getOutlines(s*o,r*o,o,this._INNER_MARGIN),drawingOptions:xe.#r,mustBeCommitted:!e});return this._cleanup(!0),l}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,s,r,o,l){et("Not implemented")}static async deserialize(e,t,s){const{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}=t.viewport,h=this.deserializeDraw(l,c,r,o,this._INNER_MARGIN,e),p=await super.deserialize(e,t,s);return p.createDrawingOptions(e),p.#c({drawOutlines:h}),p.#f(),p.onScaleChanging(),p.rotate(),p}serializeDraw(e){const[t,s]=this.pageTranslation,[r,o]=this.pageDimensions;return this.#e.serialize([t,s,r,o],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class cy{#e=new Float64Array(6);#t;#n;#i;#r;#s;#l="";#o=0;#u=new Bo;#c;#d;constructor(e,t,s,r,o,l){this.#c=s,this.#d=r,this.#i=o,this.#r=l,[e,t]=this.#h(e,t);const c=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t],this.#n=[{line:c,points:this.#s}],this.#e.set(c,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#h(e,t){return le._normalizePoint(e,t,this.#c,this.#d,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(e,t){[e,t]=this.#h(e,t);const[s,r,o,l]=this.#e.subarray(2,6),c=e-o,h=t-l;return Math.hypot(this.#c*c,this.#d*h)<=2?null:(this.#s.push(e,t),isNaN(s)?(this.#e.set([o,l,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([s,r,o,l,e,t],0),this.#t.push(...le.createBezierPoints(s,r,o,l,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,r,o){this.#c=s,this.#d=r,this.#i=o,[e,t]=this.#h(e,t);const l=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t];const c=this.#n.at(-1);return c&&(c.line=new Float32Array(c.line),c.points=new Float32Array(c.points)),this.#n.push({line:l,points:this.#s}),this.#e.set(l,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(e){return this.#n?(this.#n.push(e),this.#t=e.line,this.#s=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#u.setLastElement(e)}removeLastElement(){if(!this.#n)return this.#u.removeLastElement();this.#n.pop(),this.#l="";for(let e=0,t=this.#n.length;e<t;e++){const{line:s,points:r}=this.#n[e];this.#t=s,this.#s=r,this.#o=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){const e=le.svgRound(this.#t[4]),t=le.svgRound(this.#t[5]);if(this.#s.length===2)return this.#l=`${this.#l} M ${e} ${t} Z`,this.#l;if(this.#s.length<=6){const r=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,r)} M ${e} ${t}`,this.#o=6}if(this.#s.length===4){const r=le.svgRound(this.#t[10]),o=le.svgRound(this.#t[11]);return this.#l=`${this.#l} L ${r} ${o}`,this.#o=12,this.#l}const s=[];this.#o===0&&(s.push(`M ${e} ${t}`),this.#o=6);for(let r=this.#o,o=this.#t.length;r<o;r+=6){const[l,c,h,p,g,y]=this.#t.slice(r,r+6).map(le.svgRound);s.push(`C${l} ${c} ${h} ${p} ${g} ${y}`)}return this.#l+=s.join(" "),this.#o=this.#t.length,this.#l}getOutlines(e,t,s,r){const o=this.#n.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#u.build(this.#n,e,t,s,this.#i,this.#r,r),this.#e=null,this.#t=null,this.#n=null,this.#l=null,this.#u}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Bo extends le{#e;#t=0;#n;#i;#r;#s;#l;#o;#u;build(e,t,s,r,o,l,c){this.#r=t,this.#s=s,this.#l=r,this.#o=o,this.#u=l,this.#n=c??0,this.#i=e,this.#h()}setLastElement(e){return this.#i.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#i){if(e.push(`M${le.svgRound(t[4])} ${le.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12){e.push(`L${le.svgRound(t[10])} ${le.svgRound(t[11])}`);continue}for(let s=6,r=t.length;s<r;s+=6){const[o,l,c,h,p,g]=t.subarray(s,s+6).map(le.svgRound);e.push(`C${o} ${l} ${c} ${h} ${p} ${g}`)}}return e.join("")}serialize([e,t,s,r],o){const l=[],c=[],[h,p,g,y]=this.#d();let v,b,S,_,T,k,F,z,H;switch(this.#o){case 0:H=le._rescale,v=e,b=t+r,S=s,_=-r,T=e+h*s,k=t+(1-p-y)*r,F=e+(h+g)*s,z=t+(1-p)*r;break;case 90:H=le._rescaleAndSwap,v=e,b=t,S=s,_=r,T=e+p*s,k=t+h*r,F=e+(p+y)*s,z=t+(h+g)*r;break;case 180:H=le._rescale,v=e+s,b=t,S=-s,_=r,T=e+(1-h-g)*s,k=t+p*r,F=e+(1-h)*s,z=t+(p+y)*r;break;case 270:H=le._rescaleAndSwap,v=e+s,b=t+r,S=-s,_=-r,T=e+(1-p-y)*s,k=t+(1-h-g)*r,F=e+(1-p)*s,z=t+(1-h)*r;break}for(const{line:$,points:G}of this.#i)l.push(H($,v,b,S,_,o?new Array($.length):null)),c.push(H(G,v,b,S,_,o?new Array(G.length):null));return{lines:l,points:c,rect:[T,k,F,z]}}static deserialize(e,t,s,r,o,{paths:{lines:l,points:c},rotation:h,thickness:p}){const g=[];let y,v,b,S,_;switch(h){case 0:_=le._rescale,y=-e/s,v=t/r+1,b=1/s,S=-1/r;break;case 90:_=le._rescaleAndSwap,y=-t/r,v=-e/s,b=1/r,S=1/s;break;case 180:_=le._rescale,y=e/s+1,v=-t/r,b=-1/s,S=1/r;break;case 270:_=le._rescaleAndSwap,y=t/r+1,v=e/s+1,b=-1/r,S=-1/s;break}if(!l){l=[];for(const k of c){const F=k.length;if(F===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,k[0],k[1]]));continue}if(F===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,k[0],k[1],NaN,NaN,NaN,NaN,k[2],k[3]]));continue}const z=new Float32Array(3*(F-2));l.push(z);let[H,$,G,X]=k.subarray(0,4);z.set([NaN,NaN,NaN,NaN,H,$],0);for(let ie=4;ie<F;ie+=2){const de=k[ie],K=k[ie+1];z.set(le.createBezierPoints(H,$,G,X,de,K),(ie-2)*3),[H,$,G,X]=[G,X,de,K]}}}for(let k=0,F=l.length;k<F;k++)g.push({line:_(l[k].map(z=>z??NaN),y,v,b,S),points:_(c[k].map(z=>z??NaN),y,v,b,S)});const T=new Bo;return T.build(g,s,r,1,h,p,o),T}#c(e=this.#u){const t=this.#n+e/2*this.#l;return this.#o%180===0?[t/this.#r,t/this.#s]:[t/this.#s,t/this.#r]}#d(){const[e,t,s,r]=this.#e,[o,l]=this.#c(0);return[e+o,t+l,s-2*o,r-2*l]}#h(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:r}of this.#i){if(r.length<=12){for(let c=4,h=r.length;c<h;c+=6){const[p,g]=r.subarray(c,c+2);e[0]=Math.min(e[0],p),e[1]=Math.min(e[1],g),e[2]=Math.max(e[2],p),e[3]=Math.max(e[3],g)}continue}let o=r[4],l=r[5];for(let c=6,h=r.length;c<h;c+=6){const[p,g,y,v,b,S]=r.subarray(c,c+6);pe.bezierBoundingBox(o,l,p,g,y,v,b,S,e),o=b,l=S}}const[t,s]=this.#c();e[0]=Math.min(1,Math.max(0,e[0]-t)),e[1]=Math.min(1,Math.max(0,e[1]-s)),e[2]=Math.min(1,Math.max(0,e[2]+t)),e[3]=Math.min(1,Math.max(0,e[3]+s)),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,s]=this.#c();this.#u=e;const[r,o]=this.#c(),[l,c]=[r-t,o-s],h=this.#e;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateParentDimensions([e,t],s){const[r,o]=this.#c();this.#r=e,this.#s=t,this.#l=s;const[l,c]=this.#c(),h=l-r,p=c-o,g=this.#e;return g[0]-=h,g[1]-=p,g[2]+=2*h,g[3]+=2*p,g}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(le.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${le.svgRound(e)} ${le.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let s=0,r=0,o=0,l=0,c=0,h=0;switch(this.#t){case 90:r=t/e,o=-e/t,c=e;break;case 180:s=-1,l=-1,c=e,h=t;break;case 270:r=-t/e,o=e/t,h=t;break;default:return""}return`matrix(${s} ${r} ${o} ${l} ${le.svgRound(c)} ${le.svgRound(h)})`}getPathResizingSVGProperties([e,t,s,r]){const[o,l]=this.#c(),[c,h,p,g]=this.#e;if(Math.abs(p-o)<=le.PRECISION||Math.abs(g-l)<=le.PRECISION){const _=e+s/2-(c+p/2),T=t+r/2-(h+g/2);return{path:{"transform-origin":`${le.svgRound(e)} ${le.svgRound(t)}`,transform:`${this.rotationTransform} translate(${_} ${T})`}}}const y=(s-2*o)/(p-2*o),v=(r-2*l)/(g-2*l),b=p/s,S=g/r;return{path:{"transform-origin":`${le.svgRound(c)} ${le.svgRound(h)}`,transform:`${this.rotationTransform} scale(${b} ${S}) translate(${le.svgRound(o)} ${le.svgRound(l)}) scale(${y} ${v}) translate(${le.svgRound(-o)} ${le.svgRound(-l)})`}}}getPathResizedSVGProperties([e,t,s,r]){const[o,l]=this.#c(),c=this.#e,[h,p,g,y]=c;if(c[0]=e,c[1]=t,c[2]=s,c[3]=r,Math.abs(g-o)<=le.PRECISION||Math.abs(y-l)<=le.PRECISION){const T=e+s/2-(h+g/2),k=t+r/2-(p+y/2);for(const{line:F,points:z}of this.#i)le._translate(F,T,k,F),le._translate(z,T,k,z);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${le.svgRound(e)} ${le.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const v=(s-2*o)/(g-2*o),b=(r-2*l)/(y-2*l),S=-v*(h+o)+e+o,_=-b*(p+l)+t+l;if(v!==1||b!==1||S!==0||_!==0)for(const{line:T,points:k}of this.#i)le._rescale(T,S,_,v,b,T),le._rescale(k,S,_,v,b,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${le.svgRound(e)} ${le.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],s){const[r,o]=s,l=this.#e,c=e-l[0],h=t-l[1];if(this.#r===r&&this.#s===o)for(const{line:p,points:g}of this.#i)le._translate(p,c,h,p),le._translate(g,c,h,g);else{const p=this.#r/r,g=this.#s/o;this.#r=r,this.#s=o;for(const{line:y,points:v}of this.#i)le._rescale(y,c,h,p,g,y),le._rescale(v,c,h,p,g,v);l[2]*=p,l[3]*=g}return l[0]=e,l[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${le.svgRound(e)} ${le.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${le.svgRound(e[0])} ${le.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class ru extends ly{#e;constructor(e){super(),this.#e=e,super.updateProperties({fill:"none",stroke:Ee._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this.#e.realScale),super.updateSVGProperty(e,t)}clone(){const e=new ru(this.#e);return e.updateAll(this),e}}class au extends xe{static _type="ink";static _editorType=Fe.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0}static initialize(e,t){Ee.initialize(e,t),this._defaultDrawingOptions=new ru(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return He(this,"typesMap",new Map([[$e.INK_THICKNESS,"stroke-width"],[$e.INK_COLOR,"stroke"],[$e.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,s,r,o){return new cy(e,t,s,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,s,r,o,l){return Bo.deserialize(e,t,s,r,o,l)}static async deserialize(e,t,s){let r=null;if(e instanceof su){const{data:{inkLists:l,rect:c,rotation:h,id:p,color:g,opacity:y,borderStyle:{rawWidth:v},popupRef:b},parent:{page:{pageNumber:S}}}=e;r=e={annotationType:Fe.INK,color:Array.from(g),thickness:v,opacity:y,paths:{points:l},boxes:null,pageIndex:S-1,rect:c.slice(0),rotation:h,id:p,deleted:!1,popupRef:b}}const o=await super.deserialize(e,t,s);return o.annotationElementId=e.id||null,o._initialData=r,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:s}=this;t.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:s}){this._drawingOptions=au.getDefaultDrawingOptions({stroke:pe.makeHexColor(...e),"stroke-width":t,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:s,rect:r}=this.serializeDraw(e),{_drawingOptions:{stroke:o,"stroke-opacity":l,"stroke-width":c}}=this,h={annotationType:Fe.INK,color:Ee._colorManager.convert(o),opacity:l,thickness:c,paths:{lines:t,points:s},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?h:this.annotationElementId&&!this.#e(h)?null:(h.id=this.annotationElementId,h)}#e(e){const{color:t,thickness:s,opacity:r,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((l,c)=>l!==t[c])||e.thickness!==s||e.opacity!==r||e.pageIndex!==o}renderAnnotationElement(e){const{points:t,rect:s}=this.serializeDraw(!1);return e.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:t}),null}}class ou extends Ee{#e=null;#t=null;#n=null;#i=null;#r=null;#s="";#l=null;#o=null;#u=!1;#c=!1;static _type="stamp";static _editorType=Fe.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#i=e.bitmapUrl,this.#r=e.bitmapFile}static initialize(e,t){Ee.initialize(e,t)}static get supportedTypes(){return He(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>`image/${t}`))}static get supportedTypesStr(){return He(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(Fe.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#d(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#u=e.isSvg),e.file&&(this.#s=e.file.name),this.#a()}#h(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:l}=e||this.copyCanvas(null,null,!0).imageData,c=await s.guess({name:"altText",request:{data:r,width:o,height:l,channels:r.length/(o*l)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const h=c.output;return await this.setGuessedAltText(h),t&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}#f(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(s=>this.#d(s,!0)).finally(()=>this.#h());return}if(this.#i){const s=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(s).then(r=>this.#d(r)).finally(()=>this.#h());return}if(this.#r){const s=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(s).then(r=>this.#d(r)).finally(()=>this.#h());return}const e=document.createElement("input");e.type="file",e.accept=ou.supportedTypesStr;const t=this._uiManager._signal;this.#n=new Promise(s=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(r)}s()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:t})}).finally(()=>this.#h()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#l?.remove(),this.#l=null,this.#o&&(clearTimeout(this.#o),this.#o=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#f();return}super.rebuild(),this.div!==null&&(this.#t&&this.#l===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#i||this.#r||this.#t)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#e?this.#a():this.#f(),this.width&&!this.annotationElementId){const[s,r]=this.parentDimensions;this.setAt(e*s,t*r,this.width*s,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#o!==null&&clearTimeout(this.#o);const e=200;this.#o=setTimeout(()=>{this.#o=null,this.#m()},e)}#a(){const{div:e}=this;let{width:t,height:s}=this.#e;const[r,o]=this.pageDimensions,l=.75;if(this.width)t=this.width*r,s=this.height*o;else if(t>l*r||s>l*o){const g=Math.min(l*r/t,l*o/s);t*=g,s*=g}const[c,h]=this.parentDimensions;this.setDims(t*c/r,s*h/o),this._uiManager.enableWaiting(!1);const p=this.#l=document.createElement("canvas");p.setAttribute("role","img"),this.addContainer(p),this.width=t/r,this.height=s/o,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#m(),this.#c||(this.parent.addUndoableEditor(this),this.#c=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&p.setAttribute("aria-label",this.#s)}copyCanvas(e,t,s=!1){e||(e=224);const{width:r,height:o}=this.#e,l=new zc;let c=this.#e,h=r,p=o,g=null;if(t){if(r>t||o>t){const G=Math.min(t/r,t/o);h=Math.floor(r*G),p=Math.floor(o*G)}g=document.createElement("canvas");const v=g.width=Math.ceil(h*l.sx),b=g.height=Math.ceil(p*l.sy);this.#u||(c=this.#p(v,b));const S=g.getContext("2d");S.filter=this._uiManager.hcmFilter;let _="white",T="#cfcfd8";this._uiManager.hcmFilter!=="none"?T="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(_="#8f8f9d",T="#42414d");const k=15,F=k*l.sx,z=k*l.sy,H=new OffscreenCanvas(F*2,z*2),$=H.getContext("2d");$.fillStyle=_,$.fillRect(0,0,F*2,z*2),$.fillStyle=T,$.fillRect(0,0,F,z),$.fillRect(F,z,F,z),S.fillStyle=S.createPattern(H,"repeat"),S.fillRect(0,0,v,b),S.drawImage(c,0,0,c.width,c.height,0,0,v,b)}let y=null;if(s){let v,b;if(l.symmetric&&c.width<e&&c.height<e)v=c.width,b=c.height;else if(c=this.#e,r>e||o>e){const T=Math.min(e/r,e/o);v=Math.floor(r*T),b=Math.floor(o*T),this.#u||(c=this.#p(v,b))}const _=new OffscreenCanvas(v,b).getContext("2d",{willReadFrequently:!0});_.drawImage(c,0,0,c.width,c.height,0,0,v,b),y={width:v,height:b,data:_.getImageData(0,0,v,b).data}}return{canvas:g,width:h,height:p,imageData:y}}#p(e,t){const{width:s,height:r}=this.#e;let o=s,l=r,c=this.#e;for(;o>2*e||l>2*t;){const h=o,p=l;o>2*e&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*t&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const g=new OffscreenCanvas(o,l);g.getContext("2d").drawImage(c,0,0,h,p,0,0,o,l),c=g.transferToImageBitmap()}return c}#m(){const[e,t]=this.parentDimensions,{width:s,height:r}=this,o=new zc,l=Math.ceil(s*e*o.sx),c=Math.ceil(r*t*o.sy),h=this.#l;if(!h||h.width===l&&h.height===c)return;h.width=l,h.height=c;const p=this.#u?this.#e:this.#p(l,c),g=h.getContext("2d");g.filter=this._uiManager.hcmFilter,g.drawImage(p,0,0,p.width,p.height,0,0,l,c)}getImageForAltText(){return this.#l}#g(e){if(e){if(this.#u){const r=this._uiManager.imageManager.getSvgUrl(this.#t);if(r)return r}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#u){const[t,s]=this.pageDimensions,r=Math.round(this.width*t*yr.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*yr.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(r,o);return l.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,r,o),l.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,s){let r=null;if(e instanceof xf){const{data:{rect:S,rotation:_,id:T,structParent:k,popupRef:F},container:z,parent:{page:{pageNumber:H}}}=e,$=z.querySelector("canvas"),G=s.imageManager.getFromCanvas(z.id,$);$.remove();const X=(await t._structTree.getAriaAttributes(`${Xc}${T}`))?.get("aria-label")||"";r=e={annotationType:Fe.STAMP,bitmapId:G.id,bitmap:G.bitmap,pageIndex:H-1,rect:S.slice(0),rotation:_,id:T,deleted:!1,accessibilityData:{decorative:!1,altText:X},isSvg:!1,structParent:k,popupRef:F}}const o=await super.deserialize(e,t,s),{rect:l,bitmap:c,bitmapUrl:h,bitmapId:p,isSvg:g,accessibilityData:y}=e;p&&s.imageManager.isValidId(p)?(o.#t=p,c&&(o.#e=c)):o.#i=h,o.#u=g;const[v,b]=o.pageDimensions;return o.width=(l[2]-l[0])/v,o.height=(l[3]-l[1])/b,o.annotationElementId=e.id||null,y&&(o.altTextData=y),o._initialData=r,o.#c=!!r,o}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:Fe.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#u,structTreeParentId:this._structTreeParentId};if(e)return s.bitmapUrl=this.#g(!0),s.accessibilityData=this.serializeAltText(!0),s;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=this.#y(s);if(c.isSame)return null;c.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,t===null)return s;t.stamps||=new Map;const l=this.#u?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:l,serialized:s}),s.bitmap=this.#g(!1);else if(this.#u){const c=t.stamps.get(this.#t);l>c.area&&(c.area=l,c.serialized.bitmap.close(),c.serialized.bitmap=this.#g(!1))}return s}#y(e){const{pageIndex:t,accessibilityData:{altText:s}}=this._initialData,r=e.pageIndex===t,o=(e.accessibilityData?.alt||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}class Si{#e;#t=!1;#n=null;#i=null;#r=null;#s=new Map;#l=!1;#o=!1;#u=!1;#c=null;#d=null;#h=null;#f=null;#a;static _initialized=!1;static#p=new Map([kt,au,ou,yt].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:r,accessibilityManager:o,annotationLayer:l,drawLayer:c,textLayer:h,viewport:p,l10n:g}){const y=[...Si.#p.values()];if(!Si._initialized){Si._initialized=!0;for(const v of y)v.initialize(g,e)}e.registerEditorTypes(y),this.#a=e,this.pageIndex=t,this.div=s,this.#e=o,this.#n=l,this.viewport=p,this.#h=h,this.drawLayer=c,this._structTree=r,this.#a.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#a.getMode()===Fe.NONE}updateToolbar(e){this.#a.updateToolbar(e)}updateMode(e=this.#a.getMode()){switch(this.#v(),e){case Fe.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Fe.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Fe.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of Si.#p.values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#h?.div}setEditingState(e){this.#a.setEditingState(e)}addCommands(e){this.#a.addCommands(e)}cleanUndoStack(e){this.#a.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#n?.div.classList.toggle("disabled",!e)}async enable(){this.#u=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of this.#s.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#a.removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!this.#n){this.#u=!1;return}const t=this.#n.getEditableAnnotations();for(const s of t){if(s.hide(),this.#a.isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const r=await this.deserialize(s);r&&(this.addOrRebuild(r),r.enableEditing())}this.#u=!1}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const r of this.#s.values())if(r.disableEditing(),!!r.annotationElementId){if(r.serialize()!==null){e.set(r.annotationElementId,r);continue}else t.set(r.annotationElementId,r);this.getEditableAnnotation(r.annotationElementId)?.show(),r.remove()}if(this.#n){const r=this.#n.getEditableAnnotations();for(const o of r){const{id:l}=o.data;if(this.#a.isDeletedAnnotationElement(l))continue;let c=t.get(l);if(c){c.resetAnnotationElement(o),c.show(!1),o.show();continue}c=e.get(l),c&&(this.#a.addChangedExistingAnnotation(c),c.renderAnnotationElement(o)&&c.show(!1)),o.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of Si.#p.values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(e){return this.#n?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#a.getActive()!==e&&this.#a.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const e=this.#a.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#m.bind(this),{signal:e}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#m(e){this.#a.unselectAll();const{target:t}=e;if(t===this.#h.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#h.div.contains(t)){const{isMac:s}=en.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#a.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),yt.startHighlighting(this,this.#a.direction==="ltr",{target:this.#h.div,x:e.x,y:e.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#a._signal}),e.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const e=this.#a.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#i?.abort(),this.#i=null}attach(e){this.#s.set(e.id,e);const{annotationElementId:t}=e;t&&this.#a.isDeletedAnnotationElement(t)&&this.#a.removeDeletedAnnotationElement(e)}detach(e){this.#s.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#a.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#a.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#a.addDeletedAnnotationElement(e.annotationElementId),Ee.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#a.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#u),this.#a.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#a._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return this.#a.getId()}get#g(){return Si.#p.get(this.#a.getMode())}combinedSignal(e){return this.#a.combinedSignal(e)}#y(e){const t=this.#g;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(e,t){this.#a.updateToolbar(e),this.#a.updateMode(e);const{offsetX:s,offsetY:r}=this.#b(),o=this.getNextId(),l=this.#y({parent:this,id:o,x:s,y:r,uiManager:this.#a,isCentered:!0,...t});l&&this.add(l)}async deserialize(e){return await Si.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#a)||null}createAndAddNewEditor(e,t,s={}){const r=this.getNextId(),o=this.#y({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:this.#a,isCentered:t,...s});return o&&this.add(o),o}#b(){const{x:e,y:t,width:s,height:r}=this.div.getBoundingClientRect(),o=Math.max(0,e),l=Math.max(0,t),c=Math.min(window.innerWidth,e+s),h=Math.min(window.innerHeight,t+r),p=(o+c)/2-e,g=(l+h)/2-t,[y,v]=this.viewport.rotation%180===0?[p,g]:[g,p];return{offsetX:y,offsetY:v}}addNewEditor(){this.createAndAddNewEditor(this.#b(),!0)}setSelected(e){this.#a.setSelected(e)}toggleSelected(e){this.#a.toggleSelected(e)}unselect(e){this.#a.unselect(e)}pointerup(e){const{isMac:t}=en.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&this.#l&&(this.#l=!1,!(this.#g?.isDrawer&&this.#g.supportMultipleDrawings))){if(!this.#t){this.#t=!0;return}if(this.#a.getMode()===Fe.STAMP){this.#a.unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(this.#a.getMode()===Fe.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}const{isMac:t}=en.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer){this.startDrawingSession(e);return}const s=this.#a.getActive();this.#t=!s||s.isEmpty()}startDrawingSession(e){if(this.div.focus(),this.#c){this.#g.startDrawing(this,this.#a,!1,e);return}this.#a.setCurrentDrawingSession(this),this.#c=new AbortController;const t=this.#a.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#d=null,this.commitOrRemove())},{signal:t}),this.#g.startDrawing(this,this.#a,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#d=t);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(e=!1){return this.#c?(this.#a.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#d=null,this.#g.endDrawing(e)):null}findNewParent(e,t,s){const r=this.#a.findParent(t,s);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const e of this.#s.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#s.clear(),this.#a.removeLayer(this)}#v(){for(const e of this.#s.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,Ps(this.div,e);for(const t of this.#a.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#a.commitOrRemove(),this.#v();const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Ps(this.div,{rotation:s}),t!==s)for(const r of this.#s.values())r.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#a.viewParameters.realScale}}class Zt{#e=null;#t=0;#n=new Map;#i=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#n.size>0)for(const t of this.#n.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return He(this,"_svgFactory",new iu)}static#r(e,[t,s,r,o]){const{style:l}=e;l.top=`${100*s}%`,l.left=`${100*t}%`,l.width=`${100*r}%`,l.height=`${100*o}%`}#s(){const e=Zt._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#l(e,t){const s=Zt._svgFactory.createElement("clipPath");e.append(s);const r=`clip_${t}`;s.setAttribute("id",r),s.setAttribute("clipPathUnits","objectBoundingBox");const o=Zt._svgFactory.createElement("use");return s.append(o),o.setAttribute("href",`#${t}`),o.classList.add("clip"),r}#o(e,t){for(const[s,r]of Object.entries(t))r===null?e.removeAttribute(s):e.setAttribute(s,r)}draw(e,t=!1,s=!1){const r=this.#t++,o=this.#s(),l=Zt._svgFactory.createElement("defs");o.append(l);const c=Zt._svgFactory.createElement("path");l.append(c);const h=`path_p${this.pageIndex}_${r}`;c.setAttribute("id",h),c.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(r,c);const p=s?this.#l(l,h):null,g=Zt._svgFactory.createElement("use");return o.append(g),g.setAttribute("href",`#${h}`),this.updateProperties(o,e),this.#n.set(r,o),{id:r,clipPathId:`url(#${p})`}}drawOutline(e,t){const s=this.#t++,r=this.#s(),o=Zt._svgFactory.createElement("defs");r.append(o);const l=Zt._svgFactory.createElement("path");o.append(l);const c=`path_p${this.pageIndex}_${s}`;l.setAttribute("id",c),l.setAttribute("vector-effect","non-scaling-stroke");let h;if(t){const y=Zt._svgFactory.createElement("mask");o.append(y),h=`mask_p${this.pageIndex}_${s}`,y.setAttribute("id",h),y.setAttribute("maskUnits","objectBoundingBox");const v=Zt._svgFactory.createElement("rect");y.append(v),v.setAttribute("width","1"),v.setAttribute("height","1"),v.setAttribute("fill","white");const b=Zt._svgFactory.createElement("use");y.append(b),b.setAttribute("href",`#${c}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const p=Zt._svgFactory.createElement("use");r.append(p),p.setAttribute("href",`#${c}`),h&&p.setAttribute("mask",`url(#${h})`);const g=p.cloneNode();return r.append(g),p.classList.add("mainOutline"),g.classList.add("secondaryOutline"),this.updateProperties(r,e),this.#n.set(s,r),s}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:s,bbox:r,rootClass:o,path:l}=t,c=typeof e=="number"?this.#n.get(e):e;if(c){if(s&&this.#o(c,s),r&&Zt.#r(c,r),o){const{classList:h}=c;for(const[p,g]of Object.entries(o))h.toggle(p,g)}if(l){const p=c.firstChild.firstChild;this.#o(p,l)}}}updateParent(e,t){if(t===this)return;const s=this.#n.get(e);s&&(t.#e.append(s),this.#n.delete(e),t.#n.set(e,s))}remove(e){this.#i.delete(e),this.#e!==null&&(this.#n.get(e).remove(),this.#n.delete(e))}destroy(){this.#e=null;for(const e of this.#n.values())e.remove();this.#n.clear(),this.#i.clear()}}globalThis.pdfjsTestingUtils={HighlightOutliner:Uc};Me.AbortException;Me.AnnotationEditorLayer;Me.AnnotationEditorParamsType;Me.AnnotationEditorType;Me.AnnotationEditorUIManager;Me.AnnotationLayer;Me.AnnotationMode;Me.ColorPicker;Me.DOMSVGFactory;Me.DrawLayer;Me.FeatureTest;var uy=Me.GlobalWorkerOptions;Me.ImageKind;Me.InvalidPDFException;Me.MissingPDFException;Me.OPS;Me.OutputScale;Me.PDFDataRangeTransport;Me.PDFDateString;Me.PDFWorker;Me.PasswordResponses;Me.PermissionFlag;Me.PixelsPerInch;Me.RenderingCancelledException;Me.TextLayer;Me.TouchManager;Me.UnexpectedResponseException;Me.Util;Me.VerbosityLevel;Me.XfaLayer;Me.build;Me.createValidAbsoluteUrl;Me.fetchData;var hy=Me.getDocument;Me.getFilenameFromUrl;Me.getPdfFilenameFromUrl;Me.getXfaPageViewport;Me.isDataScheme;Me.isPdfFile;Me.noContextMenu;Me.normalizeUnicode;Me.setLayerDimensions;Me.shadow;Me.stopEvent;Me.version;const dy="/assets/pdf.worker.min-yatZIOMy.mjs";uy.workerSrc=dy;const Ic={letter:{label:"Letter (612 x 792)",width:612,height:792},a4:{label:"A4 (595.28 x 841.89)",width:595.2756,height:841.8898},legal:{label:"Legal (612 x 1008)",width:612,height:1008},custom:{label:"Custom",width:612,height:792}};function fy(f){const[e,t,s]=Array.isArray(f)&&f.length===3?f:[0,0,0],r=l=>Math.max(0,Math.min(255,Math.round(l*255))),o=l=>l.toString(16).padStart(2,"0");return`#${o(r(e))}${o(r(t))}${o(r(s))}`}function Fc(f){if(typeof f!="string"||!f.startsWith("#")||f.length!==7&&f.length!==4)return[0,0,0];let e,t,s;f.length===4?(e=parseInt(f[1]+f[1],16),t=parseInt(f[2]+f[2],16),s=parseInt(f[3]+f[3],16)):(e=parseInt(f.slice(1,3),16),t=parseInt(f.slice(3,5),16),s=parseInt(f.slice(5,7),16));const r=o=>Math.max(0,Math.min(1,o/255));return[r(e),r(t),r(s)]}function py(f){const[e,t,s]=Array.isArray(f)&&f.length===3?f:[0,0,0],r=o=>Math.max(0,Math.min(255,Math.round(o*255)));return`rgb(${r(e)}, ${r(t)}, ${r(s)})`}function gy(f){return String(f).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Vi(f){return gy(f).replace(/\n/g,"<br>")}function xo(f){const e=document.createElement("template");return e.innerHTML=String(f??""),e.content.querySelectorAll("script,style,iframe,object,embed,link,meta").forEach(t=>t.remove()),e.content.querySelectorAll("*").forEach(t=>{[...t.attributes].forEach(s=>{const r=s.name,o=s.value;if(/^on/i.test(r)){t.removeAttribute(r);return}(r==="href"||r==="src")&&typeof o=="string"&&o.trim().toLowerCase().startsWith("javascript:")&&t.removeAttribute(r)})}),e.innerHTML}function Cf(f){return String(f).replace(/["\\]/g,"\\$&")}function aa(f){const e=String(f??"").trim();if(!e)return{family:"",weight:"",style:""};const t=/bold/i.test(e),s=/(oblique|italic)/i.test(e),r=`"${Cf(e)}"`;return e.startsWith("Helvetica")?{family:`${r}, Helvetica, Arial, sans-serif`,weight:t?"bold":"",style:s?"italic":""}:e.startsWith("Times")?{family:`${r}, "Times New Roman", Times, serif`,weight:t?"bold":"",style:s?"italic":""}:e.startsWith("Courier")?{family:`${r}, "Courier New", Courier, monospace`,weight:t?"bold":"",style:s?"italic":""}:e==="Symbol"?{family:`${r}, Symbol`,weight:"",style:""}:e==="ZapfDingbats"?{family:`${r}, "Zapf Dingbats", Wingdings, fantasy`,weight:"",style:""}:{family:r,weight:"",style:""}}const Dc=[{value:"Helvetica",label:"Helvetica (Sans-serif)"},{value:"Helvetica-Bold",label:"Helvetica Bold"},{value:"Helvetica-Oblique",label:"Helvetica Oblique"},{value:"Helvetica-BoldOblique",label:"Helvetica Bold Oblique"},{value:"Times-Roman",label:"Times Roman (Serif)"},{value:"Times-Bold",label:"Times Bold"},{value:"Times-Italic",label:"Times Italic"},{value:"Times-BoldItalic",label:"Times Bold Italic"},{value:"Courier",label:"Courier (Monospace)"},{value:"Courier-Bold",label:"Courier Bold"},{value:"Courier-Oblique",label:"Courier Oblique"},{value:"Courier-BoldOblique",label:"Courier Bold Oblique"},{value:"Symbol",label:"Symbol"},{value:"ZapfDingbats",label:"Zapf Dingbats"}],my=[8,9,10,11,12,14,16,18,20,24,28,32,36,42,48,60,72],yy=["#000000","#1f1f1f","#444444","#666666","#888888","#aaaaaa","#ffffff","#d9534f","#f0ad4e","#ffd166","#5cb85c","#28a745","#20c997","#17a2b8","#1f9fff","#0d6efd","#6f42c1","#e83e8c","#ff6b6b","#ffa94d","#74c0fc"];function Eo(){return Math.random().toString(36).slice(2,10)}function ur(f,e,t){const s=Math.max(0,Math.min(f.x,e-1)),r=Math.max(0,Math.min(f.y,t-1)),o=Math.max(8,Math.min(f.w,e-s)),l=Math.max(8,Math.min(f.h,t-r));return{...f,x:s,y:r,w:o,h:l}}function vy(f,e,t){if(!f||!e||!t)return t;const s=f.length*t*.56;return s<=e?t:Math.max(8,e/s*t)}function Yd(f,e,t=null){const s=String(f??"").trim()||"field",r=new Set(e.filter(l=>l.id!==t).map(l=>String(l.name??"").trim()));if(!r.has(s))return s;let o=2;for(;r.has(`${s}_${o}`);)o+=1;return`${s}_${o}`}function wy(f){if(!f)return"";if(typeof f=="string")return f;if(typeof f=="object"){const e=[];if(f.message&&e.push(f.message),f.stderr){const t=String(f.stderr).trim();t&&e.push(`stderr: ${t}`)}if(f.stdout){const t=String(f.stdout).trim();t&&e.push(`stdout: ${t}`)}if(e.length>0)return e.join(" | ");try{return JSON.stringify(f)}catch{return String(f)}}return String(f)}function by(f,e){if(!f)return e;const t=f.match(/filename\*?=(?:UTF-8''|")?([^";\r\n]+)/i);if(!t?.[1])return e;const s=t[1].trim().replace(/"$/,"");try{return decodeURIComponent(s)}catch{return s}}async function Ay(f,e){if(f.name.split(".").pop()?.toLowerCase()==="pdf"){const o=await f.arrayBuffer(),c=await(await hy({data:o}).promise).getPage(1),h=c.getViewport({scale:1}),g=c.getViewport({scale:1.5}),y=document.createElement("canvas"),v=y.getContext("2d");return y.width=Math.floor(g.width),y.height=Math.floor(g.height),await c.render({canvasContext:v,viewport:g}).promise,{src:y.toDataURL("image/png"),displayWidth:y.width,displayHeight:y.height,pageWidthPt:h.width,pageHeightPt:h.height,name:f.name}}const s=URL.createObjectURL(f),r=await new Promise((o,l)=>{const c=new Image;c.onload=()=>o(c),c.onerror=l,c.src=s});return{src:s,displayWidth:r.naturalWidth,displayHeight:r.naturalHeight,pageWidthPt:e.width,pageHeightPt:e.height,name:f.name}}function Sy(){const f=he.useRef(null),e=he.useRef(null),[t,s]=he.useState("dark"),[r,o]=he.useState(1),[l,c]=he.useState(null),[h,p]=he.useState([]),[g,y]=he.useState(null),[v,b]=he.useState([]),[S,_]=he.useState({}),[T,k]=he.useState({}),[F,z]=he.useState(!1),[H,$]=he.useState([]),[G,X]=he.useState(""),[ie,de]=he.useState("fields.json"),[K,ke]=he.useState(null),[Re,Be]=he.useState({fieldLayouts:!0,dataSource:!0,fontManager:!0,generate:!0,fields:!0,selectedField:!0,preview:!0}),[Ne,Qe]=he.useState("letter"),[J,ee]=he.useState({width:612,height:792}),[U,re]=he.useState([]),[Y,M]=he.useState(null),[B,ae]=he.useState([]),[ye,ve]=he.useState(null),[Ae,ge]=he.useState(!1),[me,We]=he.useState(null),[ht,jt]=he.useState({}),[_i,Lt]=he.useState({}),[Ke,Xt]=he.useState(!1),tt=he.useRef({name:null,html:"",text:""}),wt=he.useRef(null),Ns=he.useRef(!1),[qe,ai]=he.useState(null),[xi,Ki]=he.useState([]),[vr,Oe]=he.useState(""),[oi,ya]=he.useState(null),[tn,Qi]=he.useState(null),[Ls,Rn]=he.useState(!1),[li,wn]=he.useState(""),[Is,Zi]=he.useState(!1),[wr,Mn]=he.useState(null),[Ji,Ei]=he.useState(!1),[es,Nn]=he.useState(""),[ci,qt]=he.useState(""),[ts,Vn]=he.useState(!1),[ns,Ci]=he.useState(!1),[is,ui]=he.useState(!1),[ss,Ln]=he.useState(!1),[_t,nn]=he.useState({row:0,output_mode:"full_pdf",dx:0,dy:0,grid_step:0,page_size:"letter",generate_all:!1}),$o=he.useMemo(()=>Ne==="custom"?{width:Number(J.width)||612,height:Number(J.height)||792}:{width:Ic[Ne].width,height:Ic[Ne].height},[Ne,J]),Z=U.find(w=>w.id===Y)??null,gt=B.find(w=>w.id===ye)??null,Wn=he.useMemo(()=>new Set([...Dc.map(w=>w.value),...h.map(w=>w.name)]),[h]),rs=he.useMemo(()=>{const w=h.filter(E=>!Dc.some(R=>R.value===E.name));return{builtIn:Dc,custom:w}},[h]);he.useEffect(()=>{if(!Ke||!Z?.name){tt.current={name:null,html:"",text:""},wt.current=null;return}const w=Z.name,E=ht[w]??`{${w}}`,R=_i[w]??Vi(E);tt.current={name:w,html:R,text:E},wt.current=null},[Ke,Y]),he.useEffect(()=>{Y||(wn(""),qt(""),Rn(!1),Mn(null),Zi(!1),Nn(""),Ei(!1))},[Y]),he.useEffect(()=>{if(!Ke||!Z?.id)return;const w=()=>{const E=window.getSelection();if(!E||E.rangeCount===0)return;const R=document.querySelector('.field-box.active .field-preview[contenteditable="true"]');if(!R)return;const I=E.getRangeAt(0);I&&!I.collapsed&&R.contains(I.startContainer)&&R.contains(I.endContainer)&&(wt.current=I.cloneRange())};return document.addEventListener("selectionchange",w),()=>document.removeEventListener("selectionchange",w)},[Ke,Y]);const Uo=async w=>{if(!w){b([]),_({});return}try{const R=(await w.text()).split(`
`);if(R.length===0){b([]),_({});return}const j=R[0].trim().split(",").map(te=>te.trim().replace(/^"|"$/g,""));if(b(j),R.length>1){const te=R[1].trim();if(te){const Te=te.split(",").map(Ce=>Ce.trim().replace(/^"|"$/g,"")),_e={};j.forEach((Ce,je)=>{_e[Ce]=Te[je]||""}),_(_e)}}}catch(E){Oe(`Failed to parse CSV: ${E.message}`),b([]),_({})}},Vo=async w=>{const E=w.target.files?.[0]??null;y(E),E?await Uo(E):(b([]),_({}),k({}))},Wo=(w,E)=>{k(R=>({...R,[w]:E})),E&&Z?.name===w&&(Yt(),Xt(!1)),E&&S[E]&&(jt(R=>({...R,[w]:S[E]})),Lt(R=>{if(!Object.prototype.hasOwnProperty.call(R,w))return R;const I={...R};return delete I[w],I}))},zt=w=>{Be(E=>({...E,[w]:!E[w]}))},ki=w=>{w.stopPropagation()},Fs=async()=>{try{const w=await fetch("/api/fields/list");if(!w.ok){Oe("Failed to load fields list.");return}const E=await w.json(),R=Array.isArray(E?.files)?E.files:[];$(R),G&&!R.includes(G)&&X(""),R.length>0&&(!ie||!ie.trim())&&de(R[0])}catch(w){Oe(`Failed to load fields list: ${w}`)}};he.useEffect(()=>{Fs(),br()},[]),he.useEffect(()=>{const w="custom-font-face-rules",E=document.getElementById(w);if(E&&E.remove(),!h.length)return;const R=h.map(j=>{const te=Cf(j.name),Te=encodeURIComponent(j.file),_e=j.type==="otf"?"opentype":"truetype";return`@font-face{font-family:"${te}";src:url("/api/font-file/${Te}") format("${_e}");font-display:swap;}`}),I=document.createElement("style");return I.id=w,I.textContent=R.join(`
`),document.head.appendChild(I),()=>{const j=document.getElementById(w);j&&j.remove()}},[h]);const br=async()=>{try{const w=await fetch("/api/list-custom-fonts");if(!w.ok){console.error("Failed to fetch custom fonts");return}const E=await w.json();p(E.custom_fonts||[])}catch(w){console.error("Error fetching custom fonts:",w)}},va=async w=>{const E=new FormData;E.append("font_file",w);try{const R=await fetch("/api/upload-font",{method:"POST",body:E});if(!R.ok){const j=await R.json();return Oe(`Failed to upload font: ${j.detail||"Unknown error"}`),!1}const I=await R.json();return Oe(`Font "${I.font_name}" uploaded successfully!`),await br(),!0}catch(R){return Oe(`Error uploading font: ${R.message}`),!1}},wa=async w=>{if(confirm(`Delete font "${w}"? This cannot be undone.`))try{const E=await fetch(`/api/delete-font/${encodeURIComponent(w)}`,{method:"DELETE"});if(!E.ok){const I=await E.json();return Oe(`Failed to delete font: ${I.detail||"Unknown error"}`),!1}const R=await E.json();return Oe(R.message),await br(),!0}catch(E){return Oe(`Error deleting font: ${E.message}`),!1}};he.useEffect(()=>{const w=E=>{const R=E.target.closest(".menu-button"),I=E.target.closest(".dropdown-menu"),j=E.target.closest(".font-picker"),te=E.target.closest(".size-picker"),Te=E.target.closest(".color-picker");ts&&!R?.textContent?.includes("Insert")&&!I&&Vn(!1),ns&&!R?.textContent?.includes("Layouts")&&!I&&Ci(!1),is&&!R?.textContent?.includes("Generate")&&!I&&ui(!1),ss&&!R?.textContent?.includes("Fonts")&&!I&&Ln(!1),Ls&&!j&&(Rn(!1),wn("")),Is&&!te&&(Zi(!1),Mn(null)),Ji&&!Te&&(Ei(!1),Nn(""))};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[ts,ns,is,ss,Ls,Is,Ji]),he.useEffect(()=>{const w=document.documentElement.classList;t==="dark"?w.add("theme-dark"):w.remove("theme-dark")},[t]);const Ye=he.useMemo(()=>K?{x:K.pageWidthPt/K.displayWidth,y:K.pageHeightPt/K.displayHeight}:null,[K]),Ds=()=>!K||!Ye?null:{page:0,default_font:"Helvetica",default_size:18,fields:U.map(w=>{const E=w.x*Ye.x,R=(w.x+w.w)*Ye.x,I=(K.displayHeight-w.y)*Ye.y,j=w.w*Ye.x,te=Number(w.size),Te=I-te;let _e=w.font||"Helvetica";if(w.bold||w.italic){const je=_e.replace(/-Bold|-Italic|-Oblique|-BoldOblique|-BoldItalic/g,"");je==="Helvetica"?_e=w.bold&&w.italic?"Helvetica-BoldOblique":w.bold?"Helvetica-Bold":w.italic?"Helvetica-Oblique":"Helvetica":je==="Times"||je==="Times-Roman"?_e=w.bold&&w.italic?"Times-BoldItalic":w.bold?"Times-Bold":w.italic?"Times-Italic":"Times-Roman":je==="Courier"&&(_e=w.bold&&w.italic?"Courier-BoldOblique":w.bold?"Courier-Bold":w.italic?"Courier-Oblique":"Courier")}const Ce={name:w.name,x:w.align==="center"?(E+R)/2:w.align==="right"?R:E,y:Te,font:_e,bold:!!w.bold,italic:!!w.italic,size:te,align:w.align,color:w.color};return w.maxWidth&&(Ce.max_width=j),Ce.wrap_start_y=I,Ce.box_width=j,Ce.box_height=w.h*Ye.y,w.wrapText&&(Ce.wrap_text=!0,Ce.wrap_width=j),Ce}),images:B.map(w=>{const E=w.w*Ye.x,R=w.h*Ye.y,j=(K.displayHeight-w.y)*Ye.y-R;return{id:w.id,name:w.name,x:w.x*Ye.x,y:j,w:E,h:R,src:w.src}}),layout_state:{sample_values:ht,sample_html_values:_i,field_mappings:T,use_csv:F,generate_options:_t}},ba=w=>{if(Ke&&tt.current.name===w){const I=tt.current.text??"",j=xo(tt.current.html??Vi(I));return{text:I,html:j}}const E=ht[w]??"",R=xo(_i[w]??Vi(E));return{text:E,html:R}},Go=()=>{const w={};return U.forEach(E=>{E.name&&(w[E.name]=ba(E.name))}),w},ot=w=>{if(!K||!Ye||!w||!Array.isArray(w.fields))return{fields:[],images:[],layoutState:null};const E=w.fields.map((j,te)=>{const Te=j.align??"left",Ce=Number(j.box_width??j.max_width??150)/Ye.x,je=Number(j.size??w.default_size??18),Se=Math.max(24,je*1.6/K.pageHeightPt*K.displayHeight*Ye.y),st=Number(j.box_height??Se),Le=Math.max(8,st/Ye.y),Ge=Number(j.x)/Ye.x,nt=Number(j.wrap_start_y),se=Number(j.y),Ie=Number.isFinite(nt)?nt:Number.isFinite(se)?se+je:K.pageHeightPt;let Pt=Ge;Te==="center"?Pt=Ge-Ce/2:Te==="right"&&(Pt=Ge-Ce);const It=K.displayHeight-Ie/Ye.y,Ft=j.font??w.default_font??"Helvetica";let Je=Ft,Zn=!1,In=!1;Ft.includes("Bold")&&(Zn=!0),(Ft.includes("Oblique")||Ft.includes("Italic"))&&(In=!0),typeof j.bold=="boolean"&&(Zn=j.bold),typeof j.italic=="boolean"&&(In=j.italic),Ft.startsWith("Helvetica")?Je="Helvetica":Ft.startsWith("Times")?Je="Times-Roman":Ft.startsWith("Courier")&&(Je="Courier");const hs=Wn.has(Je)?Je:Wn.has(Ft)?Ft:"Helvetica";return ur({id:Eo(),name:j.name??`field_${te+1}`,x:Pt,y:It,w:Ce,h:Le,align:Te,font:hs,size:je,color:Array.isArray(j.color)?j.color:[0,0,0],maxWidth:j.max_width!==void 0,wrapText:j.wrap_text!==!1,bold:Zn,italic:In},K.displayWidth,K.displayHeight)}),R=Array.isArray(w.images)?w.images.map((j,te)=>{const Te=Number(j.w??0),_e=Number(j.h??0),Ce=Number(j.x??0),je=Number(j.y??0),Se=typeof j.src=="string"?j.src:"";if(!Se||!Number.isFinite(Te)||!Number.isFinite(_e)||Te<=0||_e<=0)return null;const st=Math.max(8,Te/Ye.x),Le=Math.max(8,_e/Ye.y),Ge=Ce/Ye.x,nt=je+_e,se=K.displayHeight-nt/Ye.y;return ur({id:j.id??Eo(),name:j.name??`image_${te+1}`,x:Ge,y:se,w:st,h:Le,src:Se},K.displayWidth,K.displayHeight)}).filter(Boolean):[],I=w.layout_state&&typeof w.layout_state=="object"?w.layout_state:null;return{fields:E,images:R,layoutState:I}},Xo=w=>new Promise((E,R)=>{const I=new FileReader;I.onload=()=>E(String(I.result||"")),I.onerror=()=>R(new Error("Failed to read image file.")),I.readAsDataURL(w)}),Ar=w=>new Promise((E,R)=>{const I=new Image;I.onload=()=>E({width:I.naturalWidth,height:I.naturalHeight}),I.onerror=()=>R(new Error("Failed to load image.")),I.src=w}),Aa=async w=>{if(!K){Oe("Load a template before importing an image."),w.target.value="";return}const E=w.target.files?.[0];if(E)try{const R=await Xo(E),I=await Ar(R),j=Math.min(260,K.displayWidth*.4),te=Math.min(120,K.displayHeight*.25),Te=Math.min(1,j/Math.max(1,I.width),te/Math.max(1,I.height)),_e={id:Eo(),name:E.name.replace(/\.[^.]+$/,"")||`image_${B.length+1}`,x:24,y:24,w:Math.max(16,I.width*Te),h:Math.max(16,I.height*Te),src:R};ae(Ce=>[...Ce,ur(_e,K.displayWidth,K.displayHeight)]),Yt(),ve(_e.id),M(null),Xt(!1),Oe(`Imported image: ${E.name}`)}catch(R){Oe(`Failed to import image: ${R.message}`)}finally{w.target.value=""}},Os=async w=>{const[E]=w.target.files??[];if(!E)return;const R=await Ay(E,$o);if(ke(R),c(E),re([]),ae([]),M(null),ve(null),jt({}),Lt({}),Oe(`Loaded template: ${R.name}`),E.name.toLowerCase().endsWith(".pdf"))try{const I=new FormData;I.append("template",E);const j=await fetch("/api/extract-fonts",{method:"POST",body:I});if(j.ok){const te=await j.json();Oe(`Loaded template: ${R.name} (${te.fonts?.length||0} fonts detected)`)}}catch(I){console.error("Failed to extract fonts:",I)}},as=w=>{const E=f.current.getBoundingClientRect();return{x:(w.clientX-E.left)/r,y:(w.clientY-E.top)/r}},js=w=>{const E=String(w??"").trim();if(!E)return;const R=tt.current.name===E,I=R?tt.current.text??"":ht[E]??"",j=xo(R?tt.current.html??Vi(I):_i[E]??Vi(I));jt(te=>te[E]===I?te:{...te,[E]:I}),Lt(te=>te[E]===j?te:{...te,[E]:j}),R&&(tt.current={name:E,html:j,text:I})},Yt=()=>{if(!Ke)return;const w=tt.current.name;if(w){js(w);return}Z?.name&&js(Z.name)},bn=w=>{if(!K||qe)return;w.target.closest(".field-box")||(Yt(),Xt(!1),M(null),ve(null));const R=as(w);ge(!0),We({startX:R.x,startY:R.y,x:R.x,y:R.y,w:1,h:1})},Sa=(w,E,R="field")=>{w.preventDefault(),w.stopPropagation();const I=as(w),j=R==="image"?B.find(te=>te.id===E):U.find(te=>te.id===E);j&&(Yt(),R==="image"?(ve(E),M(null)):(M(E),ve(null)),Xt(!1),ai({mode:"move",targetType:R,targetId:E,startX:I.x,startY:I.y,initial:j}))},Ze=(w,E,R,I="field")=>{w.preventDefault(),w.stopPropagation();const j=as(w),te=I==="image"?B.find(Te=>Te.id===E):U.find(Te=>Te.id===E);te&&(Yt(),Xt(!1),I==="image"?(ve(E),M(null)):(M(E),ve(null)),ai({mode:"resize",targetType:I,targetId:E,startX:j.x,startY:j.y,initial:te,direction:R}))},hi=()=>document.querySelector(".field-box.active .field-preview"),di=(w,E)=>{if(!w||!E||E.rangeCount===0)return!1;const R=E.getRangeAt(0);return w.contains(R.startContainer)&&w.contains(R.endContainer)},qo=()=>{const w=hi(),E=window.getSelection();!w||!E||E.rangeCount===0||E.isCollapsed||di(w,E)&&(wt.current=E.getRangeAt(0).cloneRange())},zs=(w,E,R)=>{if(!w||!E||E.collapsed)return!1;const I=String(R??"").trim();if(!I)return!1;const j=aa(I),te=document.createElement("span");te.style.fontFamily=j.family||I,j.weight&&(te.style.fontWeight=j.weight),j.style&&(te.style.fontStyle=j.style);try{const Te=E.extractContents();te.appendChild(Te),E.insertNode(te);const _e=window.getSelection();if(_e){const Ce=document.createRange();Ce.selectNodeContents(te),_e.removeAllRanges(),_e.addRange(Ce),wt.current=Ce.cloneRange()}return!0}catch{return!1}},os=(w,E=null)=>{const R=hi();if(!R||!Z?.name||!R.isContentEditable)return!1;const I=window.getSelection(),j=!!I&&!I.isCollapsed&&di(R,I),te=!!(wt.current&&!wt.current.collapsed);if(!j&&!te)return!1;if(!j&&te){R.focus();const Se=window.getSelection();if(Se){Se.removeAllRanges();try{Se.addRange(wt.current)}catch{return!1}}}const Te=window.getSelection();if(!Te||Te.isCollapsed||!di(R,Te))return!1;const _e=R.innerHTML;let Ce=!1;if(w==="fontName"&&typeof E=="string"&&E.trim())Ce=zs(R,Te.getRangeAt(0),E);else{try{document.execCommand("styleWithCSS",!1,!0)}catch{}Ce=document.execCommand(w,!1,E),!Ce&&R.innerHTML!==_e&&(Ce=!0)}if(!Ce)return!1;tt.current={name:Z.name,html:R.innerHTML,text:R.innerText};const je=window.getSelection();return je&&je.rangeCount>0&&(wt.current=je.getRangeAt(0).cloneRange()),!0},Gn=w=>{if(Z&&(Tt(Z.id,w),Lt(E=>{if(!Object.prototype.hasOwnProperty.call(E,Z.name))return E;const R={...E};return delete R[Z.name],R}),tt.current.name===Z.name)){const E=tt.current.text??"";tt.current={name:Z.name,text:E,html:Vi(E)};const R=hi();R&&R.isContentEditable&&(R.innerHTML=tt.current.html)}},Xn=(w,E)=>{if(!Z)return;const R=hi();if(!!R&&(Ke||R.isContentEditable)){os(w)||Gn({[E]:!Z[E]});return}Gn({[E]:!Z[E]})},Ti=({command:w,value:E=null,fieldPatch:R,requireSelection:I=!1,selectionMessage:j=null})=>{if(!Z)return;const te=hi();if(!!te&&(Ke||te.isContentEditable)){const _e=window.getSelection(),Ce=!!_e&&!_e.isCollapsed&&di(te,_e),je=!!(wt.current&&!wt.current.collapsed);if((Ce||je||!I)&&os(w,E))return;if(I&&j){Oe(j);return}Gn(R);return}Gn(R)},Yo=w=>{if(!(w instanceof HTMLElement))return!1;if(w.isContentEditable||w.closest('[contenteditable="true"]'))return!0;const E=w.tagName;return E==="INPUT"||E==="TEXTAREA"||E==="SELECT"};he.useEffect(()=>{const w=E=>{const R=E.target,I=Yo(R),j=E.ctrlKey||E.metaKey;if(E.key==="Escape"&&Ke){E.preventDefault(),Yt(),wt.current=null,Xt(!1);return}if(j&&!E.altKey){const Ce=E.key.toLowerCase();if(Ce==="b"){Z&&(E.preventDefault(),Xn("bold","bold"));return}if(Ce==="i"){Z&&(E.preventDefault(),Xn("italic","italic"));return}if(Ce==="u"){const je=hi();Z&&je&&(Ke||je.isContentEditable)&&(E.preventDefault(),Ti({command:"underline",fieldPatch:{},requireSelection:!0,selectionMessage:"Select text in the field to underline."}));return}}if(I)return;if((E.key==="Delete"||E.key==="Backspace")&&!Ke){if(Y){E.preventDefault(),xr(Y);return}ye&&(E.preventDefault(),Er(ye));return}if(Ke)return;const te=E.shiftKey?10:1;let Te=0,_e=0;switch(E.key){case"ArrowLeft":Te=-te;break;case"ArrowRight":Te=te;break;case"ArrowUp":_e=-te;break;case"ArrowDown":_e=te;break;default:return}if(Y&&Z){E.preventDefault(),Tt(Y,{x:Z.x+Te,y:Z.y+_e});return}ye&&gt&&(E.preventDefault(),An(ye,{x:gt.x+Te,y:gt.y+_e}))};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[Ke,Z,gt,Y,ye,Ti,Xn]);const Sr=w=>{if(!w)return"";const E=String(w).split(",")[0].replace(/^['"]+|['"]+$/g,"").trim();if(!E)return"";const R=[...Wn].find(j=>j===E);return R||[...Wn].find(j=>j.toLowerCase()===E.toLowerCase())||""},_r=()=>{if(!Ke||!Z){qt("");return}const w=hi();if(!w||!w.isContentEditable){qt("");return}const E=window.getSelection();if(!(!!E&&E.rangeCount>0&&di(w,E))){qt("");return}const I=Sr(document.queryCommandValue("fontName"));qt(I||"")};he.useEffect(()=>{if(!Ke||!Z){qt("");return}const w=()=>_r();return document.addEventListener("selectionchange",w),document.addEventListener("keyup",w),setTimeout(_r,0),()=>{document.removeEventListener("selectionchange",w),document.removeEventListener("keyup",w)}},[Ke,Y,Wn]);const qn=li||(Ke&&ci?ci:Z?.font||"Helvetica"),ls=wr??Number(Z?.size??18),cs=es||(Z?fy(Z.color):"#000000"),Pi=!!Z&&F&&!!T[Z.name],Ue=w=>{if(!K)return;if(qe){const Te=as(w),_e=Te.x-qe.startX,Ce=Te.y-qe.startY;if(qe.mode==="move"){const je=qe.initial.x+_e,Se=qe.initial.y+Ce;if(qe.targetType==="image"){An(qe.targetId,{x:je,y:Se}),Ki([]);return}Tt(qe.targetId,{x:je,y:Se});const st=[],Le=5,Ge=U.find(nt=>nt.id===qe.targetId);if(Ge){const nt=je+Ge.w/2,se=Se+Ge.h/2,Ie=je,Pt=je+Ge.w,It=Se,Ft=Se+Ge.h;U.forEach(Je=>{if(Je.id===qe.targetId)return;const Zn=Je.x+Je.w/2,In=Je.y+Je.h/2,hs=Je.x,ds=Je.x+Je.w,fs=Je.y,kr=Je.y+Je.h;Math.abs(Ie-hs)<Le&&st.push({type:"vertical",x:hs}),Math.abs(Pt-ds)<Le&&st.push({type:"vertical",x:ds}),Math.abs(nt-Zn)<Le&&st.push({type:"vertical",x:Zn}),Math.abs(It-fs)<Le&&st.push({type:"horizontal",y:fs}),Math.abs(Ft-kr)<Le&&st.push({type:"horizontal",y:kr}),Math.abs(se-In)<Le&&st.push({type:"horizontal",y:In})})}Ki(st)}else if(qe.mode==="resize"){const je=qe.direction,Se={...qe.initial};je.includes("e")?Se.w=qe.initial.w+_e:je.includes("w")&&(Se.x=qe.initial.x+_e,Se.w=qe.initial.w-_e),je.includes("s")?Se.h=qe.initial.h+Ce:je.includes("n")&&(Se.y=qe.initial.y+Ce,Se.h=qe.initial.h-Ce),Se.w<0&&(Se.x+=Se.w,Se.w=Math.abs(Se.w)),Se.h<0&&(Se.y+=Se.h,Se.h=Math.abs(Se.h)),qe.targetType==="image"?An(qe.targetId,Se):Tt(qe.targetId,Se)}return}if(!Ae||!me)return;const E=as(w),R=Math.min(me.startX,E.x),I=Math.min(me.startY,E.y),j=Math.abs(E.x-me.startX),te=Math.abs(E.y-me.startY);We({...me,x:R,y:I,w:j,h:te})},Hs=()=>{if(qe){ai(null),Ki([]);return}if(!K||!me){ge(!1);return}if(ge(!1),me.w<8||me.h<8){We(null);return}const w={id:Eo(),name:Yd(`field_${U.length+1}`,U),x:me.x,y:me.y,w:me.w,h:me.h,align:"left",font:"Helvetica",size:18,color:[0,0,0],maxWidth:!1,wrapText:!0,bold:!1,italic:!1};re(E=>[...E,ur(w,K.displayWidth,K.displayHeight)]),M(w.id),We(null)};he.useEffect(()=>{if(!qe&&!Ae)return;const w=R=>{f.current&&Ue(R)},E=()=>{Hs()};return window.addEventListener("mousemove",w),window.addEventListener("mouseup",E),()=>{window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",E)}},[qe,Ae,Ue,Hs]);const Tt=(w,E)=>{if(K){if(E.name!==void 0){const R=U.find(I=>I.id===w);R&&(E={...E,name:Yd(E.name,U,w)}),R&&R.name!==E.name&&T[R.name]&&k(I=>{const j={...I};return j[E.name]=j[R.name],delete j[R.name],j}),R&&R.name!==E.name&&(jt(I=>{if(!Object.prototype.hasOwnProperty.call(I,R.name))return I;const j={...I};return Object.prototype.hasOwnProperty.call(j,E.name)||(j[E.name]=j[R.name]),delete j[R.name],j}),Lt(I=>{if(!Object.prototype.hasOwnProperty.call(I,R.name))return I;const j={...I};return Object.prototype.hasOwnProperty.call(j,E.name)||(j[E.name]=j[R.name]),delete j[R.name],j}))}re(R=>R.map(I=>I.id!==w?I:ur({...I,...E},K.displayWidth,K.displayHeight)))}},An=(w,E)=>{K&&ae(R=>R.map(I=>I.id!==w?I:ur({...I,...E},K.displayWidth,K.displayHeight)))},xr=w=>{const E=U.find(R=>R.id===w);re(R=>R.filter(I=>I.id!==w)),Y===w&&M(null),E&&T[E.name]&&k(R=>{const I={...R};return delete I[E.name],I})},Er=w=>{ae(E=>E.filter(R=>R.id!==w)),ye===w&&ve(null)},_a=()=>{const w=Ds();if(!w)return;const E=new Blob([JSON.stringify(w,null,2)],{type:"application/json"}),R=URL.createObjectURL(E),I=document.createElement("a");I.href=R,I.download="fields.json",I.click(),URL.revokeObjectURL(R)},Cr=async()=>{const w=Ds();if(!w){Oe("Load a template and create fields first.");return}const E=ie?.trim()||"fields.json";if(!(await fetch(`/api/fields?name=${encodeURIComponent(E)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)})).ok){Oe(`Failed to save ${E} to backend.`);return}Oe(`Saved ${E} on backend.`),Fs()},Bs=async()=>{if(!K){Oe("Load template first so coordinates can be mapped to canvas.");return}const w=G?.trim()||"fields.json";if(!G?.trim()){Oe("Select a backend fields file first.");return}const E=await fetch(`/api/fields?name=${encodeURIComponent(w)}`);if(!E.ok){Oe(`Failed to load backend ${w}.`);return}const R=await E.json(),I=ot(R);re(I.fields),ae(I.images),M(I.fields[0]?.id??null),ve(null),I.layoutState?(jt(I.layoutState.sample_values&&typeof I.layoutState.sample_values=="object"?I.layoutState.sample_values:{}),Lt(I.layoutState.sample_html_values&&typeof I.layoutState.sample_html_values=="object"?I.layoutState.sample_html_values:{}),k(I.layoutState.field_mappings&&typeof I.layoutState.field_mappings=="object"?I.layoutState.field_mappings:{}),z(!!I.layoutState.use_csv),I.layoutState.generate_options&&typeof I.layoutState.generate_options=="object"&&nn(j=>({...j,...I.layoutState.generate_options}))):(jt({}),Lt({}),k({}),z(!1)),Oe(`Loaded ${w} from backend.`)},Yn=async w=>{if(!K){Oe("Load template first so coordinates can be mapped to canvas.");return}const[E]=w.target.files??[];if(E)try{const R=await E.text(),I=JSON.parse(R),j=ot(I);re(j.fields),ae(j.images),M(j.fields[0]?.id??null),ve(null),j.layoutState?(jt(j.layoutState.sample_values&&typeof j.layoutState.sample_values=="object"?j.layoutState.sample_values:{}),Lt(j.layoutState.sample_html_values&&typeof j.layoutState.sample_html_values=="object"?j.layoutState.sample_html_values:{}),k(j.layoutState.field_mappings&&typeof j.layoutState.field_mappings=="object"?j.layoutState.field_mappings:{}),z(!!j.layoutState.use_csv),j.layoutState.generate_options&&typeof j.layoutState.generate_options=="object"&&nn(te=>({...te,...j.layoutState.generate_options}))):(jt({}),Lt({}),k({}),z(!1)),Oe(`Loaded ${E.name} from disk.`)}catch(R){Oe(`Failed to load fields file: ${R}`)}},Kn=w=>{let E=w.name;if(!E){const j=window.prompt("Enter a field name:","");if(!j||(E=j.trim(),!E))return;Tt(w.id,{name:E})}const R=ht[E]??"",I=window.prompt(`Enter value for ${E}:`,R);I!==null&&(jt(j=>({...j,[E]:I})),Lt(j=>{if(!Object.prototype.hasOwnProperty.call(j,E))return j;const te={...j};return delete te[E],te}))},Qn=async()=>{if(!l){Oe("Upload a template first.");return}const w=Ds();if(!w){Oe("Create fields before generating a PDF.");return}if(F&&!g){Oe("Upload a CSV file or turn off CSV mode.");return}const E={..._t,row:Number(_t.row)||0,dx:Number(_t.dx)||0,dy:Number(_t.dy)||0,grid_step:Number(_t.grid_step)||0,overlay_only:_t.output_mode==="overlay_only"},R=new FormData;if(R.append("template",l),R.append("fields_json",JSON.stringify(w)),R.append("row",String(E.row)),R.append("page_size",E.page_size),R.append("dx",String(E.dx)),R.append("dy",String(E.dy)),R.append("grid_step",String(E.grid_step)),R.append("placeholder_mode",String(!1)),R.append("overlay_only",String(E.overlay_only)),F){R.append("csv_file",g);const Le={};Object.entries(T).forEach(([nt,se])=>{se&&(Le[nt]=se)}),R.append("field_mappings_json",JSON.stringify(Le));const Ge={};U.forEach(nt=>{if(!T[nt.name]){const{text:se,html:Ie}=ba(nt.name);se&&(Ge[nt.name]={text:se,html:Ie})}}),R.append("fixed_values_json",JSON.stringify(Ge)),R.append("batch",String(_t.generate_all))}else R.append("data_json",JSON.stringify(Go()));let I;try{I=await fetch("/api/generate-file-upload",{method:"POST",body:R})}catch(Le){Oe(`Failed to reach server: ${Le}`);return}if(!I.ok){let Le="";const Ge=I.headers.get("content-type")||"";try{if(Ge.includes("application/json")){const se=await I.json();Le=wy(se?.detail??se)}else Le=await I.text()}catch{Le=`HTTP ${I.status}`}const nt=Le?` ${Le}`:"";Oe(`Failed to generate PDF. HTTP ${I.status}.${nt}`);return}const j=I.clone(),te=I.headers.get("content-type")||"n/a",Te=I.headers.get("content-disposition")||"",_e=await I.arrayBuffer();if(!_e||_e.byteLength===0){let Le="";try{Le=await j.text()}catch{Le=""}const Ge=I.headers.get("content-length")||"n/a",nt=Le?` ${Le}`:"";Oe(`Generated file is empty. HTTP ${I.status} content-length=${Ge} content-type=${te}.${nt}`);return}const Ce=te.includes("application/zip")||te.includes("application/x-zip-compressed")||/\.zip/i.test(Te);if(F&&_t.generate_all&&Ce){const Le=new Blob([_e],{type:"application/zip"}),Ge=URL.createObjectURL(Le),nt=by(Te,"certificates.zip");tn?.url&&URL.revokeObjectURL(tn.url),Qi({url:Ge,filename:nt,kind:"zip"});const se=document.createElement("a");se.href=Ge,se.download=nt,document.body.appendChild(se),se.click(),se.remove(),Oe("Downloaded ZIP file containing all certificates.");return}if(!te.includes("application/pdf")){let Le="";try{Le=await j.text()}catch{Le=""}const Ge=Le?` ${Le}`:"";Oe(`Unexpected response type: ${te}. ${Ge}`);return}const je=new Blob([_e],{type:"application/pdf"}),Se=URL.createObjectURL(je);tn?.url&&URL.revokeObjectURL(tn.url),Qi({url:Se,filename:"certificate.pdf",kind:"pdf"}),oi&&URL.revokeObjectURL(oi);const st=URL.createObjectURL(je);ya(st),Be(Le=>({...Le,preview:!0})),Oe("Generated PDF preview. Use Download PDF to save it.")},us=()=>{if(!tn?.url){Oe("Generate a file first, then download.");return}const w=document.createElement("a");w.href=tn.url,w.download=tn.filename,document.body.appendChild(w),w.click(),w.remove(),Oe(tn.kind==="zip"?"Downloaded ZIP file containing all certificates.":"Downloaded the latest generated certificate.")};return x.jsxs("div",{className:"app-shell",children:[x.jsxs("header",{className:"topbar",children:[x.jsxs("div",{className:"topbar-main",children:[x.jsxs("div",{className:"brand",children:[x.jsx("span",{className:"brand-mark",children:"CS"}),x.jsx("div",{className:"brand-text",children:x.jsx("h1",{children:"CertStudio"})}),x.jsx("span",{className:"brand-divider"}),x.jsx("button",{type:"button",className:"menu-button",onClick:()=>{Vn(!ts),Ci(!1),ui(!1),Ln(!1)},children:"Insert"}),x.jsx("button",{type:"button",className:"menu-button",onClick:()=>{Vn(!1),Ci(!ns),ui(!1),Ln(!1)},children:"Layouts"}),x.jsx("button",{type:"button",className:"menu-button",onClick:()=>{Vn(!1),ui(!is),Ci(!1),Ln(!1)},children:"Generate"}),x.jsx("button",{type:"button",className:"menu-button",onClick:()=>{Vn(!1),Ln(!ss),Ci(!1),ui(!1)},children:"Fonts"}),ts&&x.jsx("div",{className:"dropdown-menu",children:x.jsxs("div",{className:"dropdown-content",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Template file"}),x.jsx("span",{className:"label-hint",children:"PDF, JPG, or PNG"}),x.jsx("input",{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:w=>{Os(w),Vn(!1)}})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Signature or image"}),x.jsx("span",{className:"label-hint",children:"Add signature/logo as draggable element"}),x.jsx("input",{type:"file",accept:"image/*",onChange:w=>{Aa(w),Vn(!1)}})]})]})}),is&&x.jsx("div",{className:"dropdown-menu",children:x.jsxs("div",{className:"dropdown-content",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Output mode"}),x.jsxs("select",{value:_t.output_mode,onChange:w=>nn(E=>({...E,output_mode:w.target.value})),children:[x.jsx("option",{value:"full_pdf",children:"Full PDF (with template)"}),x.jsx("option",{value:"overlay_only",children:"Overlay only (for pre-printed sheets)"})]})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Page size"}),x.jsxs("select",{value:_t.page_size,onChange:w=>nn(E=>({...E,page_size:w.target.value})),children:[x.jsx("option",{value:"letter",children:"letter"}),x.jsx("option",{value:"a4",children:"a4"}),x.jsx("option",{value:"legal",children:"legal"})]})]}),x.jsxs("div",{className:"grid-two",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Global X offset (pt)"}),x.jsx("input",{type:"number",value:_t.dx,onChange:w=>nn(E=>({...E,dx:Number(w.target.value)}))})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Global Y offset (pt)"}),x.jsx("input",{type:"number",value:_t.dy,onChange:w=>nn(E=>({...E,dy:Number(w.target.value)}))})]})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Grid step (pt, 0 to hide)"}),x.jsx("input",{type:"number",value:_t.grid_step,onChange:w=>nn(E=>({...E,grid_step:Number(w.target.value)}))})]}),F&&g&&x.jsxs("label",{className:"check-row",children:[x.jsx("input",{type:"checkbox",checked:_t.generate_all,onChange:w=>nn(E=>({...E,generate_all:w.target.checked}))}),x.jsx("span",{children:"Generate for all candidates in CSV"})]}),x.jsxs("div",{className:"button-row",children:[x.jsx("button",{type:"button",onClick:Qn,className:"primary-button",children:"Generate PDF"}),x.jsx("button",{type:"button",onClick:us,disabled:!tn?.url,children:tn?.kind==="zip"?"Download ZIP":"Download PDF"})]})]})}),ns&&x.jsx("div",{className:"dropdown-menu",children:x.jsxs("div",{className:"dropdown-content",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Saved layouts"}),x.jsxs("select",{value:G,onChange:w=>X(w.target.value),children:[x.jsx("option",{value:"",children:"Select layout..."}),H.map(w=>x.jsx("option",{value:w,children:w},w))]})]}),x.jsxs("div",{className:"button-row",children:[x.jsx("button",{type:"button",onClick:Bs,disabled:!G,className:"secondary-button",children:"Load"}),x.jsx("button",{type:"button",onClick:Cr,disabled:!K||U.length===0&&B.length===0,className:"secondary-button",children:"Save"}),x.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Fs(),children:"Refresh"})]}),x.jsx("div",{className:"section-divider"}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Import from file"}),x.jsx("input",{type:"file",accept:".json",onChange:Yn})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Export name"}),x.jsx("input",{value:ie,onChange:w=>de(w.target.value),placeholder:"fields.json"})]}),x.jsx("button",{type:"button",onClick:_a,disabled:!K||U.length===0&&B.length===0,className:"secondary-button",children:"Export to file"})]})}),ss&&x.jsx("div",{className:"dropdown-menu",children:x.jsxs("div",{className:"dropdown-content",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Upload font file (.ttf or .otf)"}),x.jsx("input",{type:"file",accept:".ttf,.otf",onChange:async w=>{const E=w.target.files?.[0];E&&(await va(E),w.target.value="")}})]}),h.length>0?x.jsxs("div",{children:[x.jsxs("div",{className:"label-title",style:{marginTop:"12px",marginBottom:"8px"},children:["Installed fonts (",h.length,")"]}),x.jsx("div",{style:{display:"grid",gap:"6px",maxHeight:"300px",overflowY:"auto"},children:h.map(w=>x.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 8px",background:"var(--panel-soft)",border:"1px solid var(--line)",borderRadius:"var(--radius)",fontSize:"0.75rem"},children:[x.jsxs("div",{style:{flex:1,minWidth:0},children:[x.jsx("div",{style:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:w.name}),x.jsxs("div",{style:{fontSize:"0.688rem",color:"var(--ink-muted)",marginTop:"2px"},children:[w.file,"  ",w.size_kb," KB"]})]}),x.jsx("button",{type:"button",onClick:()=>wa(w.file),style:{marginLeft:"8px",padding:"4px 8px",fontSize:"0.688rem",background:"var(--danger)",color:"white",border:"none",borderRadius:"var(--radius)",cursor:"pointer"},children:"Delete"})]},w.file))})]}):x.jsx("p",{className:"hint",style:{marginTop:"12px"},children:"No custom fonts uploaded yet. Upload .ttf or .otf files to use them in your certificates."}),x.jsxs("div",{style:{marginTop:"12px",padding:"8px",background:"var(--panel-soft)",border:"1px solid var(--line)",borderRadius:"var(--radius)",fontSize:"0.688rem",color:"var(--ink-soft)"},children:[x.jsx("strong",{children:"Tip:"})," Download free fonts from"," ",x.jsx("a",{href:"https://fonts.google.com/",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--accent)"},children:"Google Fonts"})]})]})})]}),x.jsxs("div",{className:"topbar-right",children:[x.jsxs("div",{className:"theme-toggle","aria-label":"Theme",children:[x.jsx("button",{type:"button",className:`theme-pill ${t==="light"?"active":""}`,onClick:()=>s("light"),children:"Light"}),x.jsx("button",{type:"button",className:`theme-pill ${t==="dark"?"active":""}`,onClick:()=>s("dark"),children:"Dark"})]}),x.jsxs("div",{className:"topbar-meta",children:[x.jsx("span",{className:"meta-label",children:"Template"}),x.jsx("span",{className:"meta-value",children:K?.name??"No file loaded"})]})]})]}),x.jsxs("div",{className:"topbar-secondary",children:[x.jsxs("div",{className:"topbar-left-controls",children:[x.jsxs("div",{className:"topbar-group compact",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Page size for images"}),x.jsx("select",{value:Ne,onChange:w=>Qe(w.target.value),children:Object.entries(Ic).map(([w,E])=>x.jsx("option",{value:w,children:E.label},w))})]}),Ne==="custom"&&x.jsxs("div",{className:"custom-size",children:[x.jsxs("label",{children:["Width (pt)",x.jsx("input",{type:"number",value:J.width,onChange:w=>ee(E=>({...E,width:Number(w.target.value)}))})]}),x.jsxs("label",{children:["Height (pt)",x.jsx("input",{type:"number",value:J.height,onChange:w=>ee(E=>({...E,height:Number(w.target.value)}))})]})]})]}),x.jsx("div",{className:"topbar-group compact",children:x.jsxs("label",{className:"slider-label",children:[x.jsx("span",{className:"label-title",children:"Zoom"}),x.jsxs("div",{className:"slider-row",children:[x.jsx("input",{type:"range",min:"0.25",max:"2",step:"0.05",value:r,onChange:w=>o(Number(w.target.value))}),x.jsxs("span",{className:"slider-value",children:[Math.round(r*100),"%"]})]})]})})]}),x.jsxs("div",{className:`topbar-editing-controls ${Z?"":"disabled"}`,onMouseDownCapture:()=>{qo(),Ns.current=!0,window.setTimeout(()=>{Ns.current=!1},0)},children:[x.jsxs("div",{className:"editing-row editing-row-primary",children:[x.jsxs("div",{className:"text-control-item medium",children:[x.jsx("span",{className:"label-title",children:"Field"}),x.jsx("input",{value:Z?.name||"",onChange:w=>Z&&Tt(Z.id,{name:w.target.value}),placeholder:"Select field"})]}),x.jsxs("div",{className:"text-control-item wide font-picker",ref:e,children:[x.jsx("span",{className:"label-title",children:"Font"}),x.jsx("button",{type:"button",className:"font-picker-trigger",onMouseDown:w=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&w.preventDefault()},onClick:()=>{Rn(w=>!w),wn("")},style:{fontFamily:aa(qn).family||qn},title:qn,children:qn}),Ls&&x.jsxs("div",{className:"font-picker-menu",onMouseLeave:()=>wn(""),children:[x.jsx("div",{className:"font-picker-group-title",children:"ReportLab Built-in Fonts"}),rs.builtIn.map(w=>{const E=aa(w.value);return x.jsx("button",{type:"button",className:`font-picker-option ${qn===w.value?"active":""}`,onMouseDown:R=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&R.preventDefault()},onMouseEnter:()=>wn(w.value),onFocus:()=>wn(w.value),onClick:()=>{wn(""),Rn(!1),Ti({command:"fontName",value:w.value,fieldPatch:{font:w.value},requireSelection:!1}),qt(w.value)},title:w.label,style:{fontFamily:E.family||w.value,fontWeight:E.weight||"normal",fontStyle:E.style||"normal"},children:w.label},w.value)}),rs.custom.length>0&&x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"font-picker-group-title",children:"Uploaded Custom Fonts"}),rs.custom.map(w=>x.jsx("button",{type:"button",className:`font-picker-option ${qn===w.name?"active":""}`,onMouseDown:E=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&E.preventDefault()},onMouseEnter:()=>wn(w.name),onFocus:()=>wn(w.name),onClick:()=>{wn(""),Rn(!1),Ti({command:"fontName",value:w.name,fieldPatch:{font:w.name},requireSelection:!1}),qt(w.name)},title:w.name,style:{fontFamily:aa(w.name).family||w.name},children:w.name},w.name))]})]})]}),x.jsxs("div",{className:"text-control-item small size-picker",children:[x.jsx("span",{className:"label-title",children:"Size"}),x.jsxs("div",{className:"compact-inline",children:[x.jsx("input",{type:"number",value:ls,onChange:w=>Z&&Tt(Z.id,{size:Number(w.target.value)}),placeholder:"12"}),x.jsx("button",{type:"button",className:"font-picker-trigger size-trigger",onMouseDown:w=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&w.preventDefault()},onClick:()=>{Zi(w=>!w),Mn(null)},children:""})]}),Is&&x.jsxs("div",{className:"font-picker-menu size-picker-menu",onMouseLeave:()=>Mn(null),children:[x.jsx("div",{className:"font-picker-group-title",children:"Quick Sizes"}),my.map(w=>x.jsxs("button",{type:"button",className:`font-picker-option ${Number(Z?.size)===w?"active":""}`,onMouseDown:E=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&E.preventDefault()},onMouseEnter:()=>Mn(w),onFocus:()=>Mn(w),onClick:()=>{Mn(null),Zi(!1),Z&&Tt(Z.id,{size:w})},children:[w," pt"]},w))]})]}),x.jsxs("div",{className:"text-control-item mini color-picker",children:[x.jsx("span",{className:"label-title",children:"Color"}),x.jsxs("div",{className:"compact-inline",children:[x.jsx("input",{type:"color",value:cs,onChange:w=>Ti({command:"foreColor",value:w.target.value,fieldPatch:{color:Fc(w.target.value)},requireSelection:!0,selectionMessage:"Select text in the field to apply color."}),style:{width:"100%",padding:"2px"}}),x.jsx("button",{type:"button",className:"font-picker-trigger size-trigger",onMouseDown:w=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&w.preventDefault()},onClick:()=>{Ei(w=>!w),Nn("")},style:{background:cs,color:cs.toLowerCase()==="#ffffff"?"#111111":"#ffffff"},title:cs,children:""})]}),Ji&&x.jsxs("div",{className:"font-picker-menu color-picker-menu",onMouseLeave:()=>Nn(""),children:[x.jsx("div",{className:"font-picker-group-title",children:"Quick Colors"}),x.jsx("div",{className:"color-swatch-grid",children:yy.map(w=>x.jsx("button",{type:"button",className:`color-swatch ${cs.toLowerCase()===w.toLowerCase()?"active":""}`,style:{background:w},onMouseDown:E=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&E.preventDefault()},onMouseEnter:()=>Nn(w),onFocus:()=>Nn(w),onClick:()=>{Nn(""),Ei(!1),Ti({command:"foreColor",value:w,fieldPatch:{color:Fc(w)},requireSelection:!0,selectionMessage:"Select text in the field to apply color."})},title:w},w))})]})]})]}),x.jsxs("div",{className:"editing-row editing-row-secondary",children:[x.jsxs("div",{className:"icon-buttons-group",children:[x.jsx("button",{type:"button",className:`icon-button ${Z?.bold?"active":""}`,onMouseDown:w=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&w.preventDefault()},onClick:()=>Xn("bold","bold"),title:Ke?"Bold (select text first)":"Bold",children:"B"}),x.jsx("button",{type:"button",className:`icon-button ${Z?.italic?"active":""}`,onMouseDown:w=>{document.querySelector('.field-box.active .field-preview[contenteditable="true"]')&&w.preventDefault()},onClick:()=>Xn("italic","italic"),title:Ke?"Italic (select text first)":"Italic",style:{fontStyle:"italic"},children:"I"})]}),x.jsxs("div",{className:"text-control-item small compact-select",children:[x.jsx("span",{className:"label-title",children:"Align"}),x.jsxs("select",{value:Z?.align||"left",onChange:w=>Z&&Tt(Z.id,{align:w.target.value}),children:[x.jsx("option",{value:"left",children:"Left"}),x.jsx("option",{value:"center",children:"Center"}),x.jsx("option",{value:"right",children:"Right"})]})]}),x.jsxs("label",{className:"compact-toggle",children:[x.jsx("input",{type:"checkbox",checked:Z?.maxWidth||!1,onChange:w=>Z&&Tt(Z.id,{maxWidth:w.target.checked})}),x.jsx("span",{children:"Fit"})]}),x.jsxs("label",{className:"compact-toggle",children:[x.jsx("input",{type:"checkbox",checked:Z?.wrapText||!1,onChange:w=>Z&&Tt(Z.id,{wrapText:w.target.checked})}),x.jsx("span",{children:"Wrap"})]})]})]})]})]}),vr&&x.jsx("div",{className:"status-bar",children:vr}),x.jsxs("main",{className:"workspace",children:[x.jsx("section",{className:"sidebar sidebar-left",children:x.jsxs("div",{className:`panel ${Re.fields?"":"collapsed"}`,children:[x.jsxs("div",{className:"panel-header",onClick:()=>zt("fields"),children:[x.jsx("h2",{children:"Fields"}),x.jsx("div",{className:"panel-actions",children:x.jsx("button",{type:"button",className:"panel-toggle","data-state":Re.fields?"open":"closed","aria-label":"Toggle fields list",onClick:w=>{ki(w),zt("fields")}})})]}),x.jsx("div",{className:"panel-body",children:x.jsxs("div",{className:"field-list",children:[U.map(w=>x.jsxs("button",{type:"button",className:`field-row ${Y===w.id?"selected":""}`,onClick:()=>{Yt(),Xt(!1),ve(null),M(w.id)},children:[x.jsx("span",{className:"field-row-name",children:w.name}),x.jsx("span",{className:"field-row-meta",children:w.align})]},w.id)),U.length===0&&x.jsx("p",{className:"hint",children:"Drag on the template to create your first field."})]})})]})}),x.jsxs("section",{className:"canvas-panel",children:[!K&&x.jsxs("div",{className:"empty-state",children:[x.jsx("h2",{children:"Start by loading a template"}),x.jsx("p",{children:"Pick a certificate PDF or image above, then drag boxes on this canvas to define each field."})]}),K&&x.jsxs("div",{className:"template-layer",ref:f,style:{width:K.displayWidth,height:K.displayHeight,transform:`scale(${r})`,transformOrigin:"top left"},onMouseDown:bn,onMouseMove:Ue,onMouseUp:Hs,children:[x.jsx("img",{src:K.src,alt:"Template",draggable:!1,className:"template-image"}),U.map(w=>{const E=ht[w.name]??`{${w.name}}`,R=_i[w.name],I=Vi(E),j=R??I,te=F&&!!T[w.name],Te=es?Fc(es):w.color,Ce=(Y===w.id&&wr?Number(wr):Number(w.size))/K.pageHeightPt*K.displayHeight,je=w.maxWidth?vy(E,w.w,Ce):Ce,Se=Y===w.id,st=Se&&Ke&&!te,Le=Se&&li?li:w.font,Ge=aa(Le),nt=Se?Te:w.color;return x.jsxs("div",{className:`field-box ${Se?"active":""}`,style:{left:w.x,top:w.y,width:w.w,height:w.h},onMouseDown:se=>{const Ie=se.target;if(!(Ie instanceof HTMLElement)||!!Ie.closest(".resize-handle"))return;const It=Ie.closest(".field-preview");if(It){if(se.stopPropagation(),Ke&&Y&&Y!==w.id&&Yt(),M(w.id),ve(null),te){Xt(!1),Oe(`"${w.name}" is mapped to CSV column "${T[w.name]}" and is read-only.`);return}Ke&&tt.current.name===w.name||(tt.current={name:w.name,html:j,text:E},wt.current=null),Xt(!0),setTimeout(()=>{It instanceof HTMLElement&&It.focus()},0);return}Sa(se,w.id)},onClick:se=>{se.stopPropagation();const Ie=se.target;Ie instanceof HTMLElement&&!Ie.closest(".field-preview")&&!Ie.closest(".resize-handle")&&(Yt(),M(w.id),ve(null),Xt(!1))},onDoubleClick:se=>{const Ie=se.target;Ie instanceof HTMLElement&&!Ie.closest(".field-preview")&&!Ie.closest(".resize-handle")&&Kn(w)},children:[x.jsx("div",{className:`field-preview align-${w.align}`,contentEditable:st,suppressContentEditableWarning:!0,spellCheck:!1,ref:se=>{if(!se||!st)return;const Ie=tt.current.name===w.name?tt.current.name:null;if(!Ie)return;(se.dataset.editingField!==Ie||!se.innerHTML||se.innerHTML==="<br>")&&(se.innerHTML=tt.current.html??j,se.dataset.editingField=Ie)},style:{fontSize:je,fontFamily:Ge.family||Le,color:py(nt),fontWeight:w.bold?"bold":Ge.weight||"normal",fontStyle:w.italic?"italic":Ge.style||"normal",whiteSpace:w.wrapText?"pre-wrap":"pre",overflowWrap:w.wrapText?"break-word":"normal",wordWrap:w.wrapText?"break-word":"normal",cursor:te?"default":"text"},onInput:se=>{if(st){const Ie=se.currentTarget.innerText,Pt=xo(se.currentTarget.innerHTML);tt.current={name:w.name,html:Pt,text:Ie},jt(It=>({...It,[w.name]:Ie})),Lt(It=>({...It,[w.name]:Pt}))}},onMouseDown:se=>{Se&&Ke&&se.stopPropagation()},onMouseUp:se=>{if(!(Se&&Ke))return;const Ie=window.getSelection();Ie&&!Ie.isCollapsed&&Ie.rangeCount>0&&di(se.currentTarget,Ie)&&(wt.current=Ie.getRangeAt(0).cloneRange())},onKeyUp:se=>{if(!(Se&&Ke))return;const Ie=window.getSelection();Ie&&!Ie.isCollapsed&&Ie.rangeCount>0&&di(se.currentTarget,Ie)&&(wt.current=Ie.getRangeAt(0).cloneRange())},onBlur:se=>{const Ie=se.relatedTarget,Pt=document.activeElement,It=Ie instanceof HTMLElement&&!!Ie.closest(".topbar-editing-controls"),Ft=Pt instanceof HTMLElement&&!!Pt.closest(".topbar-editing-controls");Ns.current||It||Ft||(js(w.name),wt.current=null,Xt(!1))},dangerouslySetInnerHTML:st?void 0:{__html:j},children:null}),x.jsx("span",{className:"resize-handle resize-handle-nw",onMouseDown:se=>Ze(se,w.id,"nw")}),x.jsx("span",{className:"resize-handle resize-handle-n",onMouseDown:se=>Ze(se,w.id,"n")}),x.jsx("span",{className:"resize-handle resize-handle-ne",onMouseDown:se=>Ze(se,w.id,"ne")}),x.jsx("span",{className:"resize-handle resize-handle-e",onMouseDown:se=>Ze(se,w.id,"e")}),x.jsx("span",{className:"resize-handle resize-handle-se",onMouseDown:se=>Ze(se,w.id,"se")}),x.jsx("span",{className:"resize-handle resize-handle-s",onMouseDown:se=>Ze(se,w.id,"s")}),x.jsx("span",{className:"resize-handle resize-handle-sw",onMouseDown:se=>Ze(se,w.id,"sw")}),x.jsx("span",{className:"resize-handle resize-handle-w",onMouseDown:se=>Ze(se,w.id,"w")})]},w.id)}),B.map(w=>{const E=ye===w.id;return x.jsxs("div",{className:`field-box image-box ${E?"active":""}`,style:{left:w.x,top:w.y,width:w.w,height:w.h},onMouseDown:R=>{const I=R.target;I instanceof HTMLElement&&(I.closest(".resize-handle")||Sa(R,w.id,"image"))},onClick:R=>{R.stopPropagation(),Yt(),ve(w.id),M(null),Xt(!1)},children:[x.jsx("img",{src:w.src,alt:w.name||"Layout image",className:"image-preview",draggable:!1}),x.jsx("span",{className:"resize-handle resize-handle-nw",onMouseDown:R=>Ze(R,w.id,"nw","image")}),x.jsx("span",{className:"resize-handle resize-handle-n",onMouseDown:R=>Ze(R,w.id,"n","image")}),x.jsx("span",{className:"resize-handle resize-handle-ne",onMouseDown:R=>Ze(R,w.id,"ne","image")}),x.jsx("span",{className:"resize-handle resize-handle-e",onMouseDown:R=>Ze(R,w.id,"e","image")}),x.jsx("span",{className:"resize-handle resize-handle-se",onMouseDown:R=>Ze(R,w.id,"se","image")}),x.jsx("span",{className:"resize-handle resize-handle-s",onMouseDown:R=>Ze(R,w.id,"s","image")}),x.jsx("span",{className:"resize-handle resize-handle-sw",onMouseDown:R=>Ze(R,w.id,"sw","image")}),x.jsx("span",{className:"resize-handle resize-handle-w",onMouseDown:R=>Ze(R,w.id,"w","image")})]},w.id)}),me&&x.jsx("div",{className:"draft-box",style:{left:me.x,top:me.y,width:me.w,height:me.h}}),xi.map((w,E)=>w.type==="vertical"?x.jsx("div",{className:"alignment-guide-vertical",style:{position:"absolute",left:w.x,top:0,width:1,height:"100%",backgroundColor:"#00ff00",pointerEvents:"none",zIndex:1e3}},`guide-v-${E}`):x.jsx("div",{className:"alignment-guide-horizontal",style:{position:"absolute",left:0,top:w.y,width:"100%",height:1,backgroundColor:"#00ff00",pointerEvents:"none",zIndex:1e3}},`guide-h-${E}`))]})]}),x.jsxs("aside",{className:"sidebar sidebar-right",children:[x.jsxs("div",{className:`panel ${Re.dataSource?"":"collapsed"}`,children:[x.jsxs("div",{className:"panel-header",onClick:()=>zt("dataSource"),children:[x.jsx("h2",{children:"Data source"}),x.jsx("div",{className:"panel-actions",children:x.jsx("button",{type:"button",className:"panel-toggle","data-state":Re.dataSource?"open":"closed","aria-label":"Toggle data source",onClick:w=>{ki(w),zt("dataSource")}})})]}),x.jsxs("div",{className:"panel-body",children:[x.jsxs("label",{className:"check-row",children:[x.jsx("input",{type:"checkbox",checked:F,onChange:w=>z(w.target.checked)}),x.jsx("span",{children:"Use CSV data"})]}),F&&x.jsxs(x.Fragment,{children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Upload CSV file"}),x.jsx("input",{type:"file",accept:".csv",onChange:Vo})]}),g&&v.length>0&&x.jsxs("div",{className:"csv-headers-section",children:[x.jsx("span",{className:"label-title",children:"CSV Headers Found:"}),x.jsx("div",{className:"csv-headers-list",children:v.map((w,E)=>x.jsx("span",{className:"csv-header-chip",children:w},E))}),x.jsx("div",{className:"section-divider"}),x.jsx("span",{className:"label-title",children:"Field Mappings"}),U.length>0?x.jsx("div",{className:"field-mappings",children:U.map(w=>x.jsxs("label",{className:"mapping-row",children:[x.jsx("span",{className:"mapping-field-name",children:w.name}),x.jsxs("select",{value:T[w.name]||"",onChange:E=>Wo(w.name,E.target.value),children:[x.jsx("option",{value:"",children:"-- Use preview value --"}),v.map(E=>x.jsx("option",{value:E,children:E},E))]})]},w.id))}):x.jsx("p",{className:"hint",children:"Create fields first to set up mappings"})]}),g&&v.length===0&&x.jsx("p",{className:"hint",children:"No headers found in CSV file"})]}),!F&&x.jsx("p",{className:"hint",children:"Enable to generate PDFs from CSV rows"})]})]}),Z&&K&&Ye&&x.jsxs("div",{className:`panel ${Re.selectedField?"":"collapsed"}`,children:[x.jsxs("div",{className:"panel-header",onClick:()=>zt("selectedField"),children:[x.jsx("h2",{children:"Selected field"}),x.jsx("div",{className:"panel-actions",children:x.jsx("button",{type:"button",className:"panel-toggle","data-state":Re.selectedField?"open":"closed","aria-label":"Toggle selected field",onClick:w=>{ki(w),zt("selectedField")}})})]}),x.jsxs("div",{className:"panel-body editor",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Preview value"}),x.jsx("textarea",{value:ht[Z.name]??"",disabled:Pi,onChange:w=>{if(Pi)return;const E=w.target.value;jt(R=>({...R,[Z.name]:E})),Lt(R=>{if(!Object.prototype.hasOwnProperty.call(R,Z.name))return R;const I={...R};return delete I[Z.name],I}),tt.current.name===Z.name&&(tt.current={name:Z.name,text:E,html:Vi(E)})},rows:3,placeholder:Pi?"This field is mapped to CSV and is read-only":"Enter preview text (press Enter for new line)"})]}),Pi&&x.jsxs("p",{className:"hint",children:["Mapped to CSV column: ",T[Z.name]]}),x.jsxs("div",{className:"grid-two",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"X (px)"}),x.jsx("input",{type:"number",value:Math.round(Z.x),onChange:w=>Tt(Z.id,{x:Number(w.target.value)})})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Y (px)"}),x.jsx("input",{type:"number",value:Math.round(Z.y),onChange:w=>Tt(Z.id,{y:Number(w.target.value)})})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"W (px)"}),x.jsx("input",{type:"number",value:Math.round(Z.w),onChange:w=>Tt(Z.id,{w:Number(w.target.value)})})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"H (px)"}),x.jsx("input",{type:"number",value:Math.round(Z.h),onChange:w=>Tt(Z.id,{h:Number(w.target.value)})})]})]}),x.jsxs("div",{className:"metrics",children:[x.jsxs("div",{children:["Anchor X (pt):"," ",x.jsx("strong",{children:(Z.align==="left"?Z.x*Ye.x:Z.align==="center"?(Z.x+Z.w/2)*Ye.x:(Z.x+Z.w)*Ye.x).toFixed(2)})]}),x.jsxs("div",{children:["Anchor Y (pt):"," ",x.jsx("strong",{children:((K.displayHeight-Z.y)*Ye.y-Number(Z.size)).toFixed(2)})]}),x.jsxs("div",{children:["max_width (pt): ",x.jsx("strong",{children:(Z.w*Ye.x).toFixed(2)})]})]}),x.jsx("button",{type:"button",className:"danger",onClick:()=>xr(Z.id),children:"Delete field"})]})]}),gt&&K&&Ye&&x.jsxs("div",{className:`panel ${Re.selectedField?"":"collapsed"}`,children:[x.jsx("div",{className:"panel-header",children:x.jsx("h2",{children:"Selected image"})}),x.jsxs("div",{className:"panel-body editor",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Name"}),x.jsx("input",{value:gt.name||"",onChange:w=>An(gt.id,{name:w.target.value})})]}),x.jsxs("div",{className:"grid-two",children:[x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"X (px)"}),x.jsx("input",{type:"number",value:Math.round(gt.x),onChange:w=>An(gt.id,{x:Number(w.target.value)})})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"Y (px)"}),x.jsx("input",{type:"number",value:Math.round(gt.y),onChange:w=>An(gt.id,{y:Number(w.target.value)})})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"W (px)"}),x.jsx("input",{type:"number",value:Math.round(gt.w),onChange:w=>An(gt.id,{w:Number(w.target.value)})})]}),x.jsxs("label",{children:[x.jsx("span",{className:"label-title",children:"H (px)"}),x.jsx("input",{type:"number",value:Math.round(gt.h),onChange:w=>An(gt.id,{h:Number(w.target.value)})})]})]}),x.jsx("button",{type:"button",className:"danger",onClick:()=>Er(gt.id),children:"Delete image"})]})]}),oi&&x.jsxs("div",{className:`panel ${Re.preview?"":"collapsed"}`,children:[x.jsxs("div",{className:"panel-header",onClick:()=>zt("preview"),children:[x.jsx("h2",{children:"Latest preview"}),x.jsxs("div",{className:"panel-actions",children:[x.jsx("button",{type:"button",className:"ghost-button",onClick:w=>{ki(w),oi&&window.open(oi,"_blank","noopener,noreferrer")},children:"Open in tab"}),x.jsx("button",{type:"button",className:"panel-toggle","data-state":Re.preview?"open":"closed","aria-label":"Toggle preview",onClick:w=>{ki(w),zt("preview")}})]})]}),x.jsx("div",{className:"panel-body preview-body",children:x.jsx("iframe",{title:"Certificate preview",src:oi,className:"preview-frame"})})]})]})]})]})}ug.createRoot(document.getElementById("root")).render(x.jsx(ig.StrictMode,{children:x.jsx(Sy,{})}));
